(function(){const Ie=document.createElement("link").relList;if(Ie&&Ie.supports&&Ie.supports("modulepreload"))return;for(const Fe of document.querySelectorAll('link[rel="modulepreload"]'))oe(Fe);new MutationObserver(Fe=>{for(const Xe of Fe)if(Xe.type==="childList")for(const L of Xe.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&oe(L)}).observe(document,{childList:!0,subtree:!0});function Le(Fe){const Xe={};return Fe.integrity&&(Xe.integrity=Fe.integrity),Fe.referrerPolicy&&(Xe.referrerPolicy=Fe.referrerPolicy),Fe.crossOrigin==="use-credentials"?Xe.credentials="include":Fe.crossOrigin==="anonymous"?Xe.credentials="omit":Xe.credentials="same-origin",Xe}function oe(Fe){if(Fe.ep)return;Fe.ep=!0;const Xe=Le(Fe);fetch(Fe.href,Xe)}})();function T_(ce){return ce&&ce.__esModule&&Object.prototype.hasOwnProperty.call(ce,"default")?ce.default:ce}var bg={exports:{}},Up={};var Vg;function S_(){if(Vg)return Up;Vg=1;var ce=Symbol.for("react.transitional.element"),Ie=Symbol.for("react.fragment");function Le(oe,Fe,Xe){var L=null;if(Xe!==void 0&&(L=""+Xe),Fe.key!==void 0&&(L=""+Fe.key),"key"in Fe){Xe={};for(var f in Fe)f!=="key"&&(Xe[f]=Fe[f])}else Xe=Fe;return Fe=Xe.ref,{$$typeof:ce,type:oe,key:L,ref:Fe!==void 0?Fe:null,props:Xe}}return Up.Fragment=Ie,Up.jsx=Le,Up.jsxs=Le,Up}var jg;function M_(){return jg||(jg=1,bg.exports=S_()),bg.exports}var Yr=M_(),wg={exports:{}},Zt={};var Ug;function E_(){if(Ug)return Zt;Ug=1;var ce=Symbol.for("react.transitional.element"),Ie=Symbol.for("react.portal"),Le=Symbol.for("react.fragment"),oe=Symbol.for("react.strict_mode"),Fe=Symbol.for("react.profiler"),Xe=Symbol.for("react.consumer"),L=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),me=Symbol.for("react.suspense"),we=Symbol.for("react.memo"),st=Symbol.for("react.lazy"),it=Symbol.for("react.activity"),St=Symbol.iterator;function Mt(de){return de===null||typeof de!="object"?null:(de=St&&de[St]||de["@@iterator"],typeof de=="function"?de:null)}var Kt={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Et=Object.assign,Ae={};function Ji(de,Qe,ct){this.props=de,this.context=Qe,this.refs=Ae,this.updater=ct||Kt}Ji.prototype.isReactComponent={},Ji.prototype.setState=function(de,Qe){if(typeof de!="object"&&typeof de!="function"&&de!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,de,Qe,"setState")},Ji.prototype.forceUpdate=function(de){this.updater.enqueueForceUpdate(this,de,"forceUpdate")};function ni(){}ni.prototype=Ji.prototype;function Ut(de,Qe,ct){this.props=de,this.context=Qe,this.refs=Ae,this.updater=ct||Kt}var tr=Ut.prototype=new ni;tr.constructor=Ut,Et(tr,Ji.prototype),tr.isPureReactComponent=!0;var yr=Array.isArray;function Un(){}var Lt={H:null,A:null,T:null,S:null},Bn=Object.prototype.hasOwnProperty;function ir(de,Qe,ct){var gt=ct.ref;return{$$typeof:ce,type:de,key:Qe,ref:gt!==void 0?gt:null,props:ct}}function Lr(de,Qe){return ir(de.type,Qe,de.props)}function or(de){return typeof de=="object"&&de!==null&&de.$$typeof===ce}function en(de){var Qe={"=":"=0",":":"=2"};return"$"+de.replace(/[=:]/g,function(ct){return Qe[ct]})}var lr=/\/+/g;function Qr(de,Qe){return typeof de=="object"&&de!==null&&de.key!=null?en(""+de.key):Qe.toString(36)}function nr(de){switch(de.status){case"fulfilled":return de.value;case"rejected":throw de.reason;default:switch(typeof de.status=="string"?de.then(Un,Un):(de.status="pending",de.then(function(Qe){de.status==="pending"&&(de.status="fulfilled",de.value=Qe)},function(Qe){de.status==="pending"&&(de.status="rejected",de.reason=Qe)})),de.status){case"fulfilled":return de.value;case"rejected":throw de.reason}}throw de}function Ue(de,Qe,ct,gt,Tt){var kt=typeof de;(kt==="undefined"||kt==="boolean")&&(de=null);var $t=!1;if(de===null)$t=!0;else switch(kt){case"bigint":case"string":case"number":$t=!0;break;case"object":switch(de.$$typeof){case ce:case Ie:$t=!0;break;case st:return $t=de._init,Ue($t(de._payload),Qe,ct,gt,Tt)}}if($t)return Tt=Tt(de),$t=gt===""?"."+Qr(de,0):gt,yr(Tt)?(ct="",$t!=null&&(ct=$t.replace(lr,"$&/")+"/"),Ue(Tt,Qe,ct,"",function(vr){return vr})):Tt!=null&&(or(Tt)&&(Tt=Lr(Tt,ct+(Tt.key==null||de&&de.key===Tt.key?"":(""+Tt.key).replace(lr,"$&/")+"/")+$t)),Qe.push(Tt)),1;$t=0;var Si=gt===""?".":gt+":";if(yr(de))for(var Ri=0;Ri<de.length;Ri++)gt=de[Ri],kt=Si+Qr(gt,Ri),$t+=Ue(gt,Qe,ct,kt,Tt);else if(Ri=Mt(de),typeof Ri=="function")for(de=Ri.call(de),Ri=0;!(gt=de.next()).done;)gt=gt.value,kt=Si+Qr(gt,Ri++),$t+=Ue(gt,Qe,ct,kt,Tt);else if(kt==="object"){if(typeof de.then=="function")return Ue(nr(de),Qe,ct,gt,Tt);throw Qe=String(de),Error("Objects are not valid as a React child (found: "+(Qe==="[object Object]"?"object with keys {"+Object.keys(de).join(", ")+"}":Qe)+"). If you meant to render a collection of children, use an array instead.")}return $t}function rt(de,Qe,ct){if(de==null)return de;var gt=[],Tt=0;return Ue(de,gt,"","",function(kt){return Qe.call(ct,kt,Tt++)}),gt}function Ct(de){if(de._status===-1){var Qe=de._result;Qe=Qe(),Qe.then(function(ct){(de._status===0||de._status===-1)&&(de._status=1,de._result=ct)},function(ct){(de._status===0||de._status===-1)&&(de._status=2,de._result=ct)}),de._status===-1&&(de._status=0,de._result=Qe)}if(de._status===1)return de._result.default;throw de._result}var wt=typeof reportError=="function"?reportError:function(de){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Qe=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof de=="object"&&de!==null&&typeof de.message=="string"?String(de.message):String(de),error:de});if(!window.dispatchEvent(Qe))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",de);return}console.error(de)},ui={map:rt,forEach:function(de,Qe,ct){rt(de,function(){Qe.apply(this,arguments)},ct)},count:function(de){var Qe=0;return rt(de,function(){Qe++}),Qe},toArray:function(de){return rt(de,function(Qe){return Qe})||[]},only:function(de){if(!or(de))throw Error("React.Children.only expected to receive a single React element child.");return de}};return Zt.Activity=it,Zt.Children=ui,Zt.Component=Ji,Zt.Fragment=Le,Zt.Profiler=Fe,Zt.PureComponent=Ut,Zt.StrictMode=oe,Zt.Suspense=me,Zt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Lt,Zt.__COMPILER_RUNTIME={__proto__:null,c:function(de){return Lt.H.useMemoCache(de)}},Zt.cache=function(de){return function(){return de.apply(null,arguments)}},Zt.cacheSignal=function(){return null},Zt.cloneElement=function(de,Qe,ct){if(de==null)throw Error("The argument must be a React element, but you passed "+de+".");var gt=Et({},de.props),Tt=de.key;if(Qe!=null)for(kt in Qe.key!==void 0&&(Tt=""+Qe.key),Qe)!Bn.call(Qe,kt)||kt==="key"||kt==="__self"||kt==="__source"||kt==="ref"&&Qe.ref===void 0||(gt[kt]=Qe[kt]);var kt=arguments.length-2;if(kt===1)gt.children=ct;else if(1<kt){for(var $t=Array(kt),Si=0;Si<kt;Si++)$t[Si]=arguments[Si+2];gt.children=$t}return ir(de.type,Tt,gt)},Zt.createContext=function(de){return de={$$typeof:L,_currentValue:de,_currentValue2:de,_threadCount:0,Provider:null,Consumer:null},de.Provider=de,de.Consumer={$$typeof:Xe,_context:de},de},Zt.createElement=function(de,Qe,ct){var gt,Tt={},kt=null;if(Qe!=null)for(gt in Qe.key!==void 0&&(kt=""+Qe.key),Qe)Bn.call(Qe,gt)&&gt!=="key"&&gt!=="__self"&&gt!=="__source"&&(Tt[gt]=Qe[gt]);var $t=arguments.length-2;if($t===1)Tt.children=ct;else if(1<$t){for(var Si=Array($t),Ri=0;Ri<$t;Ri++)Si[Ri]=arguments[Ri+2];Tt.children=Si}if(de&&de.defaultProps)for(gt in $t=de.defaultProps,$t)Tt[gt]===void 0&&(Tt[gt]=$t[gt]);return ir(de,kt,Tt)},Zt.createRef=function(){return{current:null}},Zt.forwardRef=function(de){return{$$typeof:f,render:de}},Zt.isValidElement=or,Zt.lazy=function(de){return{$$typeof:st,_payload:{_status:-1,_result:de},_init:Ct}},Zt.memo=function(de,Qe){return{$$typeof:we,type:de,compare:Qe===void 0?null:Qe}},Zt.startTransition=function(de){var Qe=Lt.T,ct={};Lt.T=ct;try{var gt=de(),Tt=Lt.S;Tt!==null&&Tt(ct,gt),typeof gt=="object"&&gt!==null&&typeof gt.then=="function"&&gt.then(Un,wt)}catch(kt){wt(kt)}finally{Qe!==null&&ct.types!==null&&(Qe.types=ct.types),Lt.T=Qe}},Zt.unstable_useCacheRefresh=function(){return Lt.H.useCacheRefresh()},Zt.use=function(de){return Lt.H.use(de)},Zt.useActionState=function(de,Qe,ct){return Lt.H.useActionState(de,Qe,ct)},Zt.useCallback=function(de,Qe){return Lt.H.useCallback(de,Qe)},Zt.useContext=function(de){return Lt.H.useContext(de)},Zt.useDebugValue=function(){},Zt.useDeferredValue=function(de,Qe){return Lt.H.useDeferredValue(de,Qe)},Zt.useEffect=function(de,Qe){return Lt.H.useEffect(de,Qe)},Zt.useEffectEvent=function(de){return Lt.H.useEffectEvent(de)},Zt.useId=function(){return Lt.H.useId()},Zt.useImperativeHandle=function(de,Qe,ct){return Lt.H.useImperativeHandle(de,Qe,ct)},Zt.useInsertionEffect=function(de,Qe){return Lt.H.useInsertionEffect(de,Qe)},Zt.useLayoutEffect=function(de,Qe){return Lt.H.useLayoutEffect(de,Qe)},Zt.useMemo=function(de,Qe){return Lt.H.useMemo(de,Qe)},Zt.useOptimistic=function(de,Qe){return Lt.H.useOptimistic(de,Qe)},Zt.useReducer=function(de,Qe,ct){return Lt.H.useReducer(de,Qe,ct)},Zt.useRef=function(de){return Lt.H.useRef(de)},Zt.useState=function(de){return Lt.H.useState(de)},Zt.useSyncExternalStore=function(de,Qe,ct){return Lt.H.useSyncExternalStore(de,Qe,ct)},Zt.useTransition=function(){return Lt.H.useTransition()},Zt.version="19.2.0",Zt}var Gg;function Cg(){return Gg||(Gg=1,wg.exports=E_()),wg.exports}var er=Cg(),Tg={exports:{}},Gp={},Sg={exports:{}},Mg={};var qg;function A_(){return qg||(qg=1,(function(ce){function Ie(Ue,rt){var Ct=Ue.length;Ue.push(rt);e:for(;0<Ct;){var wt=Ct-1>>>1,ui=Ue[wt];if(0<Fe(ui,rt))Ue[wt]=rt,Ue[Ct]=ui,Ct=wt;else break e}}function Le(Ue){return Ue.length===0?null:Ue[0]}function oe(Ue){if(Ue.length===0)return null;var rt=Ue[0],Ct=Ue.pop();if(Ct!==rt){Ue[0]=Ct;e:for(var wt=0,ui=Ue.length,de=ui>>>1;wt<de;){var Qe=2*(wt+1)-1,ct=Ue[Qe],gt=Qe+1,Tt=Ue[gt];if(0>Fe(ct,Ct))gt<ui&&0>Fe(Tt,ct)?(Ue[wt]=Tt,Ue[gt]=Ct,wt=gt):(Ue[wt]=ct,Ue[Qe]=Ct,wt=Qe);else if(gt<ui&&0>Fe(Tt,Ct))Ue[wt]=Tt,Ue[gt]=Ct,wt=gt;else break e}}return rt}function Fe(Ue,rt){var Ct=Ue.sortIndex-rt.sortIndex;return Ct!==0?Ct:Ue.id-rt.id}if(ce.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var Xe=performance;ce.unstable_now=function(){return Xe.now()}}else{var L=Date,f=L.now();ce.unstable_now=function(){return L.now()-f}}var me=[],we=[],st=1,it=null,St=3,Mt=!1,Kt=!1,Et=!1,Ae=!1,Ji=typeof setTimeout=="function"?setTimeout:null,ni=typeof clearTimeout=="function"?clearTimeout:null,Ut=typeof setImmediate<"u"?setImmediate:null;function tr(Ue){for(var rt=Le(we);rt!==null;){if(rt.callback===null)oe(we);else if(rt.startTime<=Ue)oe(we),rt.sortIndex=rt.expirationTime,Ie(me,rt);else break;rt=Le(we)}}function yr(Ue){if(Et=!1,tr(Ue),!Kt)if(Le(me)!==null)Kt=!0,Un||(Un=!0,en());else{var rt=Le(we);rt!==null&&nr(yr,rt.startTime-Ue)}}var Un=!1,Lt=-1,Bn=5,ir=-1;function Lr(){return Ae?!0:!(ce.unstable_now()-ir<Bn)}function or(){if(Ae=!1,Un){var Ue=ce.unstable_now();ir=Ue;var rt=!0;try{e:{Kt=!1,Et&&(Et=!1,ni(Lt),Lt=-1),Mt=!0;var Ct=St;try{t:{for(tr(Ue),it=Le(me);it!==null&&!(it.expirationTime>Ue&&Lr());){var wt=it.callback;if(typeof wt=="function"){it.callback=null,St=it.priorityLevel;var ui=wt(it.expirationTime<=Ue);if(Ue=ce.unstable_now(),typeof ui=="function"){it.callback=ui,tr(Ue),rt=!0;break t}it===Le(me)&&oe(me),tr(Ue)}else oe(me);it=Le(me)}if(it!==null)rt=!0;else{var de=Le(we);de!==null&&nr(yr,de.startTime-Ue),rt=!1}}break e}finally{it=null,St=Ct,Mt=!1}rt=void 0}}finally{rt?en():Un=!1}}}var en;if(typeof Ut=="function")en=function(){Ut(or)};else if(typeof MessageChannel<"u"){var lr=new MessageChannel,Qr=lr.port2;lr.port1.onmessage=or,en=function(){Qr.postMessage(null)}}else en=function(){Ji(or,0)};function nr(Ue,rt){Lt=Ji(function(){Ue(ce.unstable_now())},rt)}ce.unstable_IdlePriority=5,ce.unstable_ImmediatePriority=1,ce.unstable_LowPriority=4,ce.unstable_NormalPriority=3,ce.unstable_Profiling=null,ce.unstable_UserBlockingPriority=2,ce.unstable_cancelCallback=function(Ue){Ue.callback=null},ce.unstable_forceFrameRate=function(Ue){0>Ue||125<Ue?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Bn=0<Ue?Math.floor(1e3/Ue):5},ce.unstable_getCurrentPriorityLevel=function(){return St},ce.unstable_next=function(Ue){switch(St){case 1:case 2:case 3:var rt=3;break;default:rt=St}var Ct=St;St=rt;try{return Ue()}finally{St=Ct}},ce.unstable_requestPaint=function(){Ae=!0},ce.unstable_runWithPriority=function(Ue,rt){switch(Ue){case 1:case 2:case 3:case 4:case 5:break;default:Ue=3}var Ct=St;St=Ue;try{return rt()}finally{St=Ct}},ce.unstable_scheduleCallback=function(Ue,rt,Ct){var wt=ce.unstable_now();switch(typeof Ct=="object"&&Ct!==null?(Ct=Ct.delay,Ct=typeof Ct=="number"&&0<Ct?wt+Ct:wt):Ct=wt,Ue){case 1:var ui=-1;break;case 2:ui=250;break;case 5:ui=1073741823;break;case 4:ui=1e4;break;default:ui=5e3}return ui=Ct+ui,Ue={id:st++,callback:rt,priorityLevel:Ue,startTime:Ct,expirationTime:ui,sortIndex:-1},Ct>wt?(Ue.sortIndex=Ct,Ie(we,Ue),Le(me)===null&&Ue===Le(we)&&(Et?(ni(Lt),Lt=-1):Et=!0,nr(yr,Ct-wt))):(Ue.sortIndex=ui,Ie(me,Ue),Kt||Mt||(Kt=!0,Un||(Un=!0,en()))),Ue},ce.unstable_shouldYield=Lr,ce.unstable_wrapCallback=function(Ue){var rt=St;return function(){var Ct=St;St=rt;try{return Ue.apply(this,arguments)}finally{St=Ct}}}})(Mg)),Mg}var Zg;function C_(){return Zg||(Zg=1,Sg.exports=A_()),Sg.exports}var Eg={exports:{}},Ca={};var Hg;function z_(){if(Hg)return Ca;Hg=1;var ce=Cg();function Ie(me){var we="https://react.dev/errors/"+me;if(1<arguments.length){we+="?args[]="+encodeURIComponent(arguments[1]);for(var st=2;st<arguments.length;st++)we+="&args[]="+encodeURIComponent(arguments[st])}return"Minified React error #"+me+"; visit "+we+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Le(){}var oe={d:{f:Le,r:function(){throw Error(Ie(522))},D:Le,C:Le,L:Le,m:Le,X:Le,S:Le,M:Le},p:0,findDOMNode:null},Fe=Symbol.for("react.portal");function Xe(me,we,st){var it=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fe,key:it==null?null:""+it,children:me,containerInfo:we,implementation:st}}var L=ce.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(me,we){if(me==="font")return"";if(typeof we=="string")return we==="use-credentials"?we:""}return Ca.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=oe,Ca.createPortal=function(me,we){var st=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!we||we.nodeType!==1&&we.nodeType!==9&&we.nodeType!==11)throw Error(Ie(299));return Xe(me,we,null,st)},Ca.flushSync=function(me){var we=L.T,st=oe.p;try{if(L.T=null,oe.p=2,me)return me()}finally{L.T=we,oe.p=st,oe.d.f()}},Ca.preconnect=function(me,we){typeof me=="string"&&(we?(we=we.crossOrigin,we=typeof we=="string"?we==="use-credentials"?we:"":void 0):we=null,oe.d.C(me,we))},Ca.prefetchDNS=function(me){typeof me=="string"&&oe.d.D(me)},Ca.preinit=function(me,we){if(typeof me=="string"&&we&&typeof we.as=="string"){var st=we.as,it=f(st,we.crossOrigin),St=typeof we.integrity=="string"?we.integrity:void 0,Mt=typeof we.fetchPriority=="string"?we.fetchPriority:void 0;st==="style"?oe.d.S(me,typeof we.precedence=="string"?we.precedence:void 0,{crossOrigin:it,integrity:St,fetchPriority:Mt}):st==="script"&&oe.d.X(me,{crossOrigin:it,integrity:St,fetchPriority:Mt,nonce:typeof we.nonce=="string"?we.nonce:void 0})}},Ca.preinitModule=function(me,we){if(typeof me=="string")if(typeof we=="object"&&we!==null){if(we.as==null||we.as==="script"){var st=f(we.as,we.crossOrigin);oe.d.M(me,{crossOrigin:st,integrity:typeof we.integrity=="string"?we.integrity:void 0,nonce:typeof we.nonce=="string"?we.nonce:void 0})}}else we==null&&oe.d.M(me)},Ca.preload=function(me,we){if(typeof me=="string"&&typeof we=="object"&&we!==null&&typeof we.as=="string"){var st=we.as,it=f(st,we.crossOrigin);oe.d.L(me,st,{crossOrigin:it,integrity:typeof we.integrity=="string"?we.integrity:void 0,nonce:typeof we.nonce=="string"?we.nonce:void 0,type:typeof we.type=="string"?we.type:void 0,fetchPriority:typeof we.fetchPriority=="string"?we.fetchPriority:void 0,referrerPolicy:typeof we.referrerPolicy=="string"?we.referrerPolicy:void 0,imageSrcSet:typeof we.imageSrcSet=="string"?we.imageSrcSet:void 0,imageSizes:typeof we.imageSizes=="string"?we.imageSizes:void 0,media:typeof we.media=="string"?we.media:void 0})}},Ca.preloadModule=function(me,we){if(typeof me=="string")if(we){var st=f(we.as,we.crossOrigin);oe.d.m(me,{as:typeof we.as=="string"&&we.as!=="script"?we.as:void 0,crossOrigin:st,integrity:typeof we.integrity=="string"?we.integrity:void 0})}else oe.d.m(me)},Ca.requestFormReset=function(me){oe.d.r(me)},Ca.unstable_batchedUpdates=function(me,we){return me(we)},Ca.useFormState=function(me,we,st){return L.H.useFormState(me,we,st)},Ca.useFormStatus=function(){return L.H.useHostTransitionStatus()},Ca.version="19.2.0",Ca}var $g;function D_(){if($g)return Eg.exports;$g=1;function ce(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ce)}catch(Ie){console.error(Ie)}}return ce(),Eg.exports=z_(),Eg.exports}var Xg;function P_(){if(Xg)return Gp;Xg=1;var ce=C_(),Ie=Cg(),Le=D_();function oe(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Fe(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Xe(r){var s=r,c=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,(s.flags&4098)!==0&&(c=s.return),r=s.return;while(r)}return s.tag===3?c:null}function L(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function f(r){if(r.tag===31){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function me(r){if(Xe(r)!==r)throw Error(oe(188))}function we(r){var s=r.alternate;if(!s){if(s=Xe(r),s===null)throw Error(oe(188));return s!==r?null:r}for(var c=r,g=s;;){var b=c.return;if(b===null)break;var M=b.alternate;if(M===null){if(g=b.return,g!==null){c=g;continue}break}if(b.child===M.child){for(M=b.child;M;){if(M===c)return me(b),r;if(M===g)return me(b),s;M=M.sibling}throw Error(oe(188))}if(c.return!==g.return)c=b,g=M;else{for(var B=!1,Z=b.child;Z;){if(Z===c){B=!0,c=b,g=M;break}if(Z===g){B=!0,g=b,c=M;break}Z=Z.sibling}if(!B){for(Z=M.child;Z;){if(Z===c){B=!0,c=M,g=b;break}if(Z===g){B=!0,g=M,c=b;break}Z=Z.sibling}if(!B)throw Error(oe(189))}}if(c.alternate!==g)throw Error(oe(190))}if(c.tag!==3)throw Error(oe(188));return c.stateNode.current===c?r:s}function st(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r;for(r=r.child;r!==null;){if(s=st(r),s!==null)return s;r=r.sibling}return null}var it=Object.assign,St=Symbol.for("react.element"),Mt=Symbol.for("react.transitional.element"),Kt=Symbol.for("react.portal"),Et=Symbol.for("react.fragment"),Ae=Symbol.for("react.strict_mode"),Ji=Symbol.for("react.profiler"),ni=Symbol.for("react.consumer"),Ut=Symbol.for("react.context"),tr=Symbol.for("react.forward_ref"),yr=Symbol.for("react.suspense"),Un=Symbol.for("react.suspense_list"),Lt=Symbol.for("react.memo"),Bn=Symbol.for("react.lazy"),ir=Symbol.for("react.activity"),Lr=Symbol.for("react.memo_cache_sentinel"),or=Symbol.iterator;function en(r){return r===null||typeof r!="object"?null:(r=or&&r[or]||r["@@iterator"],typeof r=="function"?r:null)}var lr=Symbol.for("react.client.reference");function Qr(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===lr?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Et:return"Fragment";case Ji:return"Profiler";case Ae:return"StrictMode";case yr:return"Suspense";case Un:return"SuspenseList";case ir:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case Kt:return"Portal";case Ut:return r.displayName||"Context";case ni:return(r._context.displayName||"Context")+".Consumer";case tr:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case Lt:return s=r.displayName||null,s!==null?s:Qr(r.type)||"Memo";case Bn:s=r._payload,r=r._init;try{return Qr(r(s))}catch{}}return null}var nr=Array.isArray,Ue=Ie.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,rt=Le.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ct={pending:!1,data:null,method:null,action:null},wt=[],ui=-1;function de(r){return{current:r}}function Qe(r){0>ui||(r.current=wt[ui],wt[ui]=null,ui--)}function ct(r,s){ui++,wt[ui]=r.current,r.current=s}var gt=de(null),Tt=de(null),kt=de(null),$t=de(null);function Si(r,s){switch(ct(kt,s),ct(Tt,r),ct(gt,null),s.nodeType){case 9:case 11:r=(r=s.documentElement)&&(r=r.namespaceURI)?cf(r):0;break;default:if(r=s.tagName,s=s.namespaceURI)s=cf(s),r=dd(s,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}Qe(gt),ct(gt,r)}function Ri(){Qe(gt),Qe(Tt),Qe(kt)}function vr(r){r.memoizedState!==null&&ct($t,r);var s=gt.current,c=dd(s,r.type);s!==c&&(ct(Tt,r),ct(gt,c))}function Hs(r){Tt.current===r&&(Qe(gt),Qe(Tt)),$t.current===r&&(Qe($t),mf._currentValue=Ct)}var Wr,gl;function Zi(r){if(Wr===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);Wr=s&&s[1]||"",gl=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Wr+r+gl}var Or=!1;function ma(r,s){if(!r||Or)return"";Or=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(s){var We=function(){throw Error()};if(Object.defineProperty(We.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(We,[])}catch(Be){var Re=Be}Reflect.construct(r,[],We)}else{try{We.call()}catch(Be){Re=Be}r.call(We.prototype)}}else{try{throw Error()}catch(Be){Re=Be}(We=r())&&typeof We.catch=="function"&&We.catch(function(){})}}catch(Be){if(Be&&Re&&typeof Be.stack=="string")return[Be.stack,Re.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var M=g.DetermineComponentFrameRoot(),B=M[0],Z=M[1];if(B&&Z){var ue=B.split(`
`),Pe=Z.split(`
`);for(b=g=0;g<ue.length&&!ue[g].includes("DetermineComponentFrameRoot");)g++;for(;b<Pe.length&&!Pe[b].includes("DetermineComponentFrameRoot");)b++;if(g===ue.length||b===Pe.length)for(g=ue.length-1,b=Pe.length-1;1<=g&&0<=b&&ue[g]!==Pe[b];)b--;for(;1<=g&&0<=b;g--,b--)if(ue[g]!==Pe[b]){if(g!==1||b!==1)do if(g--,b--,0>b||ue[g]!==Pe[b]){var Ge=`
`+ue[g].replace(" at new "," at ");return r.displayName&&Ge.includes("<anonymous>")&&(Ge=Ge.replace("<anonymous>",r.displayName)),Ge}while(1<=g&&0<=b);break}}}finally{Or=!1,Error.prepareStackTrace=c}return(c=r?r.displayName||r.name:"")?Zi(c):""}function tn(r,s){switch(r.tag){case 26:case 27:case 5:return Zi(r.type);case 16:return Zi("Lazy");case 13:return r.child!==s&&s!==null?Zi("Suspense Fallback"):Zi("Suspense");case 19:return Zi("SuspenseList");case 0:case 15:return ma(r.type,!1);case 11:return ma(r.type.render,!1);case 1:return ma(r.type,!0);case 31:return Zi("Activity");default:return""}}function _s(r){try{var s="",c=null;do s+=tn(r,c),c=r,r=r.return;while(r);return s}catch(g){return`
Error generating stack: `+g.message+`
`+g.stack}}var ys=Object.prototype.hasOwnProperty,$s=ce.unstable_scheduleCallback,$a=ce.unstable_cancelCallback,Da=ce.unstable_shouldYield,_l=ce.unstable_requestPaint,Gn=ce.unstable_now,Br=ce.unstable_getCurrentPriorityLevel,ye=ce.unstable_ImmediatePriority,j=ce.unstable_UserBlockingPriority,V=ce.unstable_NormalPriority,H=ce.unstable_LowPriority,ae=ce.unstable_IdlePriority,le=ce.log,Te=ce.unstable_setDisableYieldValue,ge=null,he=null;function Se(r){if(typeof le=="function"&&Te(r),he&&typeof he.setStrictMode=="function")try{he.setStrictMode(ge,r)}catch{}}var Ve=Math.clz32?Math.clz32:mt,je=Math.log,lt=Math.LN2;function mt(r){return r>>>=0,r===0?32:31-(je(r)/lt|0)|0}var zt=256,ci=262144,Jt=4194304;function ve(r){var s=r&42;if(s!==0)return s;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function pi(r,s,c){var g=r.pendingLanes;if(g===0)return 0;var b=0,M=r.suspendedLanes,B=r.pingedLanes;r=r.warmLanes;var Z=g&134217727;return Z!==0?(g=Z&~M,g!==0?b=ve(g):(B&=Z,B!==0?b=ve(B):c||(c=Z&~r,c!==0&&(b=ve(c))))):(Z=g&~M,Z!==0?b=ve(Z):B!==0?b=ve(B):c||(c=g&~r,c!==0&&(b=ve(c)))),b===0?0:s!==0&&s!==b&&(s&M)===0&&(M=b&-b,c=s&-s,M>=c||M===32&&(c&4194048)!==0)?s:b}function _n(r,s){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&s)===0}function It(r,s){switch(r){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mi(){var r=Jt;return Jt<<=1,(Jt&62914560)===0&&(Jt=4194304),r}function kn(r){for(var s=[],c=0;31>c;c++)s.push(r);return s}function gi(r,s){r.pendingLanes|=s,s!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function hn(r,s,c,g,b,M){var B=r.pendingLanes;r.pendingLanes=c,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=c,r.entangledLanes&=c,r.errorRecoveryDisabledLanes&=c,r.shellSuspendCounter=0;var Z=r.entanglements,ue=r.expirationTimes,Pe=r.hiddenUpdates;for(c=B&~c;0<c;){var Ge=31-Ve(c),We=1<<Ge;Z[Ge]=0,ue[Ge]=-1;var Re=Pe[Ge];if(Re!==null)for(Pe[Ge]=null,Ge=0;Ge<Re.length;Ge++){var Be=Re[Ge];Be!==null&&(Be.lane&=-536870913)}c&=~We}g!==0&&Mi(r,g,0),M!==0&&b===0&&r.tag!==0&&(r.suspendedLanes|=M&~(B&~s))}function Mi(r,s,c){r.pendingLanes|=s,r.suspendedLanes&=~s;var g=31-Ve(s);r.entangledLanes|=s,r.entanglements[g]=r.entanglements[g]|1073741824|c&261930}function yn(r,s){var c=r.entangledLanes|=s;for(r=r.entanglements;c;){var g=31-Ve(c),b=1<<g;b&s|r[g]&s&&(r[g]|=s),c&=~b}}function yl(r,s){var c=s&-s;return c=(c&42)!==0?1:Eo(c),(c&(r.suspendedLanes|s))!==0?0:c}function Eo(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Ke(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function ur(){var r=rt.p;return r!==0?r:(r=window.event,r===void 0?32:Om(r.type))}function cr(r,s){var c=rt.p;try{return rt.p=r,s()}finally{rt.p=c}}var Pa=Math.random().toString(36).slice(2),Ii="__reactFiber$"+Pa,et="__reactProps$"+Pa,Ot="__reactContainer$"+Pa,Nt="__reactEvents$"+Pa,Kr="__reactListeners$"+Pa,lc="__reactHandles$"+Pa,Xa="__reactResources$"+Pa,Rt="__reactMarker$"+Pa;function Ao(r){delete r[Ii],delete r[et],delete r[Nt],delete r[Kr],delete r[lc]}function Ya(r){var s=r[Ii];if(s)return s;for(var c=r.parentNode;c;){if(s=c[Ot]||c[Ii]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(r=tc(r);r!==null;){if(c=r[Ii])return c;r=tc(r)}return s}r=c,c=r.parentNode}return null}function vs(r){if(r=r[Ii]||r[Ot]){var s=r.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return r}return null}function Qa(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r.stateNode;throw Error(oe(33))}function Wa(r){var s=r[Xa];return s||(s=r[Xa]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function nn(r){r[Rt]=!0}var vl=new Set,hr={};function ei(r,s){xs(r,s),xs(r+"Capture",s)}function xs(r,s){for(hr[r]=s,r=0;r<s.length;r++)vl.add(s[r])}var xl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),bl={},Xs={};function Ia(r){return ys.call(Xs,r)?!0:ys.call(bl,r)?!1:xl.test(r)?Xs[r]=!0:(bl[r]=!0,!1)}function lu(r,s,c){if(Ia(s))if(c===null)r.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":r.removeAttribute(s);return;case"boolean":var g=s.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){r.removeAttribute(s);return}}r.setAttribute(s,""+c)}}function Ka(r,s,c){if(c===null)r.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(s);return}r.setAttribute(s,""+c)}}function ga(r,s,c,g){if(g===null)r.removeAttribute(c);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(c);return}r.setAttributeNS(s,c,""+g)}}function ai(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function dh(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Tf(r,s,c){var g=Object.getOwnPropertyDescriptor(r.constructor.prototype,s);if(!r.hasOwnProperty(s)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var b=g.get,M=g.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return b.call(this)},set:function(B){c=""+B,M.call(this,B)}}),Object.defineProperty(r,s,{enumerable:g.enumerable}),{getValue:function(){return c},setValue:function(B){c=""+B},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function Co(r){if(!r._valueTracker){var s=dh(r)?"checked":"value";r._valueTracker=Tf(r,s,""+r[s])}}function ph(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var c=s.getValue(),g="";return r&&(g=dh(r)?r.checked?"true":"false":r.value),r=g,r!==c?(s.setValue(r),!0):!1}function uu(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Sf=/[\n"\\]/g;function xr(r){return r.replace(Sf,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function cu(r,s,c,g,b,M,B,Z){r.name="",B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?r.type=B:r.removeAttribute("type"),s!=null?B==="number"?(s===0&&r.value===""||r.value!=s)&&(r.value=""+ai(s)):r.value!==""+ai(s)&&(r.value=""+ai(s)):B!=="submit"&&B!=="reset"||r.removeAttribute("value"),s!=null?hu(r,B,ai(s)):c!=null?hu(r,B,ai(c)):g!=null&&r.removeAttribute("value"),b==null&&M!=null&&(r.defaultChecked=!!M),b!=null&&(r.checked=b&&typeof b!="function"&&typeof b!="symbol"),Z!=null&&typeof Z!="function"&&typeof Z!="symbol"&&typeof Z!="boolean"?r.name=""+ai(Z):r.removeAttribute("name")}function uc(r,s,c,g,b,M,B,Z){if(M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(r.type=M),s!=null||c!=null){if(!(M!=="submit"&&M!=="reset"||s!=null)){Co(r);return}c=c!=null?""+ai(c):"",s=s!=null?""+ai(s):c,Z||s===r.value||(r.value=s),r.defaultValue=s}g=g??b,g=typeof g!="function"&&typeof g!="symbol"&&!!g,r.checked=Z?r.checked:!!g,r.defaultChecked=!!g,B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"&&(r.name=B),Co(r)}function hu(r,s,c){s==="number"&&uu(r.ownerDocument)===r||r.defaultValue===""+c||(r.defaultValue=""+c)}function Ys(r,s,c,g){if(r=r.options,s){s={};for(var b=0;b<c.length;b++)s["$"+c[b]]=!0;for(c=0;c<r.length;c++)b=s.hasOwnProperty("$"+r[c].value),r[c].selected!==b&&(r[c].selected=b),b&&g&&(r[c].defaultSelected=!0)}else{for(c=""+ai(c),s=null,b=0;b<r.length;b++){if(r[b].value===c){r[b].selected=!0,g&&(r[b].defaultSelected=!0);return}s!==null||r[b].disabled||(s=r[b])}s!==null&&(s.selected=!0)}}function Mf(r,s,c){if(s!=null&&(s=""+ai(s),s!==r.value&&(r.value=s),c==null)){r.defaultValue!==s&&(r.defaultValue=s);return}r.defaultValue=c!=null?""+ai(c):""}function wl(r,s,c,g){if(s==null){if(g!=null){if(c!=null)throw Error(oe(92));if(nr(g)){if(1<g.length)throw Error(oe(93));g=g[0]}c=g}c==null&&(c=""),s=c}c=ai(s),r.defaultValue=c,g=r.textContent,g===c&&g!==""&&g!==null&&(r.value=g),Co(r)}function bs(r,s){if(s){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=s;return}}r.textContent=s}var Ef=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function zo(r,s,c){var g=s.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?g?r.setProperty(s,""):s==="float"?r.cssFloat="":r[s]="":g?r.setProperty(s,c):typeof c!="number"||c===0||Ef.has(s)?s==="float"?r.cssFloat=c:r[s]=(""+c).trim():r[s]=c+"px"}function cc(r,s,c){if(s!=null&&typeof s!="object")throw Error(oe(62));if(r=r.style,c!=null){for(var g in c)!c.hasOwnProperty(g)||s!=null&&s.hasOwnProperty(g)||(g.indexOf("--")===0?r.setProperty(g,""):g==="float"?r.cssFloat="":r[g]="");for(var b in s)g=s[b],s.hasOwnProperty(b)&&c[b]!==g&&zo(r,b,g)}else for(var M in s)s.hasOwnProperty(M)&&zo(r,M,s[M])}function Do(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Qs=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Tl=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ft(r){return Tl.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Ra(){}var mh=null;function fu(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Fn=null,vn=null;function ki(r){var s=vs(r);if(s&&(r=s.stateNode)){var c=r[et]||null;e:switch(r=s.stateNode,s.type){case"input":if(cu(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),s=c.name,c.type==="radio"&&s!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+xr(""+s)+'"][type="radio"]'),s=0;s<c.length;s++){var g=c[s];if(g!==r&&g.form===r.form){var b=g[et]||null;if(!b)throw Error(oe(90));cu(g,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(s=0;s<c.length;s++)g=c[s],g.form===r.form&&ph(g)}break e;case"textarea":Mf(r,c.value,c.defaultValue);break e;case"select":s=c.value,s!=null&&Ys(r,!!c.multiple,s,!1)}}}var At=!1;function Ei(r,s,c){if(At)return r(s,c);At=!0;try{var g=r(s);return g}finally{if(At=!1,(Fn!==null||vn!==null)&&(Kh(),Fn&&(s=Fn,r=vn,vn=Fn=null,ki(s),r)))for(s=0;s<r.length;s++)ki(r[s])}}function _a(r,s){var c=r.stateNode;if(c===null)return null;var g=c[et]||null;if(g===null)return null;c=g[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(r=r.type,g=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!g;break e;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(oe(231,s,typeof c));return c}var rn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),br=!1;if(rn)try{var Nn={};Object.defineProperty(Nn,"passive",{get:function(){br=!0}}),window.addEventListener("test",Nn,Nn),window.removeEventListener("test",Nn,Nn)}catch{br=!1}var Jr=null,Ja=null,Fi=null;function Ws(){if(Fi)return Fi;var r,s=Ja,c=s.length,g,b="value"in Jr?Jr.value:Jr.textContent,M=b.length;for(r=0;r<c&&s[r]===b[r];r++);var B=c-r;for(g=1;g<=B&&s[c-g]===b[M-g];g++);return Fi=b.slice(r,1<g?1-g:void 0)}function ea(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function Po(){return!0}function wr(){return!1}function Sn(r){function s(c,g,b,M,B){this._reactName=c,this._targetInst=b,this.type=g,this.nativeEvent=M,this.target=B,this.currentTarget=null;for(var Z in r)r.hasOwnProperty(Z)&&(c=r[Z],this[Z]=c?c(M):M[Z]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?Po:wr,this.isPropagationStopped=wr,this}return it(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Po)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Po)},persist:function(){},isPersistent:Po}),s}var Tr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},du=Sn(Tr),Io=it({},Tr,{view:0,detail:0}),Ro=Sn(Io),_i,Ks,jt,Bt=it({},Io,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gu,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==jt&&(jt&&r.type==="mousemove"?(_i=r.screenX-jt.screenX,Ks=r.screenY-jt.screenY):Ks=_i=0,jt=r),_i)},movementY:function(r){return"movementY"in r?r.movementY:Ks}}),Lo=Sn(Bt),ti=it({},Bt,{dataTransfer:0}),pu=Sn(ti),ya=it({},Io,{relatedTarget:0}),Js=Sn(ya),eo=it({},Tr,{animationName:0,elapsedTime:0,pseudoElement:0}),Af=Sn(eo),mu=it({},Tr,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),gh=Sn(mu),Od=it({},Tr,{data:0}),_h=Sn(Od),Sr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},es={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ni={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Oo(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=Ni[r])?!!s[r]:!1}function gu(){return Oo}var _u=it({},Io,{key:function(r){if(r.key){var s=Sr[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=ea(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?es[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gu,charCode:function(r){return r.type==="keypress"?ea(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?ea(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),an=Sn(_u),Cf=it({},Bt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hc=Sn(Cf),zf=it({},Io,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gu}),Bd=Sn(zf),Sl=it({},Tr,{propertyName:0,elapsedTime:0,pseudoElement:0}),fc=Sn(Sl),Ml=it({},Bt,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),yh=Sn(Ml),yu=it({},Tr,{newState:0,oldState:0}),El=Sn(yu),Al=[9,13,27,32],fn=rn&&"CompositionEvent"in window,Cl=null;rn&&"documentMode"in document&&(Cl=document.documentMode);var zl=rn&&"TextEvent"in window&&!Cl,Dl=rn&&(!fn||Cl&&8<Cl&&11>=Cl),to=" ",Df=!1;function vu(r,s){switch(r){case"keyup":return Al.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Pf(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var La=!1;function dc(r,s){switch(r){case"compositionend":return Pf(s);case"keypress":return s.which!==32?null:(Df=!0,to);case"textInput":return r=s.data,r===to&&Df?null:r;default:return null}}function If(r,s){if(La)return r==="compositionend"||!fn&&vu(r,s)?(r=Ws(),Fi=Ja=Jr=null,La=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Dl&&s.locale!=="ko"?null:s.data;default:return null}}var Rf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pc(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!Rf[r.type]:s==="textarea"}function mc(r,s,c,g){Fn?vn?vn.push(g):vn=[g]:Fn=g,s=sf(s,"onChange"),0<s.length&&(c=new du("onChange","change",null,c,g),r.push({event:c,listeners:s}))}var Bo=null,Pl=null;function Lf(r){_m(r,0)}function xu(r){var s=Qa(r);if(ph(s))return r}function io(r,s){if(r==="change")return s}var vh=!1;if(rn){var bu;if(rn){var no="oninput"in document;if(!no){var xh=document.createElement("div");xh.setAttribute("oninput","return;"),no=typeof xh.oninput=="function"}bu=no}else bu=!1;vh=bu&&(!document.documentMode||9<document.documentMode)}function wu(){Bo&&(Bo.detachEvent("onpropertychange",Of),Pl=Bo=null)}function Of(r){if(r.propertyName==="value"&&xu(Pl)){var s=[];mc(s,Pl,r,fu(r)),Ei(Lf,s)}}function kd(r,s,c){r==="focusin"?(wu(),Bo=s,Pl=c,Bo.attachEvent("onpropertychange",Of)):r==="focusout"&&wu()}function Bf(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return xu(Pl)}function Tu(r,s){if(r==="click")return xu(s)}function kf(r,s){if(r==="input"||r==="change")return xu(s)}function bh(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var kr=typeof Object.is=="function"?Object.is:bh;function ro(r,s){if(kr(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var c=Object.keys(r),g=Object.keys(s);if(c.length!==g.length)return!1;for(g=0;g<c.length;g++){var b=c[g];if(!ys.call(s,b)||!kr(r[b],s[b]))return!1}return!0}function va(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Su(r,s){var c=va(r);r=0;for(var g;c;){if(c.nodeType===3){if(g=r+c.textContent.length,r<=s&&g>=s)return{node:c,offset:s-r};r=g}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=va(c)}}function gc(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?gc(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function _c(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var s=uu(r.document);s instanceof r.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)r=s.contentWindow;else break;s=uu(r.document)}return s}function Mu(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}var yc=rn&&"documentMode"in document&&11>=document.documentMode,xa=null,Eu=null,Au=null,vc=!1;function Ff(r,s,c){var g=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;vc||xa==null||xa!==uu(g)||(g=xa,"selectionStart"in g&&Mu(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),Au&&ro(Au,g)||(Au=g,g=sf(Eu,"onSelect"),0<g.length&&(s=new du("onSelect","select",null,s,c),r.push({event:s,listeners:g}),s.target=xa)))}function ko(r,s){var c={};return c[r.toLowerCase()]=s.toLowerCase(),c["Webkit"+r]="webkit"+s,c["Moz"+r]="moz"+s,c}var Fo={animationend:ko("Animation","AnimationEnd"),animationiteration:ko("Animation","AnimationIteration"),animationstart:ko("Animation","AnimationStart"),transitionrun:ko("Transition","TransitionRun"),transitionstart:ko("Transition","TransitionStart"),transitioncancel:ko("Transition","TransitionCancel"),transitionend:ko("Transition","TransitionEnd")},wh={},si={};rn&&(si=document.createElement("div").style,"AnimationEvent"in window||(delete Fo.animationend.animation,delete Fo.animationiteration.animation,delete Fo.animationstart.animation),"TransitionEvent"in window||delete Fo.transitionend.transition);function ts(r){if(wh[r])return wh[r];if(!Fo[r])return r;var s=Fo[r],c;for(c in s)if(s.hasOwnProperty(c)&&c in si)return wh[r]=s[c];return r}var Cu=ts("animationend"),zu=ts("animationiteration"),xc=ts("animationstart"),No=ts("transitionrun"),Du=ts("transitionstart"),Il=ts("transitioncancel"),ta=ts("transitionend"),Th=new Map,bc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");bc.push("scrollEnd");function ia(r,s){Th.set(r,s),ei(s,[r])}var is=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},Mr=[],ws=0,Vo=0;function jo(){for(var r=ws,s=Vo=ws=0;s<r;){var c=Mr[s];Mr[s++]=null;var g=Mr[s];Mr[s++]=null;var b=Mr[s];Mr[s++]=null;var M=Mr[s];if(Mr[s++]=null,g!==null&&b!==null){var B=g.pending;B===null?b.next=b:(b.next=B.next,B.next=b),g.pending=b}M!==0&&Sh(c,b,M)}}function Pu(r,s,c,g){Mr[ws++]=r,Mr[ws++]=s,Mr[ws++]=c,Mr[ws++]=g,Vo|=g,r.lanes|=g,r=r.alternate,r!==null&&(r.lanes|=g)}function ao(r,s,c,g){return Pu(r,s,c,g),Rl(r)}function ba(r,s){return Pu(r,null,null,s),Rl(r)}function Sh(r,s,c){r.lanes|=c;var g=r.alternate;g!==null&&(g.lanes|=c);for(var b=!1,M=r.return;M!==null;)M.childLanes|=c,g=M.alternate,g!==null&&(g.childLanes|=c),M.tag===22&&(r=M.stateNode,r===null||r._visibility&1||(b=!0)),r=M,M=M.return;return r.tag===3?(M=r.stateNode,b&&s!==null&&(b=31-Ve(c),r=M.hiddenUpdates,g=r[b],g===null?r[b]=[s]:g.push(s),s.lane=c|536870912),M):null}function Rl(r){if(50<Wh)throw Wh=0,up=null,Error(oe(185));for(var s=r.return;s!==null;)r=s,s=r.return;return r.tag===3?r.stateNode:null}var Vt={};function wc(r,s,c,g){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function na(r,s,c,g){return new wc(r,s,c,g)}function Tc(r){return r=r.prototype,!(!r||!r.isReactComponent)}function ra(r,s){var c=r.alternate;return c===null?(c=na(r.tag,s,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=s,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&65011712,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,s=r.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c.refCleanup=r.refCleanup,c}function Nf(r,s){r.flags&=65011714;var c=r.alternate;return c===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=c.childLanes,r.lanes=c.lanes,r.child=c.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=c.memoizedProps,r.memoizedState=c.memoizedState,r.updateQueue=c.updateQueue,r.type=c.type,s=c.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),r}function Sc(r,s,c,g,b,M){var B=0;if(g=r,typeof r=="function")Tc(r)&&(B=1);else if(typeof r=="string")B=Cp(r,c,gt.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case ir:return r=na(31,c,s,b),r.elementType=ir,r.lanes=M,r;case Et:return so(c.children,b,M,s);case Ae:B=8,b|=24;break;case Ji:return r=na(12,c,s,b|2),r.elementType=Ji,r.lanes=M,r;case yr:return r=na(13,c,s,b),r.elementType=yr,r.lanes=M,r;case Un:return r=na(19,c,s,b),r.elementType=Un,r.lanes=M,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case Ut:B=10;break e;case ni:B=9;break e;case tr:B=11;break e;case Lt:B=14;break e;case Bn:B=16,g=null;break e}B=29,c=Error(oe(130,r===null?"null":typeof r,"")),g=null}return s=na(B,c,s,b),s.elementType=r,s.type=g,s.lanes=M,s}function so(r,s,c,g){return r=na(7,r,g,s),r.lanes=c,r}function Mh(r,s,c){return r=na(6,r,null,s),r.lanes=c,r}function Mc(r){var s=na(18,null,null,0);return s.stateNode=r,s}function oo(r,s,c){return s=na(4,r.children!==null?r.children:[],r.key,s),s.lanes=c,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}var Iu=new WeakMap;function Er(r,s){if(typeof r=="object"&&r!==null){var c=Iu.get(r);return c!==void 0?c:(s={value:r,source:s,stack:_s(s)},Iu.set(r,s),s)}return{value:r,source:s,stack:_s(s)}}var lo=[],uo=0,Uo=null,co=0,qn=[],Zn=0,ns=null,rs=1,Fr="";function Ts(r,s){lo[uo++]=co,lo[uo++]=Uo,Uo=r,co=s}function Eh(r,s,c){qn[Zn++]=rs,qn[Zn++]=Fr,qn[Zn++]=ns,ns=r;var g=rs;r=Fr;var b=32-Ve(g)-1;g&=~(1<<b),c+=1;var M=32-Ve(s)+b;if(30<M){var B=b-b%5;M=(g&(1<<B)-1).toString(32),g>>=B,b-=B,rs=1<<32-Ve(s)+b|c<<b|g,Fr=M+r}else rs=1<<M|c<<b|g,Fr=r}function Go(r){r.return!==null&&(Ts(r,1),Eh(r,1,0))}function Ll(r){for(;r===Uo;)Uo=lo[--uo],lo[uo]=null,co=lo[--uo],lo[uo]=null;for(;r===ns;)ns=qn[--Zn],qn[Zn]=null,Fr=qn[--Zn],qn[Zn]=null,rs=qn[--Zn],qn[Zn]=null}function Ah(r,s){qn[Zn++]=rs,qn[Zn++]=Fr,qn[Zn++]=ns,rs=s.id,Fr=s.overflow,ns=r}var Hn=null,Ai=null,Xt=!1,Ss=null,aa=!1,Hi=Error(oe(519));function Nr(r){var s=Error(oe(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ms(Er(s,r)),Hi}function sa(r){var s=r.stateNode,c=r.type,g=r.memoizedProps;switch(s[Ii]=r,s[et]=g,c){case"dialog":ri("cancel",s),ri("close",s);break;case"iframe":case"object":case"embed":ri("load",s);break;case"video":case"audio":for(c=0;c<rf.length;c++)ri(rf[c],s);break;case"source":ri("error",s);break;case"img":case"image":case"link":ri("error",s),ri("load",s);break;case"details":ri("toggle",s);break;case"input":ri("invalid",s),uc(s,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0);break;case"select":ri("invalid",s);break;case"textarea":ri("invalid",s),wl(s,g.value,g.defaultValue,g.children)}c=g.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||s.textContent===""+c||g.suppressHydrationWarning===!0||cd(s.textContent,c)?(g.popover!=null&&(ri("beforetoggle",s),ri("toggle",s)),g.onScroll!=null&&ri("scroll",s),g.onScrollEnd!=null&&ri("scrollend",s),g.onClick!=null&&(s.onclick=Ra),s=!0):s=!1,s||Nr(r,!0)}function Ru(r){for(Hn=r.return;Hn;)switch(Hn.tag){case 5:case 31:case 13:aa=!1;return;case 27:case 3:aa=!0;return;default:Hn=Hn.return}}function as(r){if(r!==Hn)return!1;if(!Xt)return Ru(r),Xt=!0,!1;var s=r.tag,c;if((c=s!==3&&s!==27)&&((c=s===5)&&(c=r.type,c=!(c!=="form"&&c!=="button")||hf(r.type,r.memoizedProps)),c=!c),c&&Ai&&Nr(r),Ru(r),s===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(oe(317));Ai=tu(r)}else if(s===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(oe(317));Ai=tu(r)}else s===27?(s=Ai,ln(r.type)?(r=_d,_d=null,Ai=r):Ai=s):Ai=Hn?gs(r.stateNode.nextSibling):null;return!0}function ss(){Ai=Hn=null,Xt=!1}function os(){var r=Ss;return r!==null&&(Ea===null?Ea=r:Ea.push.apply(Ea,r),Ss=null),r}function Ms(r){Ss===null?Ss=[r]:Ss.push(r)}var Es=de(null),wa=null,ls=null;function As(r,s,c){ct(Es,s._currentValue),s._currentValue=c}function us(r){r._currentValue=Es.current,Qe(Es)}function Ec(r,s,c){for(;r!==null;){var g=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,g!==null&&(g.childLanes|=s)):g!==null&&(g.childLanes&s)!==s&&(g.childLanes|=s),r===c)break;r=r.return}}function Ac(r,s,c,g){var b=r.child;for(b!==null&&(b.return=r);b!==null;){var M=b.dependencies;if(M!==null){var B=b.child;M=M.firstContext;e:for(;M!==null;){var Z=M;M=b;for(var ue=0;ue<s.length;ue++)if(Z.context===s[ue]){M.lanes|=c,Z=M.alternate,Z!==null&&(Z.lanes|=c),Ec(M.return,c,r),g||(B=null);break e}M=Z.next}}else if(b.tag===18){if(B=b.return,B===null)throw Error(oe(341));B.lanes|=c,M=B.alternate,M!==null&&(M.lanes|=c),Ec(B,c,r),B=null}else B=b.child;if(B!==null)B.return=b;else for(B=b;B!==null;){if(B===r){B=null;break}if(b=B.sibling,b!==null){b.return=B.return,B=b;break}B=B.return}b=B}}function Ta(r,s,c,g){r=null;for(var b=s,M=!1;b!==null;){if(!M){if((b.flags&524288)!==0)M=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var B=b.alternate;if(B===null)throw Error(oe(387));if(B=B.memoizedProps,B!==null){var Z=b.type;kr(b.pendingProps.value,B.value)||(r!==null?r.push(Z):r=[Z])}}else if(b===$t.current){if(B=b.alternate,B===null)throw Error(oe(387));B.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(r!==null?r.push(mf):r=[mf])}b=b.return}r!==null&&Ac(s,r,c,g),s.flags|=262144}function Ol(r){for(r=r.firstContext;r!==null;){if(!kr(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Cs(r){wa=r,ls=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function xn(r){return Cc(wa,r)}function Lu(r,s){return wa===null&&Cs(r),Cc(r,s)}function Cc(r,s){var c=s._currentValue;if(s={context:s,memoizedValue:c,next:null},ls===null){if(r===null)throw Error(oe(308));ls=s,r.dependencies={lanes:0,firstContext:s},r.flags|=524288}else ls=ls.next=s;return c}var Ch=typeof AbortController<"u"?AbortController:function(){var r=[],s=this.signal={aborted:!1,addEventListener:function(c,g){r.push(g)}};this.abort=function(){s.aborted=!0,r.forEach(function(c){return c()})}},Vf=ce.unstable_scheduleCallback,zh=ce.unstable_NormalPriority,$i={$$typeof:Ut,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ho(){return{controller:new Ch,data:new Map,refCount:0}}function fr(r){r.refCount--,r.refCount===0&&Vf(zh,function(){r.controller.abort()})}var Ar=null,zc=0,dr=0,Bl=null;function kl(r,s){if(Ar===null){var c=Ar=[];zc=0,dr=Jl(),Bl={status:"pending",value:void 0,then:function(g){c.push(g)}}}return zc++,s.then(Fl,Fl),s}function Fl(){if(--zc===0&&Ar!==null){Bl!==null&&(Bl.status="fulfilled");var r=Ar;Ar=null,dr=0,Bl=null;for(var s=0;s<r.length;s++)(0,r[s])()}}function Ou(r,s){var c=[],g={status:"pending",value:null,reason:null,then:function(b){c.push(b)}};return r.then(function(){g.status="fulfilled",g.value=s;for(var b=0;b<c.length;b++)(0,c[b])(s)},function(b){for(g.status="rejected",g.reason=b,b=0;b<c.length;b++)(0,c[b])(void 0)}),g}var Vr=Ue.S;Ue.S=function(r,s){ap=Gn(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&kl(r,s),Vr!==null&&Vr(r,s)};var Oa=de(null);function Bu(){var r=Oa.current;return r!==null?r:Gi.pooledCache}function fo(r,s){s===null?ct(Oa,Oa.current):ct(Oa,s.pool)}function cs(){var r=Bu();return r===null?null:{parent:$i._currentValue,pool:r}}var nt=Error(oe(460)),ku=Error(oe(474)),po=Error(oe(542)),Fu={then:function(){}};function mo(r){return r=r.status,r==="fulfilled"||r==="rejected"}function Nl(r,s,c){switch(c=r[c],c===void 0?r.push(s):c!==s&&(s.then(Ra,Ra),s=c),s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,Dh(r),r;default:if(typeof s.status=="string")s.then(Ra,Ra);else{if(r=Gi,r!==null&&100<r.shellSuspendCounter)throw Error(oe(482));r=s,r.status="pending",r.then(function(g){if(s.status==="pending"){var b=s;b.status="fulfilled",b.value=g}},function(g){if(s.status==="pending"){var b=s;b.status="rejected",b.reason=g}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,Dh(r),r}throw qo=s,nt}}function oa(r){try{var s=r._init;return s(r._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(qo=c,nt):c}}var qo=null;function Dc(){if(qo===null)throw Error(oe(459));var r=qo;return qo=null,r}function Dh(r){if(r===nt||r===po)throw Error(oe(483))}var Sa=null,Nu=0;function Vu(r){var s=Nu;return Nu+=1,Sa===null&&(Sa=[]),Nl(Sa,r,s)}function go(r,s){s=s.props.ref,r.ref=s!==void 0?s:null}function Pc(r,s){throw s.$$typeof===St?Error(oe(525)):(r=Object.prototype.toString.call(s),Error(oe(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)))}function ju(r){function s(_e,pe){if(r){var De=_e.deletions;De===null?(_e.deletions=[pe],_e.flags|=16):De.push(pe)}}function c(_e,pe){if(!r)return null;for(;pe!==null;)s(_e,pe),pe=pe.sibling;return null}function g(_e){for(var pe=new Map;_e!==null;)_e.key!==null?pe.set(_e.key,_e):pe.set(_e.index,_e),_e=_e.sibling;return pe}function b(_e,pe){return _e=ra(_e,pe),_e.index=0,_e.sibling=null,_e}function M(_e,pe,De){return _e.index=De,r?(De=_e.alternate,De!==null?(De=De.index,De<pe?(_e.flags|=67108866,pe):De):(_e.flags|=67108866,pe)):(_e.flags|=1048576,pe)}function B(_e){return r&&_e.alternate===null&&(_e.flags|=67108866),_e}function Z(_e,pe,De,Ze){return pe===null||pe.tag!==6?(pe=Mh(De,_e.mode,Ze),pe.return=_e,pe):(pe=b(pe,De),pe.return=_e,pe)}function ue(_e,pe,De,Ze){var pt=De.type;return pt===Et?Ge(_e,pe,De.props.children,Ze,De.key):pe!==null&&(pe.elementType===pt||typeof pt=="object"&&pt!==null&&pt.$$typeof===Bn&&oa(pt)===pe.type)?(pe=b(pe,De.props),go(pe,De),pe.return=_e,pe):(pe=Sc(De.type,De.key,De.props,null,_e.mode,Ze),go(pe,De),pe.return=_e,pe)}function Pe(_e,pe,De,Ze){return pe===null||pe.tag!==4||pe.stateNode.containerInfo!==De.containerInfo||pe.stateNode.implementation!==De.implementation?(pe=oo(De,_e.mode,Ze),pe.return=_e,pe):(pe=b(pe,De.children||[]),pe.return=_e,pe)}function Ge(_e,pe,De,Ze,pt){return pe===null||pe.tag!==7?(pe=so(De,_e.mode,Ze,pt),pe.return=_e,pe):(pe=b(pe,De),pe.return=_e,pe)}function We(_e,pe,De){if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return pe=Mh(""+pe,_e.mode,De),pe.return=_e,pe;if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case Mt:return De=Sc(pe.type,pe.key,pe.props,null,_e.mode,De),go(De,pe),De.return=_e,De;case Kt:return pe=oo(pe,_e.mode,De),pe.return=_e,pe;case Bn:return pe=oa(pe),We(_e,pe,De)}if(nr(pe)||en(pe))return pe=so(pe,_e.mode,De,null),pe.return=_e,pe;if(typeof pe.then=="function")return We(_e,Vu(pe),De);if(pe.$$typeof===Ut)return We(_e,Lu(_e,pe),De);Pc(_e,pe)}return null}function Re(_e,pe,De,Ze){var pt=pe!==null?pe.key:null;if(typeof De=="string"&&De!==""||typeof De=="number"||typeof De=="bigint")return pt!==null?null:Z(_e,pe,""+De,Ze);if(typeof De=="object"&&De!==null){switch(De.$$typeof){case Mt:return De.key===pt?ue(_e,pe,De,Ze):null;case Kt:return De.key===pt?Pe(_e,pe,De,Ze):null;case Bn:return De=oa(De),Re(_e,pe,De,Ze)}if(nr(De)||en(De))return pt!==null?null:Ge(_e,pe,De,Ze,null);if(typeof De.then=="function")return Re(_e,pe,Vu(De),Ze);if(De.$$typeof===Ut)return Re(_e,pe,Lu(_e,De),Ze);Pc(_e,De)}return null}function Be(_e,pe,De,Ze,pt){if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number"||typeof Ze=="bigint")return _e=_e.get(De)||null,Z(pe,_e,""+Ze,pt);if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case Mt:return _e=_e.get(Ze.key===null?De:Ze.key)||null,ue(pe,_e,Ze,pt);case Kt:return _e=_e.get(Ze.key===null?De:Ze.key)||null,Pe(pe,_e,Ze,pt);case Bn:return Ze=oa(Ze),Be(_e,pe,De,Ze,pt)}if(nr(Ze)||en(Ze))return _e=_e.get(De)||null,Ge(pe,_e,Ze,pt,null);if(typeof Ze.then=="function")return Be(_e,pe,De,Vu(Ze),pt);if(Ze.$$typeof===Ut)return Be(_e,pe,De,Lu(pe,Ze),pt);Pc(pe,Ze)}return null}function _t(_e,pe,De,Ze){for(var pt=null,di=null,bt=pe,qt=pe=0,ii=null;bt!==null&&qt<De.length;qt++){bt.index>qt?(ii=bt,bt=null):ii=bt.sibling;var wi=Re(_e,bt,De[qt],Ze);if(wi===null){bt===null&&(bt=ii);break}r&&bt&&wi.alternate===null&&s(_e,bt),pe=M(wi,pe,qt),di===null?pt=wi:di.sibling=wi,di=wi,bt=ii}if(qt===De.length)return c(_e,bt),Xt&&Ts(_e,qt),pt;if(bt===null){for(;qt<De.length;qt++)bt=We(_e,De[qt],Ze),bt!==null&&(pe=M(bt,pe,qt),di===null?pt=bt:di.sibling=bt,di=bt);return Xt&&Ts(_e,qt),pt}for(bt=g(bt);qt<De.length;qt++)ii=Be(bt,_e,qt,De[qt],Ze),ii!==null&&(r&&ii.alternate!==null&&bt.delete(ii.key===null?qt:ii.key),pe=M(ii,pe,qt),di===null?pt=ii:di.sibling=ii,di=ii);return r&&bt.forEach(function(hl){return s(_e,hl)}),Xt&&Ts(_e,qt),pt}function Dt(_e,pe,De,Ze){if(De==null)throw Error(oe(151));for(var pt=null,di=null,bt=pe,qt=pe=0,ii=null,wi=De.next();bt!==null&&!wi.done;qt++,wi=De.next()){bt.index>qt?(ii=bt,bt=null):ii=bt.sibling;var hl=Re(_e,bt,wi.value,Ze);if(hl===null){bt===null&&(bt=ii);break}r&&bt&&hl.alternate===null&&s(_e,bt),pe=M(hl,pe,qt),di===null?pt=hl:di.sibling=hl,di=hl,bt=ii}if(wi.done)return c(_e,bt),Xt&&Ts(_e,qt),pt;if(bt===null){for(;!wi.done;qt++,wi=De.next())wi=We(_e,wi.value,Ze),wi!==null&&(pe=M(wi,pe,qt),di===null?pt=wi:di.sibling=wi,di=wi);return Xt&&Ts(_e,qt),pt}for(bt=g(bt);!wi.done;qt++,wi=De.next())wi=Be(bt,_e,qt,wi.value,Ze),wi!==null&&(r&&wi.alternate!==null&&bt.delete(wi.key===null?qt:wi.key),pe=M(wi,pe,qt),di===null?pt=wi:di.sibling=wi,di=wi);return r&&bt.forEach(function(Nm){return s(_e,Nm)}),Xt&&Ts(_e,qt),pt}function Pi(_e,pe,De,Ze){if(typeof De=="object"&&De!==null&&De.type===Et&&De.key===null&&(De=De.props.children),typeof De=="object"&&De!==null){switch(De.$$typeof){case Mt:e:{for(var pt=De.key;pe!==null;){if(pe.key===pt){if(pt=De.type,pt===Et){if(pe.tag===7){c(_e,pe.sibling),Ze=b(pe,De.props.children),Ze.return=_e,_e=Ze;break e}}else if(pe.elementType===pt||typeof pt=="object"&&pt!==null&&pt.$$typeof===Bn&&oa(pt)===pe.type){c(_e,pe.sibling),Ze=b(pe,De.props),go(Ze,De),Ze.return=_e,_e=Ze;break e}c(_e,pe);break}else s(_e,pe);pe=pe.sibling}De.type===Et?(Ze=so(De.props.children,_e.mode,Ze,De.key),Ze.return=_e,_e=Ze):(Ze=Sc(De.type,De.key,De.props,null,_e.mode,Ze),go(Ze,De),Ze.return=_e,_e=Ze)}return B(_e);case Kt:e:{for(pt=De.key;pe!==null;){if(pe.key===pt)if(pe.tag===4&&pe.stateNode.containerInfo===De.containerInfo&&pe.stateNode.implementation===De.implementation){c(_e,pe.sibling),Ze=b(pe,De.children||[]),Ze.return=_e,_e=Ze;break e}else{c(_e,pe);break}else s(_e,pe);pe=pe.sibling}Ze=oo(De,_e.mode,Ze),Ze.return=_e,_e=Ze}return B(_e);case Bn:return De=oa(De),Pi(_e,pe,De,Ze)}if(nr(De))return _t(_e,pe,De,Ze);if(en(De)){if(pt=en(De),typeof pt!="function")throw Error(oe(150));return De=pt.call(De),Dt(_e,pe,De,Ze)}if(typeof De.then=="function")return Pi(_e,pe,Vu(De),Ze);if(De.$$typeof===Ut)return Pi(_e,pe,Lu(_e,De),Ze);Pc(_e,De)}return typeof De=="string"&&De!==""||typeof De=="number"||typeof De=="bigint"?(De=""+De,pe!==null&&pe.tag===6?(c(_e,pe.sibling),Ze=b(pe,De),Ze.return=_e,_e=Ze):(c(_e,pe),Ze=Mh(De,_e.mode,Ze),Ze.return=_e,_e=Ze),B(_e)):c(_e,pe)}return function(_e,pe,De,Ze){try{Nu=0;var pt=Pi(_e,pe,De,Ze);return Sa=null,pt}catch(bt){if(bt===nt||bt===po)throw bt;var di=na(29,bt,null,_e.mode);return di.lanes=Ze,di.return=_e,di}finally{}}}var hs=ju(!0),Ic=ju(!1),zs=!1;function Rc(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ba(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Qt(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Ds(r,s,c){var g=r.updateQueue;if(g===null)return null;if(g=g.shared,(vi&2)!==0){var b=g.pending;return b===null?s.next=s:(s.next=b.next,b.next=s),g.pending=s,s=Rl(r),Sh(r,null,c),s}return Pu(r,g,s,c),Rl(r)}function _o(r,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194048)!==0)){var g=s.lanes;g&=r.pendingLanes,c|=g,s.lanes=c,yn(r,c)}}function Zo(r,s){var c=r.updateQueue,g=r.alternate;if(g!==null&&(g=g.updateQueue,c===g)){var b=null,M=null;if(c=c.firstBaseUpdate,c!==null){do{var B={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};M===null?b=M=B:M=M.next=B,c=c.next}while(c!==null);M===null?b=M=s:M=M.next=s}else b=M=s;c={baseState:g.baseState,firstBaseUpdate:b,lastBaseUpdate:M,shared:g.shared,callbacks:g.callbacks},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=s:r.next=s,c.lastBaseUpdate=s}var Uu=!1;function Ho(){if(Uu){var r=Bl;if(r!==null)throw r}}function Vl(r,s,c,g){Uu=!1;var b=r.updateQueue;zs=!1;var M=b.firstBaseUpdate,B=b.lastBaseUpdate,Z=b.shared.pending;if(Z!==null){b.shared.pending=null;var ue=Z,Pe=ue.next;ue.next=null,B===null?M=Pe:B.next=Pe,B=ue;var Ge=r.alternate;Ge!==null&&(Ge=Ge.updateQueue,Z=Ge.lastBaseUpdate,Z!==B&&(Z===null?Ge.firstBaseUpdate=Pe:Z.next=Pe,Ge.lastBaseUpdate=ue))}if(M!==null){var We=b.baseState;B=0,Ge=Pe=ue=null,Z=M;do{var Re=Z.lane&-536870913,Be=Re!==Z.lane;if(Be?(Yt&Re)===Re:(g&Re)===Re){Re!==0&&Re===dr&&(Uu=!0),Ge!==null&&(Ge=Ge.next={lane:0,tag:Z.tag,payload:Z.payload,callback:null,next:null});e:{var _t=r,Dt=Z;Re=s;var Pi=c;switch(Dt.tag){case 1:if(_t=Dt.payload,typeof _t=="function"){We=_t.call(Pi,We,Re);break e}We=_t;break e;case 3:_t.flags=_t.flags&-65537|128;case 0:if(_t=Dt.payload,Re=typeof _t=="function"?_t.call(Pi,We,Re):_t,Re==null)break e;We=it({},We,Re);break e;case 2:zs=!0}}Re=Z.callback,Re!==null&&(r.flags|=64,Be&&(r.flags|=8192),Be=b.callbacks,Be===null?b.callbacks=[Re]:Be.push(Re))}else Be={lane:Re,tag:Z.tag,payload:Z.payload,callback:Z.callback,next:null},Ge===null?(Pe=Ge=Be,ue=We):Ge=Ge.next=Be,B|=Re;if(Z=Z.next,Z===null){if(Z=b.shared.pending,Z===null)break;Be=Z,Z=Be.next,Be.next=null,b.lastBaseUpdate=Be,b.shared.pending=null}}while(!0);Ge===null&&(ue=We),b.baseState=ue,b.firstBaseUpdate=Pe,b.lastBaseUpdate=Ge,M===null&&(b.shared.lanes=0),ps|=B,r.lanes=B,r.memoizedState=We}}function Lc(r,s){if(typeof r!="function")throw Error(oe(191,r));r.call(s)}function Ph(r,s){var c=r.callbacks;if(c!==null)for(r.callbacks=null,r=0;r<c.length;r++)Lc(c[r],s)}var Cr=de(null),$o=de(0);function dt(r,s){r=il,ct($o,r),ct(Cr,s),il=r|s.baseLanes}function xt(){ct($o,il),ct(Cr,Cr.current)}function yo(){il=$o.current,Qe(Cr),Qe($o)}var zr=de(null),$n=null;function dn(r){var s=r.alternate;ct(pn,pn.current&1),ct(zr,r),$n===null&&(s===null||Cr.current!==null||s.memoizedState!==null)&&($n=r)}function Dr(r){ct(pn,pn.current),ct(zr,r),$n===null&&($n=r)}function Ih(r){r.tag===22?(ct(pn,pn.current),ct(zr,r),$n===null&&($n=r)):vo()}function vo(){ct(pn,pn.current),ct(zr,zr.current)}function jr(r){Qe(zr),$n===r&&($n=null),Qe(pn)}var pn=de(0);function Ps(r){for(var s=r;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||da(c)||jn(c)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var hi=0,vt=null,Ci=null,Xi=null,Xo=!1,la=!1,Is=!1,jl=0,Rs=0,Ls=null,Rh=0;function Yi(){throw Error(oe(321))}function ka(r,s){if(s===null)return!1;for(var c=0;c<s.length&&c<r.length;c++)if(!kr(r[c],s[c]))return!1;return!0}function Ul(r,s,c,g,b,M){return hi=M,vt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Ue.H=r===null||r.memoizedState===null?Cn:Pr,Is=!1,M=c(g,b),Is=!1,la&&(M=Gu(s,c,g,b)),Gl(r),M}function Gl(r){Ue.H=Wi;var s=Ci!==null&&Ci.next!==null;if(hi=0,Xi=Ci=vt=null,Xo=!1,Rs=0,Ls=null,s)throw Error(oe(300));r===null||zn||(r=r.dependencies,r!==null&&Ol(r)&&(zn=!0))}function Gu(r,s,c,g){vt=r;var b=0;do{if(la&&(Ls=null),Rs=0,la=!1,25<=b)throw Error(oe(301));if(b+=1,Xi=Ci=null,r.updateQueue!=null){var M=r.updateQueue;M.lastEffect=null,M.events=null,M.stores=null,M.memoCache!=null&&(M.memoCache.index=0)}Ue.H=ji,M=s(c,g)}while(la);return M}function qu(){var r=Ue.H,s=r.useState()[0];return s=typeof s.then=="function"?Yo(s):s,r=r.useState()[0],(Ci!==null?Ci.memoizedState:null)!==r&&(vt.flags|=1024),s}function Zu(){var r=jl!==0;return jl=0,r}function Os(r,s,c){s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~c}function Bs(r){if(Xo){for(r=r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Xo=!1}hi=0,Xi=Ci=vt=null,la=!1,Rs=jl=0,Ls=null}function rr(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xi===null?vt.memoizedState=Xi=r:Xi=Xi.next=r,Xi}function Vi(){if(Ci===null){var r=vt.alternate;r=r!==null?r.memoizedState:null}else r=Ci.next;var s=Xi===null?vt.memoizedState:Xi.next;if(s!==null)Xi=s,Ci=r;else{if(r===null)throw vt.alternate===null?Error(oe(467)):Error(oe(310));Ci=r,r={memoizedState:Ci.memoizedState,baseState:Ci.baseState,baseQueue:Ci.baseQueue,queue:Ci.queue,next:null},Xi===null?vt.memoizedState=Xi=r:Xi=Xi.next=r}return Xi}function fs(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Yo(r){var s=Rs;return Rs+=1,Ls===null&&(Ls=[]),r=Nl(Ls,r,s),s=vt,(Xi===null?s.memoizedState:Xi.next)===null&&(s=s.alternate,Ue.H=s===null||s.memoizedState===null?Cn:Pr),r}function ql(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Yo(r);if(r.$$typeof===Ut)return xn(r)}throw Error(oe(438,String(r)))}function Zl(r){var s=null,c=vt.updateQueue;if(c!==null&&(s=c.memoCache),s==null){var g=vt.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(s={data:g.data.map(function(b){return b.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),c===null&&(c=fs(),vt.updateQueue=c),c.memoCache=s,c=s.data[s.index],c===void 0)for(c=s.data[s.index]=Array(r),g=0;g<r;g++)c[g]=Lr;return s.index++,c}function Fa(r,s){return typeof s=="function"?s(r):s}function m(r){var s=Vi();return t(s,Ci,r)}function t(r,s,c){var g=r.queue;if(g===null)throw Error(oe(311));g.lastRenderedReducer=c;var b=r.baseQueue,M=g.pending;if(M!==null){if(b!==null){var B=b.next;b.next=M.next,M.next=B}s.baseQueue=b=M,g.pending=null}if(M=r.baseState,b===null)r.memoizedState=M;else{s=b.next;var Z=B=null,ue=null,Pe=s,Ge=!1;do{var We=Pe.lane&-536870913;if(We!==Pe.lane?(Yt&We)===We:(hi&We)===We){var Re=Pe.revertLane;if(Re===0)ue!==null&&(ue=ue.next={lane:0,revertLane:0,gesture:null,action:Pe.action,hasEagerState:Pe.hasEagerState,eagerState:Pe.eagerState,next:null}),We===dr&&(Ge=!0);else if((hi&Re)===Re){Pe=Pe.next,Re===dr&&(Ge=!0);continue}else We={lane:0,revertLane:Pe.revertLane,gesture:null,action:Pe.action,hasEagerState:Pe.hasEagerState,eagerState:Pe.eagerState,next:null},ue===null?(Z=ue=We,B=M):ue=ue.next=We,vt.lanes|=Re,ps|=Re;We=Pe.action,Is&&c(M,We),M=Pe.hasEagerState?Pe.eagerState:c(M,We)}else Re={lane:We,revertLane:Pe.revertLane,gesture:Pe.gesture,action:Pe.action,hasEagerState:Pe.hasEagerState,eagerState:Pe.eagerState,next:null},ue===null?(Z=ue=Re,B=M):ue=ue.next=Re,vt.lanes|=We,ps|=We;Pe=Pe.next}while(Pe!==null&&Pe!==s);if(ue===null?B=M:ue.next=Z,!kr(M,r.memoizedState)&&(zn=!0,Ge&&(c=Bl,c!==null)))throw c;r.memoizedState=M,r.baseState=B,r.baseQueue=ue,g.lastRenderedState=M}return b===null&&(g.lanes=0),[r.memoizedState,g.dispatch]}function a(r){var s=Vi(),c=s.queue;if(c===null)throw Error(oe(311));c.lastRenderedReducer=r;var g=c.dispatch,b=c.pending,M=s.memoizedState;if(b!==null){c.pending=null;var B=b=b.next;do M=r(M,B.action),B=B.next;while(B!==b);kr(M,s.memoizedState)||(zn=!0),s.memoizedState=M,s.baseQueue===null&&(s.baseState=M),c.lastRenderedState=M}return[M,g]}function l(r,s,c){var g=vt,b=Vi(),M=Xt;if(M){if(c===void 0)throw Error(oe(407));c=c()}else c=s();var B=!kr((Ci||b).memoizedState,c);if(B&&(b.memoizedState=c,zn=!0),b=b.queue,Ce(v.bind(null,g,b,r),[r]),b.getSnapshot!==s||B||Xi!==null&&Xi.memoizedState.tag&1){if(g.flags|=2048,ee(9,{destroy:void 0},_.bind(null,g,b,c,s),null),Gi===null)throw Error(oe(349));M||(hi&127)!==0||h(g,s,c)}return c}function h(r,s,c){r.flags|=16384,r={getSnapshot:s,value:c},s=vt.updateQueue,s===null?(s=fs(),vt.updateQueue=s,s.stores=[r]):(c=s.stores,c===null?s.stores=[r]:c.push(r))}function _(r,s,c,g){s.value=c,s.getSnapshot=g,w(s)&&S(r)}function v(r,s,c){return c(function(){w(s)&&S(r)})}function w(r){var s=r.getSnapshot;r=r.value;try{var c=s();return!kr(r,c)}catch{return!0}}function S(r){var s=ba(r,2);s!==null&&Aa(s,r,2)}function A(r){var s=rr();if(typeof r=="function"){var c=r;if(r=c(),Is){Se(!0);try{c()}finally{Se(!1)}}}return s.memoizedState=s.baseState=r,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Fa,lastRenderedState:r},s}function z(r,s,c,g){return r.baseState=c,t(r,Ci,typeof g=="function"?g:Fa)}function R(r,s,c,g,b){if(Vn(r))throw Error(oe(485));if(r=s.action,r!==null){var M={payload:b,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(B){M.listeners.push(B)}};Ue.T!==null?c(!0):M.isTransition=!1,g(M),c=s.pending,c===null?(M.next=s.pending=M,I(s,M)):(M.next=c.next,s.pending=c.next=M)}}function I(r,s){var c=s.action,g=s.payload,b=r.state;if(s.isTransition){var M=Ue.T,B={};Ue.T=B;try{var Z=c(b,g),ue=Ue.S;ue!==null&&ue(B,Z),F(r,s,Z)}catch(Pe){X(r,s,Pe)}finally{M!==null&&B.types!==null&&(M.types=B.types),Ue.T=M}}else try{M=c(b,g),F(r,s,M)}catch(Pe){X(r,s,Pe)}}function F(r,s,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(g){U(r,s,g)},function(g){return X(r,s,g)}):U(r,s,c)}function U(r,s,c){s.status="fulfilled",s.value=c,Q(s),r.state=c,s=r.pending,s!==null&&(c=s.next,c===s?r.pending=null:(c=c.next,s.next=c,I(r,c)))}function X(r,s,c){var g=r.pending;if(r.pending=null,g!==null){g=g.next;do s.status="rejected",s.reason=c,Q(s),s=s.next;while(s!==g)}r.action=null}function Q(r){r=r.listeners;for(var s=0;s<r.length;s++)(0,r[s])()}function Y(r,s){return s}function W(r,s){if(Xt){var c=Gi.formState;if(c!==null){e:{var g=vt;if(Xt){if(Ai){t:{for(var b=Ai,M=aa;b.nodeType!==8;){if(!M){b=null;break t}if(b=gs(b.nextSibling),b===null){b=null;break t}}M=b.data,b=M==="F!"||M==="F"?b:null}if(b){Ai=gs(b.nextSibling),g=b.data==="F!";break e}}Nr(g)}g=!1}g&&(s=c[0])}}return c=rr(),c.memoizedState=c.baseState=s,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Y,lastRenderedState:s},c.queue=g,c=Wo.bind(null,vt,g),g.dispatch=c,g=A(!1),M=An.bind(null,vt,!1,g.queue),g=rr(),b={state:s,dispatch:null,action:r,pending:null},g.queue=b,c=R.bind(null,vt,b,M,c),b.dispatch=c,g.memoizedState=r,[s,c,!1]}function ie(r){var s=Vi();return K(s,Ci,r)}function K(r,s,c){if(s=t(r,s,Y)[0],r=m(Fa)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var g=Yo(s)}catch(B){throw B===nt?po:B}else g=s;s=Vi();var b=s.queue,M=b.dispatch;return c!==s.memoizedState&&(vt.flags|=2048,ee(9,{destroy:void 0},re.bind(null,b,c),null)),[g,M,r]}function re(r,s){r.action=s}function se(r){var s=Vi(),c=Ci;if(c!==null)return K(s,c,r);Vi(),s=s.memoizedState,c=Vi();var g=c.queue.dispatch;return c.memoizedState=r,[s,g,!1]}function ee(r,s,c,g){return r={tag:r,create:c,deps:g,inst:s,next:null},s=vt.updateQueue,s===null&&(s=fs(),vt.updateQueue=s),c=s.lastEffect,c===null?s.lastEffect=r.next=r:(g=c.next,c.next=r,r.next=g,s.lastEffect=r),r}function fe(){return Vi().memoizedState}function Me(r,s,c,g){var b=rr();vt.flags|=r,b.memoizedState=ee(1|s,{destroy:void 0},c,g===void 0?null:g)}function xe(r,s,c,g){var b=Vi();g=g===void 0?null:g;var M=b.memoizedState.inst;Ci!==null&&g!==null&&ka(g,Ci.memoizedState.deps)?b.memoizedState=ee(s,M,c,g):(vt.flags|=r,b.memoizedState=ee(1|s,M,c,g))}function Ee(r,s){Me(8390656,8,r,s)}function Ce(r,s){xe(2048,8,r,s)}function He(r){vt.flags|=4;var s=vt.updateQueue;if(s===null)s=fs(),vt.updateQueue=s,s.events=[r];else{var c=s.events;c===null?s.events=[r]:c.push(r)}}function Je(r){var s=Vi().memoizedState;return He({ref:s,nextImpl:r}),function(){if((vi&2)!==0)throw Error(oe(440));return s.impl.apply(void 0,arguments)}}function qe(r,s){return xe(4,2,r,s)}function ft(r,s){return xe(4,4,r,s)}function Pt(r,s){if(typeof s=="function"){r=r();var c=s(r);return function(){typeof c=="function"?c():s(null)}}if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function li(r,s,c){c=c!=null?c.concat([r]):null,xe(4,4,Pt.bind(null,s,r),c)}function zi(){}function fi(r,s){var c=Vi();s=s===void 0?null:s;var g=c.memoizedState;return s!==null&&ka(s,g[1])?g[0]:(c.memoizedState=[r,s],r)}function Bi(r,s){var c=Vi();s=s===void 0?null:s;var g=c.memoizedState;if(s!==null&&ka(s,g[1]))return g[0];if(g=r(),Is){Se(!0);try{r()}finally{Se(!1)}}return c.memoizedState=[g,s],g}function yi(r,s,c){return c===void 0||(hi&1073741824)!==0&&(Yt&261930)===0?r.memoizedState=s:(r.memoizedState=c,r=Yc(),vt.lanes|=r,ps|=r,c)}function Mn(r,s,c,g){return kr(c,s)?c:Cr.current!==null?(r=yi(r,c,g),kr(r,s)||(zn=!0),r):(hi&42)===0||(hi&1073741824)!==0&&(Yt&261930)===0?(zn=!0,r.memoizedState=c):(r=Yc(),vt.lanes|=r,ps|=r,s)}function Li(r,s,c,g,b){var M=rt.p;rt.p=M!==0&&8>M?M:8;var B=Ue.T,Z={};Ue.T=Z,An(r,!1,s,c);try{var ue=b(),Pe=Ue.S;if(Pe!==null&&Pe(Z,ue),ue!==null&&typeof ue=="object"&&typeof ue.then=="function"){var Ge=Ou(ue,g);Ur(r,s,Ge,xi(r))}else Ur(r,s,g,xi(r))}catch(We){Ur(r,s,{then:function(){},status:"rejected",reason:We},xi())}finally{rt.p=M,B!==null&&Z.types!==null&&(B.types=Z.types),Ue.T=B}}function En(){}function Qi(r,s,c,g){if(r.tag!==5)throw Error(oe(476));var b=sn(r).queue;Li(r,b,s,Ct,c===null?En:function(){return Xn(r),c(g)})}function sn(r){var s=r.memoizedState;if(s!==null)return s;s={memoizedState:Ct,baseState:Ct,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Fa,lastRenderedState:Ct},next:null};var c={};return s.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Fa,lastRenderedState:c},next:null},r.memoizedState=s,r=r.alternate,r!==null&&(r.memoizedState=s),s}function Xn(r){var s=sn(r);s.next===null&&(s=r.alternate.memoizedState),Ur(r,s.next.queue,{},xi())}function ar(){return xn(mf)}function Na(){return Vi().memoizedState}function ks(){return Vi().memoizedState}function Qo(r){for(var s=r.return;s!==null;){switch(s.tag){case 24:case 3:var c=xi();r=Qt(c);var g=Ds(s,r,c);g!==null&&(Aa(g,s,c),_o(g,s,c)),s={cache:ho()},r.payload=s;return}s=s.return}}function Oc(r,s,c){var g=xi();c={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Vn(r)?Yn(s,c):(c=ao(r,s,c,g),c!==null&&(Aa(c,r,g),ua(c,s,g)))}function Wo(r,s,c){var g=xi();Ur(r,s,c,g)}function Ur(r,s,c,g){var b={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Vn(r))Yn(s,b);else{var M=r.alternate;if(r.lanes===0&&(M===null||M.lanes===0)&&(M=s.lastRenderedReducer,M!==null))try{var B=s.lastRenderedState,Z=M(B,c);if(b.hasEagerState=!0,b.eagerState=Z,kr(Z,B))return Pu(r,s,b,0),Gi===null&&jo(),!1}catch{}finally{}if(c=ao(r,s,b,g),c!==null)return Aa(c,r,g),ua(c,s,g),!0}return!1}function An(r,s,c,g){if(g={lane:2,revertLane:Jl(),gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},Vn(r)){if(s)throw Error(oe(479))}else s=ao(r,c,g,2),s!==null&&Aa(s,r,2)}function Vn(r){var s=r.alternate;return r===vt||s!==null&&s===vt}function Yn(r,s){la=Xo=!0;var c=r.pending;c===null?s.next=s:(s.next=c.next,c.next=s),r.pending=s}function ua(r,s,c){if((c&4194048)!==0){var g=s.lanes;g&=r.pendingLanes,c|=g,s.lanes=c,yn(r,c)}}var Wi={readContext:xn,use:ql,useCallback:Yi,useContext:Yi,useEffect:Yi,useImperativeHandle:Yi,useLayoutEffect:Yi,useInsertionEffect:Yi,useMemo:Yi,useReducer:Yi,useRef:Yi,useState:Yi,useDebugValue:Yi,useDeferredValue:Yi,useTransition:Yi,useSyncExternalStore:Yi,useId:Yi,useHostTransitionStatus:Yi,useFormState:Yi,useActionState:Yi,useOptimistic:Yi,useMemoCache:Yi,useCacheRefresh:Yi};Wi.useEffectEvent=Yi;var Cn={readContext:xn,use:ql,useCallback:function(r,s){return rr().memoizedState=[r,s===void 0?null:s],r},useContext:xn,useEffect:Ee,useImperativeHandle:function(r,s,c){c=c!=null?c.concat([r]):null,Me(4194308,4,Pt.bind(null,s,r),c)},useLayoutEffect:function(r,s){return Me(4194308,4,r,s)},useInsertionEffect:function(r,s){Me(4,2,r,s)},useMemo:function(r,s){var c=rr();s=s===void 0?null:s;var g=r();if(Is){Se(!0);try{r()}finally{Se(!1)}}return c.memoizedState=[g,s],g},useReducer:function(r,s,c){var g=rr();if(c!==void 0){var b=c(s);if(Is){Se(!0);try{c(s)}finally{Se(!1)}}}else b=s;return g.memoizedState=g.baseState=b,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:b},g.queue=r,r=r.dispatch=Oc.bind(null,vt,r),[g.memoizedState,r]},useRef:function(r){var s=rr();return r={current:r},s.memoizedState=r},useState:function(r){r=A(r);var s=r.queue,c=Wo.bind(null,vt,s);return s.dispatch=c,[r.memoizedState,c]},useDebugValue:zi,useDeferredValue:function(r,s){var c=rr();return yi(c,r,s)},useTransition:function(){var r=A(!1);return r=Li.bind(null,vt,r.queue,!0,!1),rr().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,s,c){var g=vt,b=rr();if(Xt){if(c===void 0)throw Error(oe(407));c=c()}else{if(c=s(),Gi===null)throw Error(oe(349));(Yt&127)!==0||h(g,s,c)}b.memoizedState=c;var M={value:c,getSnapshot:s};return b.queue=M,Ee(v.bind(null,g,M,r),[r]),g.flags|=2048,ee(9,{destroy:void 0},_.bind(null,g,M,c,s),null),c},useId:function(){var r=rr(),s=Gi.identifierPrefix;if(Xt){var c=Fr,g=rs;c=(g&~(1<<32-Ve(g)-1)).toString(32)+c,s="_"+s+"R_"+c,c=jl++,0<c&&(s+="H"+c.toString(32)),s+="_"}else c=Rh++,s="_"+s+"r_"+c.toString(32)+"_";return r.memoizedState=s},useHostTransitionStatus:ar,useFormState:W,useActionState:W,useOptimistic:function(r){var s=rr();s.memoizedState=s.baseState=r;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=c,s=An.bind(null,vt,!0,c),c.dispatch=s,[r,s]},useMemoCache:Zl,useCacheRefresh:function(){return rr().memoizedState=Qo.bind(null,vt)},useEffectEvent:function(r){var s=rr(),c={impl:r};return s.memoizedState=c,function(){if((vi&2)!==0)throw Error(oe(440));return c.impl.apply(void 0,arguments)}}},Pr={readContext:xn,use:ql,useCallback:fi,useContext:xn,useEffect:Ce,useImperativeHandle:li,useInsertionEffect:qe,useLayoutEffect:ft,useMemo:Bi,useReducer:m,useRef:fe,useState:function(){return m(Fa)},useDebugValue:zi,useDeferredValue:function(r,s){var c=Vi();return Mn(c,Ci.memoizedState,r,s)},useTransition:function(){var r=m(Fa)[0],s=Vi().memoizedState;return[typeof r=="boolean"?r:Yo(r),s]},useSyncExternalStore:l,useId:Na,useHostTransitionStatus:ar,useFormState:ie,useActionState:ie,useOptimistic:function(r,s){var c=Vi();return z(c,Ci,r,s)},useMemoCache:Zl,useCacheRefresh:ks};Pr.useEffectEvent=Je;var ji={readContext:xn,use:ql,useCallback:fi,useContext:xn,useEffect:Ce,useImperativeHandle:li,useInsertionEffect:qe,useLayoutEffect:ft,useMemo:Bi,useReducer:a,useRef:fe,useState:function(){return a(Fa)},useDebugValue:zi,useDeferredValue:function(r,s){var c=Vi();return Ci===null?yi(c,r,s):Mn(c,Ci.memoizedState,r,s)},useTransition:function(){var r=a(Fa)[0],s=Vi().memoizedState;return[typeof r=="boolean"?r:Yo(r),s]},useSyncExternalStore:l,useId:Na,useHostTransitionStatus:ar,useFormState:se,useActionState:se,useOptimistic:function(r,s){var c=Vi();return Ci!==null?z(c,Ci,r,s):(c.baseState=r,[r,c.queue.dispatch])},useMemoCache:Zl,useCacheRefresh:ks};ji.useEffectEvent=Je;function Lh(r,s,c,g){s=r.memoizedState,c=c(g,s),c=c==null?s:it({},s,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var Bc={enqueueSetState:function(r,s,c){r=r._reactInternals;var g=xi(),b=Qt(g);b.payload=s,c!=null&&(b.callback=c),s=Ds(r,b,g),s!==null&&(Aa(s,r,g),_o(s,r,g))},enqueueReplaceState:function(r,s,c){r=r._reactInternals;var g=xi(),b=Qt(g);b.tag=1,b.payload=s,c!=null&&(b.callback=c),s=Ds(r,b,g),s!==null&&(Aa(s,r,g),_o(s,r,g))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var c=xi(),g=Qt(c);g.tag=2,s!=null&&(g.callback=s),s=Ds(r,g,c),s!==null&&(Aa(s,r,c),_o(s,r,c))}};function kc(r,s,c,g,b,M,B){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(g,M,B):s.prototype&&s.prototype.isPureReactComponent?!ro(c,g)||!ro(b,M):!0}function Oh(r,s,c,g){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,g),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,g),s.state!==r&&Bc.enqueueReplaceState(s,s.state,null)}function ca(r,s){var c=s;if("ref"in s){c={};for(var g in s)g!=="ref"&&(c[g]=s[g])}if(r=r.defaultProps){c===s&&(c=it({},c));for(var b in r)c[b]===void 0&&(c[b]=r[b])}return c}function xo(r){is(r)}function Fs(r){console.error(r)}function Bh(r){is(r)}function Ko(r,s){try{var c=r.onUncaughtError;c(s.value,{componentStack:s.stack})}catch(g){setTimeout(function(){throw g})}}function Fc(r,s,c){try{var g=r.onCaughtError;g(c.value,{componentStack:c.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function bo(r,s,c){return c=Qt(c),c.tag=3,c.payload={element:null},c.callback=function(){Ko(r,s)},c}function Nc(r){return r=Qt(r),r.tag=3,r}function Vc(r,s,c,g){var b=c.type.getDerivedStateFromError;if(typeof b=="function"){var M=g.value;r.payload=function(){return b(M)},r.callback=function(){Fc(s,c,g)}}var B=c.stateNode;B!==null&&typeof B.componentDidCatch=="function"&&(r.callback=function(){Fc(s,c,g),typeof b!="function"&&(Ql===null?Ql=new Set([this]):Ql.add(this));var Z=g.stack;this.componentDidCatch(g.value,{componentStack:Z!==null?Z:""})})}function Fd(r,s,c,g,b){if(c.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(s=c.alternate,s!==null&&Ta(s,c,b,!0),c=zr.current,c!==null){switch(c.tag){case 31:case 13:return $n===null?rl():c.alternate===null&&In===0&&(In=3),c.flags&=-257,c.flags|=65536,c.lanes=b,g===Fu?c.flags|=16384:(s=c.updateQueue,s===null?c.updateQueue=new Set([g]):s.add(g),ef(r,g,b)),!1;case 22:return c.flags|=65536,g===Fu?c.flags|=16384:(s=c.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([g])},c.updateQueue=s):(c=s.retryQueue,c===null?s.retryQueue=new Set([g]):c.add(g)),ef(r,g,b)),!1}throw Error(oe(435,c.tag))}return ef(r,g,b),rl(),!1}if(Xt)return s=zr.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=b,g!==Hi&&(r=Error(oe(422),{cause:g}),Ms(Er(r,c)))):(g!==Hi&&(s=Error(oe(423),{cause:g}),Ms(Er(s,c))),r=r.current.alternate,r.flags|=65536,b&=-b,r.lanes|=b,g=Er(g,c),b=bo(r.stateNode,g,b),Zo(r,b),In!==4&&(In=2)),!1;var M=Error(oe(520),{cause:g});if(M=Er(M,c),Xh===null?Xh=[M]:Xh.push(M),In!==4&&(In=2),s===null)return!0;g=Er(g,c),c=s;do{switch(c.tag){case 3:return c.flags|=65536,r=b&-b,c.lanes|=r,r=bo(c.stateNode,g,r),Zo(c,r),!1;case 1:if(s=c.type,M=c.stateNode,(c.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||M!==null&&typeof M.componentDidCatch=="function"&&(Ql===null||!Ql.has(M))))return c.flags|=65536,b&=-b,c.lanes|=b,b=Nc(b),Vc(b,r,c,g),Zo(c,b),!1}c=c.return}while(c!==null);return!1}var Nd=Error(oe(461)),zn=!1;function pr(r,s,c,g){s.child=r===null?Ic(s,null,c,g):hs(s,r.child,c,g)}function Vd(r,s,c,g,b){c=c.render;var M=s.ref;if("ref"in g){var B={};for(var Z in g)Z!=="ref"&&(B[Z]=g[Z])}else B=g;return Cs(s),g=Ul(r,s,c,B,M,b),Z=Zu(),r!==null&&!zn?(Os(r,s,b),bn(r,s,b)):(Xt&&Z&&Go(s),s.flags|=1,pr(r,s,g,b),s.child)}function Hu(r,s,c,g,b){if(r===null){var M=c.type;return typeof M=="function"&&!Tc(M)&&M.defaultProps===void 0&&c.compare===null?(s.tag=15,s.type=M,Hp(r,s,M,g,b)):(r=Sc(c.type,null,g,s,s.mode,b),r.ref=s.ref,r.return=s,s.child=r)}if(M=r.child,!$f(r,b)){var B=M.memoizedProps;if(c=c.compare,c=c!==null?c:ro,c(B,g)&&r.ref===s.ref)return bn(r,s,b)}return s.flags|=1,r=ra(M,g),r.ref=s.ref,r.return=s,s.child=r}function Hp(r,s,c,g,b){if(r!==null){var M=r.memoizedProps;if(ro(M,g)&&r.ref===s.ref)if(zn=!1,s.pendingProps=g=M,$f(r,b))(r.flags&131072)!==0&&(zn=!0);else return s.lanes=r.lanes,bn(r,s,b)}return jd(r,s,c,g,b)}function $u(r,s,c,g){var b=g.children,M=r!==null?r.memoizedState:null;if(r===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.mode==="hidden"){if((s.flags&128)!==0){if(M=M!==null?M.baseLanes|c:c,r!==null){for(g=s.child=r.child,b=0;g!==null;)b=b|g.lanes|g.childLanes,g=g.sibling;g=b&~M}else g=0,s.child=null;return kh(r,s,M,c,g)}if((c&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},r!==null&&fo(s,M!==null?M.cachePool:null),M!==null?dt(s,M):xt(),Ih(s);else return g=s.lanes=536870912,kh(r,s,M!==null?M.baseLanes|c:c,c,g)}else M!==null?(fo(s,M.cachePool),dt(s,M),vo(),s.memoizedState=null):(r!==null&&fo(s,null),xt(),vo());return pr(r,s,b,c),s.child}function Hl(r,s){return r!==null&&r.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function kh(r,s,c,g,b){var M=Bu();return M=M===null?null:{parent:$i._currentValue,pool:M},s.memoizedState={baseLanes:c,cachePool:M},r!==null&&fo(s,null),xt(),Ih(s),r!==null&&Ta(r,s,g,!0),s.childLanes=b,null}function jf(r,s){return s=Hf({mode:s.mode,children:s.children},r.mode),s.ref=r.ref,r.child=s,s.return=r,s}function $p(r,s,c){return hs(s,r.child,null,c),r=jf(s,s.pendingProps),r.flags|=2,jr(s),s.memoizedState=null,r}function $m(r,s,c){var g=s.pendingProps,b=(s.flags&128)!==0;if(s.flags&=-129,r===null){if(Xt){if(g.mode==="hidden")return r=jf(s,g),s.lanes=536870912,Hl(null,r);if(Dr(s),(r=Ai)?(r=Tp(r,aa),r=r!==null&&r.data==="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:ns!==null?{id:rs,overflow:Fr}:null,retryLane:536870912,hydrationErrors:null},c=Mc(r),c.return=s,s.child=c,Hn=s,Ai=null)):r=null,r===null)throw Nr(s);return s.lanes=536870912,null}return jf(s,g)}var M=r.memoizedState;if(M!==null){var B=M.dehydrated;if(Dr(s),b)if(s.flags&256)s.flags&=-257,s=$p(r,s,c);else if(s.memoizedState!==null)s.child=r.child,s.flags|=128,s=null;else throw Error(oe(558));else if(zn||Ta(r,s,c,!1),b=(c&r.childLanes)!==0,zn||b){if(g=Gi,g!==null&&(B=yl(g,c),B!==0&&B!==M.retryLane))throw M.retryLane=B,ba(r,B),Aa(g,r,B),Nd;rl(),s=$p(r,s,c)}else r=M.treeContext,Ai=gs(B.nextSibling),Hn=s,Xt=!0,Ss=null,aa=!1,r!==null&&Ah(s,r),s=jf(s,g),s.flags|=4096;return s}return r=ra(r.child,{mode:g.mode,children:g.children}),r.ref=s.ref,s.child=r,r.return=s,r}function Uf(r,s){var c=s.ref;if(c===null)r!==null&&r.ref!==null&&(s.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(oe(284));(r===null||r.ref!==c)&&(s.flags|=4194816)}}function jd(r,s,c,g,b){return Cs(s),c=Ul(r,s,c,g,void 0,b),g=Zu(),r!==null&&!zn?(Os(r,s,b),bn(r,s,b)):(Xt&&g&&Go(s),s.flags|=1,pr(r,s,c,b),s.child)}function Ud(r,s,c,g,b,M){return Cs(s),s.updateQueue=null,c=Gu(s,g,c,b),Gl(r),g=Zu(),r!==null&&!zn?(Os(r,s,M),bn(r,s,M)):(Xt&&g&&Go(s),s.flags|=1,pr(r,s,c,M),s.child)}function Gf(r,s,c,g,b){if(Cs(s),s.stateNode===null){var M=Vt,B=c.contextType;typeof B=="object"&&B!==null&&(M=xn(B)),M=new c(g,M),s.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,M.updater=Bc,s.stateNode=M,M._reactInternals=s,M=s.stateNode,M.props=g,M.state=s.memoizedState,M.refs={},Rc(s),B=c.contextType,M.context=typeof B=="object"&&B!==null?xn(B):Vt,M.state=s.memoizedState,B=c.getDerivedStateFromProps,typeof B=="function"&&(Lh(s,c,B,g),M.state=s.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(B=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),B!==M.state&&Bc.enqueueReplaceState(M,M.state,null),Vl(s,g,M,b),Ho(),M.state=s.memoizedState),typeof M.componentDidMount=="function"&&(s.flags|=4194308),g=!0}else if(r===null){M=s.stateNode;var Z=s.memoizedProps,ue=ca(c,Z);M.props=ue;var Pe=M.context,Ge=c.contextType;B=Vt,typeof Ge=="object"&&Ge!==null&&(B=xn(Ge));var We=c.getDerivedStateFromProps;Ge=typeof We=="function"||typeof M.getSnapshotBeforeUpdate=="function",Z=s.pendingProps!==Z,Ge||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(Z||Pe!==B)&&Oh(s,M,g,B),zs=!1;var Re=s.memoizedState;M.state=Re,Vl(s,g,M,b),Ho(),Pe=s.memoizedState,Z||Re!==Pe||zs?(typeof We=="function"&&(Lh(s,c,We,g),Pe=s.memoizedState),(ue=zs||kc(s,c,ue,g,Re,Pe,B))?(Ge||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount()),typeof M.componentDidMount=="function"&&(s.flags|=4194308)):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=g,s.memoizedState=Pe),M.props=g,M.state=Pe,M.context=B,g=ue):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),g=!1)}else{M=s.stateNode,Ba(r,s),B=s.memoizedProps,Ge=ca(c,B),M.props=Ge,We=s.pendingProps,Re=M.context,Pe=c.contextType,ue=Vt,typeof Pe=="object"&&Pe!==null&&(ue=xn(Pe)),Z=c.getDerivedStateFromProps,(Pe=typeof Z=="function"||typeof M.getSnapshotBeforeUpdate=="function")||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(B!==We||Re!==ue)&&Oh(s,M,g,ue),zs=!1,Re=s.memoizedState,M.state=Re,Vl(s,g,M,b),Ho();var Be=s.memoizedState;B!==We||Re!==Be||zs||r!==null&&r.dependencies!==null&&Ol(r.dependencies)?(typeof Z=="function"&&(Lh(s,c,Z,g),Be=s.memoizedState),(Ge=zs||kc(s,c,Ge,g,Re,Be,ue)||r!==null&&r.dependencies!==null&&Ol(r.dependencies))?(Pe||typeof M.UNSAFE_componentWillUpdate!="function"&&typeof M.componentWillUpdate!="function"||(typeof M.componentWillUpdate=="function"&&M.componentWillUpdate(g,Be,ue),typeof M.UNSAFE_componentWillUpdate=="function"&&M.UNSAFE_componentWillUpdate(g,Be,ue)),typeof M.componentDidUpdate=="function"&&(s.flags|=4),typeof M.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof M.componentDidUpdate!="function"||B===r.memoizedProps&&Re===r.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||B===r.memoizedProps&&Re===r.memoizedState||(s.flags|=1024),s.memoizedProps=g,s.memoizedState=Be),M.props=g,M.state=Be,M.context=ue,g=Ge):(typeof M.componentDidUpdate!="function"||B===r.memoizedProps&&Re===r.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||B===r.memoizedProps&&Re===r.memoizedState||(s.flags|=1024),g=!1)}return M=g,Uf(r,s),g=(s.flags&128)!==0,M||g?(M=s.stateNode,c=g&&typeof c.getDerivedStateFromError!="function"?null:M.render(),s.flags|=1,r!==null&&g?(s.child=hs(s,r.child,null,b),s.child=hs(s,null,c,b)):pr(r,s,c,b),s.memoizedState=M.state,r=s.child):r=bn(r,s,b),r}function Gd(r,s,c,g){return ss(),s.flags|=256,pr(r,s,c,g),s.child}var qf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function qd(r){return{baseLanes:r,cachePool:cs()}}function Zd(r,s,c){return r=r!==null?r.childLanes&~c:0,s&&(r|=Ga),r}function Hd(r,s,c){var g=s.pendingProps,b=!1,M=(s.flags&128)!==0,B;if((B=M)||(B=r!==null&&r.memoizedState===null?!1:(pn.current&2)!==0),B&&(b=!0,s.flags&=-129),B=(s.flags&32)!==0,s.flags&=-33,r===null){if(Xt){if(b?dn(s):vo(),(r=Ai)?(r=Tp(r,aa),r=r!==null&&r.data!=="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:ns!==null?{id:rs,overflow:Fr}:null,retryLane:536870912,hydrationErrors:null},c=Mc(r),c.return=s,s.child=c,Hn=s,Ai=null)):r=null,r===null)throw Nr(s);return jn(r)?s.lanes=32:s.lanes=536870912,null}var Z=g.children;return g=g.fallback,b?(vo(),b=s.mode,Z=Hf({mode:"hidden",children:Z},b),g=so(g,b,c,null),Z.return=s,g.return=s,Z.sibling=g,s.child=Z,g=s.child,g.memoizedState=qd(c),g.childLanes=Zd(r,B,c),s.memoizedState=qf,Hl(null,g)):(dn(s),Zf(s,Z))}var ue=r.memoizedState;if(ue!==null&&(Z=ue.dehydrated,Z!==null)){if(M)s.flags&256?(dn(s),s.flags&=-257,s=Fh(r,s,c)):s.memoizedState!==null?(vo(),s.child=r.child,s.flags|=128,s=null):(vo(),Z=g.fallback,b=s.mode,g=Hf({mode:"visible",children:g.children},b),Z=so(Z,b,c,null),Z.flags|=2,g.return=s,Z.return=s,g.sibling=Z,s.child=g,hs(s,r.child,null,c),g=s.child,g.memoizedState=qd(c),g.childLanes=Zd(r,B,c),s.memoizedState=qf,s=Hl(null,g));else if(dn(s),jn(Z)){if(B=Z.nextSibling&&Z.nextSibling.dataset,B)var Pe=B.dgst;B=Pe,g=Error(oe(419)),g.stack="",g.digest=B,Ms({value:g,source:null,stack:null}),s=Fh(r,s,c)}else if(zn||Ta(r,s,c,!1),B=(c&r.childLanes)!==0,zn||B){if(B=Gi,B!==null&&(g=yl(B,c),g!==0&&g!==ue.retryLane))throw ue.retryLane=g,ba(r,g),Aa(B,r,g),Nd;da(Z)||rl(),s=Fh(r,s,c)}else da(Z)?(s.flags|=192,s.child=r.child,s=null):(r=ue.treeContext,Ai=gs(Z.nextSibling),Hn=s,Xt=!0,Ss=null,aa=!1,r!==null&&Ah(s,r),s=Zf(s,g.children),s.flags|=4096);return s}return b?(vo(),Z=g.fallback,b=s.mode,ue=r.child,Pe=ue.sibling,g=ra(ue,{mode:"hidden",children:g.children}),g.subtreeFlags=ue.subtreeFlags&65011712,Pe!==null?Z=ra(Pe,Z):(Z=so(Z,b,c,null),Z.flags|=2),Z.return=s,g.return=s,g.sibling=Z,s.child=g,Hl(null,g),g=s.child,Z=r.child.memoizedState,Z===null?Z=qd(c):(b=Z.cachePool,b!==null?(ue=$i._currentValue,b=b.parent!==ue?{parent:ue,pool:ue}:b):b=cs(),Z={baseLanes:Z.baseLanes|c,cachePool:b}),g.memoizedState=Z,g.childLanes=Zd(r,B,c),s.memoizedState=qf,Hl(r.child,g)):(dn(s),c=r.child,r=c.sibling,c=ra(c,{mode:"visible",children:g.children}),c.return=s,c.sibling=null,r!==null&&(B=s.deletions,B===null?(s.deletions=[r],s.flags|=16):B.push(r)),s.child=c,s.memoizedState=null,c)}function Zf(r,s){return s=Hf({mode:"visible",children:s},r.mode),s.return=r,r.child=s}function Hf(r,s){return r=na(22,r,null,s),r.lanes=0,r}function Fh(r,s,c){return hs(s,r.child,null,c),r=Zf(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function $d(r,s,c){r.lanes|=s;var g=r.alternate;g!==null&&(g.lanes|=s),Ec(r.return,s,c)}function Nh(r,s,c,g,b,M){var B=r.memoizedState;B===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:g,tail:c,tailMode:b,treeForkCount:M}:(B.isBackwards=s,B.rendering=null,B.renderingStartTime=0,B.last=g,B.tail=c,B.tailMode=b,B.treeForkCount=M)}function jc(r,s,c){var g=s.pendingProps,b=g.revealOrder,M=g.tail;g=g.children;var B=pn.current,Z=(B&2)!==0;if(Z?(B=B&1|2,s.flags|=128):B&=1,ct(pn,B),pr(r,s,g,c),g=Xt?co:0,!Z&&r!==null&&(r.flags&128)!==0)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&$d(r,c,s);else if(r.tag===19)$d(r,c,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(b){case"forwards":for(c=s.child,b=null;c!==null;)r=c.alternate,r!==null&&Ps(r)===null&&(b=c),c=c.sibling;c=b,c===null?(b=s.child,s.child=null):(b=c.sibling,c.sibling=null),Nh(s,!1,b,c,M,g);break;case"backwards":case"unstable_legacy-backwards":for(c=null,b=s.child,s.child=null;b!==null;){if(r=b.alternate,r!==null&&Ps(r)===null){s.child=b;break}r=b.sibling,b.sibling=c,c=b,b=r}Nh(s,!0,c,null,M,g);break;case"together":Nh(s,!1,null,null,void 0,g);break;default:s.memoizedState=null}return s.child}function bn(r,s,c){if(r!==null&&(s.dependencies=r.dependencies),ps|=s.lanes,(c&s.childLanes)===0)if(r!==null){if(Ta(r,s,c,!1),(c&s.childLanes)===0)return null}else return null;if(r!==null&&s.child!==r.child)throw Error(oe(153));if(s.child!==null){for(r=s.child,c=ra(r,r.pendingProps),s.child=c,c.return=s;r.sibling!==null;)r=r.sibling,c=c.sibling=ra(r,r.pendingProps),c.return=s;c.sibling=null}return s.child}function $f(r,s){return(r.lanes&s)!==0?!0:(r=r.dependencies,!!(r!==null&&Ol(r)))}function Xd(r,s,c){switch(s.tag){case 3:Si(s,s.stateNode.containerInfo),As(s,$i,r.memoizedState.cache),ss();break;case 27:case 5:vr(s);break;case 4:Si(s,s.stateNode.containerInfo);break;case 10:As(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,Dr(s),null;break;case 13:var g=s.memoizedState;if(g!==null)return g.dehydrated!==null?(dn(s),s.flags|=128,null):(c&s.child.childLanes)!==0?Hd(r,s,c):(dn(s),r=bn(r,s,c),r!==null?r.sibling:null);dn(s);break;case 19:var b=(r.flags&128)!==0;if(g=(c&s.childLanes)!==0,g||(Ta(r,s,c,!1),g=(c&s.childLanes)!==0),b){if(g)return jc(r,s,c);s.flags|=128}if(b=s.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),ct(pn,pn.current),g)break;return null;case 22:return s.lanes=0,$u(r,s,c,s.pendingProps);case 24:As(s,$i,r.memoizedState.cache)}return bn(r,s,c)}function Xp(r,s,c){if(r!==null)if(r.memoizedProps!==s.pendingProps)zn=!0;else{if(!$f(r,c)&&(s.flags&128)===0)return zn=!1,Xd(r,s,c);zn=(r.flags&131072)!==0}else zn=!1,Xt&&(s.flags&1048576)!==0&&Eh(s,co,s.index);switch(s.lanes=0,s.tag){case 16:e:{var g=s.pendingProps;if(r=oa(s.elementType),s.type=r,typeof r=="function")Tc(r)?(g=ca(r,g),s.tag=1,s=Gf(null,s,r,g,c)):(s.tag=0,s=jd(null,s,r,g,c));else{if(r!=null){var b=r.$$typeof;if(b===tr){s.tag=11,s=Vd(null,s,r,g,c);break e}else if(b===Lt){s.tag=14,s=Hu(null,s,r,g,c);break e}}throw s=Qr(r)||r,Error(oe(306,s,""))}}return s;case 0:return jd(r,s,s.type,s.pendingProps,c);case 1:return g=s.type,b=ca(g,s.pendingProps),Gf(r,s,g,b,c);case 3:e:{if(Si(s,s.stateNode.containerInfo),r===null)throw Error(oe(387));g=s.pendingProps;var M=s.memoizedState;b=M.element,Ba(r,s),Vl(s,g,null,c);var B=s.memoizedState;if(g=B.cache,As(s,$i,g),g!==M.cache&&Ac(s,[$i],c,!0),Ho(),g=B.element,M.isDehydrated)if(M={element:g,isDehydrated:!1,cache:B.cache},s.updateQueue.baseState=M,s.memoizedState=M,s.flags&256){s=Gd(r,s,g,c);break e}else if(g!==b){b=Er(Error(oe(424)),s),Ms(b),s=Gd(r,s,g,c);break e}else{switch(r=s.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(Ai=gs(r.firstChild),Hn=s,Xt=!0,Ss=null,aa=!0,c=Ic(s,null,g,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(ss(),g===b){s=bn(r,s,c);break e}pr(r,s,g,c)}s=s.child}return s;case 26:return Uf(r,s),r===null?(c=vd(s.type,null,s.pendingProps,null))?s.memoizedState=c:Xt||(c=s.type,r=s.pendingProps,g=sl(kt.current).createElement(c),g[Ii]=s,g[et]=r,Ln(g,c,r),nn(g),s.stateNode=g):s.memoizedState=vd(s.type,r.memoizedProps,s.pendingProps,r.memoizedState),null;case 27:return vr(s),r===null&&Xt&&(g=s.stateNode=Tm(s.type,s.pendingProps,kt.current),Hn=s,aa=!0,b=Ai,ln(s.type)?(_d=b,Ai=gs(g.firstChild)):Ai=b),pr(r,s,s.pendingProps.children,c),Uf(r,s),r===null&&(s.flags|=4194304),s.child;case 5:return r===null&&Xt&&((b=g=Ai)&&(g=Qn(g,s.type,s.pendingProps,aa),g!==null?(s.stateNode=g,Hn=s,Ai=gs(g.firstChild),aa=!1,b=!0):b=!1),b||Nr(s)),vr(s),b=s.type,M=s.pendingProps,B=r!==null?r.memoizedProps:null,g=M.children,hf(b,M)?g=null:B!==null&&hf(b,B)&&(s.flags|=32),s.memoizedState!==null&&(b=Ul(r,s,qu,null,null,c),mf._currentValue=b),Uf(r,s),pr(r,s,g,c),s.child;case 6:return r===null&&Xt&&((r=c=Ai)&&(c=Wn(c,s.pendingProps,aa),c!==null?(s.stateNode=c,Hn=s,Ai=null,r=!0):r=!1),r||Nr(s)),null;case 13:return Hd(r,s,c);case 4:return Si(s,s.stateNode.containerInfo),g=s.pendingProps,r===null?s.child=hs(s,null,g,c):pr(r,s,g,c),s.child;case 11:return Vd(r,s,s.type,s.pendingProps,c);case 7:return pr(r,s,s.pendingProps,c),s.child;case 8:return pr(r,s,s.pendingProps.children,c),s.child;case 12:return pr(r,s,s.pendingProps.children,c),s.child;case 10:return g=s.pendingProps,As(s,s.type,g.value),pr(r,s,g.children,c),s.child;case 9:return b=s.type._context,g=s.pendingProps.children,Cs(s),b=xn(b),g=g(b),s.flags|=1,pr(r,s,g,c),s.child;case 14:return Hu(r,s,s.type,s.pendingProps,c);case 15:return Hp(r,s,s.type,s.pendingProps,c);case 19:return jc(r,s,c);case 31:return $m(r,s,c);case 22:return $u(r,s,c,s.pendingProps);case 24:return Cs(s),g=xn($i),r===null?(b=Bu(),b===null&&(b=Gi,M=ho(),b.pooledCache=M,M.refCount++,M!==null&&(b.pooledCacheLanes|=c),b=M),s.memoizedState={parent:g,cache:b},Rc(s),As(s,$i,b)):((r.lanes&c)!==0&&(Ba(r,s),Vl(s,null,null,c),Ho()),b=r.memoizedState,M=s.memoizedState,b.parent!==g?(b={parent:g,cache:g},s.memoizedState=b,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=b),As(s,$i,g)):(g=M.cache,As(s,$i,g),g!==b.cache&&Ac(s,[$i],c,!0))),pr(r,s,s.pendingProps.children,c),s.child;case 29:throw s.pendingProps}throw Error(oe(156,s.tag))}function wo(r){r.flags|=4}function Yd(r,s,c,g,b){if((s=(r.mode&32)!==0)&&(s=!1),s){if(r.flags|=16777216,(b&335544128)===b)if(r.stateNode.complete)r.flags|=8192;else if(hp())r.flags|=8192;else throw qo=Fu,ku}else r.flags&=-16777217}function Yp(r,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!zp(s))if(hp())r.flags|=8192;else throw qo=Fu,ku}function Vh(r,s){s!==null&&(r.flags|=4),r.flags&16384&&(s=r.tag!==22?mi():536870912,r.lanes|=s,$c|=s)}function jh(r,s){if(!Xt)switch(r.tailMode){case"hidden":s=r.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var g=null;c!==null;)c.alternate!==null&&(g=c),c=c.sibling;g===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:g.sibling=null}}function Ui(r){var s=r.alternate!==null&&r.alternate.child===r.child,c=0,g=0;if(s)for(var b=r.child;b!==null;)c|=b.lanes|b.childLanes,g|=b.subtreeFlags&65011712,g|=b.flags&65011712,b.return=r,b=b.sibling;else for(b=r.child;b!==null;)c|=b.lanes|b.childLanes,g|=b.subtreeFlags,g|=b.flags,b.return=r,b=b.sibling;return r.subtreeFlags|=g,r.childLanes=c,s}function Qp(r,s,c){var g=s.pendingProps;switch(Ll(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ui(s),null;case 1:return Ui(s),null;case 3:return c=s.stateNode,g=null,r!==null&&(g=r.memoizedState.cache),s.memoizedState.cache!==g&&(s.flags|=2048),us($i),Ri(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(as(s)?wo(s):r===null||r.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,os())),Ui(s),null;case 26:var b=s.type,M=s.memoizedState;return r===null?(wo(s),M!==null?(Ui(s),Yp(s,M)):(Ui(s),Yd(s,b,null,g,c))):M?M!==r.memoizedState?(wo(s),Ui(s),Yp(s,M)):(Ui(s),s.flags&=-16777217):(r=r.memoizedProps,r!==g&&wo(s),Ui(s),Yd(s,b,r,g,c)),null;case 27:if(Hs(s),c=kt.current,b=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==g&&wo(s);else{if(!g){if(s.stateNode===null)throw Error(oe(166));return Ui(s),null}r=gt.current,as(s)?sa(s):(r=Tm(b,g,c),s.stateNode=r,wo(s))}return Ui(s),null;case 5:if(Hs(s),b=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==g&&wo(s);else{if(!g){if(s.stateNode===null)throw Error(oe(166));return Ui(s),null}if(M=gt.current,as(s))sa(s);else{var B=sl(kt.current);switch(M){case 1:M=B.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:M=B.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":M=B.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":M=B.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":M=B.createElement("div"),M.innerHTML="<script><\/script>",M=M.removeChild(M.firstChild);break;case"select":M=typeof g.is=="string"?B.createElement("select",{is:g.is}):B.createElement("select"),g.multiple?M.multiple=!0:g.size&&(M.size=g.size);break;default:M=typeof g.is=="string"?B.createElement(b,{is:g.is}):B.createElement(b)}}M[Ii]=s,M[et]=g;e:for(B=s.child;B!==null;){if(B.tag===5||B.tag===6)M.appendChild(B.stateNode);else if(B.tag!==4&&B.tag!==27&&B.child!==null){B.child.return=B,B=B.child;continue}if(B===s)break e;for(;B.sibling===null;){if(B.return===null||B.return===s)break e;B=B.return}B.sibling.return=B.return,B=B.sibling}s.stateNode=M;e:switch(Ln(M,b,g),b){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}g&&wo(s)}}return Ui(s),Yd(s,s.type,r===null?null:r.memoizedProps,s.pendingProps,c),null;case 6:if(r&&s.stateNode!=null)r.memoizedProps!==g&&wo(s);else{if(typeof g!="string"&&s.stateNode===null)throw Error(oe(166));if(r=kt.current,as(s)){if(r=s.stateNode,c=s.memoizedProps,g=null,b=Hn,b!==null)switch(b.tag){case 27:case 5:g=b.memoizedProps}r[Ii]=s,r=!!(r.nodeValue===c||g!==null&&g.suppressHydrationWarning===!0||cd(r.nodeValue,c)),r||Nr(s,!0)}else r=sl(r).createTextNode(g),r[Ii]=s,s.stateNode=r}return Ui(s),null;case 31:if(c=s.memoizedState,r===null||r.memoizedState!==null){if(g=as(s),c!==null){if(r===null){if(!g)throw Error(oe(318));if(r=s.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(oe(557));r[Ii]=s}else ss(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Ui(s),r=!1}else c=os(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=c),r=!0;if(!r)return s.flags&256?(jr(s),s):(jr(s),null);if((s.flags&128)!==0)throw Error(oe(558))}return Ui(s),null;case 13:if(g=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(b=as(s),g!==null&&g.dehydrated!==null){if(r===null){if(!b)throw Error(oe(318));if(b=s.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(oe(317));b[Ii]=s}else ss(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Ui(s),b=!1}else b=os(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=b),b=!0;if(!b)return s.flags&256?(jr(s),s):(jr(s),null)}return jr(s),(s.flags&128)!==0?(s.lanes=c,s):(c=g!==null,r=r!==null&&r.memoizedState!==null,c&&(g=s.child,b=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(b=g.alternate.memoizedState.cachePool.pool),M=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(M=g.memoizedState.cachePool.pool),M!==b&&(g.flags|=2048)),c!==r&&c&&(s.child.flags|=8192),Vh(s,s.updateQueue),Ui(s),null);case 4:return Ri(),r===null&&ld(s.stateNode.containerInfo),Ui(s),null;case 10:return us(s.type),Ui(s),null;case 19:if(Qe(pn),g=s.memoizedState,g===null)return Ui(s),null;if(b=(s.flags&128)!==0,M=g.rendering,M===null)if(b)jh(g,!1);else{if(In!==0||r!==null&&(r.flags&128)!==0)for(r=s.child;r!==null;){if(M=Ps(r),M!==null){for(s.flags|=128,jh(g,!1),r=M.updateQueue,s.updateQueue=r,Vh(s,r),s.subtreeFlags=0,r=c,c=s.child;c!==null;)Nf(c,r),c=c.sibling;return ct(pn,pn.current&1|2),Xt&&Ts(s,g.treeForkCount),s.child}r=r.sibling}g.tail!==null&&Gn()>Yh&&(s.flags|=128,b=!0,jh(g,!1),s.lanes=4194304)}else{if(!b)if(r=Ps(M),r!==null){if(s.flags|=128,b=!0,r=r.updateQueue,s.updateQueue=r,Vh(s,r),jh(g,!0),g.tail===null&&g.tailMode==="hidden"&&!M.alternate&&!Xt)return Ui(s),null}else 2*Gn()-g.renderingStartTime>Yh&&c!==536870912&&(s.flags|=128,b=!0,jh(g,!1),s.lanes=4194304);g.isBackwards?(M.sibling=s.child,s.child=M):(r=g.last,r!==null?r.sibling=M:s.child=M,g.last=M)}return g.tail!==null?(r=g.tail,g.rendering=r,g.tail=r.sibling,g.renderingStartTime=Gn(),r.sibling=null,c=pn.current,ct(pn,b?c&1|2:c&1),Xt&&Ts(s,g.treeForkCount),r):(Ui(s),null);case 22:case 23:return jr(s),yo(),g=s.memoizedState!==null,r!==null?r.memoizedState!==null!==g&&(s.flags|=8192):g&&(s.flags|=8192),g?(c&536870912)!==0&&(s.flags&128)===0&&(Ui(s),s.subtreeFlags&6&&(s.flags|=8192)):Ui(s),c=s.updateQueue,c!==null&&Vh(s,c.retryQueue),c=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),g=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(g=s.memoizedState.cachePool.pool),g!==c&&(s.flags|=2048),r!==null&&Qe(Oa),null;case 24:return c=null,r!==null&&(c=r.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),us($i),Ui(s),null;case 25:return null;case 30:return null}throw Error(oe(156,s.tag))}function Wp(r,s){switch(Ll(s),s.tag){case 1:return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return us($i),Ri(),r=s.flags,(r&65536)!==0&&(r&128)===0?(s.flags=r&-65537|128,s):null;case 26:case 27:case 5:return Hs(s),null;case 31:if(s.memoizedState!==null){if(jr(s),s.alternate===null)throw Error(oe(340));ss()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 13:if(jr(s),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(oe(340));ss()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return Qe(pn),null;case 4:return Ri(),null;case 10:return us(s.type),null;case 22:case 23:return jr(s),yo(),r!==null&&Qe(Oa),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 24:return us($i),null;case 25:return null;default:return null}}function Kp(r,s){switch(Ll(s),s.tag){case 3:us($i),Ri();break;case 26:case 27:case 5:Hs(s);break;case 4:Ri();break;case 31:s.memoizedState!==null&&jr(s);break;case 13:jr(s);break;case 19:Qe(pn);break;case 10:us(s.type);break;case 22:case 23:jr(s),yo(),r!==null&&Qe(Oa);break;case 24:us($i)}}function Uh(r,s){try{var c=s.updateQueue,g=c!==null?c.lastEffect:null;if(g!==null){var b=g.next;c=b;do{if((c.tag&r)===r){g=void 0;var M=c.create,B=c.inst;g=M(),B.destroy=g}c=c.next}while(c!==b)}}catch(Z){bi(s,s.return,Z)}}function $l(r,s,c){try{var g=s.updateQueue,b=g!==null?g.lastEffect:null;if(b!==null){var M=b.next;g=M;do{if((g.tag&r)===r){var B=g.inst,Z=B.destroy;if(Z!==void 0){B.destroy=void 0,b=s;var ue=c,Pe=Z;try{Pe()}catch(Ge){bi(b,ue,Ge)}}}g=g.next}while(g!==M)}}catch(Ge){bi(s,s.return,Ge)}}function Gh(r){var s=r.updateQueue;if(s!==null){var c=r.stateNode;try{Ph(s,c)}catch(g){bi(r,r.return,g)}}}function Xf(r,s,c){c.props=ca(r.type,r.memoizedProps),c.state=r.memoizedState;try{c.componentWillUnmount()}catch(g){bi(r,s,g)}}function Uc(r,s){try{var c=r.ref;if(c!==null){switch(r.tag){case 26:case 27:case 5:var g=r.stateNode;break;case 30:g=r.stateNode;break;default:g=r.stateNode}typeof c=="function"?r.refCleanup=c(g):c.current=g}}catch(b){bi(r,s,b)}}function Gr(r,s){var c=r.ref,g=r.refCleanup;if(c!==null)if(typeof g=="function")try{g()}catch(b){bi(r,s,b)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(b){bi(r,s,b)}else c.current=null}function Gc(r){var s=r.type,c=r.memoizedProps,g=r.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":c.autoFocus&&g.focus();break e;case"img":c.src?g.src=c.src:c.srcSet&&(g.srcset=c.srcSet)}}catch(b){bi(r,r.return,b)}}function Qd(r,s,c){try{var g=r.stateNode;uf(g,r.type,c,s),g[et]=s}catch(b){bi(r,r.return,b)}}function Jp(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&ln(r.type)||r.tag===4}function Wd(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Jp(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&ln(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Kd(r,s,c){var g=r.tag;if(g===5||g===6)r=r.stateNode,s?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(r,s):(s=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,s.appendChild(r),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=Ra));else if(g!==4&&(g===27&&ln(r.type)&&(c=r.stateNode,s=null),r=r.child,r!==null))for(Kd(r,s,c),r=r.sibling;r!==null;)Kd(r,s,c),r=r.sibling}function Yf(r,s,c){var g=r.tag;if(g===5||g===6)r=r.stateNode,s?c.insertBefore(r,s):c.appendChild(r);else if(g!==4&&(g===27&&ln(r.type)&&(c=r.stateNode),r=r.child,r!==null))for(Yf(r,s,c),r=r.sibling;r!==null;)Yf(r,s,c),r=r.sibling}function em(r){var s=r.stateNode,c=r.memoizedProps;try{for(var g=r.type,b=s.attributes;b.length;)s.removeAttributeNode(b[0]);Ln(s,g,c),s[Ii]=r,s[et]=c}catch(M){bi(r,r.return,M)}}var Jo=!1,Dn=!1,Jd=!1,ep=typeof WeakSet=="function"?WeakSet:Set,Pn=null;function Xm(r,s){if(r=r.containerInfo,hd=lh,r=_c(r),Mu(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else e:{c=(c=r.ownerDocument)&&c.defaultView||window;var g=c.getSelection&&c.getSelection();if(g&&g.rangeCount!==0){c=g.anchorNode;var b=g.anchorOffset,M=g.focusNode;g=g.focusOffset;try{c.nodeType,M.nodeType}catch{c=null;break e}var B=0,Z=-1,ue=-1,Pe=0,Ge=0,We=r,Re=null;t:for(;;){for(var Be;We!==c||b!==0&&We.nodeType!==3||(Z=B+b),We!==M||g!==0&&We.nodeType!==3||(ue=B+g),We.nodeType===3&&(B+=We.nodeValue.length),(Be=We.firstChild)!==null;)Re=We,We=Be;for(;;){if(We===r)break t;if(Re===c&&++Pe===b&&(Z=B),Re===M&&++Ge===g&&(ue=B),(Be=We.nextSibling)!==null)break;We=Re,Re=We.parentNode}We=Be}c=Z===-1||ue===-1?null:{start:Z,end:ue}}else c=null}c=c||{start:0,end:0}}else c=null;for(fd={focusedElem:r,selectionRange:c},lh=!1,Pn=s;Pn!==null;)if(s=Pn,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,Pn=r;else for(;Pn!==null;){switch(s=Pn,M=s.alternate,r=s.flags,s.tag){case 0:if((r&4)!==0&&(r=s.updateQueue,r=r!==null?r.events:null,r!==null))for(c=0;c<r.length;c++)b=r[c],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&M!==null){r=void 0,c=s,b=M.memoizedProps,M=M.memoizedState,g=c.stateNode;try{var _t=ca(c.type,b);r=g.getSnapshotBeforeUpdate(_t,M),g.__reactInternalSnapshotBeforeUpdate=r}catch(Dt){bi(c,c.return,Dt)}}break;case 3:if((r&1024)!==0){if(r=s.stateNode.containerInfo,c=r.nodeType,c===9)qr(r);else if(c===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":qr(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(oe(163))}if(r=s.sibling,r!==null){r.return=s.return,Pn=r;break}Pn=s.return}}function mn(r,s,c){var g=c.flags;switch(c.tag){case 0:case 11:case 15:To(r,c),g&4&&Uh(5,c);break;case 1:if(To(r,c),g&4)if(r=c.stateNode,s===null)try{r.componentDidMount()}catch(B){bi(c,c.return,B)}else{var b=ca(c.type,s.memoizedProps);s=s.memoizedState;try{r.componentDidUpdate(b,s,r.__reactInternalSnapshotBeforeUpdate)}catch(B){bi(c,c.return,B)}}g&64&&Gh(c),g&512&&Uc(c,c.return);break;case 3:if(To(r,c),g&64&&(r=c.updateQueue,r!==null)){if(s=null,c.child!==null)switch(c.child.tag){case 27:case 5:s=c.child.stateNode;break;case 1:s=c.child.stateNode}try{Ph(r,s)}catch(B){bi(c,c.return,B)}}break;case 27:s===null&&g&4&&em(c);case 26:case 5:To(r,c),s===null&&g&4&&Gc(c),g&512&&Uc(c,c.return);break;case 12:To(r,c);break;case 31:To(r,c),g&4&&tp(r,c);break;case 13:To(r,c),g&4&&ip(r,c),g&64&&(r=c.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(c=tg.bind(null,c),gd(r,c))));break;case 22:if(g=c.memoizedState!==null||Jo,!g){s=s!==null&&s.memoizedState!==null||Dn,b=Jo;var M=Dn;Jo=g,(Dn=s)&&!M?el(r,c,(c.subtreeFlags&8772)!==0):To(r,c),Jo=b,Dn=M}break;case 30:break;default:To(r,c)}}function Xu(r){var s=r.alternate;s!==null&&(r.alternate=null,Xu(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&Ao(s)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var on=null,Ir=!1;function ds(r,s,c){for(c=c.child;c!==null;)qc(r,s,c),c=c.sibling}function qc(r,s,c){if(he&&typeof he.onCommitFiberUnmount=="function")try{he.onCommitFiberUnmount(ge,c)}catch{}switch(c.tag){case 26:Dn||Gr(c,s),ds(r,s,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Dn||Gr(c,s);var g=on,b=Ir;ln(c.type)&&(on=c.stateNode,Ir=!1),ds(r,s,c),th(c.stateNode),on=g,Ir=b;break;case 5:Dn||Gr(c,s);case 6:if(g=on,b=Ir,on=null,ds(r,s,c),on=g,Ir=b,on!==null)if(Ir)try{(on.nodeType===9?on.body:on.nodeName==="HTML"?on.ownerDocument.body:on).removeChild(c.stateNode)}catch(M){bi(c,s,M)}else try{on.removeChild(c.stateNode)}catch(M){bi(c,s,M)}break;case 18:on!==null&&(Ir?(r=on,ms(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,c.stateNode),hh(r)):ms(on,c.stateNode));break;case 4:g=on,b=Ir,on=c.stateNode.containerInfo,Ir=!0,ds(r,s,c),on=g,Ir=b;break;case 0:case 11:case 14:case 15:$l(2,c,s),Dn||$l(4,c,s),ds(r,s,c);break;case 1:Dn||(Gr(c,s),g=c.stateNode,typeof g.componentWillUnmount=="function"&&Xf(c,s,g)),ds(r,s,c);break;case 21:ds(r,s,c);break;case 22:Dn=(g=Dn)||c.memoizedState!==null,ds(r,s,c),Dn=g;break;default:ds(r,s,c)}}function tp(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{hh(r)}catch(c){bi(s,s.return,c)}}}function ip(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{hh(r)}catch(c){bi(s,s.return,c)}}function qh(r){switch(r.tag){case 31:case 13:case 19:var s=r.stateNode;return s===null&&(s=r.stateNode=new ep),s;case 22:return r=r.stateNode,s=r._retryCache,s===null&&(s=r._retryCache=new ep),s;default:throw Error(oe(435,r.tag))}}function Zc(r,s){var c=qh(r);s.forEach(function(g){if(!c.has(g)){c.add(g);var b=ig.bind(null,r,g);g.then(b,b)}})}function sr(r,s){var c=s.deletions;if(c!==null)for(var g=0;g<c.length;g++){var b=c[g],M=r,B=s,Z=B;e:for(;Z!==null;){switch(Z.tag){case 27:if(ln(Z.type)){on=Z.stateNode,Ir=!1;break e}break;case 5:on=Z.stateNode,Ir=!1;break e;case 3:case 4:on=Z.stateNode.containerInfo,Ir=!0;break e}Z=Z.return}if(on===null)throw Error(oe(160));qc(M,B,b),on=null,Ir=!1,M=b.alternate,M!==null&&(M.return=null),b.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Yu(s,r),s=s.sibling}var Ma=null;function Yu(r,s){var c=r.alternate,g=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:sr(s,r),mr(r),g&4&&($l(3,r,r.return),Uh(3,r),$l(5,r,r.return));break;case 1:sr(s,r),mr(r),g&512&&(Dn||c===null||Gr(c,c.return)),g&64&&Jo&&(r=r.updateQueue,r!==null&&(g=r.callbacks,g!==null&&(c=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=c===null?g:c.concat(g))));break;case 26:var b=Ma;if(sr(s,r),mr(r),g&512&&(Dn||c===null||Gr(c,c.return)),g&4){var M=c!==null?c.memoizedState:null;if(g=r.memoizedState,c===null)if(g===null)if(r.stateNode===null){e:{g=r.type,c=r.memoizedProps,b=b.ownerDocument||b;t:switch(g){case"title":M=b.getElementsByTagName("title")[0],(!M||M[Rt]||M[Ii]||M.namespaceURI==="http://www.w3.org/2000/svg"||M.hasAttribute("itemprop"))&&(M=b.createElement(g),b.head.insertBefore(M,b.querySelector("head > title"))),Ln(M,g,c),M[Ii]=r,nn(M),g=M;break e;case"link":var B=xd("link","href",b).get(g+(c.href||""));if(B){for(var Z=0;Z<B.length;Z++)if(M=B[Z],M.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&M.getAttribute("rel")===(c.rel==null?null:c.rel)&&M.getAttribute("title")===(c.title==null?null:c.title)&&M.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){B.splice(Z,1);break t}}M=b.createElement(g),Ln(M,g,c),b.head.appendChild(M);break;case"meta":if(B=xd("meta","content",b).get(g+(c.content||""))){for(Z=0;Z<B.length;Z++)if(M=B[Z],M.getAttribute("content")===(c.content==null?null:""+c.content)&&M.getAttribute("name")===(c.name==null?null:c.name)&&M.getAttribute("property")===(c.property==null?null:c.property)&&M.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&M.getAttribute("charset")===(c.charSet==null?null:c.charSet)){B.splice(Z,1);break t}}M=b.createElement(g),Ln(M,g,c),b.head.appendChild(M);break;default:throw Error(oe(468,g))}M[Ii]=r,nn(M),g=M}r.stateNode=g}else bd(b,r.type,r.stateNode);else r.stateNode=Cm(b,g,r.memoizedProps);else M!==g?(M===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):M.count--,g===null?bd(b,r.type,r.stateNode):Cm(b,g,r.memoizedProps)):g===null&&r.stateNode!==null&&Qd(r,r.memoizedProps,c.memoizedProps)}break;case 27:sr(s,r),mr(r),g&512&&(Dn||c===null||Gr(c,c.return)),c!==null&&g&4&&Qd(r,r.memoizedProps,c.memoizedProps);break;case 5:if(sr(s,r),mr(r),g&512&&(Dn||c===null||Gr(c,c.return)),r.flags&32){b=r.stateNode;try{bs(b,"")}catch(_t){bi(r,r.return,_t)}}g&4&&r.stateNode!=null&&(b=r.memoizedProps,Qd(r,b,c!==null?c.memoizedProps:b)),g&1024&&(Jd=!0);break;case 6:if(sr(s,r),mr(r),g&4){if(r.stateNode===null)throw Error(oe(162));g=r.memoizedProps,c=r.stateNode;try{c.nodeValue=g}catch(_t){bi(r,r.return,_t)}}break;case 3:if(ic=null,b=Ma,Ma=ih(s.containerInfo),sr(s,r),Ma=b,mr(r),g&4&&c!==null&&c.memoizedState.isDehydrated)try{hh(s.containerInfo)}catch(_t){bi(r,r.return,_t)}Jd&&(Jd=!1,tm(r));break;case 4:g=Ma,Ma=ih(r.stateNode.containerInfo),sr(s,r),mr(r),Ma=g;break;case 12:sr(s,r),mr(r);break;case 31:sr(s,r),mr(r),g&4&&(g=r.updateQueue,g!==null&&(r.updateQueue=null,Zc(r,g)));break;case 13:sr(s,r),mr(r),r.child.flags&8192&&r.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(Xc=Gn()),g&4&&(g=r.updateQueue,g!==null&&(r.updateQueue=null,Zc(r,g)));break;case 22:b=r.memoizedState!==null;var ue=c!==null&&c.memoizedState!==null,Pe=Jo,Ge=Dn;if(Jo=Pe||b,Dn=Ge||ue,sr(s,r),Dn=Ge,Jo=Pe,mr(r),g&8192)e:for(s=r.stateNode,s._visibility=b?s._visibility&-2:s._visibility|1,b&&(c===null||ue||Jo||Dn||Va(r)),c=null,s=r;;){if(s.tag===5||s.tag===26){if(c===null){ue=c=s;try{if(M=ue.stateNode,b)B=M.style,typeof B.setProperty=="function"?B.setProperty("display","none","important"):B.display="none";else{Z=ue.stateNode;var We=ue.memoizedProps.style,Re=We!=null&&We.hasOwnProperty("display")?We.display:null;Z.style.display=Re==null||typeof Re=="boolean"?"":(""+Re).trim()}}catch(_t){bi(ue,ue.return,_t)}}}else if(s.tag===6){if(c===null){ue=s;try{ue.stateNode.nodeValue=b?"":ue.memoizedProps}catch(_t){bi(ue,ue.return,_t)}}}else if(s.tag===18){if(c===null){ue=s;try{var Be=ue.stateNode;b?eu(Be,!0):eu(ue.stateNode,!1)}catch(_t){bi(ue,ue.return,_t)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===r)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;c===s&&(c=null),s=s.return}c===s&&(c=null),s.sibling.return=s.return,s=s.sibling}g&4&&(g=r.updateQueue,g!==null&&(c=g.retryQueue,c!==null&&(g.retryQueue=null,Zc(r,c))));break;case 19:sr(s,r),mr(r),g&4&&(g=r.updateQueue,g!==null&&(r.updateQueue=null,Zc(r,g)));break;case 30:break;case 21:break;default:sr(s,r),mr(r)}}function mr(r){var s=r.flags;if(s&2){try{for(var c,g=r.return;g!==null;){if(Jp(g)){c=g;break}g=g.return}if(c==null)throw Error(oe(160));switch(c.tag){case 27:var b=c.stateNode,M=Wd(r);Yf(r,M,b);break;case 5:var B=c.stateNode;c.flags&32&&(bs(B,""),c.flags&=-33);var Z=Wd(r);Yf(r,Z,B);break;case 3:case 4:var ue=c.stateNode.containerInfo,Pe=Wd(r);Kd(r,Pe,ue);break;default:throw Error(oe(161))}}catch(Ge){bi(r,r.return,Ge)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function tm(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var s=r;tm(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),r=r.sibling}}function To(r,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)mn(r,s.alternate,s),s=s.sibling}function Va(r){for(r=r.child;r!==null;){var s=r;switch(s.tag){case 0:case 11:case 14:case 15:$l(4,s,s.return),Va(s);break;case 1:Gr(s,s.return);var c=s.stateNode;typeof c.componentWillUnmount=="function"&&Xf(s,s.return,c),Va(s);break;case 27:th(s.stateNode);case 26:case 5:Gr(s,s.return),Va(s);break;case 22:s.memoizedState===null&&Va(s);break;case 30:Va(s);break;default:Va(s)}r=r.sibling}}function el(r,s,c){for(c=c&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var g=s.alternate,b=r,M=s,B=M.flags;switch(M.tag){case 0:case 11:case 15:el(b,M,c),Uh(4,M);break;case 1:if(el(b,M,c),g=M,b=g.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Pe){bi(g,g.return,Pe)}if(g=M,b=g.updateQueue,b!==null){var Z=g.stateNode;try{var ue=b.shared.hiddenCallbacks;if(ue!==null)for(b.shared.hiddenCallbacks=null,b=0;b<ue.length;b++)Lc(ue[b],Z)}catch(Pe){bi(g,g.return,Pe)}}c&&B&64&&Gh(M),Uc(M,M.return);break;case 27:em(M);case 26:case 5:el(b,M,c),c&&g===null&&B&4&&Gc(M),Uc(M,M.return);break;case 12:el(b,M,c);break;case 31:el(b,M,c),c&&B&4&&tp(b,M);break;case 13:el(b,M,c),c&&B&4&&ip(b,M);break;case 22:M.memoizedState===null&&el(b,M,c),Uc(M,M.return);break;case 30:break;default:el(b,M,c)}s=s.sibling}}function Qf(r,s){var c=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),r=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(r=s.memoizedState.cachePool.pool),r!==c&&(r!=null&&r.refCount++,c!=null&&fr(c))}function Qu(r,s){r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&fr(r))}function ja(r,s,c,g){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)np(r,s,c,g),s=s.sibling}function np(r,s,c,g){var b=s.flags;switch(s.tag){case 0:case 11:case 15:ja(r,s,c,g),b&2048&&Uh(9,s);break;case 1:ja(r,s,c,g);break;case 3:ja(r,s,c,g),b&2048&&(r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&fr(r)));break;case 12:if(b&2048){ja(r,s,c,g),r=s.stateNode;try{var M=s.memoizedProps,B=M.id,Z=M.onPostCommit;typeof Z=="function"&&Z(B,s.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(ue){bi(s,s.return,ue)}}else ja(r,s,c,g);break;case 31:ja(r,s,c,g);break;case 13:ja(r,s,c,g);break;case 23:break;case 22:M=s.stateNode,B=s.alternate,s.memoizedState!==null?M._visibility&2?ja(r,s,c,g):Zh(r,s):M._visibility&2?ja(r,s,c,g):(M._visibility|=2,Wu(r,s,c,g,(s.subtreeFlags&10256)!==0||!1)),b&2048&&Qf(B,s);break;case 24:ja(r,s,c,g),b&2048&&Qu(s.alternate,s);break;default:ja(r,s,c,g)}}function Wu(r,s,c,g,b){for(b=b&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var M=r,B=s,Z=c,ue=g,Pe=B.flags;switch(B.tag){case 0:case 11:case 15:Wu(M,B,Z,ue,b),Uh(8,B);break;case 23:break;case 22:var Ge=B.stateNode;B.memoizedState!==null?Ge._visibility&2?Wu(M,B,Z,ue,b):Zh(M,B):(Ge._visibility|=2,Wu(M,B,Z,ue,b)),b&&Pe&2048&&Qf(B.alternate,B);break;case 24:Wu(M,B,Z,ue,b),b&&Pe&2048&&Qu(B.alternate,B);break;default:Wu(M,B,Z,ue,b)}s=s.sibling}}function Zh(r,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var c=r,g=s,b=g.flags;switch(g.tag){case 22:Zh(c,g),b&2048&&Qf(g.alternate,g);break;case 24:Zh(c,g),b&2048&&Qu(g.alternate,g);break;default:Zh(c,g)}s=s.sibling}}var Hh=8192;function Hc(r,s,c){if(r.subtreeFlags&Hh)for(r=r.child;r!==null;)im(r,s,c),r=r.sibling}function im(r,s,c){switch(r.tag){case 26:Hc(r,s,c),r.flags&Hh&&r.memoizedState!==null&&zm(c,Ma,r.memoizedState,r.memoizedProps);break;case 5:Hc(r,s,c);break;case 3:case 4:var g=Ma;Ma=ih(r.stateNode.containerInfo),Hc(r,s,c),Ma=g;break;case 22:r.memoizedState===null&&(g=r.alternate,g!==null&&g.memoizedState!==null?(g=Hh,Hh=16777216,Hc(r,s,c),Hh=g):Hc(r,s,c));break;default:Hc(r,s,c)}}function nm(r){var s=r.alternate;if(s!==null&&(r=s.child,r!==null)){s.child=null;do s=r.sibling,r.sibling=null,r=s;while(r!==null)}}function tl(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var g=s[c];Pn=g,am(g,r)}nm(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)rm(r),r=r.sibling}function rm(r){switch(r.tag){case 0:case 11:case 15:tl(r),r.flags&2048&&$l(9,r,r.return);break;case 3:tl(r);break;case 12:tl(r);break;case 22:var s=r.stateNode;r.memoizedState!==null&&s._visibility&2&&(r.return===null||r.return.tag!==13)?(s._visibility&=-3,$h(r)):tl(r);break;default:tl(r)}}function $h(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var g=s[c];Pn=g,am(g,r)}nm(r)}for(r=r.child;r!==null;){switch(s=r,s.tag){case 0:case 11:case 15:$l(8,s,s.return),$h(s);break;case 22:c=s.stateNode,c._visibility&2&&(c._visibility&=-3,$h(s));break;default:$h(s)}r=r.sibling}}function am(r,s){for(;Pn!==null;){var c=Pn;switch(c.tag){case 0:case 11:case 15:$l(8,c,s);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var g=c.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:fr(c.memoizedState.cache)}if(g=c.child,g!==null)g.return=c,Pn=g;else e:for(c=r;Pn!==null;){g=Pn;var b=g.sibling,M=g.return;if(Xu(g),g===c){Pn=null;break e}if(b!==null){b.return=M,Pn=b;break e}Pn=M}}}var Ym={getCacheForType:function(r){var s=xn($i),c=s.data.get(r);return c===void 0&&(c=r(),s.data.set(r,c)),c},cacheSignal:function(){return xn($i).controller.signal}},Qm=typeof WeakMap=="function"?WeakMap:Map,vi=0,Gi=null,Wt=null,Yt=0,Di=0,Ua=null,Xl=!1,Ku=!1,Wf=!1,il=0,In=0,ps=0,Yl=0,rp=0,Ga=0,$c=0,Xh=null,Ea=null,Kf=!1,Xc=0,ap=0,Yh=1/0,Qh=null,Ql=null,Rn=0,Wl=null,Ju=null,nl=0,sp=0,op=null,lp=null,Wh=0,up=null;function xi(){return(vi&2)!==0&&Yt!==0?Yt&-Yt:Ue.T!==null?Jl():ur()}function Yc(){if(Ga===0)if((Yt&536870912)===0||Xt){var r=ci;ci<<=1,(ci&3932160)===0&&(ci=262144),Ga=r}else Ga=536870912;return r=zr.current,r!==null&&(r.flags|=32),Ga}function Aa(r,s,c){(r===Gi&&(Di===2||Di===9)||r.cancelPendingCommit!==null)&&(Ns(r,0),Kl(r,Yt,Ga,!1)),gi(r,c),((vi&2)===0||r!==Gi)&&(r===Gi&&((vi&2)===0&&(Yl|=c),In===4&&Kl(r,Yt,Ga,!1)),js(r))}function sm(r,s,c){if((vi&6)!==0)throw Error(oe(327));var g=!c&&(s&127)===0&&(s&r.expiredLanes)===0||_n(r,s),b=g?Km(r,s):td(r,s,!0),M=g;do{if(b===0){Ku&&!g&&Kl(r,s,0,!1);break}else{if(c=r.current.alternate,M&&!om(c)){b=td(r,s,!1),M=!1;continue}if(b===2){if(M=s,r.errorRecoveryDisabledLanes&M)var B=0;else B=r.pendingLanes&-536870913,B=B!==0?B:B&536870912?536870912:0;if(B!==0){s=B;e:{var Z=r;b=Xh;var ue=Z.current.memoizedState.isDehydrated;if(ue&&(Ns(Z,B).flags|=256),B=td(Z,B,!1),B!==2){if(Wf&&!ue){Z.errorRecoveryDisabledLanes|=M,Yl|=M,b=4;break e}M=Ea,Ea=b,M!==null&&(Ea===null?Ea=M:Ea.push.apply(Ea,M))}b=B}if(M=!1,b!==2)continue}}if(b===1){Ns(r,0),Kl(r,s,0,!0);break}e:{switch(g=r,M=b,M){case 0:case 1:throw Error(oe(345));case 4:if((s&4194048)!==s)break;case 6:Kl(g,s,Ga,!Xl);break e;case 2:Ea=null;break;case 3:case 5:break;default:throw Error(oe(329))}if((s&62914560)===s&&(b=Xc+300-Gn(),10<b)){if(Kl(g,s,Ga,!Xl),pi(g,0,!0)!==0)break e;nl=s,g.timeoutHandle=md(cp.bind(null,g,c,Ea,Qh,Kf,s,Ga,Yl,$c,Xl,M,"Throttled",-0,0),b);break e}cp(g,c,Ea,Qh,Kf,s,Ga,Yl,$c,Xl,M,null,-0,0)}}break}while(!0);js(r)}function cp(r,s,c,g,b,M,B,Z,ue,Pe,Ge,We,Re,Be){if(r.timeoutHandle=-1,We=s.subtreeFlags,We&8192||(We&16785408)===16785408){We={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ra},im(s,M,We);var _t=(M&62914560)===M?Xc-Gn():(M&4194048)===M?ap-Gn():0;if(_t=Dm(We,_t),_t!==null){nl=M,r.cancelPendingCommit=_t(hm.bind(null,r,s,M,c,g,b,B,Z,ue,Ge,We,null,Re,Be)),Kl(r,M,B,!Pe);return}}hm(r,s,M,c,g,b,B,Z,ue)}function om(r){for(var s=r;;){var c=s.tag;if((c===0||c===11||c===15)&&s.flags&16384&&(c=s.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var g=0;g<c.length;g++){var b=c[g],M=b.getSnapshot;b=b.value;try{if(!kr(M(),b))return!1}catch{return!1}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Kl(r,s,c,g){s&=~rp,s&=~Yl,r.suspendedLanes|=s,r.pingedLanes&=~s,g&&(r.warmLanes|=s),g=r.expirationTimes;for(var b=s;0<b;){var M=31-Ve(b),B=1<<M;g[M]=-1,b&=~B}c!==0&&Mi(r,c,s)}function Kh(){return(vi&6)===0?(ec(0),!1):!0}function Jf(){if(Wt!==null){if(Di===0)var r=Wt.return;else r=Wt,ls=wa=null,Bs(r),Sa=null,Nu=0,r=Wt;for(;r!==null;)Kp(r.alternate,r),r=r.return;Wt=null}}function Ns(r,s){var c=r.timeoutHandle;c!==-1&&(r.timeoutHandle=-1,og(c)),c=r.cancelPendingCommit,c!==null&&(r.cancelPendingCommit=null,c()),nl=0,Jf(),Gi=r,Wt=c=ra(r.current,null),Yt=s,Di=0,Ua=null,Xl=!1,Ku=_n(r,s),Wf=!1,$c=Ga=rp=Yl=ps=In=0,Ea=Xh=null,Kf=!1,(s&8)!==0&&(s|=s&32);var g=r.entangledLanes;if(g!==0)for(r=r.entanglements,g&=s;0<g;){var b=31-Ve(g),M=1<<b;s|=r[b],g&=~M}return il=s,jo(),c}function ed(r,s){vt=null,Ue.H=Wi,s===nt||s===po?(s=Dc(),Di=3):s===ku?(s=Dc(),Di=4):Di=s===Nd?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Ua=s,Wt===null&&(In=1,Ko(r,Er(s,r.current)))}function hp(){var r=zr.current;return r===null?!0:(Yt&4194048)===Yt?$n===null:(Yt&62914560)===Yt||(Yt&536870912)!==0?r===$n:!1}function fp(){var r=Ue.H;return Ue.H=Wi,r===null?Wi:r}function Jh(){var r=Ue.A;return Ue.A=Ym,r}function rl(){In=4,Xl||(Yt&4194048)!==Yt&&zr.current!==null||(Ku=!0),(ps&134217727)===0&&(Yl&134217727)===0||Gi===null||Kl(Gi,Yt,Ga,!1)}function td(r,s,c){var g=vi;vi|=2;var b=fp(),M=Jh();(Gi!==r||Yt!==s)&&(Qh=null,Ns(r,s)),s=!1;var B=In;e:do try{if(Di!==0&&Wt!==null){var Z=Wt,ue=Ua;switch(Di){case 8:Jf(),B=6;break e;case 3:case 2:case 9:case 6:zr.current===null&&(s=!0);var Pe=Di;if(Di=0,Ua=null,Qc(r,Z,ue,Pe),c&&Ku){B=0;break e}break;default:Pe=Di,Di=0,Ua=null,Qc(r,Z,ue,Pe)}}Wm(),B=In;break}catch(Ge){ed(r,Ge)}while(!0);return s&&r.shellSuspendCounter++,ls=wa=null,vi=g,Ue.H=b,Ue.A=M,Wt===null&&(Gi=null,Yt=0,jo()),B}function Wm(){for(;Wt!==null;)lm(Wt)}function Km(r,s){var c=vi;vi|=2;var g=fp(),b=Jh();Gi!==r||Yt!==s?(Qh=null,Yh=Gn()+500,Ns(r,s)):Ku=_n(r,s);e:do try{if(Di!==0&&Wt!==null){s=Wt;var M=Ua;t:switch(Di){case 1:Di=0,Ua=null,Qc(r,s,M,1);break;case 2:case 9:if(mo(M)){Di=0,Ua=null,um(s);break}s=function(){Di!==2&&Di!==9||Gi!==r||(Di=7),js(r)},M.then(s,s);break e;case 3:Di=7;break e;case 4:Di=5;break e;case 7:mo(M)?(Di=0,Ua=null,um(s)):(Di=0,Ua=null,Qc(r,s,M,7));break;case 5:var B=null;switch(Wt.tag){case 26:B=Wt.memoizedState;case 5:case 27:var Z=Wt;if(B?zp(B):Z.stateNode.complete){Di=0,Ua=null;var ue=Z.sibling;if(ue!==null)Wt=ue;else{var Pe=Z.return;Pe!==null?(Wt=Pe,id(Pe)):Wt=null}break t}}Di=0,Ua=null,Qc(r,s,M,5);break;case 6:Di=0,Ua=null,Qc(r,s,M,6);break;case 8:Jf(),In=6;break e;default:throw Error(oe(462))}}Jm();break}catch(Ge){ed(r,Ge)}while(!0);return ls=wa=null,Ue.H=g,Ue.A=b,vi=c,Wt!==null?0:(Gi=null,Yt=0,jo(),In)}function Jm(){for(;Wt!==null&&!Da();)lm(Wt)}function lm(r){var s=Xp(r.alternate,r,il);r.memoizedProps=r.pendingProps,s===null?id(r):Wt=s}function um(r){var s=r,c=s.alternate;switch(s.tag){case 15:case 0:s=Ud(c,s,s.pendingProps,s.type,void 0,Yt);break;case 11:s=Ud(c,s,s.pendingProps,s.type.render,s.ref,Yt);break;case 5:Bs(s);default:Kp(c,s),s=Wt=Nf(s,il),s=Xp(c,s,il)}r.memoizedProps=r.pendingProps,s===null?id(r):Wt=s}function Qc(r,s,c,g){ls=wa=null,Bs(s),Sa=null,Nu=0;var b=s.return;try{if(Fd(r,b,s,c,Yt)){In=1,Ko(r,Er(c,r.current)),Wt=null;return}}catch(M){if(b!==null)throw Wt=b,M;In=1,Ko(r,Er(c,r.current)),Wt=null;return}s.flags&32768?(Xt||g===1?r=!0:Ku||(Yt&536870912)!==0?r=!1:(Xl=r=!0,(g===2||g===9||g===3||g===6)&&(g=zr.current,g!==null&&g.tag===13&&(g.flags|=16384))),cm(s,r)):id(s)}function id(r){var s=r;do{if((s.flags&32768)!==0){cm(s,Xl);return}r=s.return;var c=Qp(s.alternate,s,il);if(c!==null){Wt=c;return}if(s=s.sibling,s!==null){Wt=s;return}Wt=s=r}while(s!==null);In===0&&(In=5)}function cm(r,s){do{var c=Wp(r.alternate,r);if(c!==null){c.flags&=32767,Wt=c;return}if(c=r.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!s&&(r=r.sibling,r!==null)){Wt=r;return}Wt=r=c}while(r!==null);In=6,Wt=null}function hm(r,s,c,g,b,M,B,Z,ue){r.cancelPendingCommit=null;do Wc();while(Rn!==0);if((vi&6)!==0)throw Error(oe(327));if(s!==null){if(s===r.current)throw Error(oe(177));if(M=s.lanes|s.childLanes,M|=Vo,hn(r,c,M,B,Z,ue),r===Gi&&(Wt=Gi=null,Yt=0),Ju=s,Wl=r,nl=c,sp=M,op=b,lp=g,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,ng(V,function(){return pp(),null})):(r.callbackNode=null,r.callbackPriority=0),g=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||g){g=Ue.T,Ue.T=null,b=rt.p,rt.p=2,B=vi,vi|=4;try{Xm(r,s,c)}finally{vi=B,rt.p=b,Ue.T=g}}Rn=1,fm(),dm(),pm()}}function fm(){if(Rn===1){Rn=0;var r=Wl,s=Ju,c=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||c){c=Ue.T,Ue.T=null;var g=rt.p;rt.p=2;var b=vi;vi|=4;try{Yu(s,r);var M=fd,B=_c(r.containerInfo),Z=M.focusedElem,ue=M.selectionRange;if(B!==Z&&Z&&Z.ownerDocument&&gc(Z.ownerDocument.documentElement,Z)){if(ue!==null&&Mu(Z)){var Pe=ue.start,Ge=ue.end;if(Ge===void 0&&(Ge=Pe),"selectionStart"in Z)Z.selectionStart=Pe,Z.selectionEnd=Math.min(Ge,Z.value.length);else{var We=Z.ownerDocument||document,Re=We&&We.defaultView||window;if(Re.getSelection){var Be=Re.getSelection(),_t=Z.textContent.length,Dt=Math.min(ue.start,_t),Pi=ue.end===void 0?Dt:Math.min(ue.end,_t);!Be.extend&&Dt>Pi&&(B=Pi,Pi=Dt,Dt=B);var _e=Su(Z,Dt),pe=Su(Z,Pi);if(_e&&pe&&(Be.rangeCount!==1||Be.anchorNode!==_e.node||Be.anchorOffset!==_e.offset||Be.focusNode!==pe.node||Be.focusOffset!==pe.offset)){var De=We.createRange();De.setStart(_e.node,_e.offset),Be.removeAllRanges(),Dt>Pi?(Be.addRange(De),Be.extend(pe.node,pe.offset)):(De.setEnd(pe.node,pe.offset),Be.addRange(De))}}}}for(We=[],Be=Z;Be=Be.parentNode;)Be.nodeType===1&&We.push({element:Be,left:Be.scrollLeft,top:Be.scrollTop});for(typeof Z.focus=="function"&&Z.focus(),Z=0;Z<We.length;Z++){var Ze=We[Z];Ze.element.scrollLeft=Ze.left,Ze.element.scrollTop=Ze.top}}lh=!!hd,fd=hd=null}finally{vi=b,rt.p=g,Ue.T=c}}r.current=s,Rn=2}}function dm(){if(Rn===2){Rn=0;var r=Wl,s=Ju,c=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||c){c=Ue.T,Ue.T=null;var g=rt.p;rt.p=2;var b=vi;vi|=4;try{mn(r,s.alternate,s)}finally{vi=b,rt.p=g,Ue.T=c}}Rn=3}}function pm(){if(Rn===4||Rn===3){Rn=0,_l();var r=Wl,s=Ju,c=nl,g=lp;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Rn=5:(Rn=0,Ju=Wl=null,dp(r,r.pendingLanes));var b=r.pendingLanes;if(b===0&&(Ql=null),Ke(c),s=s.stateNode,he&&typeof he.onCommitFiberRoot=="function")try{he.onCommitFiberRoot(ge,s,void 0,(s.current.flags&128)===128)}catch{}if(g!==null){s=Ue.T,b=rt.p,rt.p=2,Ue.T=null;try{for(var M=r.onRecoverableError,B=0;B<g.length;B++){var Z=g[B];M(Z.value,{componentStack:Z.stack})}}finally{Ue.T=s,rt.p=b}}(nl&3)!==0&&Wc(),js(r),b=r.pendingLanes,(c&261930)!==0&&(b&42)!==0?r===up?Wh++:(Wh=0,up=r):Wh=0,ec(0)}}function dp(r,s){(r.pooledCacheLanes&=s)===0&&(s=r.pooledCache,s!=null&&(r.pooledCache=null,fr(s)))}function Wc(){return fm(),dm(),pm(),pp()}function pp(){if(Rn!==5)return!1;var r=Wl,s=sp;sp=0;var c=Ke(nl),g=Ue.T,b=rt.p;try{rt.p=32>c?32:c,Ue.T=null,c=op,op=null;var M=Wl,B=nl;if(Rn=0,Ju=Wl=null,nl=0,(vi&6)!==0)throw Error(oe(331));var Z=vi;if(vi|=4,rm(M.current),np(M,M.current,B,c),vi=Z,ec(0,!1),he&&typeof he.onPostCommitFiberRoot=="function")try{he.onPostCommitFiberRoot(ge,M)}catch{}return!0}finally{rt.p=b,Ue.T=g,dp(r,s)}}function al(r,s,c){s=Er(c,s),s=bo(r.stateNode,s,2),r=Ds(r,s,2),r!==null&&(gi(r,2),js(r))}function bi(r,s,c){if(r.tag===3)al(r,r,c);else for(;s!==null;){if(s.tag===3){al(s,r,c);break}else if(s.tag===1){var g=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(Ql===null||!Ql.has(g))){r=Er(c,r),c=Nc(2),g=Ds(s,c,2),g!==null&&(Vc(c,g,s,r),gi(g,2),js(g));break}}s=s.return}}function ef(r,s,c){var g=r.pingCache;if(g===null){g=r.pingCache=new Qm;var b=new Set;g.set(s,b)}else b=g.get(s),b===void 0&&(b=new Set,g.set(s,b));b.has(c)||(Wf=!0,b.add(c),r=eg.bind(null,r,s,c),s.then(r,r))}function eg(r,s,c){var g=r.pingCache;g!==null&&g.delete(s),r.pingedLanes|=r.suspendedLanes&c,r.warmLanes&=~c,Gi===r&&(Yt&c)===c&&(In===4||In===3&&(Yt&62914560)===Yt&&300>Gn()-Xc?(vi&2)===0&&Ns(r,0):rp|=c,$c===Yt&&($c=0)),js(r)}function mp(r,s){s===0&&(s=mi()),r=ba(r,s),r!==null&&(gi(r,s),js(r))}function tg(r){var s=r.memoizedState,c=0;s!==null&&(c=s.retryLane),mp(r,c)}function ig(r,s){var c=0;switch(r.tag){case 31:case 13:var g=r.stateNode,b=r.memoizedState;b!==null&&(c=b.retryLane);break;case 19:g=r.stateNode;break;case 22:g=r.stateNode._retryCache;break;default:throw Error(oe(314))}g!==null&&g.delete(s),mp(r,c)}function ng(r,s){return $s(r,s)}var nd=null,Kc=null,rd=!1,tf=!1,Vs=!1,ha=0;function js(r){r!==Kc&&r.next===null&&(Kc===null?nd=Kc=r:Kc=Kc.next=r),tf=!0,rd||(rd=!0,gp())}function ec(r,s){if(!Vs&&tf){Vs=!0;do for(var c=!1,g=nd;g!==null;){if(r!==0){var b=g.pendingLanes;if(b===0)var M=0;else{var B=g.suspendedLanes,Z=g.pingedLanes;M=(1<<31-Ve(42|r)+1)-1,M&=b&~(B&~Z),M=M&201326741?M&201326741|1:M?M|2:0}M!==0&&(c=!0,sd(g,M))}else M=Yt,M=pi(g,g===Gi?M:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(M&3)===0||_n(g,M)||(c=!0,sd(g,M));g=g.next}while(c);Vs=!1}}function rg(){nf()}function nf(){tf=rd=!1;var r=0;ha!==0&&wp()&&(r=ha);for(var s=Gn(),c=null,g=nd;g!==null;){var b=g.next,M=ad(g,s);M===0?(g.next=null,c===null?nd=b:c.next=b,b===null&&(Kc=c)):(c=g,(r!==0||(M&3)!==0)&&(tf=!0)),g=b}Rn!==0&&Rn!==5||ec(r),ha!==0&&(ha=0)}function ad(r,s){for(var c=r.suspendedLanes,g=r.pingedLanes,b=r.expirationTimes,M=r.pendingLanes&-62914561;0<M;){var B=31-Ve(M),Z=1<<B,ue=b[B];ue===-1?((Z&c)===0||(Z&g)!==0)&&(b[B]=It(Z,s)):ue<=s&&(r.expiredLanes|=Z),M&=~Z}if(s=Gi,c=Yt,c=pi(r,r===s?c:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),g=r.callbackNode,c===0||r===s&&(Di===2||Di===9)||r.cancelPendingCommit!==null)return g!==null&&g!==null&&$a(g),r.callbackNode=null,r.callbackPriority=0;if((c&3)===0||_n(r,c)){if(s=c&-c,s===r.callbackPriority)return s;switch(g!==null&&$a(g),Ke(c)){case 2:case 8:c=j;break;case 32:c=V;break;case 268435456:c=ae;break;default:c=V}return g=mm.bind(null,r),c=$s(c,g),r.callbackPriority=s,r.callbackNode=c,s}return g!==null&&g!==null&&$a(g),r.callbackPriority=2,r.callbackNode=null,2}function mm(r,s){if(Rn!==0&&Rn!==5)return r.callbackNode=null,r.callbackPriority=0,null;var c=r.callbackNode;if(Wc()&&r.callbackNode!==c)return null;var g=Yt;return g=pi(r,r===Gi?g:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),g===0?null:(sm(r,g,s),ad(r,Gn()),r.callbackNode!=null&&r.callbackNode===c?mm.bind(null,r):null)}function sd(r,s){if(Wc())return null;sm(r,s,!0)}function gp(){Gt(function(){(vi&6)!==0?$s(ye,rg):nf()})}function Jl(){if(ha===0){var r=dr;r===0&&(r=zt,zt<<=1,(zt&261888)===0&&(zt=256)),ha=r}return ha}function _p(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Ft(""+r)}function yp(r,s){var c=s.ownerDocument.createElement("input");return c.name=s.name,c.value=s.value,r.id&&c.setAttribute("form",r.id),s.parentNode.insertBefore(c,s),r=new FormData(r),c.parentNode.removeChild(c),r}function vp(r,s,c,g,b){if(s==="submit"&&c&&c.stateNode===b){var M=_p((b[et]||null).action),B=g.submitter;B&&(s=(s=B[et]||null)?_p(s.formAction):B.getAttribute("formAction"),s!==null&&(M=s,B=null));var Z=new du("action","action",null,g,b);r.push({event:Z,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(ha!==0){var ue=B?yp(b,B):new FormData(b);Qi(c,{pending:!0,data:ue,method:b.method,action:M},null,ue)}}else typeof M=="function"&&(Z.preventDefault(),ue=B?yp(b,B):new FormData(b),Qi(c,{pending:!0,data:ue,method:b.method,action:M},M,ue))},currentTarget:b}]})}}for(var od=0;od<bc.length;od++){var Jc=bc[od],gm=Jc.toLowerCase(),ag=Jc[0].toUpperCase()+Jc.slice(1);ia(gm,"on"+ag)}ia(Cu,"onAnimationEnd"),ia(zu,"onAnimationIteration"),ia(xc,"onAnimationStart"),ia("dblclick","onDoubleClick"),ia("focusin","onFocus"),ia("focusout","onBlur"),ia(No,"onTransitionRun"),ia(Du,"onTransitionStart"),ia(Il,"onTransitionCancel"),ia(ta,"onTransitionEnd"),xs("onMouseEnter",["mouseout","mouseover"]),xs("onMouseLeave",["mouseout","mouseover"]),xs("onPointerEnter",["pointerout","pointerover"]),xs("onPointerLeave",["pointerout","pointerover"]),ei("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ei("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ei("onBeforeInput",["compositionend","keypress","textInput","paste"]),ei("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ei("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ei("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var rf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(rf));function _m(r,s){s=(s&4)!==0;for(var c=0;c<r.length;c++){var g=r[c],b=g.event;g=g.listeners;e:{var M=void 0;if(s)for(var B=g.length-1;0<=B;B--){var Z=g[B],ue=Z.instance,Pe=Z.currentTarget;if(Z=Z.listener,ue!==M&&b.isPropagationStopped())break e;M=Z,b.currentTarget=Pe;try{M(b)}catch(Ge){is(Ge)}b.currentTarget=null,M=ue}else for(B=0;B<g.length;B++){if(Z=g[B],ue=Z.instance,Pe=Z.currentTarget,Z=Z.listener,ue!==M&&b.isPropagationStopped())break e;M=Z,b.currentTarget=Pe;try{M(b)}catch(Ge){is(Ge)}b.currentTarget=null,M=ue}}}}function ri(r,s){var c=s[Nt];c===void 0&&(c=s[Nt]=new Set);var g=r+"__bubble";c.has(g)||(xp(s,r,2,!1),c.add(g))}function af(r,s,c){var g=0;s&&(g|=4),xp(c,r,g,s)}var Us="_reactListening"+Math.random().toString(36).slice(2);function ld(r){if(!r[Us]){r[Us]=!0,vl.forEach(function(c){c!=="selectionchange"&&(sg.has(c)||af(c,!1,r),af(c,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[Us]||(s[Us]=!0,af("selectionchange",!1,s))}}function xp(r,s,c,g){switch(Om(s)){case 2:var b=Lp;break;case 8:b=Lm;break;default:b=ru}c=b.bind(null,s,c,r),b=void 0,!br||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(b=!0),g?b!==void 0?r.addEventListener(s,c,{capture:!0,passive:b}):r.addEventListener(s,c,!0):b!==void 0?r.addEventListener(s,c,{passive:b}):r.addEventListener(s,c,!1)}function ud(r,s,c,g,b){var M=g;if((s&1)===0&&(s&2)===0&&g!==null)e:for(;;){if(g===null)return;var B=g.tag;if(B===3||B===4){var Z=g.stateNode.containerInfo;if(Z===b)break;if(B===4)for(B=g.return;B!==null;){var ue=B.tag;if((ue===3||ue===4)&&B.stateNode.containerInfo===b)return;B=B.return}for(;Z!==null;){if(B=Ya(Z),B===null)return;if(ue=B.tag,ue===5||ue===6||ue===26||ue===27){g=M=B;continue e}Z=Z.parentNode}}g=g.return}Ei(function(){var Pe=M,Ge=fu(c),We=[];e:{var Re=Th.get(r);if(Re!==void 0){var Be=du,_t=r;switch(r){case"keypress":if(ea(c)===0)break e;case"keydown":case"keyup":Be=an;break;case"focusin":_t="focus",Be=Js;break;case"focusout":_t="blur",Be=Js;break;case"beforeblur":case"afterblur":Be=Js;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Be=Lo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Be=pu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Be=Bd;break;case Cu:case zu:case xc:Be=Af;break;case ta:Be=fc;break;case"scroll":case"scrollend":Be=Ro;break;case"wheel":Be=yh;break;case"copy":case"cut":case"paste":Be=gh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Be=hc;break;case"toggle":case"beforetoggle":Be=El}var Dt=(s&4)!==0,Pi=!Dt&&(r==="scroll"||r==="scrollend"),_e=Dt?Re!==null?Re+"Capture":null:Re;Dt=[];for(var pe=Pe,De;pe!==null;){var Ze=pe;if(De=Ze.stateNode,Ze=Ze.tag,Ze!==5&&Ze!==26&&Ze!==27||De===null||_e===null||(Ze=_a(pe,_e),Ze!=null&&Dt.push(eh(pe,Ze,De))),Pi)break;pe=pe.return}0<Dt.length&&(Re=new Be(Re,_t,null,c,Ge),We.push({event:Re,listeners:Dt}))}}if((s&7)===0){e:{if(Re=r==="mouseover"||r==="pointerover",Be=r==="mouseout"||r==="pointerout",Re&&c!==mh&&(_t=c.relatedTarget||c.fromElement)&&(Ya(_t)||_t[Ot]))break e;if((Be||Re)&&(Re=Ge.window===Ge?Ge:(Re=Ge.ownerDocument)?Re.defaultView||Re.parentWindow:window,Be?(_t=c.relatedTarget||c.toElement,Be=Pe,_t=_t?Ya(_t):null,_t!==null&&(Pi=Xe(_t),Dt=_t.tag,_t!==Pi||Dt!==5&&Dt!==27&&Dt!==6)&&(_t=null)):(Be=null,_t=Pe),Be!==_t)){if(Dt=Lo,Ze="onMouseLeave",_e="onMouseEnter",pe="mouse",(r==="pointerout"||r==="pointerover")&&(Dt=hc,Ze="onPointerLeave",_e="onPointerEnter",pe="pointer"),Pi=Be==null?Re:Qa(Be),De=_t==null?Re:Qa(_t),Re=new Dt(Ze,pe+"leave",Be,c,Ge),Re.target=Pi,Re.relatedTarget=De,Ze=null,Ya(Ge)===Pe&&(Dt=new Dt(_e,pe+"enter",_t,c,Ge),Dt.target=De,Dt.relatedTarget=Pi,Ze=Dt),Pi=Ze,Be&&_t)t:{for(Dt=ym,_e=Be,pe=_t,De=0,Ze=_e;Ze;Ze=Dt(Ze))De++;Ze=0;for(var pt=pe;pt;pt=Dt(pt))Ze++;for(;0<De-Ze;)_e=Dt(_e),De--;for(;0<Ze-De;)pe=Dt(pe),Ze--;for(;De--;){if(_e===pe||pe!==null&&_e===pe.alternate){Dt=_e;break t}_e=Dt(_e),pe=Dt(pe)}Dt=null}else Dt=null;Be!==null&&of(We,Re,Be,Dt,!1),_t!==null&&Pi!==null&&of(We,Pi,_t,Dt,!0)}}e:{if(Re=Pe?Qa(Pe):window,Be=Re.nodeName&&Re.nodeName.toLowerCase(),Be==="select"||Be==="input"&&Re.type==="file")var di=io;else if(pc(Re))if(vh)di=kf;else{di=Bf;var bt=kd}else Be=Re.nodeName,!Be||Be.toLowerCase()!=="input"||Re.type!=="checkbox"&&Re.type!=="radio"?Pe&&Do(Pe.elementType)&&(di=io):di=Tu;if(di&&(di=di(r,Pe))){mc(We,di,c,Ge);break e}bt&&bt(r,Re,Pe),r==="focusout"&&Pe&&Re.type==="number"&&Pe.memoizedProps.value!=null&&hu(Re,"number",Re.value)}switch(bt=Pe?Qa(Pe):window,r){case"focusin":(pc(bt)||bt.contentEditable==="true")&&(xa=bt,Eu=Pe,Au=null);break;case"focusout":Au=Eu=xa=null;break;case"mousedown":vc=!0;break;case"contextmenu":case"mouseup":case"dragend":vc=!1,Ff(We,c,Ge);break;case"selectionchange":if(yc)break;case"keydown":case"keyup":Ff(We,c,Ge)}var qt;if(fn)e:{switch(r){case"compositionstart":var ii="onCompositionStart";break e;case"compositionend":ii="onCompositionEnd";break e;case"compositionupdate":ii="onCompositionUpdate";break e}ii=void 0}else La?vu(r,c)&&(ii="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(ii="onCompositionStart");ii&&(Dl&&c.locale!=="ko"&&(La||ii!=="onCompositionStart"?ii==="onCompositionEnd"&&La&&(qt=Ws()):(Jr=Ge,Ja="value"in Jr?Jr.value:Jr.textContent,La=!0)),bt=sf(Pe,ii),0<bt.length&&(ii=new _h(ii,r,null,c,Ge),We.push({event:ii,listeners:bt}),qt?ii.data=qt:(qt=Pf(c),qt!==null&&(ii.data=qt)))),(qt=zl?dc(r,c):If(r,c))&&(ii=sf(Pe,"onBeforeInput"),0<ii.length&&(bt=new _h("onBeforeInput","beforeinput",null,c,Ge),We.push({event:bt,listeners:ii}),bt.data=qt)),vp(We,r,Pe,c,Ge)}_m(We,s)})}function eh(r,s,c){return{instance:r,listener:s,currentTarget:c}}function sf(r,s){for(var c=s+"Capture",g=[];r!==null;){var b=r,M=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||M===null||(b=_a(r,c),b!=null&&g.unshift(eh(r,b,M)),b=_a(r,s),b!=null&&g.push(eh(r,b,M))),r.tag===3)return g;r=r.return}return[]}function ym(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function of(r,s,c,g,b){for(var M=s._reactName,B=[];c!==null&&c!==g;){var Z=c,ue=Z.alternate,Pe=Z.stateNode;if(Z=Z.tag,ue!==null&&ue===g)break;Z!==5&&Z!==26&&Z!==27||Pe===null||(ue=Pe,b?(Pe=_a(c,M),Pe!=null&&B.unshift(eh(c,Pe,ue))):b||(Pe=_a(c,M),Pe!=null&&B.push(eh(c,Pe,ue)))),c=c.return}B.length!==0&&r.push({event:s,listeners:B})}var vm=/\r\n?/g,lf=/\u0000|\uFFFD/g;function bp(r){return(typeof r=="string"?r:""+r).replace(vm,`
`).replace(lf,"")}function cd(r,s){return s=bp(s),bp(r)===s}function Oi(r,s,c,g,b,M){switch(c){case"children":typeof g=="string"?s==="body"||s==="textarea"&&g===""||bs(r,g):(typeof g=="number"||typeof g=="bigint")&&s!=="body"&&bs(r,""+g);break;case"className":Ka(r,"class",g);break;case"tabIndex":Ka(r,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":Ka(r,c,g);break;case"style":cc(r,g,M);break;case"data":if(s!=="object"){Ka(r,"data",g);break}case"src":case"href":if(g===""&&(s!=="a"||c!=="href")){r.removeAttribute(c);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){r.removeAttribute(c);break}g=Ft(""+g),r.setAttribute(c,g);break;case"action":case"formAction":if(typeof g=="function"){r.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof M=="function"&&(c==="formAction"?(s!=="input"&&Oi(r,s,"name",b.name,b,null),Oi(r,s,"formEncType",b.formEncType,b,null),Oi(r,s,"formMethod",b.formMethod,b,null),Oi(r,s,"formTarget",b.formTarget,b,null)):(Oi(r,s,"encType",b.encType,b,null),Oi(r,s,"method",b.method,b,null),Oi(r,s,"target",b.target,b,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){r.removeAttribute(c);break}g=Ft(""+g),r.setAttribute(c,g);break;case"onClick":g!=null&&(r.onclick=Ra);break;case"onScroll":g!=null&&ri("scroll",r);break;case"onScrollEnd":g!=null&&ri("scrollend",r);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(oe(61));if(c=g.__html,c!=null){if(b.children!=null)throw Error(oe(60));r.innerHTML=c}}break;case"multiple":r.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":r.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){r.removeAttribute("xlink:href");break}c=Ft(""+g),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?r.setAttribute(c,""+g):r.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?r.setAttribute(c,""):r.removeAttribute(c);break;case"capture":case"download":g===!0?r.setAttribute(c,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?r.setAttribute(c,g):r.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?r.setAttribute(c,g):r.removeAttribute(c);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?r.removeAttribute(c):r.setAttribute(c,g);break;case"popover":ri("beforetoggle",r),ri("toggle",r),lu(r,"popover",g);break;case"xlinkActuate":ga(r,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":ga(r,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":ga(r,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":ga(r,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":ga(r,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":ga(r,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":ga(r,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":ga(r,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":ga(r,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":lu(r,"is",g);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Qs.get(c)||c,lu(r,c,g))}}function fa(r,s,c,g,b,M){switch(c){case"style":cc(r,g,M);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(oe(61));if(c=g.__html,c!=null){if(b.children!=null)throw Error(oe(60));r.innerHTML=c}}break;case"children":typeof g=="string"?bs(r,g):(typeof g=="number"||typeof g=="bigint")&&bs(r,""+g);break;case"onScroll":g!=null&&ri("scroll",r);break;case"onScrollEnd":g!=null&&ri("scrollend",r);break;case"onClick":g!=null&&(r.onclick=Ra);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!hr.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(b=c.endsWith("Capture"),s=c.slice(2,b?c.length-7:void 0),M=r[et]||null,M=M!=null?M[c]:null,typeof M=="function"&&r.removeEventListener(s,M,b),typeof g=="function")){typeof M!="function"&&M!==null&&(c in r?r[c]=null:r.hasAttribute(c)&&r.removeAttribute(c)),r.addEventListener(s,g,b);break e}c in r?r[c]=g:g===!0?r.setAttribute(c,""):lu(r,c,g)}}}function Ln(r,s,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ri("error",r),ri("load",r);var g=!1,b=!1,M;for(M in c)if(c.hasOwnProperty(M)){var B=c[M];if(B!=null)switch(M){case"src":g=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(oe(137,s));default:Oi(r,s,M,B,c,null)}}b&&Oi(r,s,"srcSet",c.srcSet,c,null),g&&Oi(r,s,"src",c.src,c,null);return;case"input":ri("invalid",r);var Z=M=B=b=null,ue=null,Pe=null;for(g in c)if(c.hasOwnProperty(g)){var Ge=c[g];if(Ge!=null)switch(g){case"name":b=Ge;break;case"type":B=Ge;break;case"checked":ue=Ge;break;case"defaultChecked":Pe=Ge;break;case"value":M=Ge;break;case"defaultValue":Z=Ge;break;case"children":case"dangerouslySetInnerHTML":if(Ge!=null)throw Error(oe(137,s));break;default:Oi(r,s,g,Ge,c,null)}}uc(r,M,Z,ue,Pe,B,b,!1);return;case"select":ri("invalid",r),g=B=M=null;for(b in c)if(c.hasOwnProperty(b)&&(Z=c[b],Z!=null))switch(b){case"value":M=Z;break;case"defaultValue":B=Z;break;case"multiple":g=Z;default:Oi(r,s,b,Z,c,null)}s=M,c=B,r.multiple=!!g,s!=null?Ys(r,!!g,s,!1):c!=null&&Ys(r,!!g,c,!0);return;case"textarea":ri("invalid",r),M=b=g=null;for(B in c)if(c.hasOwnProperty(B)&&(Z=c[B],Z!=null))switch(B){case"value":g=Z;break;case"defaultValue":b=Z;break;case"children":M=Z;break;case"dangerouslySetInnerHTML":if(Z!=null)throw Error(oe(91));break;default:Oi(r,s,B,Z,c,null)}wl(r,g,b,M);return;case"option":for(ue in c)if(c.hasOwnProperty(ue)&&(g=c[ue],g!=null))switch(ue){case"selected":r.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:Oi(r,s,ue,g,c,null)}return;case"dialog":ri("beforetoggle",r),ri("toggle",r),ri("cancel",r),ri("close",r);break;case"iframe":case"object":ri("load",r);break;case"video":case"audio":for(g=0;g<rf.length;g++)ri(rf[g],r);break;case"image":ri("error",r),ri("load",r);break;case"details":ri("toggle",r);break;case"embed":case"source":case"link":ri("error",r),ri("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Pe in c)if(c.hasOwnProperty(Pe)&&(g=c[Pe],g!=null))switch(Pe){case"children":case"dangerouslySetInnerHTML":throw Error(oe(137,s));default:Oi(r,s,Pe,g,c,null)}return;default:if(Do(s)){for(Ge in c)c.hasOwnProperty(Ge)&&(g=c[Ge],g!==void 0&&fa(r,s,Ge,g,c,void 0));return}}for(Z in c)c.hasOwnProperty(Z)&&(g=c[Z],g!=null&&Oi(r,s,Z,g,c,null))}function uf(r,s,c,g){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,M=null,B=null,Z=null,ue=null,Pe=null,Ge=null;for(Be in c){var We=c[Be];if(c.hasOwnProperty(Be)&&We!=null)switch(Be){case"checked":break;case"value":break;case"defaultValue":ue=We;default:g.hasOwnProperty(Be)||Oi(r,s,Be,null,g,We)}}for(var Re in g){var Be=g[Re];if(We=c[Re],g.hasOwnProperty(Re)&&(Be!=null||We!=null))switch(Re){case"type":M=Be;break;case"name":b=Be;break;case"checked":Pe=Be;break;case"defaultChecked":Ge=Be;break;case"value":B=Be;break;case"defaultValue":Z=Be;break;case"children":case"dangerouslySetInnerHTML":if(Be!=null)throw Error(oe(137,s));break;default:Be!==We&&Oi(r,s,Re,Be,g,We)}}cu(r,B,Z,ue,Pe,Ge,M,b);return;case"select":Be=B=Z=Re=null;for(M in c)if(ue=c[M],c.hasOwnProperty(M)&&ue!=null)switch(M){case"value":break;case"multiple":Be=ue;default:g.hasOwnProperty(M)||Oi(r,s,M,null,g,ue)}for(b in g)if(M=g[b],ue=c[b],g.hasOwnProperty(b)&&(M!=null||ue!=null))switch(b){case"value":Re=M;break;case"defaultValue":Z=M;break;case"multiple":B=M;default:M!==ue&&Oi(r,s,b,M,g,ue)}s=Z,c=B,g=Be,Re!=null?Ys(r,!!c,Re,!1):!!g!=!!c&&(s!=null?Ys(r,!!c,s,!0):Ys(r,!!c,c?[]:"",!1));return;case"textarea":Be=Re=null;for(Z in c)if(b=c[Z],c.hasOwnProperty(Z)&&b!=null&&!g.hasOwnProperty(Z))switch(Z){case"value":break;case"children":break;default:Oi(r,s,Z,null,g,b)}for(B in g)if(b=g[B],M=c[B],g.hasOwnProperty(B)&&(b!=null||M!=null))switch(B){case"value":Re=b;break;case"defaultValue":Be=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(oe(91));break;default:b!==M&&Oi(r,s,B,b,g,M)}Mf(r,Re,Be);return;case"option":for(var _t in c)if(Re=c[_t],c.hasOwnProperty(_t)&&Re!=null&&!g.hasOwnProperty(_t))switch(_t){case"selected":r.selected=!1;break;default:Oi(r,s,_t,null,g,Re)}for(ue in g)if(Re=g[ue],Be=c[ue],g.hasOwnProperty(ue)&&Re!==Be&&(Re!=null||Be!=null))switch(ue){case"selected":r.selected=Re&&typeof Re!="function"&&typeof Re!="symbol";break;default:Oi(r,s,ue,Re,g,Be)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Dt in c)Re=c[Dt],c.hasOwnProperty(Dt)&&Re!=null&&!g.hasOwnProperty(Dt)&&Oi(r,s,Dt,null,g,Re);for(Pe in g)if(Re=g[Pe],Be=c[Pe],g.hasOwnProperty(Pe)&&Re!==Be&&(Re!=null||Be!=null))switch(Pe){case"children":case"dangerouslySetInnerHTML":if(Re!=null)throw Error(oe(137,s));break;default:Oi(r,s,Pe,Re,g,Be)}return;default:if(Do(s)){for(var Pi in c)Re=c[Pi],c.hasOwnProperty(Pi)&&Re!==void 0&&!g.hasOwnProperty(Pi)&&fa(r,s,Pi,void 0,g,Re);for(Ge in g)Re=g[Ge],Be=c[Ge],!g.hasOwnProperty(Ge)||Re===Be||Re===void 0&&Be===void 0||fa(r,s,Ge,Re,g,Be);return}}for(var _e in c)Re=c[_e],c.hasOwnProperty(_e)&&Re!=null&&!g.hasOwnProperty(_e)&&Oi(r,s,_e,null,g,Re);for(We in g)Re=g[We],Be=c[We],!g.hasOwnProperty(We)||Re===Be||Re==null&&Be==null||Oi(r,s,We,Re,g,Be)}function xm(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function bm(){if(typeof performance.getEntriesByType=="function"){for(var r=0,s=0,c=performance.getEntriesByType("resource"),g=0;g<c.length;g++){var b=c[g],M=b.transferSize,B=b.initiatorType,Z=b.duration;if(M&&Z&&xm(B)){for(B=0,Z=b.responseEnd,g+=1;g<c.length;g++){var ue=c[g],Pe=ue.startTime;if(Pe>Z)break;var Ge=ue.transferSize,We=ue.initiatorType;Ge&&xm(We)&&(ue=ue.responseEnd,B+=Ge*(ue<Z?1:(Z-Pe)/(ue-Pe)))}if(--g,s+=8*(M+B)/(b.duration/1e3),r++,10<r)break}}if(0<r)return s/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var hd=null,fd=null;function sl(r){return r.nodeType===9?r:r.ownerDocument}function cf(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function dd(r,s){if(r===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&s==="foreignObject"?0:r}function hf(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var pd=null;function wp(){var r=window.event;return r&&r.type==="popstate"?r===pd?!1:(pd=r,!0):(pd=null,!1)}var md=typeof setTimeout=="function"?setTimeout:void 0,og=typeof clearTimeout=="function"?clearTimeout:void 0,wm=typeof Promise=="function"?Promise:void 0,Gt=typeof queueMicrotask=="function"?queueMicrotask:typeof wm<"u"?function(r){return wm.resolve(null).then(r).catch(ol)}:md;function ol(r){setTimeout(function(){throw r})}function ln(r){return r==="head"}function ms(r,s){var c=s,g=0;do{var b=c.nextSibling;if(r.removeChild(c),b&&b.nodeType===8)if(c=b.data,c==="/$"||c==="/&"){if(g===0){r.removeChild(b),hh(s);return}g--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")g++;else if(c==="html")th(r.ownerDocument.documentElement);else if(c==="head"){c=r.ownerDocument.head,th(c);for(var M=c.firstChild;M;){var B=M.nextSibling,Z=M.nodeName;M[Rt]||Z==="SCRIPT"||Z==="STYLE"||Z==="LINK"&&M.rel.toLowerCase()==="stylesheet"||c.removeChild(M),M=B}}else c==="body"&&th(r.ownerDocument.body);c=b}while(c);hh(s)}function eu(r,s){var c=r;r=0;do{var g=c.nextSibling;if(c.nodeType===1?s?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(s?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),g&&g.nodeType===8)if(c=g.data,c==="/$"){if(r===0)break;r--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||r++;c=g}while(c)}function qr(r){var s=r.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var c=s;switch(s=s.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":qr(c),Ao(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}r.removeChild(c)}}function Qn(r,s,c,g){for(;r.nodeType===1;){var b=c;if(r.nodeName.toLowerCase()!==s.toLowerCase()){if(!g&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(g){if(!r[Rt])switch(s){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(M=r.getAttribute("rel"),M==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(M!==b.rel||r.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||r.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||r.getAttribute("title")!==(b.title==null?null:b.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(M=r.getAttribute("src"),(M!==(b.src==null?null:b.src)||r.getAttribute("type")!==(b.type==null?null:b.type)||r.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&M&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(s==="input"&&r.type==="hidden"){var M=b.name==null?null:""+b.name;if(b.type==="hidden"&&r.getAttribute("name")===M)return r}else return r;if(r=gs(r.nextSibling),r===null)break}return null}function Wn(r,s,c){if(s==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!c||(r=gs(r.nextSibling),r===null))return null;return r}function Tp(r,s){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!s||(r=gs(r.nextSibling),r===null))return null;return r}function da(r){return r.data==="$?"||r.data==="$~"}function jn(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function gd(r,s){var c=r.ownerDocument;if(r.data==="$~")r._reactRetry=s;else if(r.data!=="$?"||c.readyState!=="loading")s();else{var g=function(){s(),c.removeEventListener("DOMContentLoaded",g)};c.addEventListener("DOMContentLoaded",g),r._reactRetry=g}}function gs(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return r}var _d=null;function tu(r){r=r.nextSibling;for(var s=0;r;){if(r.nodeType===8){var c=r.data;if(c==="/$"||c==="/&"){if(s===0)return gs(r.nextSibling);s--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||s++}r=r.nextSibling}return null}function tc(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(s===0)return r;s--}else c!=="/$"&&c!=="/&"||s++}r=r.previousSibling}return null}function Tm(r,s,c){switch(s=sl(c),r){case"html":if(r=s.documentElement,!r)throw Error(oe(452));return r;case"head":if(r=s.head,!r)throw Error(oe(453));return r;case"body":if(r=s.body,!r)throw Error(oe(454));return r;default:throw Error(oe(451))}}function th(r){for(var s=r.attributes;s.length;)r.removeAttributeNode(s[0]);Ao(r)}var qa=new Map,Sp=new Set;function ih(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var So=rt.d;rt.d={f:Mp,r:Zr,D:iu,C:yd,L:Ep,m:Sm,X:Em,S:Mm,M:Am};function Mp(){var r=So.f(),s=Kh();return r||s}function Zr(r){var s=vs(r);s!==null&&s.tag===5&&s.type==="form"?Xn(s):So.r(r)}var Hr=typeof document>"u"?null:document;function Rr(r,s,c){var g=Hr;if(g&&typeof s=="string"&&s){var b=xr(s);b='link[rel="'+r+'"][href="'+b+'"]',typeof c=="string"&&(b+='[crossorigin="'+c+'"]'),Sp.has(b)||(Sp.add(b),r={rel:r,crossOrigin:c,href:s},g.querySelector(b)===null&&(s=g.createElement("link"),Ln(s,"link",r),nn(s),g.head.appendChild(s)))}}function iu(r){So.D(r),Rr("dns-prefetch",r,null)}function yd(r,s){So.C(r,s),Rr("preconnect",r,s)}function Ep(r,s,c){So.L(r,s,c);var g=Hr;if(g&&r&&s){var b='link[rel="preload"][as="'+xr(s)+'"]';s==="image"&&c&&c.imageSrcSet?(b+='[imagesrcset="'+xr(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(b+='[imagesizes="'+xr(c.imageSizes)+'"]')):b+='[href="'+xr(r)+'"]';var M=b;switch(s){case"style":M=ll(r);break;case"script":M=nu(r)}qa.has(M)||(r=it({rel:"preload",href:s==="image"&&c&&c.imageSrcSet?void 0:r,as:s},c),qa.set(M,r),g.querySelector(b)!==null||s==="style"&&g.querySelector(nh(M))||s==="script"&&g.querySelector(ah(M))||(s=g.createElement("link"),Ln(s,"link",r),nn(s),g.head.appendChild(s)))}}function Sm(r,s){So.m(r,s);var c=Hr;if(c&&r){var g=s&&typeof s.as=="string"?s.as:"script",b='link[rel="modulepreload"][as="'+xr(g)+'"][href="'+xr(r)+'"]',M=b;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":M=nu(r)}if(!qa.has(M)&&(r=it({rel:"modulepreload",href:r},s),qa.set(M,r),c.querySelector(b)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(ah(M)))return}g=c.createElement("link"),Ln(g,"link",r),nn(g),c.head.appendChild(g)}}}function Mm(r,s,c){So.S(r,s,c);var g=Hr;if(g&&r){var b=Wa(g).hoistableStyles,M=ll(r);s=s||"default";var B=b.get(M);if(!B){var Z={loading:0,preload:null};if(B=g.querySelector(nh(M)))Z.loading=5;else{r=it({rel:"stylesheet",href:r,"data-precedence":s},c),(c=qa.get(M))&&sh(r,c);var ue=B=g.createElement("link");nn(ue),Ln(ue,"link",r),ue._p=new Promise(function(Pe,Ge){ue.onload=Pe,ue.onerror=Ge}),ue.addEventListener("load",function(){Z.loading|=1}),ue.addEventListener("error",function(){Z.loading|=2}),Z.loading|=4,ff(B,s,g)}B={type:"stylesheet",instance:B,count:1,state:Z},b.set(M,B)}}}function Em(r,s){So.X(r,s);var c=Hr;if(c&&r){var g=Wa(c).hoistableScripts,b=nu(r),M=g.get(b);M||(M=c.querySelector(ah(b)),M||(r=it({src:r,async:!0},s),(s=qa.get(b))&&oh(r,s),M=c.createElement("script"),nn(M),Ln(M,"link",r),c.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},g.set(b,M))}}function Am(r,s){So.M(r,s);var c=Hr;if(c&&r){var g=Wa(c).hoistableScripts,b=nu(r),M=g.get(b);M||(M=c.querySelector(ah(b)),M||(r=it({src:r,async:!0,type:"module"},s),(s=qa.get(b))&&oh(r,s),M=c.createElement("script"),nn(M),Ln(M,"link",r),c.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},g.set(b,M))}}function vd(r,s,c,g){var b=(b=kt.current)?ih(b):null;if(!b)throw Error(oe(446));switch(r){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(s=ll(c.href),c=Wa(b).hoistableStyles,g=c.get(s),g||(g={type:"style",instance:null,count:0,state:null},c.set(s,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){r=ll(c.href);var M=Wa(b).hoistableStyles,B=M.get(r);if(B||(b=b.ownerDocument||b,B={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},M.set(r,B),(M=b.querySelector(nh(r)))&&!M._p&&(B.instance=M,B.state.loading=5),qa.has(r)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},qa.set(r,c),M||rh(b,r,c,B.state))),s&&g===null)throw Error(oe(528,""));return B}if(s&&g!==null)throw Error(oe(529,""));return null;case"script":return s=c.async,c=c.src,typeof c=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=nu(c),c=Wa(b).hoistableScripts,g=c.get(s),g||(g={type:"script",instance:null,count:0,state:null},c.set(s,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(oe(444,r))}}function ll(r){return'href="'+xr(r)+'"'}function nh(r){return'link[rel="stylesheet"]['+r+"]"}function Ap(r){return it({},r,{"data-precedence":r.precedence,precedence:null})}function rh(r,s,c,g){r.querySelector('link[rel="preload"][as="style"]['+s+"]")?g.loading=1:(s=r.createElement("link"),g.preload=s,s.addEventListener("load",function(){return g.loading|=1}),s.addEventListener("error",function(){return g.loading|=2}),Ln(s,"link",c),nn(s),r.head.appendChild(s))}function nu(r){return'[src="'+xr(r)+'"]'}function ah(r){return"script[async]"+r}function Cm(r,s,c){if(s.count++,s.instance===null)switch(s.type){case"style":var g=r.querySelector('style[data-href~="'+xr(c.href)+'"]');if(g)return s.instance=g,nn(g),g;var b=it({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return g=(r.ownerDocument||r).createElement("style"),nn(g),Ln(g,"style",b),ff(g,c.precedence,r),s.instance=g;case"stylesheet":b=ll(c.href);var M=r.querySelector(nh(b));if(M)return s.state.loading|=4,s.instance=M,nn(M),M;g=Ap(c),(b=qa.get(b))&&sh(g,b),M=(r.ownerDocument||r).createElement("link"),nn(M);var B=M;return B._p=new Promise(function(Z,ue){B.onload=Z,B.onerror=ue}),Ln(M,"link",g),s.state.loading|=4,ff(M,c.precedence,r),s.instance=M;case"script":return M=nu(c.src),(b=r.querySelector(ah(M)))?(s.instance=b,nn(b),b):(g=c,(b=qa.get(M))&&(g=it({},c),oh(g,b)),r=r.ownerDocument||r,b=r.createElement("script"),nn(b),Ln(b,"link",g),r.head.appendChild(b),s.instance=b);case"void":return null;default:throw Error(oe(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(g=s.instance,s.state.loading|=4,ff(g,c.precedence,r));return s.instance}function ff(r,s,c){for(var g=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=g.length?g[g.length-1]:null,M=b,B=0;B<g.length;B++){var Z=g[B];if(Z.dataset.precedence===s)M=Z;else if(M!==b)break}M?M.parentNode.insertBefore(r,M.nextSibling):(s=c.nodeType===9?c.head:c,s.insertBefore(r,s.firstChild))}function sh(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.title==null&&(r.title=s.title)}function oh(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.integrity==null&&(r.integrity=s.integrity)}var ic=null;function xd(r,s,c){if(ic===null){var g=new Map,b=ic=new Map;b.set(c,g)}else b=ic,g=b.get(c),g||(g=new Map,b.set(c,g));if(g.has(r))return g;for(g.set(r,null),c=c.getElementsByTagName(r),b=0;b<c.length;b++){var M=c[b];if(!(M[Rt]||M[Ii]||r==="link"&&M.getAttribute("rel")==="stylesheet")&&M.namespaceURI!=="http://www.w3.org/2000/svg"){var B=M.getAttribute(s)||"";B=r+B;var Z=g.get(B);Z?Z.push(M):g.set(B,[M])}}return g}function bd(r,s,c){r=r.ownerDocument||r,r.head.insertBefore(c,s==="title"?r.querySelector("head > title"):null)}function Cp(r,s,c){if(c===1||s.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return r=s.disabled,typeof s.precedence=="string"&&r==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function zp(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function zm(r,s,c,g){if(c.type==="stylesheet"&&(typeof g.media!="string"||matchMedia(g.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var b=ll(g.href),M=s.querySelector(nh(b));if(M){s=M._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(r.count++,r=df.bind(r),s.then(r,r)),c.state.loading|=4,c.instance=M,nn(M);return}M=s.ownerDocument||s,g=Ap(g),(b=qa.get(b))&&sh(g,b),M=M.createElement("link"),nn(M);var B=M;B._p=new Promise(function(Z,ue){B.onload=Z,B.onerror=ue}),Ln(M,"link",g),c.instance=M}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(c,s),(s=c.state.preload)&&(c.state.loading&3)===0&&(r.count++,c=df.bind(r),s.addEventListener("load",c),s.addEventListener("error",c))}}var wd=0;function Dm(r,s){return r.stylesheets&&r.count===0&&pf(r,r.stylesheets),0<r.count||0<r.imgCount?function(c){var g=setTimeout(function(){if(r.stylesheets&&pf(r,r.stylesheets),r.unsuspend){var M=r.unsuspend;r.unsuspend=null,M()}},6e4+s);0<r.imgBytes&&wd===0&&(wd=62500*bm());var b=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&pf(r,r.stylesheets),r.unsuspend)){var M=r.unsuspend;r.unsuspend=null,M()}},(r.imgBytes>wd?50:800)+s);return r.unsuspend=c,function(){r.unsuspend=null,clearTimeout(g),clearTimeout(b)}}:null}function df(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)pf(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Td=null;function pf(r,s){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Td=new Map,s.forEach(lg,r),Td=null,df.call(r))}function lg(r,s){if(!(s.state.loading&4)){var c=Td.get(r);if(c)var g=c.get(null);else{c=new Map,Td.set(r,c);for(var b=r.querySelectorAll("link[data-precedence],style[data-precedence]"),M=0;M<b.length;M++){var B=b[M];(B.nodeName==="LINK"||B.getAttribute("media")!=="not all")&&(c.set(B.dataset.precedence,B),g=B)}g&&c.set(null,g)}b=s.instance,B=b.getAttribute("data-precedence"),M=c.get(B)||g,M===g&&c.set(null,b),c.set(B,b),this.count++,g=df.bind(this),b.addEventListener("load",g),b.addEventListener("error",g),M?M.parentNode.insertBefore(b,M.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(b,r.firstChild)),s.state.loading|=4}}var mf={$$typeof:Ut,Provider:null,Consumer:null,_currentValue:Ct,_currentValue2:Ct,_threadCount:0};function Dp(r,s,c,g,b,M,B,Z,ue){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=kn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kn(0),this.hiddenUpdates=kn(null),this.identifierPrefix=g,this.onUncaughtError=b,this.onCaughtError=M,this.onRecoverableError=B,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ue,this.incompleteTransitions=new Map}function Pp(r,s,c,g,b,M,B,Z,ue,Pe,Ge,We){return r=new Dp(r,s,c,B,ue,Pe,Ge,We,Z),s=1,M===!0&&(s|=24),M=na(3,null,null,s),r.current=M,M.stateNode=r,s=ho(),s.refCount++,r.pooledCache=s,s.refCount++,M.memoizedState={element:g,isDehydrated:c,cache:s},Rc(M),r}function Pm(r){return r?(r=Vt,r):Vt}function Im(r,s,c,g,b,M){b=Pm(b),g.context===null?g.context=b:g.pendingContext=b,g=Qt(s),g.payload={element:c},M=M===void 0?null:M,M!==null&&(g.callback=M),c=Ds(r,g,s),c!==null&&(Aa(c,r,s),_o(c,r,s))}function Ip(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<s?c:s}}function nc(r,s){Ip(r,s),(r=r.alternate)&&Ip(r,s)}function Rp(r){if(r.tag===13||r.tag===31){var s=ba(r,67108864);s!==null&&Aa(s,r,67108864),nc(r,67108864)}}function Rm(r){if(r.tag===13||r.tag===31){var s=xi();s=Eo(s);var c=ba(r,s);c!==null&&Aa(c,r,s),nc(r,s)}}var lh=!0;function Lp(r,s,c,g){var b=Ue.T;Ue.T=null;var M=rt.p;try{rt.p=2,ru(r,s,c,g)}finally{rt.p=M,Ue.T=b}}function Lm(r,s,c,g){var b=Ue.T;Ue.T=null;var M=rt.p;try{rt.p=8,ru(r,s,c,g)}finally{rt.p=M,Ue.T=b}}function ru(r,s,c,g){if(lh){var b=Sd(g);if(b===null)ud(r,s,g,Md,c),Bp(r,g);else if(cg(b,r,s,c,g))g.stopPropagation();else if(Bp(r,g),s&4&&-1<ug.indexOf(r)){for(;b!==null;){var M=vs(b);if(M!==null)switch(M.tag){case 3:if(M=M.stateNode,M.current.memoizedState.isDehydrated){var B=ve(M.pendingLanes);if(B!==0){var Z=M;for(Z.pendingLanes|=2,Z.entangledLanes|=2;B;){var ue=1<<31-Ve(B);Z.entanglements[1]|=ue,B&=~ue}js(M),(vi&6)===0&&(Yh=Gn()+500,ec(0))}}break;case 31:case 13:Z=ba(M,2),Z!==null&&Aa(Z,M,2),Kh(),nc(M,2)}if(M=Sd(g),M===null&&ud(r,s,g,Md,c),M===b)break;b=M}b!==null&&g.stopPropagation()}else ud(r,s,g,null,c)}}function Sd(r){return r=fu(r),rc(r)}var Md=null;function rc(r){if(Md=null,r=Ya(r),r!==null){var s=Xe(r);if(s===null)r=null;else{var c=s.tag;if(c===13){if(r=L(s),r!==null)return r;r=null}else if(c===31){if(r=f(s),r!==null)return r;r=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return Md=r,null}function Om(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Br()){case ye:return 2;case j:return 8;case V:case H:return 32;case ae:return 268435456;default:return 32}default:return 32}}var Op=!1,ul=null,cl=null,au=null,gf=new Map,_f=new Map,su=[],ug="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Bp(r,s){switch(r){case"focusin":case"focusout":ul=null;break;case"dragenter":case"dragleave":cl=null;break;case"mouseover":case"mouseout":au=null;break;case"pointerover":case"pointerout":gf.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":_f.delete(s.pointerId)}}function Gs(r,s,c,g,b,M){return r===null||r.nativeEvent!==M?(r={blockedOn:s,domEventName:c,eventSystemFlags:g,nativeEvent:M,targetContainers:[b]},s!==null&&(s=vs(s),s!==null&&Rp(s)),r):(r.eventSystemFlags|=g,s=r.targetContainers,b!==null&&s.indexOf(b)===-1&&s.push(b),r)}function cg(r,s,c,g,b){switch(s){case"focusin":return ul=Gs(ul,r,s,c,g,b),!0;case"dragenter":return cl=Gs(cl,r,s,c,g,b),!0;case"mouseover":return au=Gs(au,r,s,c,g,b),!0;case"pointerover":var M=b.pointerId;return gf.set(M,Gs(gf.get(M)||null,r,s,c,g,b)),!0;case"gotpointercapture":return M=b.pointerId,_f.set(M,Gs(_f.get(M)||null,r,s,c,g,b)),!0}return!1}function uh(r){var s=Ya(r.target);if(s!==null){var c=Xe(s);if(c!==null){if(s=c.tag,s===13){if(s=L(c),s!==null){r.blockedOn=s,cr(r.priority,function(){Rm(c)});return}}else if(s===31){if(s=f(c),s!==null){r.blockedOn=s,cr(r.priority,function(){Rm(c)});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Ed(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var c=Sd(r.nativeEvent);if(c===null){c=r.nativeEvent;var g=new c.constructor(c.type,c);mh=g,c.target.dispatchEvent(g),mh=null}else return s=vs(c),s!==null&&Rp(s),r.blockedOn=c,!1;s.shift()}return!0}function Bm(r,s,c){Ed(r)&&c.delete(s)}function hg(){Op=!1,ul!==null&&Ed(ul)&&(ul=null),cl!==null&&Ed(cl)&&(cl=null),au!==null&&Ed(au)&&(au=null),gf.forEach(Bm),_f.forEach(Bm)}function ch(r,s){r.blockedOn===s&&(r.blockedOn=null,Op||(Op=!0,ce.unstable_scheduleCallback(ce.unstable_NormalPriority,hg)))}var yf=null;function km(r){yf!==r&&(yf=r,ce.unstable_scheduleCallback(ce.unstable_NormalPriority,function(){yf===r&&(yf=null);for(var s=0;s<r.length;s+=3){var c=r[s],g=r[s+1],b=r[s+2];if(typeof g!="function"){if(rc(g||c)===null)continue;break}var M=vs(c);M!==null&&(r.splice(s,3),s-=3,Qi(M,{pending:!0,data:b,method:c.method,action:g},g,b))}}))}function hh(r){function s(ue){return ch(ue,r)}ul!==null&&ch(ul,r),cl!==null&&ch(cl,r),au!==null&&ch(au,r),gf.forEach(s),_f.forEach(s);for(var c=0;c<su.length;c++){var g=su[c];g.blockedOn===r&&(g.blockedOn=null)}for(;0<su.length&&(c=su[0],c.blockedOn===null);)uh(c),c.blockedOn===null&&su.shift();if(c=(r.ownerDocument||r).$$reactFormReplay,c!=null)for(g=0;g<c.length;g+=3){var b=c[g],M=c[g+1],B=b[et]||null;if(typeof M=="function")B||km(c);else if(B){var Z=null;if(M&&M.hasAttribute("formAction")){if(b=M,B=M[et]||null)Z=B.formAction;else if(rc(b)!==null)continue}else Z=B.action;typeof Z=="function"?c[g+1]=Z:(c.splice(g,3),g-=3),km(c)}}}function kp(){function r(M){M.canIntercept&&M.info==="react-transition"&&M.intercept({handler:function(){return new Promise(function(B){return b=B})},focusReset:"manual",scroll:"manual"})}function s(){b!==null&&(b(),b=null),g||setTimeout(c,20)}function c(){if(!g&&!navigation.transition){var M=navigation.currentEntry;M&&M.url!=null&&navigation.navigate(M.url,{state:M.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var g=!1,b=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(c,100),function(){g=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),b!==null&&(b(),b=null)}}}function Ad(r){this._internalRoot=r}Cd.prototype.render=Ad.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(oe(409));var c=s.current,g=xi();Im(c,g,r,s,null,null)},Cd.prototype.unmount=Ad.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;Im(r.current,2,null,r,null,null),Kh(),s[Ot]=null}};function Cd(r){this._internalRoot=r}Cd.prototype.unstable_scheduleHydration=function(r){if(r){var s=ur();r={blockedOn:null,target:r,priority:s};for(var c=0;c<su.length&&s!==0&&s<su[c].priority;c++);su.splice(c,0,r),c===0&&uh(r)}};var Fp=Ie.version;if(Fp!=="19.2.0")throw Error(oe(527,Fp,"19.2.0"));rt.findDOMNode=function(r){var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(oe(188)):(r=Object.keys(r).join(","),Error(oe(268,r)));return r=we(s),r=r!==null?st(r):null,r=r===null?null:r.stateNode,r};var Fm={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:Ue,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var zd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!zd.isDisabled&&zd.supportsFiber)try{ge=zd.inject(Fm),he=zd}catch{}}return Gp.createRoot=function(r,s){if(!Fe(r))throw Error(oe(299));var c=!1,g="",b=xo,M=Fs,B=Bh;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(g=s.identifierPrefix),s.onUncaughtError!==void 0&&(b=s.onUncaughtError),s.onCaughtError!==void 0&&(M=s.onCaughtError),s.onRecoverableError!==void 0&&(B=s.onRecoverableError)),s=Pp(r,1,!1,null,null,c,g,null,b,M,B,kp),r[Ot]=s.current,ld(r),new Ad(s)},Gp.hydrateRoot=function(r,s,c){if(!Fe(r))throw Error(oe(299));var g=!1,b="",M=xo,B=Fs,Z=Bh,ue=null;return c!=null&&(c.unstable_strictMode===!0&&(g=!0),c.identifierPrefix!==void 0&&(b=c.identifierPrefix),c.onUncaughtError!==void 0&&(M=c.onUncaughtError),c.onCaughtError!==void 0&&(B=c.onCaughtError),c.onRecoverableError!==void 0&&(Z=c.onRecoverableError),c.formState!==void 0&&(ue=c.formState)),s=Pp(r,1,!0,s,c??null,g,b,ue,M,B,Z,kp),s.context=Pm(null),c=s.current,g=xi(),g=Eo(g),b=Qt(g),b.callback=null,Ds(c,b,g),c=g,s.current.lanes=c,gi(s,c),js(s),r[Ot]=s.current,ld(r),new Cd(s)},Gp.version="19.2.0",Gp}var Yg;function I_(){if(Yg)return Tg.exports;Yg=1;function ce(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ce)}catch(Ie){console.error(Ie)}}return ce(),Tg.exports=P_(),Tg.exports}var R_=I_();const L_="_container_1cbra_1",O_="_input_1cbra_6",B_="_suggestionsPopover_1cbra_13",k_="_suggestion_1cbra_13",Um={container:L_,input:O_,suggestionsPopover:B_,suggestion:k_};function F_(ce){console.log(ce);const Le=ce.split(",").map(oe=>parseFloat(oe.trim()));return console.log(Le),Le.length===2&&Le.every(oe=>!isNaN(oe))?{lat:Le[0],lng:Le[1]}:null}const r_="M0hbn38cFfDqO9cqfEtq",N_=`https://api.maptiler.com/maps/basic/style.json?key=${r_}`;async function V_(ce){const Le=`https://api.maptiler.com/geocoding/${encodeURIComponent(ce)}.json?key=${r_}&limit=5`;return(await(await fetch(Le)).json()).features.map(Xe=>{const[L,f]=Xe.geometry.coordinates;return{label:Xe.place_name,coordinates:{lat:f,lng:L}}})}function j_({onChange:ce}){const[Ie,Le]=er.useState([]),[oe,Fe]=er.useState("");function Xe(f){const me=f.target.value.trim(),we=F_(me);we?(ce(we),Le([])):me.length>2&&V_(me).then(st=>{Le(st)}),Fe(me)}function L(f){ce(f.coordinates),Fe(f.label),Le([])}return Yr.jsxs("div",{className:Um.container,children:[Yr.jsx("input",{value:oe,placeholder:" ",onChange:Xe,className:Um.input}),!!Ie.length&&Yr.jsx("div",{className:Um.suggestionsPopover,children:Ie.map((f,me)=>Yr.jsx("div",{className:Um.suggestion,onClick:()=>L(f),children:f.label},me))})]})}function U_(ce,Ie){const Le=ce.lng,oe=ce.lat;let Fe=!1;for(let Xe=0,L=Ie.length-1;Xe<Ie.length;L=Xe++){const f=Ie[Xe][0],me=Ie[Xe][1],we=Ie[L][0],st=Ie[L][1];me>oe!=st>oe&&Le<(we-f)*(oe-me)/(st-me)+f&&(Fe=!Fe)}return Fe}var Gm={exports:{}};var G_=Gm.exports,Qg;function q_(){return Qg||(Qg=1,(function(ce,Ie){(function(Le,oe){ce.exports=oe()})(G_,(function(){var Le={},oe={};function Fe(L,f,me){if(oe[L]=me,L==="index"){var we="var sharedModule = {}; ("+oe.shared+")(sharedModule); ("+oe.worker+")(sharedModule);",st={};return oe.shared(st),oe.index(Le,st),typeof window<"u"&&Le.setWorkerUrl(window.URL.createObjectURL(new Blob([we],{type:"text/javascript"}))),Le}}Fe("shared",["exports"],(function(L){function f(n,e,i,o){return new(i||(i=Promise))((function(u,d){function p(T){try{x(o.next(T))}catch(E){d(E)}}function y(T){try{x(o.throw(T))}catch(E){d(E)}}function x(T){var E;T.done?u(T.value):(E=T.value,E instanceof i?E:new i((function(C){C(E)}))).then(p,y)}x((o=o.apply(n,e||[])).next())}))}function me(n,e){this.x=n,this.y=e}function we(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var st,it;typeof SuppressedError=="function"&&SuppressedError,me.prototype={clone(){return new me(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),i=Math.sin(n),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround(n,e){const i=Math.cos(n),o=Math.sin(n),u=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:me},me.convert=function(n){if(n instanceof me)return n;if(Array.isArray(n))return new me(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new me(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var St=(function(){if(it)return st;function n(e,i,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=u}return it=1,st=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var d=this.sampleCurveX(o)-e;if(Math.abs(d)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=d/p}var y=0,x=1;for(o=e,u=0;u<20&&(d=this.sampleCurveX(o),!(Math.abs(d-e)<i));u++)e>d?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},st})(),Mt=we(St);let Kt,Et;function Ae(){return Kt==null&&(Kt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Kt}function Ji(){if(Et==null&&(Et=!1,Ae())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<25;o++){const u=4*o;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const i=e.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&i[o]!==o){Et=!0;break}}}return Et||!1}var ni=1e-6,Ut=typeof Float32Array<"u"?Float32Array:Array;function tr(){var n=new Ut(9);return Ut!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function yr(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Un(){var n=new Ut(3);return Ut!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Lt(n){var e=n[0],i=n[1],o=n[2];return Math.sqrt(e*e+i*i+o*o)}function Bn(n,e,i){var o=new Ut(3);return o[0]=n,o[1]=e,o[2]=i,o}function ir(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function Lr(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function or(n,e,i){var o=e[0],u=e[1],d=e[2],p=i[0],y=i[1],x=i[2];return n[0]=u*x-d*y,n[1]=d*p-o*x,n[2]=o*y-u*p,n}var en,lr=Lt;function Qr(n,e,i){var o=e[0],u=e[1],d=e[2],p=e[3];return n[0]=i[0]*o+i[4]*u+i[8]*d+i[12]*p,n[1]=i[1]*o+i[5]*u+i[9]*d+i[13]*p,n[2]=i[2]*o+i[6]*u+i[10]*d+i[14]*p,n[3]=i[3]*o+i[7]*u+i[11]*d+i[15]*p,n}function nr(){var n=new Ut(4);return Ut!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Ue(n,e,i,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",d=Math.PI/360;e*=d,o*=d,i*=d;var p=Math.sin(e),y=Math.cos(e),x=Math.sin(i),T=Math.cos(i),E=Math.sin(o),C=Math.cos(o);switch(u){case"xyz":n[0]=p*T*C+y*x*E,n[1]=y*x*C-p*T*E,n[2]=y*T*E+p*x*C,n[3]=y*T*C-p*x*E;break;case"xzy":n[0]=p*T*C-y*x*E,n[1]=y*x*C-p*T*E,n[2]=y*T*E+p*x*C,n[3]=y*T*C+p*x*E;break;case"yxz":n[0]=p*T*C+y*x*E,n[1]=y*x*C-p*T*E,n[2]=y*T*E-p*x*C,n[3]=y*T*C+p*x*E;break;case"yzx":n[0]=p*T*C+y*x*E,n[1]=y*x*C+p*T*E,n[2]=y*T*E-p*x*C,n[3]=y*T*C-p*x*E;break;case"zxy":n[0]=p*T*C-y*x*E,n[1]=y*x*C+p*T*E,n[2]=y*T*E+p*x*C,n[3]=y*T*C-p*x*E;break;case"zyx":n[0]=p*T*C-y*x*E,n[1]=y*x*C+p*T*E,n[2]=y*T*E-p*x*C,n[3]=y*T*C+p*x*E;break;default:throw new Error("Unknown angle order "+u)}return n}function rt(){var n=new Ut(2);return Ut!=Float32Array&&(n[0]=0,n[1]=0),n}function Ct(n,e){var i=new Ut(2);return i[0]=n,i[1]=e,i}Un(),en=new Ut(4),Ut!=Float32Array&&(en[0]=0,en[1]=0,en[2]=0,en[3]=0),Un(),Bn(1,0,0),Bn(0,1,0),nr(),nr(),tr(),rt();const wt=8192;function ui(n,e,i){return e*(wt/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}function de(n,e){return(n%e+e)%e}function Qe(n,e,i){return n*(1-i)+e*i}function ct(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function gt(n,e,i,o){const u=new Mt(n,e,i,o);return d=>u.solve(d)}const Tt=gt(.25,.1,.25,1);function kt(n,e,i){return Math.min(i,Math.max(e,n))}function $t(n,e,i){const o=i-e,u=((n-e)%o+o)%o+e;return u===e?i:u}function Si(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}let Ri=1;function vr(n,e,i){const o={};for(const u in n)o[u]=e.call(this,n[u],u,n);return o}function Hs(n,e,i){const o={};for(const u in n)e.call(this,n[u],u,n)&&(o[u]=n[u]);return o}function Wr(n){return Array.isArray(n)?n.map(Wr):typeof n=="object"&&n?vr(n,Wr):n}const gl={};function Zi(n){gl[n]||(typeof console<"u"&&console.warn(n),gl[n]=!0)}function Or(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function ma(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let tn=null;function _s(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const ys="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function $s(n,e,i,o,u){return f(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const d=new VideoFrame(n,{timestamp:0});try{const p=d?.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const y=p.startsWith("BGR"),x=new Uint8ClampedArray(o*u*4);if(yield d.copyTo(x,(function(T,E,C,D,P){const O=4*Math.max(-E,0),k=(Math.max(0,C)-C)*D*4+O,N=4*D,G=Math.max(0,E),J=Math.max(0,C);return{rect:{x:G,y:J,width:Math.min(T.width,E+D)-G,height:Math.min(T.height,C+P)-J},layout:[{offset:k,stride:N}]}})(n,e,i,o,u)),y)for(let T=0;T<x.length;T+=4){const E=x[T];x[T]=x[T+2],x[T+2]=E}return x}finally{d.close()}}))}let $a,Da;function _l(n,e,i,o){return n.addEventListener(e,i,o),{unsubscribe:()=>{n.removeEventListener(e,i,o)}}}function Gn(n){return n*Math.PI/180}function Br(n){return n/Math.PI*180}const ye={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},j={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},V="AbortError";class H extends Error{constructor(e=V){super(e instanceof Error?e.message:e),this.name=V,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function ae(n){return n.name===V}const le={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Te(n){return le.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const ge="global-dispatcher";class he extends Error{constructor(e,i,o,u){super(`AJAXError: ${i} (${e}): ${o}`),this.status=e,this.statusText=i,this.url=o,this.body=u}}const Se=()=>ma(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ve=function(n,e){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const o=Te(n.url);if(o)return o(n,e);if(ma(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:ge},e)}if(!(/^file:/.test(i=n.url)||/^file:/.test(Se())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,u){return f(this,void 0,void 0,(function*(){const d=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Se(),signal:u.signal});let p,y;o.type!=="json"||d.headers.has("Accept")||d.headers.set("Accept","application/json");try{p=yield fetch(d)}catch(T){throw ae(T)?T:new he(0,T.message,o.url,new Blob)}if(!p.ok){const T=yield p.blob();throw new he(p.status,p.statusText,o.url,T)}y=o.type==="arrayBuffer"||o.type==="image"?p.arrayBuffer():o.type==="json"?p.json():p.text();const x=yield y;return u.signal.throwIfAborted(),{data:x,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}}))})(n,e);if(ma(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:ge},e)}var i;return(function(o,u){return new Promise(((d,p)=>{var y;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const T in o.headers)x.setRequestHeader(T,o.headers[T]);o.type==="json"&&(x.responseType="text",!((y=o.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if(!u.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let T=x.response;if(o.type==="json")try{T=JSON.parse(x.response)}catch(E){return void p(E)}d({data:T,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const T=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});p(new he(x.status,x.statusText,o.url,T))}},u.signal.addEventListener("abort",(()=>{x.abort(),p(new H(u.signal.reason))})),x.send(o.body)}))})(n,e)};function je(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const e=new URL(n),i=window.location;return e.protocol===i.protocol&&e.host===i.host}function lt(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function mt(n,e,i){if(i&&i[n]){const o=i[n].indexOf(e);o!==-1&&i[n].splice(o,1)}}class zt{constructor(e,i={}){Si(this,i),this.type=e}}class ci extends zt{constructor(e,i={}){super("error",Si({error:e},i))}}class Jt{on(e,i){return this._listeners=this._listeners||{},lt(e,i,this._listeners),{unsubscribe:()=>{this.off(e,i)}}}off(e,i){return mt(e,i,this._listeners),mt(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},lt(e,i,this._oneTimeListeners),this):new Promise((o=>this.once(e,o)))}fire(e,i){typeof e=="string"&&(e=new zt(e,i||{}));const o=e.type;if(this.listens(o)){e.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of u)y.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of d)mt(o,y,this._oneTimeListeners),y.call(this,e);const p=this._eventedParent;p&&(Si(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof ci&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var ve={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const pi=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function _n(n,e){const i={};for(const o in n)o!=="ref"&&(i[o]=n[o]);return pi.forEach((o=>{o in e&&(i[o]=e[o])})),i}function It(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!It(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!It(n[i],e[i]))return!1;return!0}return n===e}function mi(n,e){n.push(e)}function kn(n,e,i){mi(i,{command:"addSource",args:[n,e[n]]})}function gi(n,e,i){mi(e,{command:"removeSource",args:[n]}),i[n]=!0}function hn(n,e,i,o){gi(n,i,o),kn(n,e,i)}function Mi(n,e,i){let o;for(o in n[i])if(Object.prototype.hasOwnProperty.call(n[i],o)&&o!=="data"&&!It(n[i][o],e[i][o]))return!1;for(o in e[i])if(Object.prototype.hasOwnProperty.call(e[i],o)&&o!=="data"&&!It(n[i][o],e[i][o]))return!1;return!0}function yn(n,e,i,o,u,d){n=n||{},e=e||{};for(const p in n)Object.prototype.hasOwnProperty.call(n,p)&&(It(n[p],e[p])||i.push({command:d,args:[o,p,e[p],u]}));for(const p in e)Object.prototype.hasOwnProperty.call(e,p)&&!Object.prototype.hasOwnProperty.call(n,p)&&(It(n[p],e[p])||i.push({command:d,args:[o,p,e[p],u]}))}function yl(n){return n.id}function Eo(n,e){return n[e.id]=e,n}class Ke{constructor(e,i,o,u){this.message=(e?`${e}: `:"")+o,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function ur(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}class cr extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Pa{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,u]of i)this.bindings[o]=u}concat(e){return new Pa(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ii={kind:"null"},et={kind:"number"},Ot={kind:"string"},Nt={kind:"boolean"},Kr={kind:"color"},lc={kind:"projectionDefinition"},Xa={kind:"object"},Rt={kind:"value"},Ao={kind:"collator"},Ya={kind:"formatted"},vs={kind:"padding"},Qa={kind:"colorArray"},Wa={kind:"numberArray"},nn={kind:"resolvedImage"},vl={kind:"variableAnchorOffsetCollection"};function hr(n,e){return{kind:"array",itemType:n,N:e}}function ei(n){if(n.kind==="array"){const e=ei(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const xs=[Ii,et,Ot,Nt,Kr,lc,Ya,Xa,hr(Rt),vs,Wa,Qa,nn,vl];function xl(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!xl(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of xs)if(!xl(i,e))return null}}return`Expected ${ei(n)} but found ${ei(e)} instead.`}function bl(n,e){return e.some((i=>i.kind===n.kind))}function Xs(n,e){return e.some((i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n))}function Ia(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const lu=.96422,Ka=.82521,ga=4/29,ai=6/29,dh=3*ai*ai,Tf=ai*ai*ai,Co=Math.PI/180,ph=180/Math.PI;function uu(n){return(n%=360)<0&&(n+=360),n}function Sf([n,e,i,o]){let u,d;const p=cu((.2225045*(n=xr(n))+.7168786*(e=xr(e))+.0606169*(i=xr(i)))/1);n===e&&e===i?u=d=p:(u=cu((.4360747*n+.3850649*e+.1430804*i)/lu),d=cu((.0139322*n+.0971045*e+.7141733*i)/Ka));const y=116*p-16;return[y<0?0:y,500*(u-p),200*(p-d),o]}function xr(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function cu(n){return n>Tf?Math.pow(n,1/3):n/dh+ga}function uc([n,e,i,o]){let u=(n+16)/116,d=isNaN(e)?u:u+e/500,p=isNaN(i)?u:u-i/200;return u=1*Ys(u),d=lu*Ys(d),p=Ka*Ys(p),[hu(3.1338561*d-1.6168667*u-.4906146*p),hu(-.9787684*d+1.9161415*u+.033454*p),hu(.0719453*d-.2289914*u+1.4052427*p),o]}function hu(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Ys(n){return n>ai?n*n*n:dh*(n-ga)}const Mf=Object.hasOwn||function(n,e){return Object.prototype.hasOwnProperty.call(n,e)};function wl(n,e){return Mf(n,e)?n[e]:void 0}function bs(n){return parseInt(n.padEnd(2,n),16)/255}function Ef(n,e){return zo(e?n/100:n,0,1)}function zo(n,e,i){return Math.min(Math.max(e,n),i)}function cc(n){return!n.some(Number.isNaN)}const Do={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Qs(n,e,i){return n+i*(e-n)}function Tl(n,e,i){return n.map(((o,u)=>Qs(o,e[u],i)))}class Ft{constructor(e,i,o,u=1,d=!0){this.r=e,this.g=i,this.b=o,this.a=u,d||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,i,o,u]))}static parse(e){if(e instanceof Ft)return e;if(typeof e!="string")return;const i=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=wl(Do,o);if(u){const[p,y,x]=u;return[p/255,y/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const p=o.length<6?1:2;let y=1;return[bs(o.slice(y,y+=p)),bs(o.slice(y,y+=p)),bs(o.slice(y,y+=p)),bs(o.slice(y,y+p)||"ff")]}if(o.startsWith("rgb")){const p=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[y,x,T,E,C,D,P,O,k,N,G,J]=p,q=[E||" ",P||" ",N].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const $=[T,D,k].join(""),te=$==="%%%"?100:$===""?255:0;if(te){const ne=[zo(+x/te,0,1),zo(+C/te,0,1),zo(+O/te,0,1),G?Ef(+G,J):1];if(cc(ne))return ne}}return}}const d=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(d){const[p,y,x,T,E,C,D,P,O]=d,k=[x||" ",E||" ",D].join("");if(k==="  "||k==="  /"||k===",,"||k===",,,"){const N=[+y,zo(+T,0,100),zo(+C,0,100),P?Ef(+P,O):1];if(cc(N))return(function([G,J,q,$]){function te(ne){const be=(ne+G/30)%12,Ne=J*Math.min(q,1-q);return q-Ne*Math.max(-1,Math.min(be-3,9-be,1))}return G=uu(G),J/=100,q/=100,[te(0),te(8),te(4),$]})(N)}}})(e);return i?new Ft(...i,!1):void 0}get rgb(){const{r:e,g:i,b:o,a:u}=this,d=u||1/0;return this.overwriteGetter("rgb",[e/d,i/d,o/d,u])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[i,o,u,d]=Sf(e),p=Math.sqrt(o*o+u*u);return[Math.round(1e4*p)?uu(Math.atan2(u,o)*ph):NaN,p,i,d]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Sf(this.rgb))}overwriteGetter(e,i){return Object.defineProperty(this,e,{value:i}),i}toString(){const[e,i,o,u]=this.rgb;return`rgba(${[e,i,o].map((d=>Math.round(255*d))).join(",")},${u})`}static interpolate(e,i,o,u="rgb"){switch(u){case"rgb":{const[d,p,y,x]=Tl(e.rgb,i.rgb,o);return new Ft(d,p,y,x,!1)}case"hcl":{const[d,p,y,x]=e.hcl,[T,E,C,D]=i.hcl;let P,O;if(isNaN(d)||isNaN(T))isNaN(d)?isNaN(T)?P=NaN:(P=T,y!==1&&y!==0||(O=E)):(P=d,C!==1&&C!==0||(O=p));else{let q=T-d;T>d&&q>180?q-=360:T<d&&d-T>180&&(q+=360),P=d+o*q}const[k,N,G,J]=(function([q,$,te,ne]){return q=isNaN(q)?0:q*Co,uc([te,Math.cos(q)*$,Math.sin(q)*$,ne])})([P,O??Qs(p,E,o),Qs(y,C,o),Qs(x,D,o)]);return new Ft(k,N,G,J,!1)}case"lab":{const[d,p,y,x]=uc(Tl(e.lab,i.lab,o));return new Ft(d,p,y,x,!1)}}}}Ft.black=new Ft(0,0,0,1),Ft.white=new Ft(1,1,1,1),Ft.transparent=new Ft(0,0,0,0),Ft.red=new Ft(1,0,0,1);class Ra{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const mh=["bottom","center","top"];class fu{constructor(e,i,o,u,d,p){this.text=e,this.image=i,this.scale=o,this.fontStack=u,this.textColor=d,this.verticalAlign=p}}class Fn{constructor(e){this.sections=e}static fromString(e){return new Fn([new fu(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof Fn?e:Fn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class vn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof vn)return e;if(typeof e=="number")return new vn([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const i of e)if(typeof i!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new vn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new vn(Tl(e.values,i.values,o))}}class ki{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ki)return e;if(typeof e=="number")return new ki([e]);if(Array.isArray(e)){for(const i of e)if(typeof i!="number")return;return new ki(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new ki(Tl(e.values,i.values,o))}}class At{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof At)return e;if(typeof e=="string"){const o=Ft.parse(e);return o?new At([o]):void 0}if(!Array.isArray(e))return;const i=[];for(const o of e){if(typeof o!="string")return;const u=Ft.parse(o);if(!u)return;i.push(u)}return new At(i)}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o,u="rgb"){const d=[];if(e.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let p=0;p<e.values.length;p++)d.push(Ft.interpolate(e.values[p],i.values[p],o,u));return new At(d)}}class Ei extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const _a=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class rn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof rn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let i=0;i<e.length;i+=2){const o=e[i],u=e[i+1];if(typeof o!="string"||!_a.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new rn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){const u=e.values,d=i.values;if(u.length!==d.length)throw new Ei(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${i.toString()}`);const p=[];for(let y=0;y<u.length;y+=2){if(u[y]!==d[y])throw new Ei(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${u[y]}, to[${y}]: ${d[y]}`);p.push(u[y]);const[x,T]=u[y+1],[E,C]=d[y+1];p.push([Qs(x,E,o),Qs(T,C,o)])}return new rn(p)}}class br{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new br({name:e,available:!1}):null}}class Nn{constructor(e,i,o){this.from=e,this.to=i,this.transition=o}static interpolate(e,i,o){return new Nn(e,i,o)}static parse(e){return e instanceof Nn?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new Nn(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new Nn(e.from,e.to,e.transition):typeof e=="string"?new Nn(e,e,1):void 0}}function Jr(n,e,i,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,i,o]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ja(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Nn||n instanceof Ft||n instanceof Ra||n instanceof Fn||n instanceof vn||n instanceof ki||n instanceof At||n instanceof rn||n instanceof br)return!0;if(Array.isArray(n)){for(const e of n)if(!Ja(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Ja(n[e]))return!1;return!0}return!1}function Fi(n){if(n===null)return Ii;if(typeof n=="string")return Ot;if(typeof n=="boolean")return Nt;if(typeof n=="number")return et;if(n instanceof Ft)return Kr;if(n instanceof Nn)return lc;if(n instanceof Ra)return Ao;if(n instanceof Fn)return Ya;if(n instanceof vn)return vs;if(n instanceof ki)return Wa;if(n instanceof At)return Qa;if(n instanceof rn)return vl;if(n instanceof br)return nn;if(Array.isArray(n)){const e=n.length;let i;for(const o of n){const u=Fi(o);if(i){if(i===u)continue;i=Rt;break}i=u}return hr(i||Rt,e)}return Xa}function Ws(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Ft||n instanceof Nn||n instanceof Fn||n instanceof vn||n instanceof ki||n instanceof At||n instanceof rn||n instanceof br?n.toString():JSON.stringify(n)}class ea{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ja(e[1]))return i.error("invalid value");const o=e[1];let u=Fi(o);const d=i.expectedType;return u.kind!=="array"||u.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(u=d),new ea(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Po={string:Ot,number:et,boolean:Nt,object:Xa};class wr{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,u=1;const d=e[0];if(d==="array"){let y,x;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in Po)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=Po[T],u++}else y=Rt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=e[2],u++}o=hr(y,x)}else{if(!Po[d])throw new Error(`Types doesn't contain name = ${d}`);o=Po[d]}const p=[];for(;u<e.length;u++){const y=i.parse(e[u],u,Rt);if(!y)return null;p.push(y)}return new wr(o,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!xl(this.type,Fi(o)))return o;if(i===this.args.length-1)throw new Ei(`Expected value to be of type ${ei(this.type)}, but found ${ei(Fi(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Sn={"to-boolean":Nt,"to-color":Kr,"to-number":et,"to-string":Ot};class Tr{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0];if(!Sn[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");const u=Sn[o],d=[];for(let p=1;p<e.length;p++){const y=i.parse(e[p],p,Rt);if(!y)return null;d.push(y)}return new Tr(u,d)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let i,o;for(const u of this.args){if(i=u.evaluate(e),o=null,i instanceof Ft)return i;if(typeof i=="string"){const d=e.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Jr(i[0],i[1],i[2],i[3]),!o))return new Ft(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Ei(o||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const o of this.args){i=o.evaluate(e);const u=vn.parse(i);if(u)return u}throw new Ei(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(const o of this.args){i=o.evaluate(e);const u=ki.parse(i);if(u)return u}throw new Ei(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(const o of this.args){i=o.evaluate(e);const u=At.parse(i);if(u)return u}throw new Ei(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const o of this.args){i=o.evaluate(e);const u=rn.parse(i);if(u)return u}throw new Ei(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new Ei(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return Fn.fromString(Ws(this.args[0].evaluate(e)));case"resolvedImage":return br.fromString(Ws(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Ws(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const du=["Unknown","Point","LineString","Polygon"];class Io{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?du[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let i=this._parseColorCache.get(e);return i||(i=Ft.parse(e),this._parseColorCache.set(e,i)),i}}class Ro{constructor(e,i,o=[],u,d=new Pa,p=[]){this.registry=e,this.path=o,this.key=o.map((y=>`[${y}]`)).join(""),this.scope=d,this.errors=p,this.expectedType=u,this._isConstant=i}parse(e,i,o,u,d={}){return i?this.concat(i,o,u)._parse(e,d):this._parse(e,d)}_parse(e,i){function o(u,d,p){return p==="assert"?new wr(d,[u]):p==="coerce"?new Tr(d,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[u];if(d){let p=d.parse(e,this);if(!p)return null;if(this.expectedType){const y=this.expectedType,x=p.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value"){if(y.kind==="projectionDefinition"&&["string","array"].includes(x.kind)||["color","formatted","resolvedImage"].includes(y.kind)&&["value","string"].includes(x.kind)||["padding","numberArray"].includes(y.kind)&&["value","number","array"].includes(x.kind)||y.kind==="colorArray"&&["value","string","array"].includes(x.kind)||y.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(x.kind))p=o(p,y,i.typeAnnotation||"coerce");else if(this.checkSubtype(y,x))return null}else p=o(p,y,i.typeAnnotation||"assert")}if(!(p instanceof ea)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const y=new Io;try{p=new ea(p.type,p.evaluate(y))}catch(x){return this.error(x.message),null}}return p}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){const u=typeof e=="number"?this.path.concat(e):this.path,d=o?this.scope.concat(o):this.scope;return new Ro(this.registry,this._isConstant,u,i||null,d,this.errors)}error(e,...i){const o=`${this.key}${i.map((u=>`[${u}]`)).join("")}`;this.errors.push(new cr(o,e))}checkSubtype(e,i){const o=xl(e,i);return o&&this.error(o),o}}class _i{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let d=1;d<e.length-1;d+=2){const p=e[d];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,d);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=i.parse(e[d+1],d+1);if(!y)return null;o.push([p,y])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return u?new _i(o,u):null}outputDefined(){return this.result.outputDefined()}}class Ks{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new Ks(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class jt{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,et),u=i.parse(e[2],2,hr(i.expectedType||Rt));return o&&u?new jt(u.type.itemType,o,u):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Ei(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Ei(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Ei(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Bt{constructor(e,i){this.type=Nt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Rt),u=i.parse(e[2],2,Rt);return o&&u?bl(o.type,[Nt,Ot,et,Ii,Rt])?new Bt(o,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ei(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!Xs(i,["boolean","string","number","null"]))throw new Ei(`Expected first argument to be of type boolean, string, number or null, but found ${ei(Fi(i))} instead.`);if(!Xs(o,["string","array"]))throw new Ei(`Expected second argument to be of type array or string, but found ${ei(Fi(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Lo{constructor(e,i,o){this.type=et,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Rt),u=i.parse(e[2],2,Rt);if(!o||!u)return null;if(!bl(o.type,[Nt,Ot,et,Ii,Rt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ei(o.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,et);return d?new Lo(o,u,d):null}return new Lo(o,u)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Xs(i,["boolean","string","number","null"]))throw new Ei(`Expected first argument to be of type boolean, string, number or null, but found ${ei(Fi(i))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(e)),Xs(o,["string"])){const d=o.indexOf(i,u);return d===-1?-1:[...o.slice(0,d)].length}if(Xs(o,["array"]))return o.indexOf(i,u);throw new Ei(`Expected second argument to be of type array or string, but found ${ei(Fi(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class ti{constructor(e,i,o,u,d,p){this.inputType=e,this.type=i,this.input=o,this.cases=u,this.outputs=d,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const d={},p=[];for(let T=2;T<e.length-1;T+=2){let E=e[T];const C=e[T+1];Array.isArray(E)||(E=[E]);const D=i.concat(T);if(E.length===0)return D.error("Expected at least one branch label.");for(const O of E){if(typeof O!="number"&&typeof O!="string")return D.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return D.error("Numeric branch labels must be integer values.");if(o){if(D.checkSubtype(o,Fi(O)))return null}else o=Fi(O);if(d[String(O)]!==void 0)return D.error("Branch labels must be unique.");d[String(O)]=p.length}const P=i.parse(C,T,u);if(!P)return null;u=u||P.type,p.push(P)}const y=i.parse(e[1],1,Rt);if(!y)return null;const x=i.parse(e[e.length-1],e.length-1,u);return x?y.type.kind!=="value"&&i.concat(1).checkSubtype(o,y.type)?null:new ti(o,u,y,d,p,x):null}evaluate(e){const i=this.input.evaluate(e);return(Fi(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class pu{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const u=[];for(let p=1;p<e.length-1;p+=2){const y=i.parse(e[p],p,Nt);if(!y)return null;const x=i.parse(e[p+1],p+1,o);if(!x)return null;u.push([y,x]),o=o||x.type}const d=i.parse(e[e.length-1],e.length-1,o);if(!d)return null;if(!o)throw new Error("Can't infer output type");return new pu(o,u,d)}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}}class ya{constructor(e,i,o,u){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Rt),u=i.parse(e[2],2,et);if(!o||!u)return null;if(!bl(o.type,[hr(Rt),Ot,Rt]))return i.error(`Expected first argument to be of type array or string, but found ${ei(o.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,et);return d?new ya(o.type,o,u,d):null}return new ya(o.type,o,u)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let u;if(this.endIndex&&(u=this.endIndex.evaluate(e)),Xs(i,["string"]))return[...i].slice(o,u).join("");if(Xs(i,["array"]))return i.slice(o,u);throw new Ei(`Expected first argument to be of type array or string, but found ${ei(Fi(i))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Js(n,e){const i=n.length-1;let o,u,d=0,p=i,y=0;for(;d<=p;)if(y=Math.floor((d+p)/2),o=n[y],u=n[y+1],o<=e){if(y===i||e<u)return y;d=y+1}else{if(!(o>e))throw new Ei("Input is not a number.");p=y-1}return 0}class eo{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,d]of o)this.labels.push(u),this.outputs.push(d)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,et);if(!o)return null;const u=[];let d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let p=1;p<e.length;p+=2){const y=p===1?-1/0:e[p],x=e[p+1],T=p,E=p+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(u.length&&u[u.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const C=i.parse(x,E,d);if(!C)return null;d=d||C.type,u.push([y,C])}return new eo(d,o,u)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const d=i.length;return u>=i[d-1]?o[d-1].evaluate(e):o[Js(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Af(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var mu,gh,Od=(function(){if(gh)return mu;function n(e,i,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=u}return gh=1,mu=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var d=this.sampleCurveX(o)-e;if(Math.abs(d)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=d/p}var y=0,x=1;for(o=e,u=0;u<20&&(d=this.sampleCurveX(o),!(Math.abs(d-e)<i));u++)e>d?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},mu})(),_h=Af(Od);class Sr{constructor(e,i,o,u,d){this.type=e,this.operator=i,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[p,y]of d)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(e,i,o,u){let d=0;if(e.name==="exponential")d=es(i,e.base,o,u);else if(e.name==="linear")d=es(i,1,o,u);else if(e.name==="cubic-bezier"){const p=e.controlPoints;d=new _h(p[0],p[1],p[2],p[3]).solve(es(i,1,o,u))}return d}static parse(e,i){let[o,u,d,...p]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const T=u[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:T}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const T=u.slice(1);if(T.length!==4||T.some((E=>typeof E!="number"||E<0||E>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,et),!d)return null;const y=[];let x=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||i.expectedType==Qa?i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType):x=Kr;for(let T=0;T<p.length;T+=2){const E=p[T],C=p[T+1],D=T+3,P=T+4;if(typeof E!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(y.length&&y[y.length-1][0]>=E)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const O=i.parse(C,P,x);if(!O)return null;x=x||O.type,y.push([E,O])}return Ia(x,et)||Ia(x,lc)||Ia(x,Kr)||Ia(x,vs)||Ia(x,Wa)||Ia(x,Qa)||Ia(x,vl)||Ia(x,hr(et))?new Sr(x,o,u,d,y):i.error(`Type ${ei(x)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const d=i.length;if(u>=i[d-1])return o[d-1].evaluate(e);const p=Js(i,u),y=Sr.interpolationFactor(this.interpolation,u,i[p],i[p+1]),x=o[p].evaluate(e),T=o[p+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Qs(x,T,y);case"color":return Ft.interpolate(x,T,y);case"padding":return vn.interpolate(x,T,y);case"colorArray":return At.interpolate(x,T,y);case"numberArray":return ki.interpolate(x,T,y);case"variableAnchorOffsetCollection":return rn.interpolate(x,T,y);case"array":return Tl(x,T,y);case"projectionDefinition":return Nn.interpolate(x,T,y)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ft.interpolate(x,T,y,"hcl");case"colorArray":return At.interpolate(x,T,y,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ft.interpolate(x,T,y,"lab");case"colorArray":return At.interpolate(x,T,y,"lab")}}}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function es(n,e,i,o){const u=o-i,d=n-i;return u===0?0:e===1?d/u:(Math.pow(e,d)-1)/(Math.pow(e,u)-1)}const Ni={color:Ft.interpolate,number:Qs,padding:vn.interpolate,numberArray:ki.interpolate,colorArray:At.interpolate,variableAnchorOffsetCollection:rn.interpolate,array:Tl};class Oo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o=null;const u=i.expectedType;u&&u.kind!=="value"&&(o=u);const d=[];for(const y of e.slice(1)){const x=i.parse(y,1+d.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,d.push(x)}if(!o)throw new Error("No output type");const p=u&&d.some((y=>xl(u,y.type)));return new Oo(p?Rt:o,d)}evaluate(e){let i,o=null,u=0;for(const d of this.args)if(u++,o=d.evaluate(e),o&&o instanceof br&&!o.available&&(i||(i=o.name),o=null,u===this.args.length&&(o=i)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function gu(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function _u(n,e,i,o){return o.compare(e,i)===0}function an(n,e,i){const o=n!=="=="&&n!=="!=";return class a_{constructor(d,p,y){this.type=Nt,this.lhs=d,this.rhs=p,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||p.type.kind==="value"}static parse(d,p){if(d.length!==3&&d.length!==4)return p.error("Expected two or three arguments.");const y=d[0];let x=p.parse(d[1],1,Rt);if(!x)return null;if(!gu(y,x.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${ei(x.type)}'.`);let T=p.parse(d[2],2,Rt);if(!T)return null;if(!gu(y,T.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${ei(T.type)}'.`);if(x.type.kind!==T.type.kind&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error(`Cannot compare types '${ei(x.type)}' and '${ei(T.type)}'.`);o&&(x.type.kind==="value"&&T.type.kind!=="value"?x=new wr(T.type,[x]):x.type.kind!=="value"&&T.type.kind==="value"&&(T=new wr(x.type,[T])));let E=null;if(d.length===4){if(x.type.kind!=="string"&&T.type.kind!=="string"&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(E=p.parse(d[3],3,Ao),!E)return null}return new a_(x,T,E)}evaluate(d){const p=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(o&&this.hasUntypedArgument){const x=Fi(p),T=Fi(y);if(x.kind!==T.kind||x.kind!=="string"&&x.kind!=="number")throw new Ei(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${x.kind}, ${T.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=Fi(p),T=Fi(y);if(x.kind!=="string"||T.kind!=="string")return e(d,p,y)}return this.collator?i(d,p,y,this.collator.evaluate(d)):e(d,p,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}}}const Cf=an("==",(function(n,e,i){return e===i}),_u),hc=an("!=",(function(n,e,i){return e!==i}),(function(n,e,i,o){return!_u(0,e,i,o)})),zf=an("<",(function(n,e,i){return e<i}),(function(n,e,i,o){return o.compare(e,i)<0})),Bd=an(">",(function(n,e,i){return e>i}),(function(n,e,i,o){return o.compare(e,i)>0})),Sl=an("<=",(function(n,e,i){return e<=i}),(function(n,e,i,o){return o.compare(e,i)<=0})),fc=an(">=",(function(n,e,i){return e>=i}),(function(n,e,i,o){return o.compare(e,i)>=0}));class Ml{constructor(e,i,o){this.type=Ao,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const u=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Nt);if(!u)return null;const d=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Nt);if(!d)return null;let p=null;return o.locale&&(p=i.parse(o.locale,1,Ot),!p)?null:new Ml(u,d,p)}evaluate(e){return new Ra(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class yh{constructor(e,i,o,u,d){this.type=Ot,this.number=e,this.locale=i,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=d}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,et);if(!o)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let d=null;if(u.locale&&(d=i.parse(u.locale,1,Ot),!d))return null;let p=null;if(u.currency&&(p=i.parse(u.currency,1,Ot),!p))return null;let y=null;if(u["min-fraction-digits"]&&(y=i.parse(u["min-fraction-digits"],1,et),!y))return null;let x=null;return u["max-fraction-digits"]&&(x=i.parse(u["max-fraction-digits"],1,et),!x)?null:new yh(o,d,p,y,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class yu{constructor(e){this.type=Ya,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const u=[];let d=!1;for(let p=1;p<=e.length-1;++p){const y=e[p];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let x=null;if(y["font-scale"]&&(x=i.parse(y["font-scale"],1,et),!x))return null;let T=null;if(y["text-font"]&&(T=i.parse(y["text-font"],1,hr(Ot)),!T))return null;let E=null;if(y["text-color"]&&(E=i.parse(y["text-color"],1,Kr),!E))return null;let C=null;if(y["vertical-align"]){if(typeof y["vertical-align"]=="string"&&!mh.includes(y["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${y["vertical-align"]}' instead.`);if(C=i.parse(y["vertical-align"],1,Ot),!C)return null}const D=u[u.length-1];D.scale=x,D.font=T,D.textColor=E,D.verticalAlign=C}else{const x=i.parse(e[p],1,Rt);if(!x)return null;const T=x.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,u.push({content:x,scale:null,font:null,textColor:null,verticalAlign:null})}}return new yu(u)}evaluate(e){return new Fn(this.sections.map((i=>{const o=i.content.evaluate(e);return Fi(o)===nn?new fu("",o,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(e):null):new fu(Ws(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null,i.verticalAlign?i.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor),i.verticalAlign&&e(i.verticalAlign)}outputDefined(){return!1}}class El{constructor(e){this.type=nn,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Ot);return o?new El(o):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),o=br.fromString(i);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(i)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class Al{constructor(e){this.type=et,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${ei(o.type)} instead.`):new Al(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new Ei(`Expected value to be of type string or array, but found ${ei(Fi(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const fn=8192;function Cl(n,e){const i=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*fn),Math.round(o*u*fn)]}function zl(n,e){const i=Math.pow(2,e.z);return[(u=(n[0]/fn+e.x)/i,360*u-180),(o=(n[1]/fn+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Dl(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function to(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Df(n,e,i){const o=n[0]-e[0],u=n[1]-e[1],d=n[0]-i[0],p=n[1]-i[1];return o*p-d*u==0&&o*d<=0&&u*p<=0}function vu(n,e,i,o){return(u=[o[0]-i[0],o[1]-i[1]])[0]*(d=[e[0]-n[0],e[1]-n[1]])[1]-u[1]*d[0]!=0&&!(!pc(n,e,i,o)||!pc(i,o,n,e));var u,d}function Pf(n,e,i){for(const o of i)for(let u=0;u<o.length-1;++u)if(vu(n,e,o[u],o[u+1]))return!0;return!1}function La(n,e,i=!1){let o=!1;for(const y of e)for(let x=0;x<y.length-1;x++){if(Df(n,y[x],y[x+1]))return i;(d=y[x])[1]>(u=n)[1]!=(p=y[x+1])[1]>u[1]&&u[0]<(p[0]-d[0])*(u[1]-d[1])/(p[1]-d[1])+d[0]&&(o=!o)}var u,d,p;return o}function dc(n,e){for(const i of e)if(La(n,i))return!0;return!1}function If(n,e){for(const i of n)if(!La(i,e))return!1;for(let i=0;i<n.length-1;++i)if(Pf(n[i],n[i+1],e))return!1;return!0}function Rf(n,e){for(const i of e)if(If(n,i))return!0;return!1}function pc(n,e,i,o){const u=o[0]-i[0],d=o[1]-i[1],p=(n[0]-i[0])*d-u*(n[1]-i[1]),y=(e[0]-i[0])*d-u*(e[1]-i[1]);return p>0&&y<0||p<0&&y>0}function mc(n,e,i){const o=[];for(let u=0;u<n.length;u++){const d=[];for(let p=0;p<n[u].length;p++){const y=Cl(n[u][p],i);Dl(e,y),d.push(y)}o.push(d)}return o}function Bo(n,e,i){const o=[];for(let u=0;u<n.length;u++){const d=mc(n[u],e,i);o.push(d)}return o}function Pl(n,e,i,o){if(n[0]<i[0]||n[0]>i[2]){const u=.5*o;let d=n[0]-i[0]>u?-o:i[0]-n[0]>u?o:0;d===0&&(d=n[0]-i[2]>u?-o:i[2]-n[0]>u?o:0),n[0]+=d}Dl(e,n)}function Lf(n,e,i,o){const u=Math.pow(2,o.z)*fn,d=[o.x*fn,o.y*fn],p=[];for(const y of n)for(const x of y){const T=[x.x+d[0],x.y+d[1]];Pl(T,e,i,u),p.push(T)}return p}function xu(n,e,i,o){const u=Math.pow(2,o.z)*fn,d=[o.x*fn,o.y*fn],p=[];for(const x of n){const T=[];for(const E of x){const C=[E.x+d[0],E.y+d[1]];Dl(e,C),T.push(C)}p.push(T)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of p)for(const T of x)Pl(T,e,i,u)}var y;return p}class io{constructor(e,i){this.type=Nt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ja(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const u=[];for(const d of o.features){const{type:p,coordinates:y}=d.geometry;p==="Polygon"&&u.push(y),p==="MultiPolygon"&&u.push(...y)}if(u.length)return new io(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new io(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new io(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=mc(o.coordinates,d,p),x=Lf(i.geometry(),u,d,p);if(!to(u,d))return!1;for(const T of x)if(!La(T,y))return!1}if(o.type==="MultiPolygon"){const y=Bo(o.coordinates,d,p),x=Lf(i.geometry(),u,d,p);if(!to(u,d))return!1;for(const T of x)if(!dc(T,y))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const u=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=mc(o.coordinates,d,p),x=xu(i.geometry(),u,d,p);if(!to(u,d))return!1;for(const T of x)if(!If(T,y))return!1}if(o.type==="MultiPolygon"){const y=Bo(o.coordinates,d,p),x=xu(i.geometry(),u,d,p);if(!to(u,d))return!1;for(const T of x)if(!Rf(T,y))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let vh=class{constructor(n=[],e=(i,o)=>i<o?-1:i>o?1:0){if(this.data=n,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:e,compare:i}=this,o=e[n];for(;n>0;){const u=n-1>>1,d=e[u];if(i(o,d)>=0)break;e[n]=d,n=u}e[n]=o}_down(n){const{data:e,compare:i}=this,o=this.length>>1,u=e[n];for(;n<o;){let d=1+(n<<1);const p=d+1;if(p<this.length&&i(e[p],e[d])<0&&(d=p),i(e[d],u)>=0)break;e[n]=e[d],n=d}e[n]=u}};function bu(n,e,i=0,o=n.length-1,u=xh){for(;o>i;){if(o-i>600){const x=o-i+1,T=e-i+1,E=Math.log(x),C=.5*Math.exp(2*E/3),D=.5*Math.sqrt(E*C*(x-C)/x)*(T-x/2<0?-1:1);bu(n,e,Math.max(i,Math.floor(e-T*C/x+D)),Math.min(o,Math.floor(e+(x-T)*C/x+D)),u)}const d=n[e];let p=i,y=o;for(no(n,i,e),u(n[o],d)>0&&no(n,i,o);p<y;){for(no(n,p,y),p++,y--;u(n[p],d)<0;)p++;for(;u(n[y],d)>0;)y--}u(n[i],d)===0?no(n,i,y):(y++,no(n,y,o)),y<=e&&(i=y+1),e<=y&&(o=y-1)}}function no(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function xh(n,e){return n<e?-1:n>e?1:0}function wu(n,e){if(n.length<=1)return[n];const i=[];let o,u;for(const d of n){const p=kd(d);p!==0&&(d.area=Math.abs(p),u===void 0&&(u=p<0),u===p<0?(o&&i.push(o),o=[d]):o.push(d))}if(o&&i.push(o),e>1)for(let d=0;d<i.length;d++)i[d].length<=e||(bu(i[d],e,1,i[d].length-1,Of),i[d]=i[d].slice(0,e));return i}function Of(n,e){return e.area-n.area}function kd(n){let e=0;for(let i,o,u=0,d=n.length,p=d-1;u<d;p=u++)i=n[u],o=n[p],e+=(o.x-i.x)*(i.y+o.y);return e}const Bf=1/298.257223563,Tu=Bf*(2-Bf),kf=Math.PI/180;class bh{constructor(e){const i=6378.137*kf*1e3,o=Math.cos(e*kf),u=1/(1-Tu*(1-o*o)),d=Math.sqrt(u);this.kx=i*d*o,this.ky=i*d*u*(1-Tu)}distance(e,i){const o=this.wrap(e[0]-i[0])*this.kx,u=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(e,i){let o,u,d,p,y=1/0;for(let x=0;x<e.length-1;x++){let T=e[x][0],E=e[x][1],C=this.wrap(e[x+1][0]-T)*this.kx,D=(e[x+1][1]-E)*this.ky,P=0;C===0&&D===0||(P=(this.wrap(i[0]-T)*this.kx*C+(i[1]-E)*this.ky*D)/(C*C+D*D),P>1?(T=e[x+1][0],E=e[x+1][1]):P>0&&(T+=C/this.kx*P,E+=D/this.ky*P)),C=this.wrap(i[0]-T)*this.kx,D=(i[1]-E)*this.ky;const O=C*C+D*D;O<y&&(y=O,o=T,u=E,d=x,p=P)}return{point:[o,u],index:d,t:Math.max(0,Math.min(1,p))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function kr(n,e){return e[0]-n[0]}function ro(n){return n[1]-n[0]+1}function va(n,e){return n[1]>=n[0]&&n[1]<e}function Su(n,e){if(n[0]>n[1])return[null,null];const i=ro(n);if(e){if(i===2)return[n,null];const u=Math.floor(i/2);return[[n[0],n[0]+u],[n[0]+u,n[1]]]}if(i===1)return[n,null];const o=Math.floor(i/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}function gc(n,e){if(!va(e,n.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)Dl(i,n[o]);return i}function _c(n){const e=[1/0,1/0,-1/0,-1/0];for(const i of n)for(const o of i)Dl(e,o);return e}function Mu(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function yc(n,e,i){if(!Mu(n)||!Mu(e))return NaN;let o=0,u=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(u=n[1]-e[3]),n[3]<e[1]&&(u=e[1]-n[3]),i.distance([0,0],[o,u])}function xa(n,e,i){const o=i.pointOnLine(e,n);return i.distance(n,o.point)}function Eu(n,e,i,o,u){const d=Math.min(xa(n,[i,o],u),xa(e,[i,o],u)),p=Math.min(xa(i,[n,e],u),xa(o,[n,e],u));return Math.min(d,p)}function Au(n,e,i,o,u){if(!va(e,n.length)||!va(o,i.length))return 1/0;let d=1/0;for(let p=e[0];p<e[1];++p){const y=n[p],x=n[p+1];for(let T=o[0];T<o[1];++T){const E=i[T],C=i[T+1];if(vu(y,x,E,C))return 0;d=Math.min(d,Eu(y,x,E,C,u))}}return d}function vc(n,e,i,o,u){if(!va(e,n.length)||!va(o,i.length))return NaN;let d=1/0;for(let p=e[0];p<=e[1];++p)for(let y=o[0];y<=o[1];++y)if(d=Math.min(d,u.distance(n[p],i[y])),d===0)return d;return d}function Ff(n,e,i){if(La(n,e,!0))return 0;let o=1/0;for(const u of e){const d=u[0],p=u[u.length-1];if(d!==p&&(o=Math.min(o,xa(n,[p,d],i)),o===0))return o;const y=i.pointOnLine(u,n);if(o=Math.min(o,i.distance(n,y.point)),o===0)return o}return o}function ko(n,e,i,o){if(!va(e,n.length))return NaN;for(let d=e[0];d<=e[1];++d)if(La(n[d],i,!0))return 0;let u=1/0;for(let d=e[0];d<e[1];++d){const p=n[d],y=n[d+1];for(const x of i)for(let T=0,E=x.length,C=E-1;T<E;C=T++){const D=x[C],P=x[T];if(vu(p,y,D,P))return 0;u=Math.min(u,Eu(p,y,D,P,o))}}return u}function Fo(n,e){for(const i of n)for(const o of i)if(La(o,e,!0))return!0;return!1}function wh(n,e,i,o=1/0){const u=_c(n),d=_c(e);if(o!==1/0&&yc(u,d,i)>=o)return o;if(to(u,d)){if(Fo(n,e))return 0}else if(Fo(e,n))return 0;let p=1/0;for(const y of n)for(let x=0,T=y.length,E=T-1;x<T;E=x++){const C=y[E],D=y[x];for(const P of e)for(let O=0,k=P.length,N=k-1;O<k;N=O++){const G=P[N],J=P[O];if(vu(C,D,G,J))return 0;p=Math.min(p,Eu(C,D,G,J,i))}}return p}function si(n,e,i,o,u,d){if(!d)return;const p=yc(gc(o,d),u,i);p<e&&n.push([p,d,[0,0]])}function ts(n,e,i,o,u,d,p){if(!d||!p)return;const y=yc(gc(o,d),gc(u,p),i);y<e&&n.push([y,d,p])}function Cu(n,e,i,o,u=1/0){let d=Math.min(o.distance(n[0],i[0][0]),u);if(d===0)return d;const p=new vh([[0,[0,n.length-1],[0,0]]],kr),y=_c(i);for(;p.length>0;){const x=p.pop();if(x[0]>=d)continue;const T=x[1],E=e?50:100;if(ro(T)<=E){if(!va(T,n.length))return NaN;if(e){const C=ko(n,T,i,o);if(isNaN(C)||C===0)return C;d=Math.min(d,C)}else for(let C=T[0];C<=T[1];++C){const D=Ff(n[C],i,o);if(d=Math.min(d,D),d===0)return 0}}else{const C=Su(T,e);si(p,d,o,n,y,C[0]),si(p,d,o,n,y,C[1])}}return d}function zu(n,e,i,o,u,d=1/0){let p=Math.min(d,u.distance(n[0],i[0]));if(p===0)return p;const y=new vh([[0,[0,n.length-1],[0,i.length-1]]],kr);for(;y.length>0;){const x=y.pop();if(x[0]>=p)continue;const T=x[1],E=x[2],C=e?50:100,D=o?50:100;if(ro(T)<=C&&ro(E)<=D){if(!va(T,n.length)&&va(E,i.length))return NaN;let P;if(e&&o)P=Au(n,T,i,E,u),p=Math.min(p,P);else if(e&&!o){const O=n.slice(T[0],T[1]+1);for(let k=E[0];k<=E[1];++k)if(P=xa(i[k],O,u),p=Math.min(p,P),p===0)return p}else if(!e&&o){const O=i.slice(E[0],E[1]+1);for(let k=T[0];k<=T[1];++k)if(P=xa(n[k],O,u),p=Math.min(p,P),p===0)return p}else P=vc(n,T,i,E,u),p=Math.min(p,P)}else{const P=Su(T,e),O=Su(E,o);ts(y,p,u,n,i,P[0],O[0]),ts(y,p,u,n,i,P[0],O[1]),ts(y,p,u,n,i,P[1],O[0]),ts(y,p,u,n,i,P[1],O[1])}}return p}function xc(n){return n.type==="MultiPolygon"?n.coordinates.map((e=>({type:"Polygon",coordinates:e}))):n.type==="MultiLineString"?n.coordinates.map((e=>({type:"LineString",coordinates:e}))):n.type==="MultiPoint"?n.coordinates.map((e=>({type:"Point",coordinates:e}))):[n]}class No{constructor(e,i){this.type=et,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ja(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new No(o,o.features.map((u=>xc(u.geometry))).flat());if(o.type==="Feature")return new No(o,xc(o.geometry));if("type"in o&&"coordinates"in o)return new No(o,xc(o))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const u=i.geometry(),d=u.flat().map((x=>zl([x.x,x.y],i.canonical)));if(u.length===0)return NaN;const p=new bh(d[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,zu(d,!1,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,zu(d,!1,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,Cu(d,!1,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const u=i.geometry(),d=u.flat().map((x=>zl([x.x,x.y],i.canonical)));if(u.length===0)return NaN;const p=new bh(d[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,zu(d,!0,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,zu(d,!0,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,Cu(d,!0,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(i,o){const u=i.geometry();if(u.length===0||u[0].length===0)return NaN;const d=wu(u,0).map((x=>x.map((T=>T.map((E=>zl([E.x,E.y],i.canonical))))))),p=new bh(d[0][0][0][1]);let y=1/0;for(const x of o)for(const T of d){switch(x.type){case"Point":y=Math.min(y,Cu([x.coordinates],!1,T,p,y));break;case"LineString":y=Math.min(y,Cu(x.coordinates,!0,T,p,y));break;case"Polygon":y=Math.min(y,wh(T,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Du{constructor(e){this.type=Rt,this.key=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?i.error("Global state property must be defined."):typeof o!="string"?i.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Du(o)}evaluate(e){var i;const o=(i=e.globals)===null||i===void 0?void 0:i.globalState;return o&&Object.keys(o).length!==0?wl(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Il={"==":Cf,"!=":hc,">":Bd,"<":zf,">=":fc,"<=":Sl,array:wr,at:jt,boolean:wr,case:pu,coalesce:Oo,collator:Ml,format:yu,image:El,in:Bt,"index-of":Lo,interpolate:Sr,"interpolate-hcl":Sr,"interpolate-lab":Sr,length:Al,let:_i,literal:ea,match:ti,number:wr,"number-format":yh,object:wr,slice:ya,step:eo,string:wr,"to-boolean":Tr,"to-color":Tr,"to-number":Tr,"to-string":Tr,var:Ks,within:io,distance:No,"global-state":Du};class ta{constructor(e,i,o,u){this.name=e,this.type=i,this._evaluate=o,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,i){const o=e[0],u=ta.definitions[o];if(!u)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(u)?u[0]:u.type,p=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=p.filter((([T])=>!Array.isArray(T)||T.length===e.length-1));let x=null;for(const[T,E]of y){x=new Ro(i.registry,Mr,i.path,null,i.scope);const C=[];let D=!1;for(let P=1;P<e.length;P++){const O=e[P],k=Array.isArray(T)?T[P-1]:T.type,N=x.parse(O,1+C.length,k);if(!N){D=!0;break}C.push(N)}if(!D)if(Array.isArray(T)&&T.length!==C.length)x.error(`Expected ${T.length} arguments, but found ${C.length} instead.`);else{for(let P=0;P<C.length;P++){const O=Array.isArray(T)?T[P]:T.type,k=C[P];x.concat(P+1).checkSubtype(O,k.type)}if(x.errors.length===0)return new ta(o,d,E,C)}}if(y.length===1)i.errors.push(...x.errors);else{const T=(y.length?y:p).map((([C])=>{return D=C,Array.isArray(D)?`(${D.map(ei).join(", ")})`:`(${ei(D.type)}...)`;var D})).join(" | "),E=[];for(let C=1;C<e.length;C++){const D=i.parse(e[C],1+E.length);if(!D)return null;E.push(ei(D.type))}i.error(`Expected arguments of type ${T}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){ta.definitions=i;for(const o in i)e[o]=ta}}function Th(n,[e,i,o,u]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const d=u?u.evaluate(n):1,p=Jr(e,i,o,d);if(p)throw new Ei(p);return new Ft(e/255,i/255,o/255,d,!1)}function bc(n,e){return n in e}function ia(n,e){const i=e[n];return i===void 0?null:i}function is(n){return{type:n}}function Mr(n){if(n instanceof Ks)return Mr(n.boundExpression);if(n instanceof ta&&n.name==="error"||n instanceof Ml||n instanceof io||n instanceof No||n instanceof Du)return!1;const e=n instanceof Tr||n instanceof wr;let i=!0;return n.eachChild((o=>{i=e?i&&Mr(o):i&&o instanceof ea})),!!i&&ws(n)&&jo(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function ws(n){if(n instanceof ta&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof io||n instanceof No)return!1;let e=!0;return n.eachChild((i=>{e&&!ws(i)&&(e=!1)})),e}function Vo(n){if(n instanceof ta&&n.name==="feature-state")return!1;let e=!0;return n.eachChild((i=>{e&&!Vo(i)&&(e=!1)})),e}function jo(n,e){if(n instanceof ta&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild((o=>{i&&!jo(o,e)&&(i=!1)})),i}function Pu(n){return{result:"success",value:n}}function ao(n){return{result:"error",value:n}}function ba(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Sh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Rl(n){return!!n.expression&&n.expression.interpolated}function Vt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function wc(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Fi(n)===Xa}function na(n){return n}function Tc(n,e){const i=n.stops&&typeof n.stops[0][0]=="object",o=i||!(i||n.property!==void 0),u=n.type||(Rl(e)?"exponential":"interval"),d=(function(E){switch(E.type){case"color":return Ft.parse;case"padding":return vn.parse;case"numberArray":return ki.parse;case"colorArray":return At.parse;default:return null}})(e);if(d&&((n=ur({},n)).stops&&(n.stops=n.stops.map((E=>[E[0],d(E[1])]))),n.default=d(n.default?n.default:e.default)),n.colorSpace&&(p=n.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var p;const y=(function(E){switch(E){case"exponential":return so;case"interval":return Sc;case"categorical":return Nf;case"identity":return Mh;default:throw new Error(`Unknown function type "${E}"`)}})(u);let x,T;if(u==="categorical"){x=Object.create(null);for(const E of n.stops)x[E[0]]=E[1];T=typeof n.stops[0][0]}if(i){const E={},C=[];for(let O=0;O<n.stops.length;O++){const k=n.stops[O],N=k[0].zoom;E[N]===void 0&&(E[N]={zoom:N,type:n.type,property:n.property,default:n.default,stops:[]},C.push(N)),E[N].stops.push([k[0].value,k[1]])}const D=[];for(const O of C)D.push([E[O].zoom,Tc(E[O],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Sr.interpolationFactor.bind(void 0,P),zoomStops:D.map((O=>O[0])),evaluate:({zoom:O},k)=>so({stops:D,base:n.base},e,O).evaluate(O,k)}}if(o){const E=u==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Sr.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map((C=>C[0])),evaluate:({zoom:C})=>y(n,e,C,x,T)}}return{kind:"source",evaluate(E,C){const D=C&&C.properties?C.properties[n.property]:void 0;return D===void 0?ra(n.default,e.default):y(n,e,D,x,T)}}}function ra(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function Nf(n,e,i,o,u){return ra(typeof i===u?o[i]:void 0,n.default,e.default)}function Sc(n,e,i){if(Vt(i)!=="number")return ra(n.default,e.default);const o=n.stops.length;if(o===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[o-1][0])return n.stops[o-1][1];const u=Js(n.stops.map((d=>d[0])),i);return n.stops[u][1]}function so(n,e,i){const o=n.base!==void 0?n.base:1;if(Vt(i)!=="number")return ra(n.default,e.default);const u=n.stops.length;if(u===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[u-1][0])return n.stops[u-1][1];const d=Js(n.stops.map((E=>E[0])),i),p=(function(E,C,D,P){const O=P-D,k=E-D;return O===0?0:C===1?k/O:(Math.pow(C,k)-1)/(Math.pow(C,O)-1)})(i,o,n.stops[d][0],n.stops[d+1][0]),y=n.stops[d][1],x=n.stops[d+1][1],T=Ni[e.type]||na;return typeof y.evaluate=="function"?{evaluate(...E){const C=y.evaluate.apply(void 0,E),D=x.evaluate.apply(void 0,E);if(C!==void 0&&D!==void 0)return T(C,D,p,n.colorSpace)}}:T(y,x,p,n.colorSpace)}function Mh(n,e,i){switch(e.type){case"color":i=Ft.parse(i);break;case"formatted":i=Fn.fromString(i.toString());break;case"resolvedImage":i=br.fromString(i.toString());break;case"padding":i=vn.parse(i);break;case"colorArray":i=At.parse(i);break;case"numberArray":i=ki.parse(i);break;default:Vt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0)}return ra(i,n.default,e.default)}ta.register(Il,{error:[{kind:"error"},[Ot],(n,[e])=>{throw new Ei(e.evaluate(n))}],typeof:[Ot,[Rt],(n,[e])=>ei(Fi(e.evaluate(n)))],"to-rgba":[hr(et,4),[Kr],(n,[e])=>{const[i,o,u,d]=e.evaluate(n).rgb;return[255*i,255*o,255*u,d]}],rgb:[Kr,[et,et,et],Th],rgba:[Kr,[et,et,et,et],Th],has:{type:Nt,overloads:[[[Ot],(n,[e])=>bc(e.evaluate(n),n.properties())],[[Ot,Xa],(n,[e,i])=>bc(e.evaluate(n),i.evaluate(n))]]},get:{type:Rt,overloads:[[[Ot],(n,[e])=>ia(e.evaluate(n),n.properties())],[[Ot,Xa],(n,[e,i])=>ia(e.evaluate(n),i.evaluate(n))]]},"feature-state":[Rt,[Ot],(n,[e])=>ia(e.evaluate(n),n.featureState||{})],properties:[Xa,[],n=>n.properties()],"geometry-type":[Ot,[],n=>n.geometryType()],id:[Rt,[],n=>n.id()],zoom:[et,[],n=>n.globals.zoom],"heatmap-density":[et,[],n=>n.globals.heatmapDensity||0],elevation:[et,[],n=>n.globals.elevation||0],"line-progress":[et,[],n=>n.globals.lineProgress||0],accumulated:[Rt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[et,is(et),(n,e)=>{let i=0;for(const o of e)i+=o.evaluate(n);return i}],"*":[et,is(et),(n,e)=>{let i=1;for(const o of e)i*=o.evaluate(n);return i}],"-":{type:et,overloads:[[[et,et],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[et],(n,[e])=>-e.evaluate(n)]]},"/":[et,[et,et],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[et,[et,et],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[et,[],()=>Math.LN2],pi:[et,[],()=>Math.PI],e:[et,[],()=>Math.E],"^":[et,[et,et],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[et,[et],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[et,[et],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[et,[et],(n,[e])=>Math.log(e.evaluate(n))],log2:[et,[et],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[et,[et],(n,[e])=>Math.sin(e.evaluate(n))],cos:[et,[et],(n,[e])=>Math.cos(e.evaluate(n))],tan:[et,[et],(n,[e])=>Math.tan(e.evaluate(n))],asin:[et,[et],(n,[e])=>Math.asin(e.evaluate(n))],acos:[et,[et],(n,[e])=>Math.acos(e.evaluate(n))],atan:[et,[et],(n,[e])=>Math.atan(e.evaluate(n))],min:[et,is(et),(n,e)=>Math.min(...e.map((i=>i.evaluate(n))))],max:[et,is(et),(n,e)=>Math.max(...e.map((i=>i.evaluate(n))))],abs:[et,[et],(n,[e])=>Math.abs(e.evaluate(n))],round:[et,[et],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[et,[et],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[et,[et],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Nt,[Ot,Rt],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Nt,[Rt],(n,[e])=>n.id()===e.value],"filter-type-==":[Nt,[Ot],(n,[e])=>n.geometryType()===e.value],"filter-<":[Nt,[Ot,Rt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Nt,[Rt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Nt,[Ot,Rt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o>u}],"filter-id->":[Nt,[Rt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Nt,[Ot,Rt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Nt,[Rt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Nt,[Ot,Rt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Nt,[Rt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Nt,[Rt],(n,[e])=>e.value in n.properties()],"filter-has-id":[Nt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Nt,[hr(Ot)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Nt,[hr(Rt)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Nt,[Ot,hr(Rt)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Nt,[Ot,hr(Rt)],(n,[e,i])=>(function(o,u,d,p){for(;d<=p;){const y=d+p>>1;if(u[y]===o)return!0;u[y]>o?p=y-1:d=y+1}return!1})(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Nt,overloads:[[[Nt,Nt],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[is(Nt),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Nt,overloads:[[[Nt,Nt],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[is(Nt),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Nt,[Nt],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Nt,[Ot],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[Ot,[Ot],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Ot,[Ot],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Ot,is(Rt),(n,e)=>e.map((i=>Ws(i.evaluate(n)))).join("")],"resolved-locale":[Ot,[Ao],(n,[e])=>e.evaluate(n).resolvedLocale()]});class Mc{constructor(e,i,o){this.expression=e,this._warningHistory={},this._evaluator=new Io,this._defaultValue=i?(function(u){if(u.type==="color"&&wc(u.default))return new Ft(0,0,0,0);switch(u.type){case"color":return Ft.parse(u.default)||null;case"padding":return vn.parse(u.default)||null;case"numberArray":return ki.parse(u.default)||null;case"colorArray":return At.parse(u.default)||null;case"variableAnchorOffsetCollection":return rn.parse(u.default)||null;case"projectionDefinition":return Nn.parse(u.default)||null;default:return u.default===void 0?null:u.default}})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this._globalState=o}evaluateWithoutErrorHandling(e,i,o,u,d,p){return this._globalState&&(e=Zn(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,u,d,p){this._globalState&&(e=Zn(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Ei(`Expected value to be one of ${Object.keys(this._enumValues).map((x=>JSON.stringify(x))).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function oo(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Il}function Iu(n,e,i){const o=new Ro(Il,Mr,[],e?(function(d){const p={color:Kr,string:Ot,number:et,enum:Ot,boolean:Nt,formatted:Ya,padding:vs,numberArray:Wa,colorArray:Qa,projectionDefinition:lc,resolvedImage:nn,variableAnchorOffsetCollection:vl};return d.type==="array"?hr(p[d.value]||Rt,d.length):p[d.type]})(e):void 0),u=o.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Pu(new Mc(u,e,i)):ao(o.errors)}class Er{constructor(e,i,o){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!Vo(i.expression),this.globalStateRefs=qn(i.expression),this._globalState=o}evaluateWithoutErrorHandling(e,i,o,u,d,p){return this._globalState&&(e=Zn(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,d,p)}evaluate(e,i,o,u,d,p){return this._globalState&&(e=Zn(e,this._globalState)),this._styleExpression.evaluate(e,i,o,u,d,p)}}class lo{constructor(e,i,o,u,d){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Vo(i.expression),this.globalStateRefs=qn(i.expression),this.interpolationType=u,this._globalState=d}evaluateWithoutErrorHandling(e,i,o,u,d,p){return this._globalState&&(e=Zn(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,d,p)}evaluate(e,i,o,u,d,p){return this._globalState&&(e=Zn(e,this._globalState)),this._styleExpression.evaluate(e,i,o,u,d,p)}interpolationFactor(e,i,o){return this.interpolationType?Sr.interpolationFactor(this.interpolationType,e,i,o):0}}function uo(n,e,i){const o=Iu(n,e,i);if(o.result==="error")return o;const u=o.value.expression,d=ws(u);if(!d&&!ba(e))return ao([new cr("","data expressions not supported")]);const p=jo(u,["zoom"]);if(!p&&!Sh(e))return ao([new cr("","zoom expressions not supported")]);const y=co(u);return y||p?y instanceof cr?ao([y]):y instanceof Sr&&!Rl(e)?ao([new cr("",'"interpolate" expressions cannot be used with this property')]):Pu(y?new lo(d?"camera":"composite",o.value,y.labels,y instanceof Sr?y.interpolation:void 0,i):new Er(d?"constant":"source",o.value,i)):ao([new cr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Uo{constructor(e,i){this._parameters=e,this._specification=i,ur(this,Tc(this._parameters,this._specification))}static deserialize(e){return new Uo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function co(n){let e=null;if(n instanceof _i)e=co(n.result);else if(n instanceof Oo){for(const i of n.args)if(e=co(i),e)break}else(n instanceof eo||n instanceof Sr)&&n.input instanceof ta&&n.input.name==="zoom"&&(e=n);return e instanceof cr||n.eachChild((i=>{const o=co(i);o instanceof cr?e=o:!e&&o?e=new cr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new cr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function qn(n,e=new Set){return n instanceof Du&&e.add(n.key),n.eachChild((i=>{qn(i,e)})),e}function Zn(n,e){const{zoom:i,heatmapDensity:o,elevation:u,lineProgress:d,isSupportedScript:p,accumulated:y}=n??{};return{zoom:i,heatmapDensity:o,elevation:u,lineProgress:d,isSupportedScript:p,accumulated:y,globalState:e}}function ns(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!ns(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const rs={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Fr(n,e){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ns(n)||(n=Go(n));const i=Iu(n,rs,e);if(i.result==="error")throw new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,u,d)=>i.value.evaluate(o,u,{},d),needGeometry:Eh(n),getGlobalStateRefs:()=>qn(i.value.expression)}}function Ts(n,e){return n<e?-1:n>e?1:0}function Eh(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(Eh(n[e]))return!0;return!1}function Go(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Ll(n[1],n[2],"=="):e==="!="?Ai(Ll(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ll(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(Go))):e==="all"?["all"].concat(n.slice(1).map(Go)):e==="none"?["all"].concat(n.slice(1).map(Go).map(Ai)):e==="in"?Ah(n[1],n.slice(2)):e==="!in"?Ai(Ah(n[1],n.slice(2))):e==="has"?Hn(n[1]):e!=="!has"||Ai(Hn(n[1]));var i}function Ll(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function Ah(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",n,["literal",e.sort(Ts)]]:["filter-in-small",n,["literal",e]]}}function Hn(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Ai(n){return["!",n]}function Xt(n){const e=typeof n;if(e==="number"||e==="boolean"||e==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let u="[";for(const d of n)u+=`${Xt(d)},`;return`${u}]`}const i=Object.keys(n).sort();let o="{";for(let u=0;u<i.length;u++)o+=`${JSON.stringify(i[u])}:${Xt(n[i[u]])},`;return`${o}}`}function Ss(n){let e="";for(const i of pi)e+=`/${Xt(n[i])}`;return e}function aa(n){const e=n.value;return e?[new Ke(n.key,e,"constants have been deprecated as of v8")]:[]}function Hi(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Nr(n){if(Array.isArray(n))return n.map(Nr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Nr(n[i]);return e}return Hi(n)}function sa(n){const e=n.key,i=n.value,o=n.valueSpec||{},u=n.objectElementValidators||{},d=n.style,p=n.styleSpec,y=n.validateSpec;let x=[];const T=Vt(i);if(T!=="object")return[new Ke(e,i,`object expected, ${T} found`)];for(const E in i){const C=E.split(".")[0],D=wl(o,C)||o["*"];let P;if(wl(u,C))P=u[C];else if(wl(o,C))P=y;else if(u["*"])P=u["*"];else{if(!o["*"]){x.push(new Ke(e,i[E],`unknown property "${E}"`));continue}P=y}x=x.concat(P({key:(e&&`${e}.`)+E,value:i[E],valueSpec:D,style:d,styleSpec:p,object:i,objectKey:E,validateSpec:y},i))}for(const E in o)u[E]||o[E].required&&o[E].default===void 0&&i[E]===void 0&&x.push(new Ke(e,i,`missing required property "${E}"`));return x}function Ru(n){const e=n.value,i=n.valueSpec,o=n.style,u=n.styleSpec,d=n.key,p=n.arrayElementValidator||n.validateSpec;if(Vt(e)!=="array")return[new Ke(d,e,`array expected, ${Vt(e)} found`)];if(i.length&&e.length!==i.length)return[new Ke(d,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new Ke(d,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let y={type:i.value,values:i.values};u.$version<7&&(y.function=i.function),Vt(i.value)==="object"&&(y=i.value);let x=[];for(let T=0;T<e.length;T++)x=x.concat(p({array:e,arrayIndex:T,value:e[T],valueSpec:y,validateSpec:n.validateSpec,style:o,styleSpec:u,key:`${d}[${T}]`}));return x}function as(n){const e=n.key,i=n.value,o=n.valueSpec;let u=Vt(i);return u==="number"&&i!=i&&(u="NaN"),u!=="number"?[new Ke(e,i,`number expected, ${u} found`)]:"minimum"in o&&i<o.minimum?[new Ke(e,i,`${i} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&i>o.maximum?[new Ke(e,i,`${i} is greater than the maximum value ${o.maximum}`)]:[]}function ss(n){const e=n.valueSpec,i=Hi(n.value.type);let o,u,d,p={};const y=i!=="categorical"&&n.value.property===void 0,x=!y,T=Vt(n.value.stops)==="array"&&Vt(n.value.stops[0])==="array"&&Vt(n.value.stops[0][0])==="object",E=sa({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(P){if(i==="identity")return[new Ke(P.key,P.value,'identity function may not have a "stops" property')];let O=[];const k=P.value;return O=O.concat(Ru({key:P.key,value:k,valueSpec:P.valueSpec,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:C})),Vt(k)==="array"&&k.length===0&&O.push(new Ke(P.key,k,"array must have at least one stop")),O},default:function(P){return P.validateSpec({key:P.key,value:P.value,valueSpec:e,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec})}}});return i==="identity"&&y&&E.push(new Ke(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||E.push(new Ke(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!Rl(n.valueSpec)&&E.push(new Ke(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(x&&!ba(n.valueSpec)?E.push(new Ke(n.key,n.value,"property functions not supported")):y&&!Sh(n.valueSpec)&&E.push(new Ke(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!T||n.value.property!==void 0||E.push(new Ke(n.key,n.value,'"property" property is required')),E;function C(P){let O=[];const k=P.value,N=P.key;if(Vt(k)!=="array")return[new Ke(N,k,`array expected, ${Vt(k)} found`)];if(k.length!==2)return[new Ke(N,k,`array length 2 expected, length ${k.length} found`)];if(T){if(Vt(k[0])!=="object")return[new Ke(N,k,`object expected, ${Vt(k[0])} found`)];if(k[0].zoom===void 0)return[new Ke(N,k,"object stop key must have zoom")];if(k[0].value===void 0)return[new Ke(N,k,"object stop key must have value")];if(d&&d>Hi(k[0].zoom))return[new Ke(N,k[0].zoom,"stop zoom values must appear in ascending order")];Hi(k[0].zoom)!==d&&(d=Hi(k[0].zoom),u=void 0,p={}),O=O.concat(sa({key:`${N}[0]`,value:k[0],valueSpec:{zoom:{}},validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:as,value:D}}))}else O=O.concat(D({key:`${N}[0]`,value:k[0],validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec},k));return oo(Nr(k[1]))?O.concat([new Ke(`${N}[1]`,k[1],"expressions are not allowed in function stops.")]):O.concat(P.validateSpec({key:`${N}[1]`,value:k[1],valueSpec:e,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec}))}function D(P,O){const k=Vt(P.value),N=Hi(P.value),G=P.value!==null?P.value:O;if(o){if(k!==o)return[new Ke(P.key,G,`${k} stop domain type must match previous stop domain type ${o}`)]}else o=k;if(k!=="number"&&k!=="string"&&k!=="boolean")return[new Ke(P.key,G,"stop domain value must be a number, string, or boolean")];if(k!=="number"&&i!=="categorical"){let J=`number expected, ${k} found`;return ba(e)&&i===void 0&&(J+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ke(P.key,G,J)]}return i!=="categorical"||k!=="number"||isFinite(N)&&Math.floor(N)===N?i!=="categorical"&&k==="number"&&u!==void 0&&N<u?[new Ke(P.key,G,"stop domain values must appear in ascending order")]:(u=N,i==="categorical"&&N in p?[new Ke(P.key,G,"stop domain values must be unique")]:(p[N]=!0,[])):[new Ke(P.key,G,`integer expected, found ${N}`)]}}function os(n){const e=(n.expressionContext==="property"?uo:Iu)(Nr(n.value),n.valueSpec);if(e.result==="error")return e.value.map((o=>new Ke(`${n.key}${o.key}`,n.value,o.message)));const i=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new Ke(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Vo(i))return[new Ke(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Vo(i))return[new Ke(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!jo(i,["zoom","feature-state"]))return[new Ke(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!ws(i))return[new Ke(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ms(n){const e=n.key,i=n.value,o=Vt(i);return o!=="string"?[new Ke(e,i,`color expected, ${o} found`)]:Ft.parse(String(i))?[]:[new Ke(e,i,`color expected, "${i}" found`)]}function Es(n){const e=n.key,i=n.value,o=n.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(Hi(i))===-1&&u.push(new Ke(e,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(Hi(i))===-1&&u.push(new Ke(e,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function wa(n){return ns(Nr(n.value))?os(ur({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ls(n)}function ls(n){const e=n.value,i=n.key;if(Vt(e)!=="array")return[new Ke(i,e,`array expected, ${Vt(e)} found`)];const o=n.styleSpec;let u,d=[];if(e.length<1)return[new Ke(i,e,"filter array must have at least 1 element")];switch(d=d.concat(Es({key:`${i}[0]`,value:e[0],valueSpec:o.filter_operator,style:n.style,styleSpec:n.styleSpec})),Hi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Hi(e[1])==="$type"&&d.push(new Ke(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new Ke(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Vt(e[1]),u!=="string"&&d.push(new Ke(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let p=2;p<e.length;p++)u=Vt(e[p]),Hi(e[1])==="$type"?d=d.concat(Es({key:`${i}[${p}]`,value:e[p],valueSpec:o.geometry_type,style:n.style,styleSpec:n.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&d.push(new Ke(`${i}[${p}]`,e[p],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)d=d.concat(ls({key:`${i}[${p}]`,value:e[p],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=Vt(e[1]),e.length!==2?d.push(new Ke(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&d.push(new Ke(`${i}[1]`,e[1],`string expected, ${u} found`))}return d}function As(n,e){const i=n.key,o=n.validateSpec,u=n.style,d=n.styleSpec,p=n.value,y=n.objectKey,x=d[`${e}_${n.layerType}`];if(!x)return[];const T=y.match(/^(.*)-transition$/);if(e==="paint"&&T&&x[T[1]]&&x[T[1]].transition)return o({key:i,value:p,valueSpec:d.transition,style:u,styleSpec:d});const E=n.valueSpec||x[y];if(!E)return[new Ke(i,p,`unknown property "${y}"`)];let C;if(Vt(p)==="string"&&ba(E)&&!E.tokens&&(C=/^{([^}]+)}$/.exec(p)))return[new Ke(i,p,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const D=[];return n.layerType==="symbol"&&y==="text-font"&&wc(Nr(p))&&Hi(p.type)==="identity"&&D.push(new Ke(i,p,'"text-font" does not support identity functions')),D.concat(o({key:n.key,value:p,valueSpec:E,style:u,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:y}))}function us(n){return As(n,"paint")}function Ec(n){return As(n,"layout")}function Ac(n){let e=[];const i=n.value,o=n.key,u=n.style,d=n.styleSpec;if(Vt(i)!=="object")return[new Ke(o,i,`object expected, ${Vt(i)} found`)];i.type||i.ref||e.push(new Ke(o,i,'either "type" or "ref" is required'));let p=Hi(i.type);const y=Hi(i.ref);if(i.id){const x=Hi(i.id);for(let T=0;T<n.arrayIndex;T++){const E=u.layers[T];Hi(E.id)===x&&e.push(new Ke(o,i.id,`duplicate layer id "${i.id}", previously used at line ${E.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach((T=>{T in i&&e.push(new Ke(o,i[T],`"${T}" is prohibited for ref layers`))})),u.layers.forEach((T=>{Hi(T.id)===y&&(x=T)})),x?x.ref?e.push(new Ke(o,i.ref,"ref cannot reference another ref layer")):p=Hi(x.type):e.push(new Ke(o,i.ref,`ref layer "${y}" not found`))}else if(p!=="background")if(i.source){const x=u.sources&&u.sources[i.source],T=x&&Hi(x.type);x?T==="vector"&&p==="raster"?e.push(new Ke(o,i.source,`layer "${i.id}" requires a raster source`)):T!=="raster-dem"&&p==="hillshade"||T!=="raster-dem"&&p==="color-relief"?e.push(new Ke(o,i.source,`layer "${i.id}" requires a raster-dem source`)):T==="raster"&&p!=="raster"?e.push(new Ke(o,i.source,`layer "${i.id}" requires a vector source`)):T!=="vector"||i["source-layer"]?T==="raster-dem"&&p!=="hillshade"&&p!=="color-relief"?e.push(new Ke(o,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):p!=="line"||!i.paint||!i.paint["line-gradient"]||T==="geojson"&&x.lineMetrics||e.push(new Ke(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ke(o,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new Ke(o,i.source,`source "${i.source}" not found`))}else e.push(new Ke(o,i,'missing required property "source"'));return e=e.concat(sa({key:o,value:i,valueSpec:d.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${o}.type`,value:i.type,valueSpec:d.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:i,objectKey:"type"}),filter:wa,layout:x=>sa({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>Ec(ur({layerType:p},T))}}),paint:x=>sa({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>us(ur({layerType:p},T))}})}})),e}function Ta(n){const e=n.value,i=n.key,o=Vt(e);return o!=="string"?[new Ke(i,e,`string expected, ${o} found`)]:[]}const Ol={promoteId:function({key:n,value:e}){if(Vt(e)==="string")return Ta({key:n,value:e});{const i=[];for(const o in e)i.push(...Ta({key:`${n}.${o}`,value:e[o]}));return i}}};function Cs(n){const e=n.value,i=n.key,o=n.styleSpec,u=n.style,d=n.validateSpec;if(!e.type)return[new Ke(i,e,'"type" is required')];const p=Hi(e.type);let y;switch(p){case"vector":case"raster":return y=sa({key:i,value:e,valueSpec:o[`source_${p.replace("-","_")}`],style:n.style,styleSpec:o,objectElementValidators:Ol,validateSpec:d}),y;case"raster-dem":return y=(function(x){var T;const E=(T=x.sourceName)!==null&&T!==void 0?T:"",C=x.value,D=x.styleSpec,P=D.source_raster_dem,O=x.style;let k=[];const N=Vt(C);if(C===void 0)return k;if(N!=="object")return k.push(new Ke("source_raster_dem",C,`object expected, ${N} found`)),k;const G=Hi(C.encoding)==="custom",J=["redFactor","greenFactor","blueFactor","baseShift"],q=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const $ in C)!G&&J.includes($)?k.push(new Ke($,C[$],`In "${E}": "${$}" is only valid when "encoding" is set to "custom". ${q} encoding found`)):P[$]?k=k.concat(x.validateSpec({key:$,value:C[$],valueSpec:P[$],validateSpec:x.validateSpec,style:O,styleSpec:D})):k.push(new Ke($,C[$],`unknown property "${$}"`));return k})({sourceName:i,value:e,style:n.style,styleSpec:o,validateSpec:d}),y;case"geojson":if(y=sa({key:i,value:e,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:d,objectElementValidators:Ol}),e.cluster)for(const x in e.clusterProperties){const[T,E]=e.clusterProperties[x],C=typeof T=="string"?[T,["accumulated"],["get",x]]:T;y.push(...os({key:`${i}.${x}.map`,value:E,expressionContext:"cluster-map"})),y.push(...os({key:`${i}.${x}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return y;case"video":return sa({key:i,value:e,valueSpec:o.source_video,style:u,validateSpec:d,styleSpec:o});case"image":return sa({key:i,value:e,valueSpec:o.source_image,style:u,validateSpec:d,styleSpec:o});case"canvas":return[new Ke(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Es({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function xn(n){const e=n.value,i=n.styleSpec,o=i.light,u=n.style;let d=[];const p=Vt(e);if(e===void 0)return d;if(p!=="object")return d=d.concat([new Ke("light",e,`object expected, ${p} found`)]),d;for(const y in e){const x=y.match(/^(.*)-transition$/);d=d.concat(x&&o[x[1]]&&o[x[1]].transition?n.validateSpec({key:y,value:e[y],valueSpec:i.transition,validateSpec:n.validateSpec,style:u,styleSpec:i}):o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:n.validateSpec,style:u,styleSpec:i}):[new Ke(y,e[y],`unknown property "${y}"`)])}return d}function Lu(n){const e=n.value,i=n.styleSpec,o=i.sky,u=n.style,d=Vt(e);if(e===void 0)return[];if(d!=="object")return[new Ke("sky",e,`object expected, ${d} found`)];let p=[];for(const y in e)p=p.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:i}):[new Ke(y,e[y],`unknown property "${y}"`)]);return p}function Cc(n){const e=n.value,i=n.styleSpec,o=i.terrain,u=n.style;let d=[];const p=Vt(e);if(e===void 0)return d;if(p!=="object")return d=d.concat([new Ke("terrain",e,`object expected, ${p} found`)]),d;for(const y in e)d=d.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:n.validateSpec,style:u,styleSpec:i}):[new Ke(y,e[y],`unknown property "${y}"`)]);return d}function Ch(n){let e=[];const i=n.value,o=n.key;if(Array.isArray(i)){const u=[],d=[];for(const p in i)i[p].id&&u.includes(i[p].id)&&e.push(new Ke(o,i,`all the sprites' ids must be unique, but ${i[p].id} is duplicated`)),u.push(i[p].id),i[p].url&&d.includes(i[p].url)&&e.push(new Ke(o,i,`all the sprites' URLs must be unique, but ${i[p].url} is duplicated`)),d.push(i[p].url),e=e.concat(sa({key:`${o}[${p}]`,value:i[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return e}return Ta({key:o,value:i})}function Vf(n){return e=n.value,e&&e.constructor===Object?[]:[new Ke(n.key,n.value,`object expected, ${Vt(n.value)} found`)];var e}const zh={"*":()=>[],array:Ru,boolean:function(n){const e=n.value,i=n.key,o=Vt(e);return o!=="boolean"?[new Ke(i,e,`boolean expected, ${o} found`)]:[]},number:as,color:Ms,constants:aa,enum:Es,filter:wa,function:ss,layer:Ac,object:sa,source:Cs,light:xn,sky:Lu,terrain:Cc,projection:function(n){const e=n.value,i=n.styleSpec,o=i.projection,u=n.style,d=Vt(e);if(e===void 0)return[];if(d!=="object")return[new Ke("projection",e,`object expected, ${d} found`)];let p=[];for(const y in e)p=p.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:i}):[new Ke(y,e[y],`unknown property "${y}"`)]);return p},projectionDefinition:function(n){const e=n.key;let i=n.value;i=i instanceof String?i.valueOf():i;const o=Vt(i);return o!=="array"||(function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"})(i)||(function(u){return!!["interpolate","step","literal"].includes(u[0])})(i)?["array","string"].includes(o)?[]:[new Ke(e,i,`projection expected, invalid type "${o}" found`)]:[new Ke(e,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:Ta,formatted:function(n){return Ta(n).length===0?[]:os(n)},resolvedImage:function(n){return Ta(n).length===0?[]:os(n)},padding:function(n){const e=n.key,i=n.value;if(Vt(i)==="array"){if(i.length<1||i.length>4)return[new Ke(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const o={type:"number"};let u=[];for(let d=0;d<i.length;d++)u=u.concat(n.validateSpec({key:`${e}[${d}]`,value:i[d],validateSpec:n.validateSpec,valueSpec:o}));return u}return as({key:e,value:i,valueSpec:{}})},numberArray:function(n){const e=n.key,i=n.value;if(Vt(i)==="array"){const o={type:"number"};if(i.length<1)return[new Ke(e,i,"array length at least 1 expected, length 0 found")];let u=[];for(let d=0;d<i.length;d++)u=u.concat(n.validateSpec({key:`${e}[${d}]`,value:i[d],validateSpec:n.validateSpec,valueSpec:o}));return u}return as({key:e,value:i,valueSpec:{}})},colorArray:function(n){const e=n.key,i=n.value;if(Vt(i)==="array"){if(i.length<1)return[new Ke(e,i,"array length at least 1 expected, length 0 found")];let o=[];for(let u=0;u<i.length;u++)o=o.concat(Ms({key:`${e}[${u}]`,value:i[u]}));return o}return Ms({key:e,value:i})},variableAnchorOffsetCollection:function(n){const e=n.key,i=n.value,o=Vt(i),u=n.styleSpec;if(o!=="array"||i.length<1||i.length%2!=0)return[new Ke(e,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let d=[];for(let p=0;p<i.length;p+=2)d=d.concat(Es({key:`${e}[${p}]`,value:i[p],valueSpec:u.layout_symbol["text-anchor"]})),d=d.concat(Ru({key:`${e}[${p+1}]`,value:i[p+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:u}));return d},sprite:Ch,state:Vf};function $i(n){const e=n.value,i=n.valueSpec,o=n.styleSpec;return n.validateSpec=$i,i.expression&&wc(Hi(e))?ss(n):i.expression&&oo(Nr(e))?os(n):i.type&&zh[i.type]?zh[i.type](n):sa(ur({},n,{valueSpec:i.type?o[i.type]:i}))}function ho(n){const e=n.value,i=n.key,o=Ta(n);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Ke(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Ke(i,e,'"glyphs" url must include a "{range}" token'))),o}function fr(n,e=ve){let i=[];return i=i.concat($i({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,validateSpec:$i,objectElementValidators:{glyphs:ho,"*":()=>[]}})),n.constants&&(i=i.concat(aa({key:"constants",value:n.constants}))),zc(i)}function Ar(n){return function(e){return n(Object.assign({},e,{validateSpec:$i}))}}function zc(n){return[].concat(n).sort(((e,i)=>e.line-i.line))}function dr(n){return function(...e){return zc(n.apply(this,e))}}fr.source=dr(Ar(Cs)),fr.sprite=dr(Ar(Ch)),fr.glyphs=dr(Ar(ho)),fr.light=dr(Ar(xn)),fr.sky=dr(Ar(Lu)),fr.terrain=dr(Ar(Cc)),fr.state=dr(Ar(Vf)),fr.layer=dr(Ar(Ac)),fr.filter=dr(Ar(wa)),fr.paintProperty=dr(Ar(us)),fr.layoutProperty=dr(Ar(Ec));const Bl=ve,kl=fr,Fl=kl.light,Ou=kl.sky,Vr=kl.paintProperty,Oa=kl.layoutProperty;function Bu(n,e){let i=!1;if(e&&e.length)for(const o of e)n.fire(new ci(new Error(o.message))),i=!0;return i}class fo{constructor(e,i,o){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(i=p[1])+2*(o=p[2]);for(let x=0;x<this.d*this.d;x++){const T=p[3+x],E=p[3+x+1];u.push(T===E?null:p.subarray(T,E))}const y=p[3+u.length+1];this.keys=p.subarray(p[3+u.length],y),this.bboxes=p.subarray(y),this.insert=this._insertReadonly}else{this.d=i+2*o;for(let p=0;p<this.d*this.d;p++)u.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=e,this.padding=o,this.scale=i/e,this.uid=0;const d=o/i*e;this.min=-d,this.max=e+d}insert(e,i,o,u,d){this._forEachCell(i,o,u,d,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(d)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,i,o,u,d,p){this.cells[d].push(p)}query(e,i,o,u,d){const p=this.min,y=this.max;if(e<=p&&i<=p&&y<=o&&y<=u&&!d)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(e,i,o,u,this._queryCell,x,{},d),x}}_queryCell(e,i,o,u,d,p,y,x){const T=this.cells[d];if(T!==null){const E=this.keys,C=this.bboxes;for(let D=0;D<T.length;D++){const P=T[D];if(y[P]===void 0){const O=4*P;(x?x(C[O+0],C[O+1],C[O+2],C[O+3]):e<=C[O+2]&&i<=C[O+3]&&o>=C[O+0]&&u>=C[O+1])?(y[P]=!0,p.push(E[P])):y[P]=!1}}}}_forEachCell(e,i,o,u,d,p,y,x){const T=this._convertToCellCoord(e),E=this._convertToCellCoord(i),C=this._convertToCellCoord(o),D=this._convertToCellCoord(u);for(let P=T;P<=C;P++)for(let O=E;O<=D;O++){const k=this.d*O+P;if((!x||x(this._convertFromCellCoord(P),this._convertFromCellCoord(O),this._convertFromCellCoord(P+1),this._convertFromCellCoord(O+1)))&&d.call(this,e,i,o,u,k,p,y,x))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,i=3+this.cells.length+1+1;let o=0;for(let p=0;p<this.cells.length;p++)o+=this.cells[p].length;const u=new Int32Array(i+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let d=i;for(let p=0;p<e.length;p++){const y=e[p];u[3+p]=d,u.set(y,d),d+=y.length}return u[3+e.length]=d,u.set(this.keys,d),d+=this.keys.length,u[3+e.length+1]=d,u.set(this.bboxes,d),d+=this.bboxes.length,u.buffer}static serialize(e,i){const o=e.toArrayBuffer();return i&&i.push(o),{buffer:o}}static deserialize(e){return new fo(e.buffer)}}const cs={};function nt(n,e,i={}){if(cs[n])throw new Error(`${n} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),cs[n]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}nt("Object",Object),nt("Set",Set),nt("TransferableGridIndex",fo),nt("Color",Ft),nt("Error",Error),nt("AJAXError",he),nt("ResolvedImage",br),nt("StylePropertyFunction",Uo),nt("StyleExpression",Mc,{omit:["_evaluator"]}),nt("ZoomDependentExpression",lo),nt("ZoomConstantExpression",Er),nt("CompoundExpression",ta,{omit:["_evaluate"]});for(const n in Il)Il[n]._classRegistryKey||nt(`Expression_${n}`,Il[n]);function ku(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function po(n){return n.$name||n.constructor._classRegistryKey}function Fu(n){return!(function(e){if(e===null||typeof e!="object")return!1;const i=po(e);return!(!i||i==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||ku(n)||_s(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function mo(n,e){if(Fu(n))return(ku(n)||_s(n))&&e&&e.push(n),ArrayBuffer.isView(n)&&e&&e.push(n.buffer),n instanceof ImageData&&e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const d=[];for(const p of n)d.push(mo(p,e));return d}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const i=po(n);if(!i)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!cs[i])throw new Error(`${i} is not registered.`);const{klass:o}=cs[i],u=o.serialize?o.serialize(n,e):{};if(o.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const d in n){if(!n.hasOwnProperty(d)||cs[i].omit.indexOf(d)>=0)continue;const p=n[d];u[d]=cs[i].shallow.indexOf(d)>=0?p:mo(p,e)}n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(u.$name=i),u}function Nl(n){if(Fu(n))return n;if(Array.isArray(n))return n.map(Nl);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const e=po(n)||"Object";if(!cs[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=cs[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const o=Object.create(i.prototype);for(const u of Object.keys(n)){if(u==="$name")continue;const d=n[u];o[u]=cs[e].shallow.indexOf(u)>=0?d:Nl(d)}return o}class oa{constructor(){this.first=!0}update(e,i){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}function qo(n){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function Dc(n){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function Dh(n){return/\s/u.test(String.fromCodePoint(n))}function Sa(n){for(const e of n)if(Dc(e.codePointAt(0)))return!0;return!1}function Nu(n){for(const e of n)if(!Pc(e.codePointAt(0)))return!1;return!0}function Vu(n){const e=n.map((i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}})).filter((i=>i));return new RegExp(e.join("|"),"u")}const go=Vu(["Arab","Dupl","Mong","Ougr","Syrc"]);function Pc(n){return!go.test(String.fromCodePoint(n))}function ju(n){return!(Dc(n)||(e=n,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const hs=Vu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ic(n){return hs.test(String.fromCodePoint(n))}function zs(n,e){return!(!e&&Ic(n)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(n)))}function Rc(n){for(const e of n)if(Ic(e.codePointAt(0)))return!0;return!1}const Ba=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(Ba.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,e){return f(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const i=n.pluginURL,o=new Promise((d=>{this.loadScriptResolve=d}));e(i);const u=new Promise((d=>setTimeout((()=>d()),this.TIMEOUT)));if(yield Promise.race([o,u]),this.isParsed()){const d={pluginStatus:"loaded",pluginURL:i};return this.setState(d),d}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)}))}};class Qt{constructor(e,i){this.isSupportedScript=Ds,this.zoom=e,i?(this.now=i.now||0,this.fadeDuration=i.fadeDuration||0,this.zoomHistory=i.zoomHistory||new oa,this.transition=i.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new oa,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}function Ds(n){return(function(e,i){for(const o of e)if(!zs(o.codePointAt(0),i))return!1;return!0})(n,Ba.getRTLTextPluginStatus()==="loaded")}const _o="-transition";class Zo{constructor(e,i,o){this.property=e,this.value=i,this.expression=(function(u,d,p){if(wc(u))return new Uo(u,d);if(oo(u)){const y=uo(u,d,p);if(y.result==="error")throw new Error(y.value.map((x=>`${x.key}: ${x.message}`)).join(", "));return y.value}{let y=u;return d.type==="color"&&typeof u=="string"?y=Ft.parse(u):d.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?d.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?d.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?y=rn.parse(u):d.type==="projectionDefinition"&&typeof u=="string"&&(y=Nn.parse(u)):y=At.parse(u):y=ki.parse(u):y=vn.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>y}}})(i===void 0?e.specification.default:i,e.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class Uu{constructor(e,i){this.property=e,this.value=new Zo(e,void 0,i)}transitioned(e,i){return new Vl(this.property,this.value,i,Si({},e.transition,this.transition),e.now)}untransitioned(){return new Vl(this.property,this.value,null,{},0)}}class Ho{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=i}getValue(e){return Wr(this._values[e].value.value)}setValue(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Uu(this._values[e].property,this._globalState)),this._values[e].value=new Zo(this._values[e].property,i===null?void 0:Wr(i),this._globalState)}getTransition(e){return Wr(this._values[e].transition)}setTransition(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Uu(this._values[e].property,this._globalState)),this._values[e].transition=Wr(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const u=this.getTransition(i);u!==void 0&&(e[`${i}${_o}`]=u)}return e}transitioned(e,i){const o=new Lc(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(e,i._values[u]);return o}untransitioned(){const e=new Lc(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Vl{constructor(e,i,o,u,d){this.property=e,this.value=i,this.begin=d+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const u=e.now||0,d=this.value.possiblyEvaluate(e,i,o),p=this.prior;if(p){if(u>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(u<this.begin)return p.possiblyEvaluate(e,i,o);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,o),d,ct(y))}}return d}}class Lc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const u=new $o(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,i,o);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ph{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=i}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Wr(this._values[e].value)}setValue(e,i){this._values[e]=new Zo(this._values[e].property,i===null?void 0:Wr(i),this._globalState)}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const u=new $o(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].possiblyEvaluate(e,i,o);return u}}class Cr{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,u){return this.property.evaluate(this.value,this.parameters,e,i,o,u)}}class $o{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class dt{constructor(e){this.specification=e}possiblyEvaluate(e,i){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(i)}interpolate(e,i,o){const u=Ni[this.specification.type];return u?u(e,i,o):e}}class xt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,u){return new Cr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,u)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Cr(this,{kind:"constant",value:void 0},e.parameters);const u=Ni[this.specification.type];if(u){const d=u(e.value.value,i.value.value,o);return new Cr(this,{kind:"constant",value:d},e.parameters)}return e}evaluate(e,i,o,u,d,p){return e.kind==="constant"?e.value:e.evaluate(i,o,u,d,p)}}class yo extends xt{possiblyEvaluate(e,i,o,u){if(e.value===void 0)return new Cr(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const d=e.expression.evaluate(i,null,{},o,u),p=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,y=this._calculate(p,p,p,i);return new Cr(this,{kind:"constant",value:y},i)}if(e.expression.kind==="camera"){const d=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new Cr(this,{kind:"constant",value:d},i)}return new Cr(this,e.expression,i)}evaluate(e,i,o,u,d,p){if(e.kind==="source"){const y=e.evaluate(i,o,u,d,p);return this._calculate(y,y,y,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},o,u),e.evaluate({zoom:Math.floor(i.zoom)},o,u),e.evaluate({zoom:Math.floor(i.zoom)+1},o,u),i):e.value}_calculate(e,i,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class zr{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const d=e.expression.evaluate(i,null,{},o,u);return this._calculate(d,d,d,i)}return this._calculate(e.expression.evaluate(new Qt(Math.floor(i.zoom-1),i)),e.expression.evaluate(new Qt(Math.floor(i.zoom),i)),e.expression.evaluate(new Qt(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class $n{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){return!!e.expression.evaluate(i,null,{},o,u)}interpolate(){return!1}}class dn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const o=e[i];o.specification.overridable&&this.overridableProperties.push(i);const u=this.defaultPropertyValues[i]=new Zo(o,void 0,void 0),d=this.defaultTransitionablePropertyValues[i]=new Uu(o,void 0);this.defaultTransitioningPropertyValues[i]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=u.possiblyEvaluate({})}}}nt("DataDrivenProperty",xt),nt("DataConstantProperty",dt),nt("CrossFadedDataDrivenProperty",yo),nt("CrossFadedProperty",zr),nt("ColorRampProperty",$n);class Dr extends Jt{constructor(e,i,o){if(super(),this.id=e.id,this.type=e.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Fr(e.filter,o)),i.layout&&(this._unevaluatedLayout=new Ph(i.layout,o)),i.paint)){this._transitionablePaint=new Ho(i.paint,o);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new $o(i.paint)}}setFilter(e){this.filter=e,this._featureFilter=Fr(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;if(this._unevaluatedLayout)for(const i in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[i];for(const u of o.getGlobalStateRefs())e.add(u)}for(const i of this._featureFilter.getGlobalStateRefs())e.add(i);return e}getPaintAffectingGlobalStateRefs(){var e;const i=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const u=this._transitionablePaint._values[o].value;for(const d of u.getGlobalStateRefs()){const p=(e=i.get(d))!==null&&e!==void 0?e:[];p.push({name:o,value:u.value}),i.set(d,p)}}return i}setLayoutProperty(e,i,o={}){i!=null&&this._validate(Oa,`layers.${this.id}.layout.${e}`,e,i,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return e.endsWith(_o)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,o={}){if(i!=null&&this._validate(Vr,`layers.${this.id}.paint.${e}`,e,i,o))return!1;if(e.endsWith(_o))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const u=this._transitionablePaint._values[e],d=u.property.specification["property-type"]==="cross-faded-data-driven",p=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||p||d||this._handleOverridablePaintPropertyUpdate(e,y,x)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e,i=!1){return!!(this.minzoom&&e<(i?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Hs(e,((i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length)))}_validate(e,i,o,u,d={}){return(!d||d.validate!==!1)&&Bu(this,e.call(kl,{key:i,layerType:this.type,objectKey:o,value:u,styleSpec:ve,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Cr&&ba(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}let Ih;var vo={get paint(){return Ih=Ih||new dn({"raster-opacity":new dt(ve.paint_raster["raster-opacity"]),"raster-hue-rotate":new dt(ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new dt(ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new dt(ve.paint_raster["raster-brightness-max"]),"raster-saturation":new dt(ve.paint_raster["raster-saturation"]),"raster-contrast":new dt(ve.paint_raster["raster-contrast"]),"raster-resampling":new dt(ve.paint_raster["raster-resampling"]),"raster-fade-duration":new dt(ve.paint_raster["raster-fade-duration"])})}};class jr extends Dr{constructor(e,i){super(e,vo,i)}}const pn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ps{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class hi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function vt(n,e=1){let i=0,o=0;return{members:n.map((u=>{const d=pn[u.type].BYTES_PER_ELEMENT,p=i=Ci(i,Math.max(e,d)),y=u.components||1;return o=Math.max(o,d),i+=d*y,{name:u.name,type:u.type,components:y,offset:p}})),size:Ci(i,Math.max(o,e)),alignment:e}}function Ci(n,e){return Math.ceil(n/e)*e}class Xi extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=o,e}}Xi.prototype.bytesPerElement=4,nt("StructArrayLayout2i4",Xi);class Xo extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const d=3*e;return this.int16[d+0]=i,this.int16[d+1]=o,this.int16[d+2]=u,e}}Xo.prototype.bytesPerElement=6,nt("StructArrayLayout3i6",Xo);class la extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,u)}emplace(e,i,o,u,d){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=o,this.int16[p+2]=u,this.int16[p+3]=d,e}}la.prototype.bytesPerElement=8,nt("StructArrayLayout4i8",la);class Is extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,d,p)}emplace(e,i,o,u,d,p,y){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=d,this.int16[x+4]=p,this.int16[x+5]=y,e}}Is.prototype.bytesPerElement=12,nt("StructArrayLayout2i4i12",Is);class jl extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,d,p)}emplace(e,i,o,u,d,p,y){const x=4*e,T=8*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.uint8[T+4]=u,this.uint8[T+5]=d,this.uint8[T+6]=p,this.uint8[T+7]=y,e}}jl.prototype.bytesPerElement=8,nt("StructArrayLayout2i4ub8",jl);class Rs extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=o,e}}Rs.prototype.bytesPerElement=8,nt("StructArrayLayout2f8",Rs);class Ls extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p,y,x,T,E){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,u,d,p,y,x,T,E)}emplace(e,i,o,u,d,p,y,x,T,E,C){const D=10*e;return this.uint16[D+0]=i,this.uint16[D+1]=o,this.uint16[D+2]=u,this.uint16[D+3]=d,this.uint16[D+4]=p,this.uint16[D+5]=y,this.uint16[D+6]=x,this.uint16[D+7]=T,this.uint16[D+8]=E,this.uint16[D+9]=C,e}}Ls.prototype.bytesPerElement=20,nt("StructArrayLayout10ui20",Ls);class Rh extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p,y,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,o,u,d,p,y,x)}emplace(e,i,o,u,d,p,y,x,T){const E=8*e;return this.uint16[E+0]=i,this.uint16[E+1]=o,this.uint16[E+2]=u,this.uint16[E+3]=d,this.uint16[E+4]=p,this.uint16[E+5]=y,this.uint16[E+6]=x,this.uint16[E+7]=T,e}}Rh.prototype.bytesPerElement=16,nt("StructArrayLayout8ui16",Rh);class Yi extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p,y,x,T,E,C,D){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,o,u,d,p,y,x,T,E,C,D)}emplace(e,i,o,u,d,p,y,x,T,E,C,D,P){const O=12*e;return this.int16[O+0]=i,this.int16[O+1]=o,this.int16[O+2]=u,this.int16[O+3]=d,this.uint16[O+4]=p,this.uint16[O+5]=y,this.uint16[O+6]=x,this.uint16[O+7]=T,this.int16[O+8]=E,this.int16[O+9]=C,this.int16[O+10]=D,this.int16[O+11]=P,e}}Yi.prototype.bytesPerElement=24,nt("StructArrayLayout4i4ui4i24",Yi);class ka extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const d=3*e;return this.float32[d+0]=i,this.float32[d+1]=o,this.float32[d+2]=u,e}}ka.prototype.bytesPerElement=12,nt("StructArrayLayout3f12",ka);class Ul extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Ul.prototype.bytesPerElement=4,nt("StructArrayLayout1ul4",Ul);class Gl extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p,y,x,T){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,o,u,d,p,y,x,T)}emplace(e,i,o,u,d,p,y,x,T,E){const C=10*e,D=5*e;return this.int16[C+0]=i,this.int16[C+1]=o,this.int16[C+2]=u,this.int16[C+3]=d,this.int16[C+4]=p,this.int16[C+5]=y,this.uint32[D+3]=x,this.uint16[C+8]=T,this.uint16[C+9]=E,e}}Gl.prototype.bytesPerElement=20,nt("StructArrayLayout6i1ul2ui20",Gl);class Gu extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,d,p)}emplace(e,i,o,u,d,p,y){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=d,this.int16[x+4]=p,this.int16[x+5]=y,e}}Gu.prototype.bytesPerElement=12,nt("StructArrayLayout2i2i2i12",Gu);class qu extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,u,d)}emplace(e,i,o,u,d,p){const y=4*e,x=8*e;return this.float32[y+0]=i,this.float32[y+1]=o,this.float32[y+2]=u,this.int16[x+6]=d,this.int16[x+7]=p,e}}qu.prototype.bytesPerElement=16,nt("StructArrayLayout2f1f2i16",qu);class Zu extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,d,p)}emplace(e,i,o,u,d,p,y){const x=16*e,T=4*e,E=8*e;return this.uint8[x+0]=i,this.uint8[x+1]=o,this.float32[T+1]=u,this.float32[T+2]=d,this.int16[E+6]=p,this.int16[E+7]=y,e}}Zu.prototype.bytesPerElement=16,nt("StructArrayLayout2ub2f2i16",Zu);class Os extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const d=3*e;return this.uint16[d+0]=i,this.uint16[d+1]=o,this.uint16[d+2]=u,e}}Os.prototype.bytesPerElement=6,nt("StructArrayLayout3ui6",Os);class Bs extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p,y,x,T,E,C,D,P,O,k,N,G){const J=this.length;return this.resize(J+1),this.emplace(J,e,i,o,u,d,p,y,x,T,E,C,D,P,O,k,N,G)}emplace(e,i,o,u,d,p,y,x,T,E,C,D,P,O,k,N,G,J){const q=24*e,$=12*e,te=48*e;return this.int16[q+0]=i,this.int16[q+1]=o,this.uint16[q+2]=u,this.uint16[q+3]=d,this.uint32[$+2]=p,this.uint32[$+3]=y,this.uint32[$+4]=x,this.uint16[q+10]=T,this.uint16[q+11]=E,this.uint16[q+12]=C,this.float32[$+7]=D,this.float32[$+8]=P,this.uint8[te+36]=O,this.uint8[te+37]=k,this.uint8[te+38]=N,this.uint32[$+10]=G,this.int16[q+22]=J,e}}Bs.prototype.bytesPerElement=48,nt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Bs);class rr extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,d,p,y,x,T,E,C,D,P,O,k,N,G,J,q,$,te,ne,be,Ne,Oe,$e,tt,Ye){const ke=this.length;return this.resize(ke+1),this.emplace(ke,e,i,o,u,d,p,y,x,T,E,C,D,P,O,k,N,G,J,q,$,te,ne,be,Ne,Oe,$e,tt,Ye)}emplace(e,i,o,u,d,p,y,x,T,E,C,D,P,O,k,N,G,J,q,$,te,ne,be,Ne,Oe,$e,tt,Ye,ke){const ze=32*e,ut=16*e;return this.int16[ze+0]=i,this.int16[ze+1]=o,this.int16[ze+2]=u,this.int16[ze+3]=d,this.int16[ze+4]=p,this.int16[ze+5]=y,this.int16[ze+6]=x,this.int16[ze+7]=T,this.uint16[ze+8]=E,this.uint16[ze+9]=C,this.uint16[ze+10]=D,this.uint16[ze+11]=P,this.uint16[ze+12]=O,this.uint16[ze+13]=k,this.uint16[ze+14]=N,this.uint16[ze+15]=G,this.uint16[ze+16]=J,this.uint16[ze+17]=q,this.uint16[ze+18]=$,this.uint16[ze+19]=te,this.uint16[ze+20]=ne,this.uint16[ze+21]=be,this.uint16[ze+22]=Ne,this.uint32[ut+12]=Oe,this.float32[ut+13]=$e,this.float32[ut+14]=tt,this.uint16[ze+30]=Ye,this.uint16[ze+31]=ke,e}}rr.prototype.bytesPerElement=64,nt("StructArrayLayout8i15ui1ul2f2ui64",rr);class Vi extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Vi.prototype.bytesPerElement=4,nt("StructArrayLayout1f4",Vi);class fs extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const d=3*e;return this.uint16[6*e+0]=i,this.float32[d+1]=o,this.float32[d+2]=u,e}}fs.prototype.bytesPerElement=12,nt("StructArrayLayout1ui2f12",fs);class Yo extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const d=4*e;return this.uint32[2*e+0]=i,this.uint16[d+2]=o,this.uint16[d+3]=u,e}}Yo.prototype.bytesPerElement=8,nt("StructArrayLayout1ul2ui8",Yo);class ql extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=o,e}}ql.prototype.bytesPerElement=4,nt("StructArrayLayout2ui4",ql);class Zl extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Zl.prototype.bytesPerElement=2,nt("StructArrayLayout1ui2",Zl);class Fa extends hi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,u)}emplace(e,i,o,u,d){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=u,this.float32[p+3]=d,e}}Fa.prototype.bytesPerElement=16,nt("StructArrayLayout4f16",Fa);class m extends Ps{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new me(this.anchorPointX,this.anchorPointY)}}m.prototype.size=20;class t extends Gl{get(e){return new m(this,e)}}nt("CollisionBoxArray",t);class a extends Ps{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}a.prototype.size=48;class l extends Bs{get(e){return new a(this,e)}}nt("PlacedSymbolArray",l);class h extends Ps{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}h.prototype.size=64;class _ extends rr{get(e){return new h(this,e)}}nt("SymbolInstanceArray",_);class v extends Vi{getoffsetX(e){return this.float32[1*e+0]}}nt("GlyphOffsetArray",v);class w extends Xo{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}nt("SymbolLineVertexArray",w);class S extends Ps{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}S.prototype.size=12;class A extends fs{get(e){return new S(this,e)}}nt("TextAnchorOffsetArray",A);class z extends Ps{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}z.prototype.size=8;class R extends Yo{get(e){return new z(this,e)}}nt("FeatureIndexArray",R);class I extends Xi{}class F extends Xi{}class U extends Xi{}class X extends Is{}class Q extends jl{}class Y extends Rs{}class W extends Ls{}class ie extends Rh{}class K extends Yi{}class re extends ka{}class se extends Ul{}class ee extends Gu{}class fe extends Zu{}class Me extends Os{}class xe extends ql{}const Ee=vt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ce}=Ee;class He{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,i,o,u){const d=this.segments[this.segments.length-1];return e>He.MAX_VERTEX_ARRAY_LENGTH&&Zi(`Max vertices per segment is ${He.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${He.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!d||d.vertexLength+e>He.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==u?this.createNewSegment(i,o,u):d}createNewSegment(e,i,o){const u={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(u.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(e,i,o){return this.prepareSegment(0,e,i,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,u){return new He([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function Je(n,e){return 256*(n=kt(Math.floor(n),0,255))+kt(Math.floor(e),0,255)}He.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,nt("SegmentVector",He);const qe=vt([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ft=vt([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Pt,li,zi,fi={exports:{}},Bi={exports:{}},yi={exports:{}},Mn=(function(){if(zi)return fi.exports;zi=1;var n=(Pt||(Pt=1,Bi.exports=function(i,o){var u,d,p,y,x,T,E,C;for(d=i.length-(u=3&i.length),p=o,x=3432918353,T=461845907,C=0;C<d;)E=255&i.charCodeAt(C)|(255&i.charCodeAt(++C))<<8|(255&i.charCodeAt(++C))<<16|(255&i.charCodeAt(++C))<<24,++C,p=27492+(65535&(y=5*(65535&(p=(p^=E=(65535&(E=(E=(65535&E)*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(E=0,u){case 3:E^=(255&i.charCodeAt(C+2))<<16;case 2:E^=(255&i.charCodeAt(C+1))<<8;case 1:p^=E=(65535&(E=(E=(65535&(E^=255&i.charCodeAt(C)))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),Bi.exports),e=(li||(li=1,yi.exports=function(i,o){for(var u,d=i.length,p=o^d,y=0;d>=4;)u=1540483477*(65535&(u=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:p^=(255&i.charCodeAt(y+2))<<16;case 2:p^=(255&i.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),yi.exports);return fi.exports=n,fi.exports.murmur3=n,fi.exports.murmur2=e,fi.exports})(),Li=we(Mn);class En{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,o,u){this.ids.push(Qi(e)),this.positions.push(i,o,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=Qi(e);let o=0,u=this.ids.length-1;for(;o<u;){const p=o+u>>1;this.ids[p]>=i?u=p:o=p+1}const d=[];for(;this.ids[o]===i;)d.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return d}static serialize(e,i){const o=new Float64Array(e.ids),u=new Uint32Array(e.positions);return sn(o,u,0,o.length-1),i&&i.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(e){const i=new En;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function Qi(n){const e=+n;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Li(String(n))}function sn(n,e,i,o){for(;i<o;){const u=n[i+o>>1];let d=i-1,p=o+1;for(;;){do d++;while(n[d]<u);do p--;while(n[p]>u);if(d>=p)break;Xn(n,d,p),Xn(e,3*d,3*p),Xn(e,3*d+1,3*p+1),Xn(e,3*d+2,3*p+2)}p-i<o-p?(sn(n,e,i,p),i=p+1):(sn(n,e,p+1,o),o=p)}}function Xn(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}nt("FeaturePositionMap",En);class ar{constructor(e,i){this.gl=e.gl,this.location=i}}class Na extends ar{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class ks extends ar{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Qo extends ar{constructor(e,i){super(e,i),this.current=Ft.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Oc=new Float32Array(16);function Wo(n){return[Je(255*n.r,255*n.g),Je(255*n.b,255*n.a)]}class Ur{constructor(e,i,o){this.value=e,this.uniformNames=i.map((u=>`u_${u}`)),this.type=o}setUniform(e,i,o){e.set(o.constantOr(this.value))}getBinding(e,i,o){return this.type==="color"?new Qo(e,i):new Na(e,i)}}class An{constructor(e,i){this.uniformNames=i.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,i){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,i.y,i.height,i.width]}setUniform(e,i,o,u){let d=null;u==="u_pattern_to"?d=this.patternTo:u==="u_pattern_from"?d=this.patternFrom:u==="u_dasharray_to"?d=this.dashTo:u==="u_dasharray_from"?d=this.dashFrom:u==="u_pixel_ratio_to"?d=this.pixelRatioTo:u==="u_pixel_ratio_from"&&(d=this.pixelRatioFrom),d!==null&&e.set(d)}getBinding(e,i,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new ks(e,i):new Na(e,i)}}class Vn{constructor(e,i,o,u){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map((d=>({name:`a_${d}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(e,i,o){const u=this.paintVertexArray.length,d=this.expression.evaluate(new Qt(0,o),i,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(u,e,d)}updatePaintArray(e,i,o,u,d){const p=this.expression.evaluate(new Qt(0,d),o,u);this._setPaintValue(e,i,p)}_setPaintValue(e,i,o){if(this.type==="color"){const u=Wo(o);for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Yn{constructor(e,i,o,u,d,p){this.expression=e,this.uniformNames=i.map((y=>`u_${y}_t`)),this.type=o,this.useIntegerZoom=u,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=i.map((y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new p}populatePaintArray(e,i,o){const u=this.expression.evaluate(new Qt(this.zoom,o),i,{},o.canonical,[],o.formattedSection),d=this.expression.evaluate(new Qt(this.zoom+1,o),i,{},o.canonical,[],o.formattedSection),p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(p,e,u,d)}updatePaintArray(e,i,o,u,d){const p=this.expression.evaluate(new Qt(this.zoom,d),o,u),y=this.expression.evaluate(new Qt(this.zoom+1,d),o,u);this._setPaintValue(e,i,p,y)}_setPaintValue(e,i,o,u){if(this.type==="color"){const d=Wo(o),p=Wo(u);for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,d[0],d[1],p[0],p[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,u=kt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,i,o){return new Na(e,i)}}class ua{constructor(e,i,o,u,d,p){this.expression=e,this.type=i,this.useIntegerZoom=o,this.zoom=u,this.layerId=p,this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(e,i,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,this.getPositionIds(i),o)}updatePaintArray(e,i,o,u,d){this._setPaintValues(e,i,this.getPositionIds(o),d)}_setPaintValues(e,i,o,u){const d=this.getPositions(u);if(!d||!o)return;const p=d[o.min],y=d[o.mid],x=d[o.max];if(p&&y&&x)for(let T=e;T<i;T++)this.emplace(this.zoomInPaintVertexArray,T,y,p),this.emplace(this.zoomOutPaintVertexArray,T,y,x)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const i=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,i,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,i,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Wi extends ua{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return qe.members}emplace(e,i,o,u){e.emplace(i,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],o.pixelRatio,u.pixelRatio)}}class Cn extends ua{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return ft.members}emplace(e,i,o,u){e.emplace(i,0,o.y,o.height,o.width,0,u.y,u.height,u.width)}}class Pr{constructor(e,i,o){this.binders={},this._buffers=[];const u=[];for(const d in e.paint._values){if(!o(d))continue;const p=e.paint.get(d);if(!(p instanceof Cr&&ba(p.property.specification)))continue;const y=Lh(d,e.type),x=p.value,T=p.property.specification.type,E=p.property.useIntegerZoom,C=p.property.specification["property-type"],D=C==="cross-faded"||C==="cross-faded-data-driven";if(x.kind==="constant")this.binders[d]=D?new An(x.value,y):new Ur(x.value,y,T),u.push(`/u_${d}`);else if(x.kind==="source"||D){const P=Bc(d,T,"source");this.binders[d]=D?d==="line-dasharray"?new Cn(x,T,E,i,P,e.id):new Wi(x,T,E,i,P,e.id):new Vn(x,y,T,P),u.push(`/a_${d}`)}else{const P=Bc(d,T,"composite");this.binders[d]=new Yn(x,y,T,E,i,P),u.push(`/z_${d}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Vn||i instanceof Yn?i.maxValue:0}populatePaintArrays(e,i,o){for(const u in this.binders){const d=this.binders[u];(d instanceof Vn||d instanceof Yn||d instanceof ua)&&d.populatePaintArray(e,i,o)}}setConstantPatternPositions(e,i){for(const o in this.binders){const u=this.binders[o];u instanceof An&&u.setConstantPatternPositions(e,i)}}setConstantDashPositions(e,i){for(const o in this.binders){const u=this.binders[o];u instanceof An&&u.setConstantDashPositions(e,i)}}updatePaintArrays(e,i,o,u,d){let p=!1;for(const y in e){const x=i.getPositions(y);for(const T of x){const E=o.feature(T.index);for(const C in this.binders){const D=this.binders[C];if((D instanceof Vn||D instanceof Yn||D instanceof ua)&&D.expression.isStateDependent===!0){const P=u.paint.get(C);D.expression=P.value,D.updatePaintArray(T.start,T.end,E,e[y],d),p=!0}}}}return p}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Ur||o instanceof An)&&e.push(...o.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Vn||o instanceof Yn)for(let u=0;u<o.paintVertexAttributes.length;u++)e.push(o.paintVertexAttributes[u].name);else if(o instanceof ua){const u=o.getVertexAttributes();for(const d of u)e.push(d.name)}}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Ur||o instanceof An||o instanceof Yn)for(const u of o.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const o=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof Ur||d instanceof An||d instanceof Yn){for(const p of d.uniformNames)if(i[p]){const y=d.getBinding(e,i[p],p);o.push({name:p,property:u,binding:y})}}}return o}setUniforms(e,i,o,u){for(const{name:d,property:p,binding:y}of i)this.binders[p].setUniform(y,u,o.get(p),d)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(e&&o instanceof ua){const u=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Vn||o instanceof Yn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof Vn||o instanceof Yn||o instanceof ua)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Vn||i instanceof Yn||i instanceof ua)&&i.destroy()}}}class ji{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Pr(u,i,o);this.needsUpload=!1,this._featureMap=new En,this._bufferOffset=0}populatePaintArrays(e,i,o,u){for(const d in this.programConfigurations)this.programConfigurations[d].populatePaintArrays(e,i,u);i.id!==void 0&&this._featureMap.add(i.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,u){for(const d of o)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,i,d,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Lh(n,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}function Bc(n,e,i){const o={color:{source:Rs,composite:Fa},number:{source:Vi,composite:Rs}},u=(function(d){return{"line-pattern":{source:W,composite:W},"fill-pattern":{source:W,composite:W},"fill-extrusion-pattern":{source:W,composite:W},"line-dasharray":{source:ie,composite:ie}}[d]})(n);return u&&u[i]||o[e][i]}nt("ConstantBinder",Ur),nt("CrossFadedConstantBinder",An),nt("SourceExpressionBinder",Vn),nt("CrossFadedPatternBinder",Wi),nt("CrossFadedDasharrayBinder",Cn),nt("CompositeExpressionBinder",Yn),nt("ProgramConfiguration",Pr,{omit:["_buffers"]}),nt("ProgramConfigurationSet",ji);const kc=Math.pow(2,14)-1,Oh=-kc-1;function ca(n){const e=wt/n.extent,i=n.loadGeometry();for(let o=0;o<i.length;o++){const u=i[o];for(let d=0;d<u.length;d++){const p=u[d],y=Math.round(p.x*e),x=Math.round(p.y*e);p.x=kt(y,Oh,kc),p.y=kt(x,Oh,kc),(y<p.x||y>p.x+1||x<p.y||x>p.y+1)&&Zi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function xo(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?ca(n):[]}}const Fs=-32768;function Bh(n,e,i,o,u){n.emplaceBack(Fs+8*e+o,Fs+8*i+u)}class Ko{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new F,this.indexArray=new Me,this.segments=new He,this.programConfigurations=new ji(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){const u=this.layers[0],d=[];let p=null,y=!1,x=u.type==="heatmap";if(u.type==="circle"){const E=u;p=E.layout.get("circle-sort-key"),y=!p.isConstant(),x=x||E.paint.get("circle-pitch-alignment")==="map"}const T=x?i.subdivisionGranularity.circle:1;for(const{feature:E,id:C,index:D,sourceLayerIndex:P}of e){const O=this.layers[0]._featureFilter.needGeometry,k=xo(E,O);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),k,o))continue;const N=y?p.evaluate(k,{},o):void 0,G={id:C,properties:E.properties,type:E.type,sourceLayerIndex:P,index:D,geometry:O?k.geometry:ca(E),patterns:{},sortKey:N};d.push(G)}y&&d.sort(((E,C)=>E.sortKey-C.sortKey));for(const E of d){const{geometry:C,index:D,sourceLayerIndex:P}=E,O=e[D].feature;this.addFeature(E,C,D,o,T),i.featureIndex.insert(O,C,D,P,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ce),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,u,d=1){let p;switch(d){case 1:p=[0,7];break;case 3:p=[0,2,5,7];break;case 5:p=[0,1,3,4,6,7];break;case 7:p=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${d}; valid values are 1, 3, 5, 7.`)}const y=p.length;for(const x of i)for(const T of x){const E=T.x,C=T.y;if(E<0||E>=wt||C<0||C>=wt)continue;const D=this.segments.prepareSegment(y*y,this.layoutVertexArray,this.indexArray,e.sortKey),P=D.vertexLength;for(let O=0;O<y;O++)for(let k=0;k<y;k++)Bh(this.layoutVertexArray,E,C,p[k],p[O]);for(let O=0;O<y-1;O++)for(let k=0;k<y-1;k++){const N=P+O*y+k,G=P+(O+1)*y+k;this.indexArray.emplaceBack(N,G+1,N+1),this.indexArray.emplaceBack(N,G,G+1)}D.vertexLength+=y*y,D.primitiveLength+=(y-1)*(y-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:{},canonical:u})}}function Fc(n,e){for(let i=0;i<n.length;i++)if(Hu(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Hu(n,e[i]))return!0;return!!Fd(n,e)}function bo(n,e,i){return!!Hu(n,e)||!!zn(e,n,i)}function Nc(n,e){if(n.length===1)return Vd(e,n[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let u=0;u<o.length;u++)if(Hu(n,o[u]))return!0}for(let i=0;i<n.length;i++)if(Vd(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Fd(n,e[i]))return!0;return!1}function Vc(n,e,i){if(n.length>1){if(Fd(n,e))return!0;for(let o=0;o<e.length;o++)if(zn(e[o],n,i))return!0}for(let o=0;o<n.length;o++)if(zn(n[o],e,i))return!0;return!1}function Fd(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const o=n[i],u=n[i+1];for(let d=0;d<e.length-1;d++)if(Nd(o,u,e[d],e[d+1]))return!0}return!1}function Nd(n,e,i,o){return Or(n,i,o)!==Or(e,i,o)&&Or(n,e,i)!==Or(n,e,o)}function zn(n,e,i){const o=i*i;if(e.length===1)return n.distSqr(e[0])<o;for(let u=1;u<e.length;u++)if(pr(n,e[u-1],e[u])<o)return!0;return!1}function pr(n,e,i){const o=e.distSqr(i);if(o===0)return n.distSqr(e);const u=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/o;return n.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function Vd(n,e){let i,o,u,d=!1;for(let p=0;p<n.length;p++){i=n[p];for(let y=0,x=i.length-1;y<i.length;x=y++)o=i[y],u=i[x],o.y>e.y!=u.y>e.y&&e.x<(u.x-o.x)*(e.y-o.y)/(u.y-o.y)+o.x&&(d=!d)}return d}function Hu(n,e){let i=!1;for(let o=0,u=n.length-1;o<n.length;u=o++){const d=n[o],p=n[u];d.y>e.y!=p.y>e.y&&e.x<(p.x-d.x)*(e.y-d.y)/(p.y-d.y)+d.x&&(i=!i)}return i}function Hp(n,e,i){const o=i[0],u=i[2];if(n.x<o.x&&e.x<o.x||n.x>u.x&&e.x>u.x||n.y<o.y&&e.y<o.y||n.y>u.y&&e.y>u.y)return!1;const d=Or(n,e,i[0]);return d!==Or(n,e,i[1])||d!==Or(n,e,i[2])||d!==Or(n,e,i[3])}function $u(n,e,i){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(n)}function Hl(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function kh(n,e,i,o,u){if(!e[0]&&!e[1])return n;const d=me.convert(e)._mult(u);i==="viewport"&&d._rotate(-o);const p=[];for(let y=0;y<n.length;y++)p.push(n[y].sub(d));return p}function jf(n){const e=[];for(let i=0;i<n.length;i++){const o=n[i],u=e.at(-1);(i===0||u&&!o.equals(u))&&e.push(o)}return e}function $p({queryGeometry:n,size:e},i){return bo(n,i,e)}function $m({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},d){return bo(n,d,e*(i.projectTileCoordinates(d.x,d.y,o,u).signedDistanceFromCamera/i.cameraToCenterDistance))}function Uf({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},d){const p=i.projectTileCoordinates(d.x,d.y,o,u).signedDistanceFromCamera,y=e*(i.cameraToCenterDistance/p);return bo(n,Gf(d,i,o,u),y)}function jd({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},d){return bo(n,Gf(d,i,o,u),e)}function Ud({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u,pitchAlignment:d="map",pitchScale:p="map"},y){const x=d==="map"?p==="map"?$p:$m:p==="map"?Uf:jd,T={queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u};for(const E of y)for(const C of E)if(x(T,C))return!0;return!1}function Gf(n,e,i,o){const u=e.projectTileCoordinates(n.x,n.y,i,o).point;return new me((.5*u.x+.5)*e.width,(.5*-u.y+.5)*e.height)}let Gd,qf;nt("CircleBucket",Ko,{omit:["layers"]});var qd={get paint(){return qf=qf||new dn({"circle-radius":new xt(ve.paint_circle["circle-radius"]),"circle-color":new xt(ve.paint_circle["circle-color"]),"circle-blur":new xt(ve.paint_circle["circle-blur"]),"circle-opacity":new xt(ve.paint_circle["circle-opacity"]),"circle-translate":new dt(ve.paint_circle["circle-translate"]),"circle-translate-anchor":new dt(ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new dt(ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new dt(ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new xt(ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new xt(ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new xt(ve.paint_circle["circle-stroke-opacity"])})},get layout(){return Gd=Gd||new dn({"circle-sort-key":new xt(ve.layout_circle["circle-sort-key"])})}};class Zd extends Dr{constructor(e,i){super(e,qd,i)}createBucket(e){return new Ko(e)}queryRadius(e){const i=e;return $u("circle-radius",this,i)+$u("circle-stroke-width",this,i)+Hl(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:d,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){const T=kh(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-d.bearingInRadians,p),E=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o),C=this.paint.get("circle-pitch-scale"),D=this.paint.get("circle-pitch-alignment");let P,O;return D==="map"?(P=T,O=E*p):(P=(function(k,N,G,J){return k.map((q=>Gf(q,N,G,J)))})(T,d,y,x),O=E),Ud({queryGeometry:P,size:O,transform:d,unwrappedTileID:y,getElevation:x,pitchAlignment:D,pitchScale:C},u)}}class Hd extends Ko{}let Zf;nt("HeatmapBucket",Hd,{omit:["layers"]});var Hf={get paint(){return Zf=Zf||new dn({"heatmap-radius":new xt(ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new xt(ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new dt(ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $n(ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new dt(ve.paint_heatmap["heatmap-opacity"])})}};function Fh(n,{width:e,height:i},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*i*o}`)}else u=new Uint8Array(e*i*o);return n.width=e,n.height=i,n.data=u,n}function $d(n,{width:e,height:i},o){if(e===n.width&&i===n.height)return;const u=Fh({},{width:e,height:i},o);Nh(n,u,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,i)},o),n.width=e,n.height=i,n.data=u.data}function Nh(n,e,i,o,u,d){if(u.width===0||u.height===0)return e;if(u.width>n.width||u.height>n.height||i.x>n.width-u.width||i.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||o.x>e.width-u.width||o.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const p=n.data,y=e.data;if(p===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<u.height;x++){const T=((i.y+x)*n.width+i.x)*d,E=((o.y+x)*e.width+o.x)*d;for(let C=0;C<u.width*d;C++)y[E+C]=p[T+C]}return e}class jc{constructor(e,i){Fh(this,e,1,i)}resize(e){$d(this,e,1)}clone(){return new jc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,d){Nh(e,i,o,u,d,1)}}class bn{constructor(e,i){Fh(this,e,4,i)}resize(e){$d(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new bn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,d){Nh(e,i,o,u,d,4)}setPixel(e,i,o){const u=4*(e*this.width+i);this.data[u+0]=Math.round(255*o.r/o.a),this.data[u+1]=Math.round(255*o.g/o.a),this.data[u+2]=Math.round(255*o.b/o.a),this.data[u+3]=Math.round(255*o.a)}}function $f(n){const e={},i=n.resolution||256,o=n.clips?n.clips.length:1,u=n.image||new bn({width:i,height:o});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const d=(p,y,x)=>{e[n.evaluationKey]=x;const T=n.expression.evaluate(e);u.setPixel(p/4/i,y/4,T)};if(n.clips)for(let p=0,y=0;p<o;++p,y+=4*i)for(let x=0,T=0;x<i;x++,T+=4){const E=x/(i-1),{start:C,end:D}=n.clips[p];d(y,T,C*(1-E)+D*E)}else for(let p=0,y=0;p<i;p++,y+=4)d(0,y,p/(i-1));return u}nt("AlphaImage",jc),nt("RGBAImage",bn);const Xd="big-fb";class Xp extends Dr{createBucket(e){return new Hd(e)}constructor(e,i){super(e,Hf,i),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=$f({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Xd)&&this.heatmapFbos.delete(Xd)}queryRadius(e){return $u("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:d,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){return Ud({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(i,o)*p,transform:d,unwrappedTileID:y,getElevation:x},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let wo;var Yd={get paint(){return wo=wo||new dn({"hillshade-illumination-direction":new dt(ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new dt(ve.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new dt(ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new dt(ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new dt(ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new dt(ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new dt(ve.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new dt(ve.paint_hillshade["hillshade-method"])})}};class Yp extends Dr{constructor(e,i){super(e,Yd,i),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const d=Math.max(e.length,i.length,o.length,u.length);e=e.concat(Array(d-e.length).fill(e.at(-1))),i=i.concat(Array(d-i.length).fill(i.at(-1))),o=o.concat(Array(d-o.length).fill(o.at(-1))),u=u.concat(Array(d-u.length).fill(u.at(-1)));const p=i.map(Gn);return{directionRadians:e.map(Gn),altitudeRadians:p,shadowColor:u,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Vh;var jh={get paint(){return Vh=Vh||new dn({"color-relief-opacity":new dt(ve["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new $n(ve["paint_color-relief"]["color-relief-color"])})}};class Ui{constructor(e,i,o,u){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,o){const{width:u,height:d}=e,p=!(this.size&&this.size[0]===u&&this.size[1]===d||o),{context:y}=this,{gl:x}=y;if(this.useMipmap=!!(i&&i.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||i.premultiply!==!1)),p)this.size=[u,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||_s(e)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,u,d,0,this.format,x.UNSIGNED_BYTE,e.data);else{const{x:T,y:E}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||_s(e)?x.texSubImage2D(x.TEXTURE_2D,0,T,E,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,T,E,u,d,x.RGBA,x.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D),y.pixelStoreUnpackFlipY.setDefault(),y.pixelStoreUnpack.setDefault(),y.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,i,o){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),o!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=d.LINEAR),e!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,o||e),this.filter=e),i!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Qp{constructor(e,i,o,u=1,d=1,p=1,y=0){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Zi(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const x=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=d,this.blueFactor=p,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<x;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(x,T)]=this.data[this._idx(x-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,x)]=this.data[this._idx(T,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<x;T++)for(let E=0;E<x;E++){const C=this.get(T,E);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(e,i){const o=new Uint8Array(this.data.buffer),u=4*this._idx(e,i);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}unpack(e,i,o){return e*this.redFactor+i*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return Wp(e,this.getUnpackVector())}getPixels(){return new bn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,d=i*this.dim+this.dim,p=o*this.dim,y=o*this.dim+this.dim;switch(i){case-1:u=d-1;break;case 1:d=u+1}switch(o){case-1:p=y-1;break;case 1:y=p+1}const x=-i*this.dim,T=-o*this.dim;for(let E=p;E<y;E++)for(let C=u;C<d;C++)this.data[this._idx(C,E)]=e.data[this._idx(C+x,E+T)]}}function Wp(n,e){const i=e[0],o=e[1],u=e[2],d=e[3],p=Math.min(i,o,u),y=Math.round((n+d)/p);return{r:Math.floor(y*p/i)%256,g:Math.floor(y*p/o)%256,b:Math.floor(y*p/u)%256}}nt("DEMData",Qp);class Kp extends Dr{constructor(e,i){super(e,jh,i)}_createColorRamp(e){const i={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof Er&&o._styleExpression.expression instanceof Sr){this.colorRampExpression=o;const p=o._styleExpression.expression;i.elevationStops=p.labels,i.colorStops=[];for(const y of i.elevationStops)i.colorStops.push(p.evaluate({globals:{elevation:y}}))}if(i.elevationStops.length<1&&(i.elevationStops=[0],i.colorStops=[Ft.transparent]),i.elevationStops.length<2&&(i.elevationStops.push(i.elevationStops[0]+1),i.colorStops.push(i.colorStops[0])),i.elevationStops.length<=e)return i;const u={elevationStops:[],colorStops:[]},d=(i.elevationStops.length-1)/(e-1);for(let p=0;p<i.elevationStops.length-.5;p+=d)u.elevationStops.push(i.elevationStops[Math.round(p)]),u.colorStops.push(i.colorStops[Math.round(p)]);return Zi(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${i.elevationStops.length}`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,i,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(i),d=new bn({width:u.colorStops.length,height:1}),p=new bn({width:u.colorStops.length,height:1});for(let y=0;y<u.elevationStops.length;y++){const x=Wp(u.elevationStops[y],o);p.setPixel(0,y,new Ft(x.r/255,x.g/255,x.b/255,1)),d.setPixel(0,y,u.colorStops[y])}return this.colorRampTextures={elevationTexture:new Ui(e,p,e.gl.RGBA),colorTexture:new Ui(e,d,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Uh=vt([{name:"a_pos",components:2,type:"Int16"}],4),{members:$l}=Uh;function Gh(n,e,i){const o=i.patternDependencies;let u=!1;for(const d of e){const p=d.paint.get(`${n}-pattern`);p.isConstant()||(u=!0);const y=p.constantOr(null);y&&(u=!0,o[y.to]=!0,o[y.from]=!0)}return u}function Xf(n,e,i,o,u){const{zoom:d}=o,p=u.patternDependencies;for(const y of e){const x=y.paint.get(`${n}-pattern`).value;if(x.kind!=="constant"){let T=x.evaluate({zoom:d-1},i,{},u.availableImages),E=x.evaluate({zoom:d},i,{},u.availableImages),C=x.evaluate({zoom:d+1},i,{},u.availableImages);T=T&&T.name?T.name:T,E=E&&E.name?E.name:E,C=C&&C.name?C.name:C,p[T]=!0,p[E]=!0,p[C]=!0,i.patterns[y.id]={min:T,mid:E,max:C}}}return i}function Uc(n,e,i,o,u){let d;if(u===(function(p,y,x,T){let E=0;for(let C=y,D=x-T;C<x;C+=T)E+=(p[D]-p[C])*(p[C+1]+p[D+1]),D=C;return E})(n,e,i,o)>0)for(let p=e;p<i;p+=o)d=ip(p/o|0,n[p],n[p+1],d);else for(let p=i-o;p>=e;p-=o)d=ip(p/o|0,n[p],n[p+1],d);return d&&Xu(d,d.next)&&(qh(d),d=d.next),d}function Gr(n,e){if(!n)return n;e||(e=n);let i,o=n;do if(i=!1,o.steiner||!Xu(o,o.next)&&mn(o.prev,o,o.next)!==0)o=o.next;else{if(qh(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function Gc(n,e,i,o,u,d,p){if(!n)return;!p&&d&&(function(x,T,E,C){let D=x;do D.z===0&&(D.z=Dn(D.x,D.y,T,E,C)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==x);D.prevZ.nextZ=null,D.prevZ=null,(function(P){let O,k=1;do{let N,G=P;P=null;let J=null;for(O=0;G;){O++;let q=G,$=0;for(let ne=0;ne<k&&($++,q=q.nextZ,q);ne++);let te=k;for(;$>0||te>0&&q;)$!==0&&(te===0||!q||G.z<=q.z)?(N=G,G=G.nextZ,$--):(N=q,q=q.nextZ,te--),J?J.nextZ=N:P=N,N.prevZ=J,J=N;G=q}J.nextZ=null,k*=2}while(O>1)})(D)})(n,o,u,d);let y=n;for(;n.prev!==n.next;){const x=n.prev,T=n.next;if(d?Jp(n,o,u,d):Qd(n))e.push(x.i,n.i,T.i),qh(n),n=T.next,y=T.next;else if((n=T)===y){p?p===1?Gc(n=Wd(Gr(n),e),e,i,o,u,d,2):p===2&&Kd(n,e,i,o,u,d):Gc(Gr(n),e,i,o,u,d,1);break}}}function Qd(n){const e=n.prev,i=n,o=n.next;if(mn(e,i,o)>=0)return!1;const u=e.x,d=i.x,p=o.x,y=e.y,x=i.y,T=o.y,E=Math.min(u,d,p),C=Math.min(y,x,T),D=Math.max(u,d,p),P=Math.max(y,x,T);let O=o.next;for(;O!==e;){if(O.x>=E&&O.x<=D&&O.y>=C&&O.y<=P&&Pn(u,y,d,x,p,T,O.x,O.y)&&mn(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function Jp(n,e,i,o){const u=n.prev,d=n,p=n.next;if(mn(u,d,p)>=0)return!1;const y=u.x,x=d.x,T=p.x,E=u.y,C=d.y,D=p.y,P=Math.min(y,x,T),O=Math.min(E,C,D),k=Math.max(y,x,T),N=Math.max(E,C,D),G=Dn(P,O,e,i,o),J=Dn(k,N,e,i,o);let q=n.prevZ,$=n.nextZ;for(;q&&q.z>=G&&$&&$.z<=J;){if(q.x>=P&&q.x<=k&&q.y>=O&&q.y<=N&&q!==u&&q!==p&&Pn(y,E,x,C,T,D,q.x,q.y)&&mn(q.prev,q,q.next)>=0||(q=q.prevZ,$.x>=P&&$.x<=k&&$.y>=O&&$.y<=N&&$!==u&&$!==p&&Pn(y,E,x,C,T,D,$.x,$.y)&&mn($.prev,$,$.next)>=0))return!1;$=$.nextZ}for(;q&&q.z>=G;){if(q.x>=P&&q.x<=k&&q.y>=O&&q.y<=N&&q!==u&&q!==p&&Pn(y,E,x,C,T,D,q.x,q.y)&&mn(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;$&&$.z<=J;){if($.x>=P&&$.x<=k&&$.y>=O&&$.y<=N&&$!==u&&$!==p&&Pn(y,E,x,C,T,D,$.x,$.y)&&mn($.prev,$,$.next)>=0)return!1;$=$.nextZ}return!0}function Wd(n,e){let i=n;do{const o=i.prev,u=i.next.next;!Xu(o,u)&&on(o,i,i.next,u)&&qc(o,u)&&qc(u,o)&&(e.push(o.i,i.i,u.i),qh(i),qh(i.next),i=n=u),i=i.next}while(i!==n);return Gr(i)}function Kd(n,e,i,o,u,d){let p=n;do{let y=p.next.next;for(;y!==p.prev;){if(p.i!==y.i&&Xm(p,y)){let x=tp(p,y);return p=Gr(p,p.next),x=Gr(x,x.next),Gc(p,e,i,o,u,d,0),void Gc(x,e,i,o,u,d,0)}y=y.next}p=p.next}while(p!==n)}function Yf(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function em(n,e){const i=(function(u,d){let p=d;const y=u.x,x=u.y;let T,E=-1/0;if(Xu(u,p))return p;do{if(Xu(u,p.next))return p.next;if(x<=p.y&&x>=p.next.y&&p.next.y!==p.y){const k=p.x+(x-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(k<=y&&k>E&&(E=k,T=p.x<p.next.x?p:p.next,k===y))return T}p=p.next}while(p!==d);if(!T)return null;const C=T,D=T.x,P=T.y;let O=1/0;p=T;do{if(y>=p.x&&p.x>=D&&y!==p.x&&ep(x<P?y:E,x,D,P,x<P?E:y,x,p.x,p.y)){const k=Math.abs(x-p.y)/(y-p.x);qc(p,u)&&(k<O||k===O&&(p.x>T.x||p.x===T.x&&Jo(T,p)))&&(T=p,O=k)}p=p.next}while(p!==C);return T})(n,e);if(!i)return e;const o=tp(i,n);return Gr(o,o.next),Gr(i,i.next)}function Jo(n,e){return mn(n.prev,n,e.prev)<0&&mn(e.next,n,n.next)<0}function Dn(n,e,i,o,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*u|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Jd(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function ep(n,e,i,o,u,d,p,y){return(u-p)*(e-y)>=(n-p)*(d-y)&&(n-p)*(o-y)>=(i-p)*(e-y)&&(i-p)*(d-y)>=(u-p)*(o-y)}function Pn(n,e,i,o,u,d,p,y){return!(n===p&&e===y)&&ep(n,e,i,o,u,d,p,y)}function Xm(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!(function(i,o){let u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==o.i&&u.next.i!==o.i&&on(u,u.next,i,o))return!0;u=u.next}while(u!==i);return!1})(n,e)&&(qc(n,e)&&qc(e,n)&&(function(i,o){let u=i,d=!1;const p=(i.x+o.x)/2,y=(i.y+o.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&p<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(d=!d),u=u.next;while(u!==i);return d})(n,e)&&(mn(n.prev,n,e.prev)||mn(n,e.prev,e))||Xu(n,e)&&mn(n.prev,n,n.next)>0&&mn(e.prev,e,e.next)>0)}function mn(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Xu(n,e){return n.x===e.x&&n.y===e.y}function on(n,e,i,o){const u=ds(mn(n,e,i)),d=ds(mn(n,e,o)),p=ds(mn(i,o,n)),y=ds(mn(i,o,e));return u!==d&&p!==y||!(u!==0||!Ir(n,i,e))||!(d!==0||!Ir(n,o,e))||!(p!==0||!Ir(i,n,o))||!(y!==0||!Ir(i,e,o))}function Ir(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function ds(n){return n>0?1:n<0?-1:0}function qc(n,e){return mn(n.prev,n,n.next)<0?mn(n,e,n.next)>=0&&mn(n,n.prev,e)>=0:mn(n,e,n.prev)<0||mn(n,n.next,e)<0}function tp(n,e){const i=Zc(n.i,n.x,n.y),o=Zc(e.i,e.x,e.y),u=n.next,d=e.prev;return n.next=e,e.prev=n,i.next=u,u.prev=i,o.next=i,i.prev=o,d.next=o,o.prev=d,o}function ip(n,e,i,o){const u=Zc(n,e,i);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function qh(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Zc(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class sr{constructor(e,i){if(i>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=i}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Ma{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Ma.noSubdivision=new Ma({fill:new sr(0,0),line:new sr(0,0),tile:new sr(0,0),stencil:new sr(0,0),circle:1}),nt("SubdivisionGranularityExpression",sr),nt("SubdivisionGranularitySetting",Ma);const Yu=-32768,mr=32767;class tm{constructor(e,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=wt/e,this._canonical=i}_getKey(e,i){return(e+=32768)<<16|i+32768}_vertexToIndex(e,i){if(e<-32768||i<-32768||e>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(e),u=0|Math.round(i),d=this._getKey(o,u);if(this._vertexDictionary.has(d))return this._vertexDictionary.get(d);const p=this._vertexBuffer.length/2;return this._vertexDictionary.set(d,p),this._vertexBuffer.push(o,u),p}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(u,d){const p=[];for(let y=0;y<d.length;y+=3){const x=d[y],T=d[y+1],E=d[y+2],C=u[2*x],D=u[2*x+1];(u[2*T]-C)*(u[2*E+1]-D)-(u[2*T+1]-D)*(u[2*E]-C)>0?(p.push(x),p.push(E),p.push(T)):(p.push(x),p.push(T),p.push(E))}return p})(this._vertexBuffer,e);const i=[],o=e.length;for(let u=0;u<o;u+=3){const d=[e[u+0],e[u+1],e[u+2]],p=[this._vertexBuffer[2*e[u+0]+0],this._vertexBuffer[2*e[u+0]+1],this._vertexBuffer[2*e[u+1]+0],this._vertexBuffer[2*e[u+1]+1],this._vertexBuffer[2*e[u+2]+0],this._vertexBuffer[2*e[u+2]+1]];let y=1/0,x=1/0,T=-1/0,E=-1/0;for(let k=0;k<3;k++){const N=p[2*k],G=p[2*k+1];y=Math.min(y,N),T=Math.max(T,N),x=Math.min(x,G),E=Math.max(E,G)}if(y===T||x===E)continue;const C=Math.floor(y/this._granularityCellSize),D=Math.ceil(T/this._granularityCellSize),P=Math.floor(x/this._granularityCellSize),O=Math.ceil(E/this._granularityCellSize);if(C!==D||P!==O)for(let k=P;k<O;k++){const N=this._scanlineGenerateVertexRingForCellRow(k,p,d);el(this._vertexBuffer,N,i)}else i.push(...d)}return i}_scanlineGenerateVertexRingForCellRow(e,i,o){const u=e*this._granularityCellSize,d=u+this._granularityCellSize,p=[];for(let y=0;y<3;y++){const x=i[2*y],T=i[2*y+1],E=i[2*(y+1)%6],C=i[(2*(y+1)+1)%6],D=i[2*(y+2)%6],P=i[(2*(y+2)+1)%6],O=E-x,k=C-T,N=O===0,G=k===0,J=(u-T)/k,q=(d-T)/k,$=Math.min(J,q),te=Math.max(J,q);if(!G&&($>=1||te<=0)||G&&(T<u||T>d)){C>=u&&C<=d&&p.push(o[(y+1)%3]);continue}!G&&$>0&&p.push(this._vertexToIndex(x+O*$,T+k*$));const ne=x+O*Math.max($,0),be=x+O*Math.min(te,1);N||this._generateIntraEdgeVertices(p,x,T,E,C,ne,be),!G&&te<1&&p.push(this._vertexToIndex(x+O*te,T+k*te)),(G||C>=u&&C<=d)&&p.push(o[(y+1)%3]),!G&&(C<=u||C>=d)&&this._generateInterEdgeVertices(p,x,T,E,C,D,P,be,u,d)}return p}_generateIntraEdgeVertices(e,i,o,u,d,p,y){const x=u-i,T=d-o,E=T===0,C=E?Math.min(i,u):Math.min(p,y),D=E?Math.max(i,u):Math.max(p,y),P=Math.floor(C/this._granularityCellSize)+1,O=Math.ceil(D/this._granularityCellSize)-1;if(E?i<u:p<y)for(let k=P;k<=O;k++){const N=k*this._granularityCellSize;e.push(this._vertexToIndex(N,o+T*(N-i)/x))}else for(let k=O;k>=P;k--){const N=k*this._granularityCellSize;e.push(this._vertexToIndex(N,o+T*(N-i)/x))}}_generateInterEdgeVertices(e,i,o,u,d,p,y,x,T,E){const C=d-o,D=p-u,P=y-d,O=(T-d)/P,k=(E-d)/P,N=Math.min(O,k),G=Math.max(O,k),J=u+D*N;let q=Math.floor(Math.min(J,x)/this._granularityCellSize)+1,$=Math.ceil(Math.max(J,x)/this._granularityCellSize)-1,te=x<J;const ne=P===0;if(ne&&(y===T||y===E))return;if(ne||N>=1||G<=0){const Ne=o-y,Oe=p+(i-p)*Math.min((T-y)/Ne,(E-y)/Ne);q=Math.floor(Math.min(Oe,x)/this._granularityCellSize)+1,$=Math.ceil(Math.max(Oe,x)/this._granularityCellSize)-1,te=x<Oe}const be=C>0?E:T;if(te)for(let Ne=q;Ne<=$;Ne++)e.push(this._vertexToIndex(Ne*this._granularityCellSize,be));else for(let Ne=$;Ne>=q;Ne--)e.push(this._vertexToIndex(Ne*this._granularityCellSize,be))}_generateOutline(e){const i=[];for(const o of e){const u=Va(o,this._granularity,!0),d=this._pointArrayToIndices(u),p=[];for(let y=1;y<d.length;y++)p.push(d[y-1]),p.push(d[y]);i.push(p)}return i}_handlePoles(e){let i=!1,o=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(i||o)&&this._fillPoles(e,i,o)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let i=0;i<e.length;i+=2){const o=e[i+1];o===Yu&&(e[i+1]=-32767),o===mr&&(e[i+1]=32766)}}_generatePoleQuad(e,i,o,u,d,p){u>d!=(p===Yu)?(e.push(i),e.push(o),e.push(this._vertexToIndex(u,p)),e.push(o),e.push(this._vertexToIndex(d,p)),e.push(this._vertexToIndex(u,p))):(e.push(o),e.push(i),e.push(this._vertexToIndex(u,p)),e.push(this._vertexToIndex(d,p)),e.push(o),e.push(this._vertexToIndex(u,p)))}_fillPoles(e,i,o){const u=this._vertexBuffer,d=wt,p=e.length;for(let y=2;y<p;y+=3){const x=e[y-2],T=e[y-1],E=e[y],C=u[2*x],D=u[2*x+1],P=u[2*T],O=u[2*T+1],k=u[2*E],N=u[2*E+1];i&&(D===0&&O===0&&this._generatePoleQuad(e,x,T,C,P,Yu),O===0&&N===0&&this._generatePoleQuad(e,T,E,P,k,Yu),N===0&&D===0&&this._generatePoleQuad(e,E,x,k,C,Yu)),o&&(D===d&&O===d&&this._generatePoleQuad(e,x,T,C,P,mr),O===d&&N===d&&this._generatePoleQuad(e,T,E,P,k,mr),N===d&&D===d&&this._generatePoleQuad(e,E,x,k,C,mr))}}_initializeVertices(e){for(let i=0;i<e.length;i+=2)this._vertexToIndex(e[i],e[i+1])}subdividePolygonInternal(e,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:u}=(function(y){const x=[],T=[];for(const E of y)if(E.length!==0){E!==y[0]&&x.push(T.length/2);for(let C=0;C<E.length;C++)T.push(E[C].x),T.push(E[C].y)}return{flattened:T,holeIndices:x}})(e);let d;this._initializeVertices(o);try{const y=(function(T,E,C=2){const D=E&&E.length,P=D?E[0]*C:T.length;let O=Uc(T,0,P,C,!0);const k=[];if(!O||O.next===O.prev)return k;let N,G,J;if(D&&(O=(function(q,$,te,ne){const be=[];for(let Ne=0,Oe=$.length;Ne<Oe;Ne++){const $e=Uc(q,$[Ne]*ne,Ne<Oe-1?$[Ne+1]*ne:q.length,ne,!1);$e===$e.next&&($e.steiner=!0),be.push(Jd($e))}be.sort(Yf);for(let Ne=0;Ne<be.length;Ne++)te=em(be[Ne],te);return te})(T,E,O,C)),T.length>80*C){N=T[0],G=T[1];let q=N,$=G;for(let te=C;te<P;te+=C){const ne=T[te],be=T[te+1];ne<N&&(N=ne),be<G&&(G=be),ne>q&&(q=ne),be>$&&($=be)}J=Math.max(q-N,$-G),J=J!==0?32767/J:0}return Gc(O,k,C,N,G,J,0),k})(o,u),x=this._convertIndices(o,y);d=this._subdivideTrianglesScanline(x)}catch(y){console.error(y)}let p=[];return i&&(p=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(d),{verticesFlattened:this._vertexBuffer,indicesTriangles:d,indicesLineList:p}}_convertIndices(e,i){const o=[];for(let u=0;u<i.length;u++)o.push(this._vertexToIndex(e[2*i[u]],e[2*i[u]+1]));return o}_pointArrayToIndices(e){const i=[];for(let o=0;o<e.length;o++){const u=e[o];i.push(this._vertexToIndex(u.x,u.y))}return i}}function To(n,e,i,o=!0){return new tm(i,e).subdividePolygonInternal(n,o)}function Va(n,e,i=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const o=n[0],u=n[n.length-1],d=i&&(o.x!==u.x||o.y!==u.y);if(e<2)return d?[...n,n[0]]:[...n];const p=Math.floor(wt/e),y=[];y.push(new me(n[0].x,n[0].y));const x=n.length,T=d?x:x-1;for(let E=0;E<T;E++){const C=n[E],D=E<x-1?n[E+1]:n[0],P=C.x,O=C.y,k=D.x,N=D.y,G=P!==k,J=O!==N;if(!G&&!J)continue;const q=k-P,$=N-O,te=Math.abs(q),ne=Math.abs($);let be=P,Ne=O;for(;;){const $e=q>0?(Math.floor(be/p)+1)*p:(Math.ceil(be/p)-1)*p,tt=$>0?(Math.floor(Ne/p)+1)*p:(Math.ceil(Ne/p)-1)*p,Ye=Math.abs(be-$e),ke=Math.abs(Ne-tt),ze=Math.abs(be-k),ut=Math.abs(Ne-N),ot=G?Ye/te:Number.POSITIVE_INFINITY,ht=J?ke/ne:Number.POSITIVE_INFINITY;if((ze<=Ye||!G)&&(ut<=ke||!J))break;if(ot<ht&&G||!J){be=$e,Ne+=$*ot;const at=new me(be,Math.round(Ne));y[y.length-1].x===at.x&&y[y.length-1].y===at.y||y.push(at)}else{be+=q*ht,Ne=tt;const at=new me(Math.round(be),Ne);y[y.length-1].x===at.x&&y[y.length-1].y===at.y||y.push(at)}}const Oe=new me(k,N);y[y.length-1].x===Oe.x&&y[y.length-1].y===Oe.y||y.push(Oe)}return y}function el(n,e,i){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,u=n[2*e[0]];for(let x=1;x<e.length;x++){const T=n[2*e[x]];T<u&&(u=T,o=x)}const d=e.length;let p=o,y=(p+1)%d;for(;;){const x=p-1>=0?p-1:d-1,T=(y+1)%d,E=n[2*e[x]],C=n[2*e[T]],D=n[2*e[p]],P=n[2*e[p]+1],O=n[2*e[y]+1];let k=!1;if(E<C)k=!0;else if(E>C)k=!1;else{const N=O-P,G=-(n[2*e[y]]-D),J=P<O?1:-1;((E-D)*N+(n[2*e[x]+1]-P)*G)*J>((C-D)*N+(n[2*e[T]+1]-P)*G)*J&&(k=!0)}if(k){const N=e[x],G=e[p],J=e[y];N!==G&&N!==J&&G!==J&&i.push(J,G,N),p--,p<0&&(p=d-1)}else{const N=e[T],G=e[p],J=e[y];N!==G&&N!==J&&G!==J&&i.push(J,G,N),y++,y>=d&&(y=0)}if(x===T)break}}function Qf(n,e,i,o,u,d,p,y,x){const T=u.length/2,E=p&&y&&x;if(T<He.MAX_VERTEX_ARRAY_LENGTH){const C=e.prepareSegment(T,i,o),D=C.vertexLength;for(let k=0;k<d.length;k+=3)o.emplaceBack(D+d[k],D+d[k+1],D+d[k+2]);let P,O;C.vertexLength+=T,C.primitiveLength+=d.length/3,E&&(O=p.prepareSegment(T,i,y),P=O.vertexLength,O.vertexLength+=T);for(let k=0;k<u.length;k+=2)n(u[k],u[k+1]);if(E)for(let k=0;k<x.length;k++){const N=x[k];for(let G=1;G<N.length;G+=2)y.emplaceBack(P+N[G-1],P+N[G]);O.primitiveLength+=N.length/2}}else(function(C,D,P,O,k,N){const G=[];for(let ne=0;ne<O.length/2;ne++)G.push(-1);const J={count:0};let q=0,$=C.getOrCreateLatestSegment(D,P),te=$.vertexLength;for(let ne=2;ne<k.length;ne+=3){const be=k[ne-2],Ne=k[ne-1],Oe=k[ne];let $e=G[be]<q,tt=G[Ne]<q,Ye=G[Oe]<q;$.vertexLength+(($e?1:0)+(tt?1:0)+(Ye?1:0))>He.MAX_VERTEX_ARRAY_LENGTH&&($=C.createNewSegment(D,P),q=J.count,$e=!0,tt=!0,Ye=!0,te=0);const ke=Qu(G,O,N,J,be,$e,$),ze=Qu(G,O,N,J,Ne,tt,$),ut=Qu(G,O,N,J,Oe,Ye,$);P.emplaceBack(te+ke-q,te+ze-q,te+ut-q),$.primitiveLength++}})(e,i,o,u,d,n),E&&(function(C,D,P,O,k,N){const G=[];for(let ne=0;ne<O.length/2;ne++)G.push(-1);const J={count:0};let q=0,$=C.getOrCreateLatestSegment(D,P),te=$.vertexLength;for(let ne=0;ne<k.length;ne++){const be=k[ne];for(let Ne=1;Ne<k[ne].length;Ne+=2){const Oe=be[Ne-1],$e=be[Ne];let tt=G[Oe]<q,Ye=G[$e]<q;$.vertexLength+((tt?1:0)+(Ye?1:0))>He.MAX_VERTEX_ARRAY_LENGTH&&($=C.createNewSegment(D,P),q=J.count,tt=!0,Ye=!0,te=0);const ke=Qu(G,O,N,J,Oe,tt,$),ze=Qu(G,O,N,J,$e,Ye,$);P.emplaceBack(te+ke-q,te+ze-q),$.primitiveLength++}}})(p,i,y,u,x,n),e.forceNewSegmentOnNextPrepare(),p?.forceNewSegmentOnNextPrepare()}function Qu(n,e,i,o,u,d,p){if(d){const y=o.count;return i(e[2*u],e[2*u+1]),n[u]=o.count,o.count++,p.vertexLength++,y}return n[u]}class ja{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new U,this.indexArray=new Me,this.indexArray2=new xe,this.programConfigurations=new ji(e.layers,e.zoom),this.segments=new He,this.segments2=new He,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=Gh("fill",this.layers,i);const u=this.layers[0].layout.get("fill-sort-key"),d=!u.isConstant(),p=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:E}of e){const C=this.layers[0]._featureFilter.needGeometry,D=xo(y,C);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),D,o))continue;const P=d?u.evaluate(D,{},o,i.availableImages):void 0,O={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:C?D.geometry:ca(y),patterns:{},sortKey:P};p.push(O)}d&&p.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of p){const{geometry:x,index:T,sourceLayerIndex:E}=y;if(this.hasDependencies){const C=Xf("fill",this.layers,y,{zoom:this.zoom},i);this.patternFeatures.push(C)}else this.addFeature(y,x,T,o,{},i.subdivisionGranularity);i.featureIndex.insert(e[T].feature,x,T,E,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}addFeatures(e,i,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,i,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$l),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,u,d,p){for(const y of wu(i,500)){const x=To(y,u,p.fill.getGranularityForZoomLevel(u.z)),T=this.layoutVertexArray;Qf(((E,C)=>{T.emplaceBack(E,C)}),this.segments,this.layoutVertexArray,this.indexArray,x.verticesFlattened,x.indicesTriangles,this.segments2,this.indexArray2,x.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:d,canonical:u})}}let np,Wu;nt("FillBucket",ja,{omit:["layers","patternFeatures"]});var Zh={get paint(){return Wu=Wu||new dn({"fill-antialias":new dt(ve.paint_fill["fill-antialias"]),"fill-opacity":new xt(ve.paint_fill["fill-opacity"]),"fill-color":new xt(ve.paint_fill["fill-color"]),"fill-outline-color":new xt(ve.paint_fill["fill-outline-color"]),"fill-translate":new dt(ve.paint_fill["fill-translate"]),"fill-translate-anchor":new dt(ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new yo(ve.paint_fill["fill-pattern"])})},get layout(){return np=np||new dn({"fill-sort-key":new xt(ve.layout_fill["fill-sort-key"])})}};class Hh extends Dr{constructor(e,i){super(e,Zh,i)}recalculate(e,i){super.recalculate(e,i);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new ja(e)}queryRadius(){return Hl(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:i,transform:o,pixelsToTileUnits:u}){return Nc(kh(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,u),i)}isTileClipped(){return!0}}const Hc=vt([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),im=vt([{name:"a_centroid",components:2,type:"Int16"}],4),{members:nm}=Hc;class tl{constructor(e,i,o,u,d){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=d,e.readFields(rm,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,o=[];let u,d=1,p=0,y=0,x=0;for(;e.pos<i;){if(p<=0){const T=e.readVarint();d=7&T,p=T>>3}if(p--,d===1||d===2)y+=e.readSVarint(),x+=e.readSVarint(),d===1&&(u&&o.push(u),u=[]),u&&u.push(new me(y,x));else{if(d!==7)throw new Error(`unknown command ${d}`);u&&u.push(u[0].clone())}}return u&&o.push(u),o}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let o=1,u=0,d=0,p=0,y=1/0,x=-1/0,T=1/0,E=-1/0;for(;e.pos<i;){if(u<=0){const C=e.readVarint();o=7&C,u=C>>3}if(u--,o===1||o===2)d+=e.readSVarint(),p+=e.readSVarint(),d<y&&(y=d),d>x&&(x=d),p<T&&(T=p),p>E&&(E=p);else if(o!==7)throw new Error(`unknown command ${o}`)}return[y,T,x,E]}toGeoJSON(e,i,o){const u=this.extent*Math.pow(2,o),d=this.extent*e,p=this.extent*i,y=this.loadGeometry();function x(D){return[360*(D.x+d)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+p)/u)*Math.PI))-90]}function T(D){return D.map(x)}let E;if(this.type===1){const D=[];for(const O of y)D.push(O[0]);const P=T(D);E=D.length===1?{type:"Point",coordinates:P[0]}:{type:"MultiPoint",coordinates:P}}else if(this.type===2){const D=y.map(T);E=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{const D=$h(y),P=[];for(const O of D)P.push(O.map(T));E=P.length===1?{type:"Polygon",coordinates:P[0]}:{type:"MultiPolygon",coordinates:P}}}const C={type:"Feature",geometry:E,properties:this.properties};return this.id!=null&&(C.id=this.id),C}}function rm(n,e,i){n===1?e.id=i.readVarint():n===2?(function(o,u){const d=o.readVarint()+o.pos;for(;o.pos<d;){const p=u._keys[o.readVarint()],y=u._values[o.readVarint()];u.properties[p]=y}})(i,e):n===3?e.type=i.readVarint():n===4&&(e._geometry=i.pos)}function $h(n){const e=n.length;if(e<=1)return[n];const i=[];let o,u;for(let d=0;d<e;d++){const p=am(n[d]);p!==0&&(u===void 0&&(u=p<0),u===p<0?(o&&i.push(o),o=[n[d]]):o&&o.push(n[d]))}return o&&i.push(o),i}function am(n){let e=0;for(let i,o,u=0,d=n.length,p=d-1;u<d;p=u++)i=n[u],o=n[p],e+=(o.x-i.x)*(i.y+o.y);return e}tl.types=["Unknown","Point","LineString","Polygon"];class Ym{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Qm,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new tl(this._pbf,i,this.extent,this._keys,this._values)}}function Qm(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push((function(o){let u=null;const d=o.readVarint()+o.pos;for(;o.pos<d;){const p=o.readVarint()>>3;u=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(i))}class vi{constructor(e,i){this.layers=e.readFields(Gi,{},i)}}function Gi(n,e,i){if(n===3){const o=new Ym(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}const Wt=Math.pow(2,13);function Yt(n,e,i,o,u,d,p,y){n.emplaceBack(e,i,2*Math.floor(o*Wt)+p,u*Wt*2,d*Wt*2,Math.round(y))}class Di{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new X,this.centroidVertexArray=new I,this.indexArray=new Me,this.programConfigurations=new ji(e.layers,e.zoom),this.segments=new He,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.features=[],this.hasDependencies=Gh("fill-extrusion",this.layers,i);for(const{feature:u,id:d,index:p,sourceLayerIndex:y}of e){const x=this.layers[0]._featureFilter.needGeometry,T=xo(u,x);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),T,o))continue;const E={id:d,sourceLayerIndex:y,index:p,geometry:x?T.geometry:ca(u),properties:u.properties,type:u.type,patterns:{}};this.hasDependencies?this.features.push(Xf("fill-extrusion",this.layers,E,{zoom:this.zoom},i)):this.addFeature(E,E.geometry,p,o,{},i.subdivisionGranularity),i.featureIndex.insert(u,E.geometry,p,y,this.index,!0)}}addFeatures(e,i,o){for(const u of this.features){const{geometry:d}=u;this.addFeature(u,d,u.index,i,o,e.subdivisionGranularity)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nm),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,im.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,i,o,u,d,p){for(const y of wu(i,500)){const x={x:0,y:0,sampleCount:0},T=this.layoutVertexArray.length;this.processPolygon(x,u,e,y,p);const E=this.layoutVertexArray.length-T,C=Math.floor(x.x/x.sampleCount),D=Math.floor(x.y/x.sampleCount);for(let P=0;P<E;P++)this.centroidVertexArray.emplaceBack(C,D)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:d,canonical:u})}processPolygon(e,i,o,u,d){if(u.length<1||Ku(u[0]))return;for(const C of u)C.length!==0&&Ua(e,C);const p={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},y=d.fill.getGranularityForZoomLevel(i.z),x=tl.types[o.type]==="Polygon";for(const C of u){if(C.length===0||Ku(C))continue;const D=Va(C,y,x);this._generateSideFaces(D,p)}if(!x)return;const T=To(u,i,y,!1),E=this.layoutVertexArray;Qf(((C,D)=>{Yt(E,C,D,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles)}_generateSideFaces(e,i){let o=0;for(let u=1;u<e.length;u++){const d=e[u],p=e[u-1];if(Xl(d,p))continue;i.segment.vertexLength+4>He.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const y=d.sub(p)._perp()._unit(),x=p.dist(d);o+x>32768&&(o=0),Yt(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,0,o),Yt(this.layoutVertexArray,d.x,d.y,y.x,y.y,0,1,o),o+=x,Yt(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,0,o),Yt(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,1,o);const T=i.segment.vertexLength;this.indexArray.emplaceBack(T,T+2,T+1),this.indexArray.emplaceBack(T+1,T+2,T+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function Ua(n,e){for(let i=0;i<e.length;i++){const o=e[i];i===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(n.x+=o.x,n.y+=o.y,n.sampleCount++)}}function Xl(n,e){return n.x===e.x&&(n.x<0||n.x>wt)||n.y===e.y&&(n.y<0||n.y>wt)}function Ku(n){return n.every((e=>e.x<0))||n.every((e=>e.x>wt))||n.every((e=>e.y<0))||n.every((e=>e.y>wt))}let Wf;nt("FillExtrusionBucket",Di,{omit:["layers","features"]});var il={get paint(){return Wf=Wf||new dn({"fill-extrusion-opacity":new dt(ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new xt(ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new dt(ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new dt(ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yo(ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new xt(ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new xt(ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new dt(ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class In extends Dr{constructor(e,i){super(e,il,i)}createBucket(e){return new Di(e)}queryRadius(){return Hl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:d,pixelsToTileUnits:p,pixelPosMatrix:y}){const x=kh(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-d.bearingInRadians,p),T=this.paint.get("fill-extrusion-height").evaluate(i,o),E=this.paint.get("fill-extrusion-base").evaluate(i,o),C=(function(P,O){const k=[];for(const N of P){const G=[N.x,N.y,0,1];Qr(G,G,O),k.push(new me(G[0]/G[3],G[1]/G[3]))}return k})(x,y),D=(function(P,O,k,N){const G=[],J=[],q=N[8]*O,$=N[9]*O,te=N[10]*O,ne=N[11]*O,be=N[8]*k,Ne=N[9]*k,Oe=N[10]*k,$e=N[11]*k;for(const tt of P){const Ye=[],ke=[];for(const ze of tt){const ut=ze.x,ot=ze.y,ht=N[0]*ut+N[4]*ot+N[12],at=N[1]*ut+N[5]*ot+N[13],yt=N[2]*ut+N[6]*ot+N[14],oi=N[3]*ut+N[7]*ot+N[15],Ht=yt+te,un=oi+ne,$r=ht+be,Kn=at+Ne,cn=yt+Oe,Ki=oi+$e,Ti=new me((ht+q)/un,(at+$)/un);Ti.z=Ht/un,Ye.push(Ti);const wn=new me($r/Ki,Kn/Ki);wn.z=cn/Ki,ke.push(wn)}G.push(Ye),J.push(ke)}return[G,J]})(u,E,T,y);return(function(P,O,k){let N=1/0;Nc(k,O)&&(N=Yl(k,O[0]));for(let G=0;G<O.length;G++){const J=O[G],q=P[G];for(let $=0;$<J.length-1;$++){const te=J[$],ne=[te,J[$+1],q[$+1],q[$],te];Fc(k,ne)&&(N=Math.min(N,Yl(k,ne)))}}return N!==1/0&&N})(D[0],D[1],C)}}function ps(n,e){return n.x*e.x+n.y*e.y}function Yl(n,e){if(n.length===1){let i=0;const o=e[i++];let u;for(;!u||o.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const d=e[i],p=n[0],y=u.sub(o),x=d.sub(o),T=p.sub(o),E=ps(y,y),C=ps(y,x),D=ps(x,x),P=ps(T,y),O=ps(T,x),k=E*D-C*C,N=(D*P-C*O)/k,G=(E*O-C*P)/k,J=o.z*(1-N-G)+u.z*N+d.z*G;if(isFinite(J))return J}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}const rp=vt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ga}=rp,$c=vt([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Xh}=$c,Ea=Math.cos(Math.PI/180*37.5),Kf=Math.pow(2,14)/.5;class Xc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new Q,this.layoutVertexArray2=new Y,this.indexArray=new Me,this.programConfigurations=new ji(e.layers,e.zoom),this.segments=new He,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=Gh("line",this.layers,i)||this.hasLineDasharray(this.layers);const u=this.layers[0].layout.get("line-sort-key"),d=!u.isConstant(),p=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:E}of e){const C=this.layers[0]._featureFilter.needGeometry,D=xo(y,C);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),D,o))continue;const P=d?u.evaluate(D,{},o):void 0,O={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:C?D.geometry:ca(y),patterns:{},dashes:{},sortKey:P};p.push(O)}d&&p.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of p){const{geometry:x,index:T,sourceLayerIndex:E}=y;this.hasDependencies?(Gh("line",this.layers,i)?Xf("line",this.layers,y,{zoom:this.zoom},i):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,y,this.zoom,i),this.patternFeatures.push(y)):this.addFeature(y,x,T,o,{},{},i.subdivisionGranularity),i.featureIndex.insert(e[T].feature,x,T,E,this.index)}}update(e,i,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o,dashPositions:u})}addFeatures(e,i,o,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,i,o,u,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Xh)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ga),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,u,d,p,y){const x=this.layers[0].layout,T=x.get("line-join").evaluate(e,{}),E=x.get("line-cap"),C=x.get("line-miter-limit"),D=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of i)this.addLine(P,e,T,E,C,D,u,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:d,dashPositions:p,canonical:u})}addLine(e,i,o,u,d,p,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Va(e,y?x.line.getGranularityForZoomLevel(y.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let q=0;q<e.length-1;q++)this.totalDistance+=e[q].dist(e[q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=tl.types[i.type]==="Polygon";let E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let C=0;for(;C<E-1&&e[C].equals(e[C+1]);)C++;if(E<(T?3:2))return;o==="bevel"&&(d=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let O,k,N,G,J;this.e1=this.e2=-1,T&&(O=e[E-2],J=e[C].sub(O)._unit()._perp());for(let q=C;q<E;q++){if(N=q===E-1?T?e[C+1]:void 0:e[q+1],N&&e[q].equals(N))continue;J&&(G=J),O&&(k=O),O=e[q],J=N?N.sub(O)._unit()._perp():G,G=G||J;let $=G.add(J);$.x===0&&$.y===0||$._unit();const te=G.x*J.x+G.y*J.y,ne=$.x*J.x+$.y*J.y,be=ne!==0?1/ne:1/0,Ne=2*Math.sqrt(2-2*ne),Oe=ne<Ea&&k&&N,$e=G.x*J.y-G.y*J.x>0;if(Oe&&q>C){const ke=O.dist(k);if(ke>2*D){const ze=O.sub(O.sub(k)._mult(D/ke)._round());this.updateDistance(k,ze),this.addCurrentVertex(ze,G,0,0,P),k=ze}}const tt=k&&N;let Ye=tt?o:T?"butt":u;if(tt&&Ye==="round"&&(be<p?Ye="miter":be<=2&&(Ye="fakeround")),Ye==="miter"&&be>d&&(Ye="bevel"),Ye==="bevel"&&(be>2&&(Ye="flipbevel"),be<d&&(Ye="miter")),k&&this.updateDistance(k,O),Ye==="miter")$._mult(be),this.addCurrentVertex(O,$,0,0,P);else if(Ye==="flipbevel"){if(be>100)$=J.mult(-1);else{const ke=be*G.add(J).mag()/G.sub(J).mag();$._perp()._mult(ke*($e?-1:1))}this.addCurrentVertex(O,$,0,0,P),this.addCurrentVertex(O,$.mult(-1),0,0,P)}else if(Ye==="bevel"||Ye==="fakeround"){const ke=-Math.sqrt(be*be-1),ze=$e?ke:0,ut=$e?0:ke;if(k&&this.addCurrentVertex(O,G,ze,ut,P),Ye==="fakeround"){const ot=Math.round(180*Ne/Math.PI/20);for(let ht=1;ht<ot;ht++){let at=ht/ot;if(at!==.5){const oi=at-.5;at+=at*oi*(at-1)*((1.0904+te*(te*(3.55645-1.43519*te)-3.2452))*oi*oi+(.848013+te*(.215638*te-1.06021)))}const yt=J.sub(G)._mult(at)._add(G)._unit()._mult($e?-1:1);this.addHalfVertex(O,yt.x,yt.y,!1,$e,0,P)}}N&&this.addCurrentVertex(O,J,-ze,-ut,P)}else if(Ye==="butt")this.addCurrentVertex(O,$,0,0,P);else if(Ye==="square"){const ke=k?1:-1;this.addCurrentVertex(O,$,ke,ke,P)}else Ye==="round"&&(k&&(this.addCurrentVertex(O,G,0,0,P),this.addCurrentVertex(O,G,1,1,P,!0)),N&&(this.addCurrentVertex(O,J,-1,-1,P,!0),this.addCurrentVertex(O,J,0,0,P)));if(Oe&&q<E-1){const ke=O.dist(N);if(ke>2*D){const ze=O.add(N.sub(O)._mult(D/ke)._round());this.updateDistance(O,ze),this.addCurrentVertex(ze,J,0,0,P),O=ze}}}}addCurrentVertex(e,i,o,u,d,p=!1){const y=i.y*u-i.x,x=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,p,!1,o,d),this.addHalfVertex(e,y,x,p,!0,-u,d),this.distance>Kf/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,i,o,u,d,p))}addHalfVertex({x:e,y:i},o,u,d,p,y,x){const T=.5*(this.lineClips?this.scaledDistance*(Kf-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(i<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,E,this.e2),x.primitiveLength++),p?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}hasLineDasharray(e){for(const i of e){const o=i.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(e,i,o,u){for(const d of e){const p=d.paint.get("line-dasharray");if(!p||p.value.kind==="constant")continue;const y=d.layout.get("line-cap")==="round",x={dasharray:p.value.evaluate({zoom:o-1},i,{}),round:y},T={dasharray:p.value.evaluate({zoom:o},i,{}),round:y},E={dasharray:p.value.evaluate({zoom:o+1},i,{}),round:y},C=`${x.dasharray.join(",")},${x.round}`,D=`${T.dasharray.join(",")},${T.round}`,P=`${E.dasharray.join(",")},${E.round}`;u.dashDependencies[C]=x,u.dashDependencies[D]=T,u.dashDependencies[P]=E,i.dashes[d.id]={min:C,mid:D,max:P}}}}let ap,Yh;nt("LineBucket",Xc,{omit:["layers","patternFeatures"]});var Qh={get paint(){return Yh=Yh||new dn({"line-opacity":new xt(ve.paint_line["line-opacity"]),"line-color":new xt(ve.paint_line["line-color"]),"line-translate":new dt(ve.paint_line["line-translate"]),"line-translate-anchor":new dt(ve.paint_line["line-translate-anchor"]),"line-width":new xt(ve.paint_line["line-width"]),"line-gap-width":new xt(ve.paint_line["line-gap-width"]),"line-offset":new xt(ve.paint_line["line-offset"]),"line-blur":new xt(ve.paint_line["line-blur"]),"line-dasharray":new yo(ve.paint_line["line-dasharray"]),"line-pattern":new yo(ve.paint_line["line-pattern"]),"line-gradient":new $n(ve.paint_line["line-gradient"])})},get layout(){return ap=ap||new dn({"line-cap":new dt(ve.layout_line["line-cap"]),"line-join":new xt(ve.layout_line["line-join"]),"line-miter-limit":new dt(ve.layout_line["line-miter-limit"]),"line-round-limit":new dt(ve.layout_line["line-round-limit"]),"line-sort-key":new xt(ve.layout_line["line-sort-key"])})}};class Ql extends xt{possiblyEvaluate(e,i){return i=new Qt(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,u){return i=Si({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,u)}}let Rn;class Wl extends Dr{constructor(e,i){super(e,Qh,i),this.gradientVersion=0,Rn||(Rn=new Ql(Qh.paint.properties["line-width"].specification),Rn.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(i)&&i._styleExpression.expression instanceof eo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,i){super.recalculate(e,i),this.paint._values["line-floorwidth"]=Rn.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Xc(e)}queryRadius(e){const i=e,o=Ju($u("line-width",this,i),$u("line-gap-width",this,i)),u=$u("line-offset",this,i);return o/2+Math.abs(u)+Hl(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:d,pixelsToTileUnits:p}){const y=kh(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-d.bearingInRadians,p),x=p/2*Ju(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),T=this.paint.get("line-offset").evaluate(i,o);return T&&(u=(function(E,C){const D=[];for(let P=0;P<E.length;P++){const O=jf(E[P]),k=[];for(let N=0;N<O.length;N++){const G=O[N],J=O[N-1],q=O[N+1],$=N===0?new me(0,0):G.sub(J)._unit()._perp(),te=N===O.length-1?new me(0,0):q.sub(G)._unit()._perp(),ne=$._add(te)._unit(),be=ne.x*te.x+ne.y*te.y;be!==0&&ne._mult(1/be),k.push(ne._mult(C)._add(G))}D.push(k)}return D})(u,T*p)),(function(E,C,D){for(let P=0;P<C.length;P++){const O=C[P];if(E.length>=3){for(let k=0;k<O.length;k++)if(Hu(E,O[k]))return!0}if(Vc(E,O,D))return!0}return!1})(y,u,x)}isTileClipped(){return!0}}function Ju(n,e){return e>0?e+2*n:n}const nl=vt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sp=vt([{name:"a_projected_pos",components:3,type:"Float32"}],4);vt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const op=vt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);vt([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const lp=vt([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Wh=vt([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function up(n,e,i){return n.sections.forEach((o=>{o.text=(function(u,d,p){const y=d.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),Ba.applyArabicShaping&&(u=Ba.applyArabicShaping(u)),u})(o.text,e,i)})),n}vt([{name:"triangle",components:3,type:"Uint16"}]),vt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),vt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),vt([{type:"Float32",name:"offsetX"}]),vt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),vt([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var xi=24;const Yc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},Aa={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},sm={40:!0};function cp(n,e,i,o,u,d){if("fontStack"in e){const p=i[e.fontStack],y=p&&p[n];return y?y.metrics.advance*e.scale+u:0}{const p=o[e.imageName];return p?p.displaySize[0]*e.scale*xi/d+u:0}}function om(n,e,i,o){const u=Math.pow(n-e,2);return o?n<e?u/2:2*u:u+Math.abs(i)*i}function Kl(n,e,i){let o=0;return n===10&&(o-=1e4),i&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Kh(n,e,i,o,u,d){let p=null,y=om(e,i,u,d);for(const x of o){const T=om(e-x.x,i,u,d)+x.badness;T<=y&&(p=x,y=T)}return{index:n,x:e,priorBreak:p,badness:y}}function Jf(n){return n?Jf(n.priorBreak).concat(n.index):[]}class Ns{constructor(e="",i=[],o=[]){this.text=e,this.sections=i,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(e,i){const o=new Ns;for(let u=0;u<e.sections.length;u++){const d=e.sections[u];d.image?o.addImageSection(d):o.addTextSection(d,i)}return o}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let i="",o={premature:!0,value:void 0};const u=e[Symbol.iterator]();let d=u.next();const p=e[Symbol.iterator]();p.next();let y=p.next();for(;!d.done;)i+=!y.done&&ju(y.value.codePointAt(0))&&!Yc[y.value]||!o.premature&&ju(o.value.codePointAt(0))&&!Yc[o.value]||!Yc[d.value]?d.value:Yc[d.value],o={value:d.value,premature:!1},d=u.next(),y=p.next();return i})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),i=e?e[0].length:0,o=this.text.match(/\S\s*$/),u=o?o[0].length-1:0;this.text=this.text.substring(i,this.text.length-u),this.sectionIndex=this.sectionIndex.slice(i,this.sectionIndex.length-u)}substring(e,i){const o=[...this.text].slice(e,i).join(""),u=this.sectionIndex.slice(e,i);return new Ns(o,this.sections,u)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}getMaxImageSize(e){let i=0,o=0;for(let u=0;u<this.length();u++){const d=this.getSection(u);if("imageName"in d){const p=e[d.imageName];if(!p)continue;const y=p.displaySize;i=Math.max(i,y[0]),o=Math.max(o,y[1])}}return{maxImageWidth:i,maxImageHeight:o}}addTextSection(e,i){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||i});const o=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>o)))}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void Zi("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:i}),this.sectionIndex.push(this.sections.length-1)):Zi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,i,o,u,d){const p=[],y=this.determineAverageLineWidth(e,i,o,u,d),x=this.hasZeroWidthSpaces();let T=0,E=0;const C=this.text[Symbol.iterator]();let D=C.next();const P=this.text[Symbol.iterator]();P.next();let O=P.next();const k=this.text[Symbol.iterator]();k.next(),k.next();let N=k.next();for(;!D.done;){const G=this.getSection(E),J=D.value.codePointAt(0);if(Dh(J)||(T+=cp(J,G,o,u,e,d)),!O.done){const q=qo(J),$=O.value.codePointAt(0);(Aa[J]||q||"imageName"in G||!N.done&&sm[$])&&p.push(Kh(E+1,T,y,p,Kl(J,$,q&&x),!1))}E++,D=C.next(),O=P.next(),N=k.next()}return Jf(Kh(this.length(),T,y,p,0,!0))}determineAverageLineWidth(e,i,o,u,d){let p=0,y=0;for(const x of this.text){const T=this.getSection(y);p+=cp(x.codePointAt(0),T,o,u,e,d),y++}return p/Math.max(1,Math.ceil(p/i))}}const ed=4294967296,hp=1/ed,fp=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Jh{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,i,o=this.length){for(;this.pos<o;){const u=this.readVarint(),d=u>>3,p=this.pos;this.type=7&u,e(d,i,this),this.pos===p&&this.skip(u)}return i}readMessage(e,i){return this.readFields(e,i,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*ed;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*ed;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const i=this.buf;let o,u;return u=i[this.pos++],o=127&u,u<128?o:(u=i[this.pos++],o|=(127&u)<<7,u<128?o:(u=i[this.pos++],o|=(127&u)<<14,u<128?o:(u=i[this.pos++],o|=(127&u)<<21,u<128?o:(u=i[this.pos],o|=(15&u)<<28,(function(d,p,y){const x=y.buf;let T,E;if(E=x[y.pos++],T=(112&E)>>4,E<128||(E=x[y.pos++],T|=(127&E)<<3,E<128)||(E=x[y.pos++],T|=(127&E)<<10,E<128)||(E=x[y.pos++],T|=(127&E)<<17,E<128)||(E=x[y.pos++],T|=(127&E)<<24,E<128)||(E=x[y.pos++],T|=(1&E)<<31,E<128))return rl(d,T,p);throw new Error("Expected varint not more than 10 bytes")})(o,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,i=this.pos;return this.pos=e,e-i>=12&&fp?fp.decode(this.buf.subarray(i,e)):(function(o,u,d){let p="",y=u;for(;y<d;){const x=o[y];let T,E,C,D=null,P=x>239?4:x>223?3:x>191?2:1;if(y+P>d)break;P===1?x<128&&(D=x):P===2?(T=o[y+1],(192&T)==128&&(D=(31&x)<<6|63&T,D<=127&&(D=null))):P===3?(T=o[y+1],E=o[y+2],(192&T)==128&&(192&E)==128&&(D=(15&x)<<12|(63&T)<<6|63&E,(D<=2047||D>=55296&&D<=57343)&&(D=null))):P===4&&(T=o[y+1],E=o[y+2],C=o[y+3],(192&T)==128&&(192&E)==128&&(192&C)==128&&(D=(15&x)<<18|(63&T)<<12|(63&E)<<6|63&C,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,P=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),y+=P}return p})(this.buf,i,e)}readBytes(){const e=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,e);return this.pos=e,i}readPackedVarint(e=[],i){const o=this.readPackedEnd();for(;this.pos<o;)e.push(this.readVarint(i));return e}readPackedSVarint(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const i=7&e;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(e,i){this.writeVarint(e<<3|i)}realloc(e){let i=this.length||16;for(;i<this.pos+e;)i*=2;if(i!==this.length){const o=new Uint8Array(i);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*hp),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*hp),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(i,o){let u,d;if(i>=0?(u=i%4294967296|0,d=i/4294967296|0):(u=~(-i%4294967296),d=~(-i/4294967296),4294967295^u?u=u+1|0:(u=0,d=d+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(p,y,x){x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7)})(u,0,o),(function(p,y){const x=(7&p)<<4;y.buf[y.pos++]|=x|((p>>>=3)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p)))))})(d,o)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const i=this.pos;this.pos=(function(u,d,p){for(let y,x,T=0;T<d.length;T++){if(y=d.charCodeAt(T),y>55295&&y<57344){if(!x){y>56319||T+1===d.length?(u[p++]=239,u[p++]=191,u[p++]=189):x=y;continue}if(y<56320){u[p++]=239,u[p++]=191,u[p++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(u[p++]=239,u[p++]=191,u[p++]=189,x=null);y<128?u[p++]=y:(y<2048?u[p++]=y>>6|192:(y<65536?u[p++]=y>>12|224:(u[p++]=y>>18|240,u[p++]=y>>12&63|128),u[p++]=y>>6&63|128),u[p++]=63&y|128)}return p})(this.buf,e,this.pos);const o=this.pos-i;o>=128&&td(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const i=e.length;this.writeVarint(i),this.realloc(i);for(let o=0;o<i;o++)this.buf[this.pos++]=e[o]}writeRawMessage(e,i){this.pos++;const o=this.pos;e(i,this);const u=this.pos-o;u>=128&&td(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u}writeMessage(e,i,o){this.writeTag(e,2),this.writeRawMessage(i,o)}writePackedVarint(e,i){i.length&&this.writeMessage(e,Wm,i)}writePackedSVarint(e,i){i.length&&this.writeMessage(e,Km,i)}writePackedBoolean(e,i){i.length&&this.writeMessage(e,um,i)}writePackedFloat(e,i){i.length&&this.writeMessage(e,Jm,i)}writePackedDouble(e,i){i.length&&this.writeMessage(e,lm,i)}writePackedFixed32(e,i){i.length&&this.writeMessage(e,Qc,i)}writePackedSFixed32(e,i){i.length&&this.writeMessage(e,id,i)}writePackedFixed64(e,i){i.length&&this.writeMessage(e,cm,i)}writePackedSFixed64(e,i){i.length&&this.writeMessage(e,hm,i)}writeBytesField(e,i){this.writeTag(e,2),this.writeBytes(i)}writeFixed32Field(e,i){this.writeTag(e,5),this.writeFixed32(i)}writeSFixed32Field(e,i){this.writeTag(e,5),this.writeSFixed32(i)}writeFixed64Field(e,i){this.writeTag(e,1),this.writeFixed64(i)}writeSFixed64Field(e,i){this.writeTag(e,1),this.writeSFixed64(i)}writeVarintField(e,i){this.writeTag(e,0),this.writeVarint(i)}writeSVarintField(e,i){this.writeTag(e,0),this.writeSVarint(i)}writeStringField(e,i){this.writeTag(e,2),this.writeString(i)}writeFloatField(e,i){this.writeTag(e,5),this.writeFloat(i)}writeDoubleField(e,i){this.writeTag(e,1),this.writeDouble(i)}writeBooleanField(e,i){this.writeVarintField(e,+i)}}function rl(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function td(n,e,i){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(let u=i.pos-1;u>=n;u--)i.buf[u+o]=i.buf[u]}function Wm(n,e){for(let i=0;i<n.length;i++)e.writeVarint(n[i])}function Km(n,e){for(let i=0;i<n.length;i++)e.writeSVarint(n[i])}function Jm(n,e){for(let i=0;i<n.length;i++)e.writeFloat(n[i])}function lm(n,e){for(let i=0;i<n.length;i++)e.writeDouble(n[i])}function um(n,e){for(let i=0;i<n.length;i++)e.writeBoolean(n[i])}function Qc(n,e){for(let i=0;i<n.length;i++)e.writeFixed32(n[i])}function id(n,e){for(let i=0;i<n.length;i++)e.writeSFixed32(n[i])}function cm(n,e){for(let i=0;i<n.length;i++)e.writeFixed64(n[i])}function hm(n,e){for(let i=0;i<n.length;i++)e.writeSFixed64(n[i])}function fm(n,e,i){n===1&&i.readMessage(dm,e)}function dm(n,e,i){if(n===3){const{id:o,bitmap:u,width:d,height:p,left:y,top:x,advance:T}=i.readMessage(pm,{});e.push({id:o,bitmap:new jc({width:d+6,height:p+6},u),metrics:{width:d,height:p,left:y,top:x,advance:T}})}}function pm(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}function dp(n){let e=0,i=0;for(const p of n)e+=p.w*p.h,i=Math.max(i,p.w);n.sort(((p,y)=>y.h-p.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,d=0;for(const p of n)for(let y=o.length-1;y>=0;y--){const x=o[y];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,d=Math.max(d,p.y+p.h),u=Math.max(u,p.x+p.w),p.w===x.w&&p.h===x.h){const T=o.pop();T&&y<o.length&&(o[y]=T)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(o.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:u,h:d,fill:e/(u*d)||0}}class Wc{constructor(e,{pixelRatio:i,version:o,stretchX:u,stretchY:d,content:p,textFitWidth:y,textFitHeight:x}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=d,this.content=p,this.version=o,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class pp{constructor(e,i){const o={},u={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,o,d),this.addImages(i,u,d);const{w:p,h:y}=dp(d),x=new bn({width:p||1,height:y||1});for(const T in e){const E=e[T],C=o[T].paddedRect;bn.copy(E.data,x,{x:0,y:0},{x:C.x+1,y:C.y+1},E.data)}for(const T in i){const E=i[T],C=u[T].paddedRect,D=C.x+1,P=C.y+1,O=E.data.width,k=E.data.height;bn.copy(E.data,x,{x:0,y:0},{x:D,y:P},E.data),bn.copy(E.data,x,{x:0,y:k-1},{x:D,y:P-1},{width:O,height:1}),bn.copy(E.data,x,{x:0,y:0},{x:D,y:P+k},{width:O,height:1}),bn.copy(E.data,x,{x:O-1,y:0},{x:D-1,y:P},{width:1,height:k}),bn.copy(E.data,x,{x:0,y:0},{x:D+O,y:P},{width:1,height:k})}this.image=x,this.iconPositions=o,this.patternPositions=u}addImages(e,i,o){for(const u in e){const d=e[u],p={x:0,y:0,w:d.data.width+2,h:d.data.height+2};o.push(p),i[u]=new Wc(p,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,d]=e.tl;o.update(i.data,void 0,{x:u,y:d})}}var al;function bi(n,e,i,o,u,d,p,y,x,T,E,C,D,P,O){const k=Ns.fromFeature(n,u);let N;C===L.aA.vertical&&k.verticalizePunctuation();let G=k.determineLineBreaks(T,d,e,o,P);const{processBidirectionalText:J,processStyledBidirectionalText:q}=Ba;if(J&&k.sections.length===1){N=[],G=G.map((be=>k.toCodeUnitIndex(be)));const ne=J(k.toString(),G);for(const be of ne){const Ne=[...be].map((()=>0));N.push(new Ns(be,k.sections,Ne))}}else if(q){N=[],G=G.map((Oe=>k.toCodeUnitIndex(Oe)));let ne=0;const be=[];for(const Oe of k.text)be.push(...Array(Oe.length).fill(k.sectionIndex[ne])),ne++;const Ne=q(k.text,be,G);for(const Oe of Ne){const $e=[];let tt="";for(const Ye of Oe[0])$e.push(Oe[1][tt.length]),tt+=Ye;N.push(new Ns(Oe[0],k.sections,$e))}}else N=(function(ne,be){const Ne=[];let Oe=0;for(const $e of be)Ne.push(ne.substring(Oe,$e)),Oe=$e;return Oe<ne.length()&&Ne.push(ne.substring(Oe,ne.length())),Ne})(k,G);const $=[],te={positionedLines:$,text:k.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:C,iconsInText:!1,verticalizable:!1};return(function(ne,be,Ne,Oe,$e,tt,Ye,ke,ze,ut,ot,ht){let at=0,yt=0,oi=0,Ht=0;const un=ke==="right"?1:ke==="left"?0:.5,$r=xi/ht;let Kn=0;for(const Ti of $e){Ti.trim();const wn=Ti.getMaxScale(),On={positionedGlyphs:[],lineOffset:0};ne.positionedLines[Kn]=On;const qi=On.positionedGlyphs;let Za=0;if(!Ti.length()){yt+=tt,++Kn;continue}const Xr=eg(Oe,Ti,$r);let Ha=0;for(const gr of Ti.text){const gn=Ti.getSection(Ha),Jn=gr.codePointAt(0),Tn=tg(ze,ot,Jn),_r={glyph:Jn,imageName:null,x:at,y:yt+-17,vertical:Tn,scale:1,fontStack:"",sectionIndex:Ti.getSectionIndex(Ha),metrics:null,rect:null};let ac;if("fontStack"in gn){if(ac=ig(gn,Jn,Tn,Xr,be,Ne),!ac)continue;_r.fontStack=gn.fontStack}else{if(ne.iconsInText=!0,gn.scale*=$r,ac=ng(gn,Tn,wn,Xr,Oe),!ac)continue;Za=Math.max(Za,ac.imageOffset),_r.imageName=gn.imageName}const{rect:fl,metrics:jp,baselineOffset:fh}=ac;_r.y+=fh,_r.scale=gn.scale,_r.metrics=jp,_r.rect=fl,qi.push(_r),Tn?(ne.verticalizable=!0,at+=("imageName"in gn?jp.advance:xi)*gn.scale+ut):at+=jp.advance*gn.scale+ut,Ha++}qi.length!==0&&(oi=Math.max(at-ut,oi),nd(qi,0,qi.length-1,un)),at=0,On.lineOffset=Math.max(Za,(wn-1)*xi);const Mo=tt*wn+Za;yt+=Mo,Ht=Math.max(Mo,Ht),++Kn}const{horizontalAlign:cn,verticalAlign:Ki}=ef(Ye);(function(Ti,wn,On,qi,Za,Xr,Ha,Mo,gr){const gn=(wn-On)*Za;let Jn=0;Jn=Xr!==Ha?-Mo*qi- -17:-qi*gr*Ha+.5*Ha;for(const Tn of Ti)for(const _r of Tn.positionedGlyphs)_r.x+=gn,_r.y+=Jn})(ne.positionedLines,un,cn,Ki,oi,Ht,tt,yt,$e.length),ne.top+=-Ki*yt,ne.bottom=ne.top+yt,ne.left+=-cn*oi,ne.right=ne.left+oi})(te,e,i,o,N,p,y,x,C,T,D,O),!(function(ne){for(const be of ne)if(be.positionedGlyphs.length!==0)return!1;return!0})($)&&te}function ef(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function eg(n,e,i){const o=e.getMaxScale()*xi,{maxImageWidth:u,maxImageHeight:d}=e.getMaxImageSize(n),p=Math.max(o,d*i);return{verticalLineContentWidth:Math.max(o,u*i),horizontalLineContentHeight:p}}function mp(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function tg(n,e,i){return!(n===L.aA.horizontal||!e&&!Dc(i)||e&&(Dh(i)||(o=i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function ig(n,e,i,o,u,d){const p=d[n.fontStack],y=(function(T,E,C,D){if(T&&T.rect)return T;const P=E[C.fontStack],O=P&&P[D];return O?{rect:null,metrics:O.metrics}:null})(p&&p[e],u,n,e);if(y===null)return null;let x;if(i)x=o.verticalLineContentWidth-n.scale*xi;else{const T=mp(n.verticalAlign);x=(o.horizontalLineContentHeight-n.scale*xi)*T}return{rect:y.rect,metrics:y.metrics,baselineOffset:x}}function ng(n,e,i,o,u){const d=u[n.imageName];if(!d)return null;const p=d.paddedRect,y=d.displaySize,x={width:y[0],height:y[1],left:1,top:-3,advance:e?y[1]:y[0]};let T;if(e)T=o.verticalLineContentWidth-y[1]*n.scale;else{const E=mp(n.verticalAlign);T=(o.horizontalLineContentHeight-y[1]*n.scale)*E}return{rect:p,metrics:x,baselineOffset:T,imageOffset:(e?y[0]:y[1])*n.scale-xi*i}}function nd(n,e,i,o){if(o===0)return;const u=n[i],d=(n[i].x+u.metrics.advance*u.scale)*o;for(let p=e;p<=i;p++)n[p].x-=d}function Kc(n,e,i){const{horizontalAlign:o,verticalAlign:u}=ef(i),d=e[0]-n.displaySize[0]*o,p=e[1]-n.displaySize[1]*u;return{image:n,top:p,bottom:p+n.displaySize[1],left:d,right:d+n.displaySize[0]}}function rd(n){var e,i;let o=n.left,u=n.top,d=n.right-o,p=n.bottom-u;const y=(e=n.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",x=(i=n.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",T=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&d/p<T||y==="proportional"){const E=Math.ceil(p*T);o*=E/d,d=E}}else if(y==="proportional"&&x==="stretchOnly"&&T!==0&&d/p>T){const E=Math.ceil(d/T);u*=E/p,p=E}return{x1:o,y1:u,x2:o+d,y2:u+p}}function tf(n,e,i,o,u,d){const p=n.image;let y;if(p.content){const N=p.content,G=p.pixelRatio||1;y=[N[0]/G,N[1]/G,p.displaySize[0]-N[2]/G,p.displaySize[1]-N[3]/G]}const x=e.left*d,T=e.right*d;let E,C,D,P;i==="width"||i==="both"?(P=u[0]+x-o[3],C=u[0]+T+o[1]):(P=u[0]+(x+T-p.displaySize[0])/2,C=P+p.displaySize[0]);const O=e.top*d,k=e.bottom*d;return i==="height"||i==="both"?(E=u[1]+O-o[0],D=u[1]+k+o[2]):(E=u[1]+(O+k-p.displaySize[1])/2,D=E+p.displaySize[1]),{image:p,top:E,right:C,bottom:D,left:P,collisionPadding:y}}nt("ImagePosition",Wc),nt("ImageAtlas",pp),L.aA=void 0,(al=L.aA||(L.aA={}))[al.none=0]="none",al[al.horizontal=1]="horizontal",al[al.vertical=2]="vertical",al[al.horizontalOnly=3]="horizontalOnly";const Vs=128,ha=32640;function js(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Qt(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=i;let d=0;for(;d<o.length&&o[d]<=n;)d++;d=Math.max(0,d-1);let p=d;for(;p<o.length&&o[p]<n+1;)p++;p=Math.min(o.length-1,p);const y=o[d],x=o[p];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:x,minSize:i.evaluate(new Qt(y)),maxSize:i.evaluate(new Qt(x)),interpolationType:u}}}function ec(n,e,i){let o="never";const u=n.get(e);return u?o=u:n.get(i)&&(o="always"),o}const rg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function nf(n,e,i,o,u,d,p,y,x,T,E,C,D){const P=y?Math.min(ha,Math.round(y[0])):0,O=y?Math.min(ha,Math.round(y[1])):0;n.emplaceBack(e,i,Math.round(32*o),Math.round(32*u),d,p,(P<<1)+(x?1:0),O,16*T,16*E,256*C,256*D)}function ad(n,e,i){n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i)}function mm(n){for(const e of n.sections)if(Rc(e.text))return!0;return!1}class sd{constructor(e){this.layoutVertexArray=new K,this.indexArray=new Me,this.programConfigurations=e,this.segments=new He,this.dynamicLayoutVertexArray=new re,this.opacityVertexArray=new se,this.hasVisibleVertices=!1,this.placedSymbolArray=new l}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nl.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,sp.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,rg,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}nt("SymbolBuffers",sd);class gp{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new He,this.collisionVertexArray=new fe}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,op.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}nt("CollisionBuffers",gp);class Jl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((p=>p.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=js(this.zoom,i["text-size"]),this.iconSizeData=js(this.zoom,i["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),d=o.get("symbol-z-order");this.canOverlap=ec(o,"text-overlap","text-allow-overlap")!=="never"||ec(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((p=>L.aA[p]))),this.stateDependentLayerIds=this.layers.filter((p=>p.isStateDependent())).map((p=>p.id)),this.sourceID=e.sourceID}createArrays(){this.text=new sd(new ji(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new sd(new ji(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new v,this.lineVertexArray=new w,this.symbolInstances=new _,this.textAnchorOffsets=new A}calculateGlyphDependencies(e,i,o,u,d){for(const p of e)if(i[p.codePointAt(0)]=!0,(o||u)&&d){const y=Yc[p];y&&(i[y.codePointAt(0)]=!0)}}populate(e,i,o){const u=this.layers[0],d=u.layout,p=d.get("text-font"),y=d.get("text-field"),x=d.get("icon-image"),T=(y.value.kind!=="constant"||y.value.value instanceof Fn&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),E=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,C=d.get("symbol-sort-key");if(this.features=[],!T&&!E)return;const D=i.iconDependencies,P=i.glyphDependencies,O=i.availableImages,k=new Qt(this.zoom);for(const{feature:N,id:G,index:J,sourceLayerIndex:q}of e){const $=u._featureFilter.needGeometry,te=xo(N,$);if(!u._featureFilter.filter(k,te,o))continue;let ne,be;if($||(te.geometry=ca(N)),T){const Oe=u.getValueAndResolveTokens("text-field",te,o,O),$e=Fn.factory(Oe),tt=this.hasRTLText=this.hasRTLText||mm($e);(!tt||Ba.getRTLTextPluginStatus()==="unavailable"||tt&&Ba.isParsed())&&(ne=up($e,u,te))}if(E){const Oe=u.getValueAndResolveTokens("icon-image",te,o,O);be=Oe instanceof br?Oe:br.fromString(Oe)}if(!ne&&!be)continue;const Ne=this.sortFeaturesByKey?C.evaluate(te,{},o):void 0;if(this.features.push({id:G,text:ne,icon:be,index:J,sourceLayerIndex:q,geometry:te.geometry,properties:N.properties,type:tl.types[N.type],sortKey:Ne}),be&&(D[be.name]=!0),ne){const Oe=p.evaluate(te,{},o).join(","),$e=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(L.aA.vertical)>=0;for(const tt of ne.sections)if(tt.image)D[tt.image.name]=!0;else{const Ye=Sa(ne.toString()),ke=tt.fontStack||Oe,ze=P[ke]=P[ke]||{};this.calculateGlyphDependencies(tt.text,ze,$e,this.allowVerticalPlacement,Ye)}}}d.get("symbol-placement")==="line"&&(this.features=(function(N){const G={},J={},q=[];let $=0;function te(Oe){q.push(N[Oe]),$++}function ne(Oe,$e,tt){const Ye=J[Oe];return delete J[Oe],J[$e]=Ye,q[Ye].geometry[0].pop(),q[Ye].geometry[0]=q[Ye].geometry[0].concat(tt[0]),Ye}function be(Oe,$e,tt){const Ye=G[$e];return delete G[$e],G[Oe]=Ye,q[Ye].geometry[0].shift(),q[Ye].geometry[0]=tt[0].concat(q[Ye].geometry[0]),Ye}function Ne(Oe,$e,tt){const Ye=tt?$e[0][$e[0].length-1]:$e[0][0];return`${Oe}:${Ye.x}:${Ye.y}`}for(let Oe=0;Oe<N.length;Oe++){const $e=N[Oe],tt=$e.geometry,Ye=$e.text?$e.text.toString():null;if(!Ye){te(Oe);continue}const ke=Ne(Ye,tt),ze=Ne(Ye,tt,!0);if(ke in J&&ze in G&&J[ke]!==G[ze]){const ut=be(ke,ze,tt),ot=ne(ke,ze,q[ut].geometry);delete G[ke],delete J[ze],J[Ne(Ye,q[ot].geometry,!0)]=ot,q[ut].geometry=null}else ke in J?ne(ke,ze,tt):ze in G?be(ke,ze,tt):(te(Oe),G[ke]=$-1,J[ze]=$-1)}return q.filter((Oe=>Oe.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((N,G)=>N.sortKey-G.sortKey))}update(e,i,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(i[e.segment+1]),d=e.dist(i[e.segment]);const p={};for(let y=e.segment+1;y<i.length;y++)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:u},y<i.length-1&&(u+=i[y+1].dist(i[y]));for(let y=e.segment||0;y>=0;y--)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:d},y>0&&(d+=i[y-1].dist(i[y]));for(let y=0;y<i.length;y++){const x=p[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,u,d,p,y,x,T,E,C,D){const P=e.indexArray,O=e.layoutVertexArray,k=e.segments.prepareSegment(4*i.length,O,P,this.canOverlap?p.sortKey:void 0),N=this.glyphOffsetArray.length,G=k.vertexLength,J=this.allowVerticalPlacement&&y===L.aA.vertical?Math.PI/2:0,q=p.text&&p.text.sections;for(let $=0;$<i.length;$++){const{tl:te,tr:ne,bl:be,br:Ne,tex:Oe,pixelOffsetTL:$e,pixelOffsetBR:tt,minFontScaleX:Ye,minFontScaleY:ke,glyphOffset:ze,isSDF:ut,sectionIndex:ot}=i[$],ht=k.vertexLength,at=ze[1];nf(O,x.x,x.y,te.x,at+te.y,Oe.x,Oe.y,o,ut,$e.x,$e.y,Ye,ke),nf(O,x.x,x.y,ne.x,at+ne.y,Oe.x+Oe.w,Oe.y,o,ut,tt.x,$e.y,Ye,ke),nf(O,x.x,x.y,be.x,at+be.y,Oe.x,Oe.y+Oe.h,o,ut,$e.x,tt.y,Ye,ke),nf(O,x.x,x.y,Ne.x,at+Ne.y,Oe.x+Oe.w,Oe.y+Oe.h,o,ut,tt.x,tt.y,Ye,ke),ad(e.dynamicLayoutVertexArray,x,J),P.emplaceBack(ht,ht+2,ht+1),P.emplaceBack(ht+1,ht+2,ht+3),k.vertexLength+=4,k.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ze[0]),$!==i.length-1&&ot===i[$+1].sectionIndex||e.programConfigurations.populatePaintArrays(O.length,p,p.index,{imagePositions:{},canonical:D,formattedSection:q&&q[ot]})}e.placedSymbolArray.emplaceBack(x.x,x.y,N,this.glyphOffsetArray.length-N,G,T,E,x.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],y,0,!1,0,C)}_addCollisionDebugVertex(e,i,o,u,d,p){return i.emplaceBack(0,0),e.emplaceBack(o.x,o.y,u,d,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,i,o,u,d,p,y){const x=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),T=x.vertexLength,E=d.layoutVertexArray,C=d.collisionVertexArray,D=y.anchorX,P=y.anchorY;this._addCollisionDebugVertex(E,C,p,D,P,new me(e,i)),this._addCollisionDebugVertex(E,C,p,D,P,new me(o,i)),this._addCollisionDebugVertex(E,C,p,D,P,new me(o,u)),this._addCollisionDebugVertex(E,C,p,D,P,new me(e,u)),x.vertexLength+=4;const O=d.indexArray;O.emplaceBack(T,T+1),O.emplaceBack(T+1,T+2),O.emplaceBack(T+2,T+3),O.emplaceBack(T+3,T),x.primitiveLength+=4}addDebugCollisionBoxes(e,i,o,u){for(let d=e;d<i;d++){const p=this.collisionBoxArray.get(d);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,u?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gp(ee,lp.members,xe),this.iconCollisionBox=new gp(ee,lp.members,xe);for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(e,i,o,u,d,p,y,x,T){const E={};for(let C=i;C<o;C++){const D=e.get(C);E.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.textFeatureIndex=D.featureIndex;break}for(let C=u;C<d;C++){const D=e.get(C);E.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.verticalTextFeatureIndex=D.featureIndex;break}for(let C=p;C<y;C++){const D=e.get(C);E.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.iconFeatureIndex=D.featureIndex;break}for(let C=x;C<T;C++){const D=e.get(C);E.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.verticalIconFeatureIndex=D.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),u=o.vertexStartIndex+4*o.numGlyphs;for(let d=o.vertexStartIndex;d<u;d+=4)e.indexArray.emplaceBack(d,d+2,d+1),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),u=[],d=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const x=this.symbolInstances.get(y);u.push(0|Math.round(i*x.anchorX+o*x.anchorY)),d.push(x.featureIndex)}return p.sort(((y,x)=>u[y]-u[x]||d[x]-d[y])),p}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((u,d,p)=>{u>=0&&p.indexOf(u)===d&&this.addIndicesForPlacedSymbol(this.text,u)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let _p,yp;nt("SymbolBucket",Jl,{omit:["layers","collisionBoxArray","features","compareText"]}),Jl.MAX_GLYPHS=65535,Jl.addDynamicAttributes=ad;var vp={get paint(){return yp=yp||new dn({"icon-opacity":new xt(ve.paint_symbol["icon-opacity"]),"icon-color":new xt(ve.paint_symbol["icon-color"]),"icon-halo-color":new xt(ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new xt(ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new xt(ve.paint_symbol["icon-halo-blur"]),"icon-translate":new dt(ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new dt(ve.paint_symbol["icon-translate-anchor"]),"text-opacity":new xt(ve.paint_symbol["text-opacity"]),"text-color":new xt(ve.paint_symbol["text-color"],{runtimeType:Kr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new xt(ve.paint_symbol["text-halo-color"]),"text-halo-width":new xt(ve.paint_symbol["text-halo-width"]),"text-halo-blur":new xt(ve.paint_symbol["text-halo-blur"]),"text-translate":new dt(ve.paint_symbol["text-translate"]),"text-translate-anchor":new dt(ve.paint_symbol["text-translate-anchor"])})},get layout(){return _p=_p||new dn({"symbol-placement":new dt(ve.layout_symbol["symbol-placement"]),"symbol-spacing":new dt(ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new dt(ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new xt(ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new dt(ve.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new dt(ve.layout_symbol["icon-allow-overlap"]),"icon-overlap":new dt(ve.layout_symbol["icon-overlap"]),"icon-ignore-placement":new dt(ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new dt(ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new dt(ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new xt(ve.layout_symbol["icon-size"]),"icon-text-fit":new dt(ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new dt(ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new xt(ve.layout_symbol["icon-image"]),"icon-rotate":new xt(ve.layout_symbol["icon-rotate"]),"icon-padding":new xt(ve.layout_symbol["icon-padding"]),"icon-keep-upright":new dt(ve.layout_symbol["icon-keep-upright"]),"icon-offset":new xt(ve.layout_symbol["icon-offset"]),"icon-anchor":new xt(ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new dt(ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new dt(ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new dt(ve.layout_symbol["text-rotation-alignment"]),"text-field":new xt(ve.layout_symbol["text-field"]),"text-font":new xt(ve.layout_symbol["text-font"]),"text-size":new xt(ve.layout_symbol["text-size"]),"text-max-width":new xt(ve.layout_symbol["text-max-width"]),"text-line-height":new dt(ve.layout_symbol["text-line-height"]),"text-letter-spacing":new xt(ve.layout_symbol["text-letter-spacing"]),"text-justify":new xt(ve.layout_symbol["text-justify"]),"text-radial-offset":new xt(ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new dt(ve.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new xt(ve.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new xt(ve.layout_symbol["text-anchor"]),"text-max-angle":new dt(ve.layout_symbol["text-max-angle"]),"text-writing-mode":new dt(ve.layout_symbol["text-writing-mode"]),"text-rotate":new xt(ve.layout_symbol["text-rotate"]),"text-padding":new dt(ve.layout_symbol["text-padding"]),"text-keep-upright":new dt(ve.layout_symbol["text-keep-upright"]),"text-transform":new xt(ve.layout_symbol["text-transform"]),"text-offset":new xt(ve.layout_symbol["text-offset"]),"text-allow-overlap":new dt(ve.layout_symbol["text-allow-overlap"]),"text-overlap":new dt(ve.layout_symbol["text-overlap"]),"text-ignore-placement":new dt(ve.layout_symbol["text-ignore-placement"]),"text-optional":new dt(ve.layout_symbol["text-optional"])})}};class od{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Ii,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}nt("FormatSectionOverride",od,{omit:["defaultValue"]});class Jc extends Dr{constructor(e,i){super(e,vp,i)}recalculate(e,i){if(super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const d of o)u.indexOf(d)<0&&u.push(d);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,i,o,u){const d=this.layout.get(e).evaluate(i,{},o,u),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||oo(p.value)||!d?d:(function(y,x){return x.replace(/{([^{}]+)}/g,((T,E)=>y&&E in y?String(y[E]):""))})(i.properties,d)}createBucket(e){return new Jl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of vp.paint.overridableProperties){if(!Jc.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new od(i),u=new Mc(o,i.property.specification);let d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new Er("source",u):new lo("composite",u,i.value.zoomStops),this.paint._values[e]=new Cr(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&Jc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),u=vp.paint.properties[i];let d=!1;const p=y=>{for(const x of y)if(u.overrides&&u.overrides.hasOverride(x))return void(d=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Fn)p(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const y=T=>{d||(T instanceof ea&&Fi(T.value)===Ya?p(T.value.sections):T instanceof yu?p(T.sections):T.eachChild(y))},x=o.value;x._styleExpression&&y(x._styleExpression.expression)}return d}}let gm;var ag={get paint(){return gm=gm||new dn({"background-color":new dt(ve.paint_background["background-color"]),"background-pattern":new zr(ve.paint_background["background-pattern"]),"background-opacity":new dt(ve.paint_background["background-opacity"])})}};class rf extends Dr{constructor(e,i){super(e,ag,i)}}class sg extends Dr{constructor(e,i){super(e,{},i),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class _m{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const ri={once:!0},af=63710088e-1;class Us{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Us($t(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,u=e.lat*i,d=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return af*Math.acos(Math.min(d,1))}static convert(e){if(e instanceof Us)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Us(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Us(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ld=2*Math.PI*af;function xp(n){return ld*Math.cos(n*Math.PI/180)}function ud(n){return(180+n)/360}function eh(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function sf(n,e){return n/xp(e)}function ym(n){return 360*n-180}function of(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function vm(n,e){return n*xp(of(e))}class lf{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=Us.convert(e);return new lf(ud(o.lng),eh(o.lat),sf(i,o.lat))}toLngLat(){return new Us(ym(this.x),of(this.y))}toAltitude(){return vm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ld*(e=of(this.y),1/Math.cos(e*Math.PI/180));var e}}function bp(n,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class cd{constructor(e,i,o){if(!(function(u,d,p){return!(u<0||u>25||p<0||p>=Math.pow(2,u)||d<0||d>=Math.pow(2,u))})(e,i,o))throw new Error(`x=${i}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=i,this.y=o,this.key=Ln(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i,o){const u=(function(p,y,x){var T=bp(256*p,256*(y=Math.pow(2,x)-y-1),x),E=bp(256*(p+1),256*(y+1),x);return T[0]+","+T[1]+","+E[0]+","+E[1]})(this.x,this.y,this.z),d=(function(p,y,x){let T,E="";for(let C=p;C>0;C--)T=1<<C-1,E+=(y&T?1:0)+(x&T?2:0);return E})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,d).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const i=this.z-e.z;return i>0&&e.x===this.x>>i&&e.y===this.y>>i}getTilePoint(e){const i=Math.pow(2,this.z);return new me((e.x*i-this.x)*wt,(e.y*i-this.y)*wt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Oi{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Ln(e,i.z,i.z,i.x,i.y)}}class fa{constructor(e,i,o,u,d){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=i,this.canonical=new cd(o,+u,+d),this.key=Ln(i,e,o,u,d)}clone(){return new fa(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-e;return e>this.canonical.z?new fa(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fa(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,i){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?Ln(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y):Ln(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const i=this.canonical.z-e.canonical.z;return!(i<0)&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new fa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new fa(i,this.wrap,i,o,u),new fa(i,this.wrap,i,o+1,u),new fa(i,this.wrap,i,o,u+1),new fa(i,this.wrap,i,o+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new fa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new fa(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Oi(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new lf(e.x-this.wrap,e.y))}}function Ln(n,e,i,o,u){(n*=2)<0&&(n=-1*n-1);const d=1<<i;return(d*d*n+d*u+o).toString(36)+i.toString(36)+e.toString(36)}function uf(n,e){return e?n.properties[e]:n.id}function xm(n,e){const i={id:n.id};if(e.removeAllProperties&&(delete n.removeProperties,delete n.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const o of e.removeProperties){const u=n.addOrUpdateProperties.findIndex((d=>d.key===o));u>-1&&n.addOrUpdateProperties.splice(u,1)}return(n.removeAllProperties||e.removeAllProperties)&&(i.removeAllProperties=!0),(n.removeProperties||e.removeProperties)&&(i.removeProperties=[...n.removeProperties||[],...e.removeProperties||[]]),(n.addOrUpdateProperties||e.addOrUpdateProperties)&&(i.addOrUpdateProperties=[...n.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(n.newGeometry||e.newGeometry)&&(i.newGeometry=e.newGeometry||n.newGeometry),i}function bm(n){var e,i;if(!n)return{};const o={};return o.removeAll=n.removeAll,o.remove=new Set(n.remove||[]),o.add=new Map((e=n.add)===null||e===void 0?void 0:e.map((u=>[u.id,u]))),o.update=new Map((i=n.update)===null||i===void 0?void 0:i.map((u=>[u.id,u]))),o}nt("CanonicalTileID",cd),nt("OverscaledTileID",fa,{omit:["terrainRttPosMatrix32f"]});class hd{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class fd{constructor(e,i,o,u,d){this.type="Feature",this._vectorTileFeature=e,this._x=o,this._y=u,this._z=i,this.properties=e.properties,this.id=d}projectPoint(e,i,o,u){return[360*(e.x+i)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/u)*Math.PI))-90]}projectLine(e,i,o,u){return e.map((d=>this.projectPoint(d,i,o,u)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,i=e.extent*Math.pow(2,this._z),o=e.extent*this._x,u=e.extent*this._y,d=e.loadGeometry();switch(e.type){case 1:{const p=[];for(const x of d)p.push(x[0]);const y=this.projectLine(p,o,u,i);this._geometry=p.length===1?{type:"Point",coordinates:y[0]}:{type:"MultiPoint",coordinates:y};break}case 2:{const p=d.map((y=>this.projectLine(y,o,u,i)));this._geometry=p.length===1?{type:"LineString",coordinates:p[0]}:{type:"MultiLineString",coordinates:p};break}case 3:{const p=$h(d),y=[];for(const x of p)y.push(x.map((T=>this.projectLine(T,o,u,i))));this._geometry=y.length===1?{type:"Polygon",coordinates:y[0]}:{type:"MultiPolygon",coordinates:y};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&i!=="_x"&&i!=="_y"&&i!=="_z"&&(e[i]=this[i]);return e}}class sl{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,i,o){this._name=e,this.dataBuffer=i,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class cf extends sl{}class dd extends cf{getValueFromBuffer(e){return this.dataBuffer[e]}}class hf extends cf{getValueFromBuffer(e){return this.dataBuffer[e]}}class pd extends sl{delta;constructor(e,i,o,u){super(e,i,u),this.delta=o}}class wp extends pd{constructor(e,i,o,u){super(e,Int32Array.of(i),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class md extends sl{constructor(e,i,o){super(e,Int32Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}class og{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,i,o,u,d=4096){this._name=e,this._geometryVector=i,this._idVector=o,this._propertyVectors=u,this._extent=d}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((i=>[i.name,i])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let i=0;for(;i<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(i)):this.idVector.getValue(i));const u=e?.next().value,d={};for(const p of this.propertyVectors){if(!p)continue;const y=p.name,x=p.getValue(i);x!==null&&(d[y]=x)}i++,yield{id:o,geometry:u,properties:d}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],i=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let u;this.idVector&&(u=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const d={coordinates:i[o],type:this.geometryVector.geometryType(o)},p={};for(const y of this.propertyVectors){if(!y)continue;const x=y.name,T=y.getValue(o);T!==null&&(p[x]=T)}e.push({id:u,geometry:d,properties:p})}return e}containsMaxSaveIntegerValues(e){return e instanceof dd||e instanceof md&&e instanceof wp||e instanceof hf}}class wm{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var Gt,ol,ln,ms,eu,qr,Qn,Wn,Tp,da;function jn(n,e,i){const o=new Int32Array(i);let u=0,d=e.get();for(let p=0;p<o.length;p++){let y=n[d++],x=127&y;y<128||(y=n[d++],x|=(127&y)<<7,y<128||(y=n[d++],x|=(127&y)<<14,y<128||(y=n[d++],x|=(127&y)<<21,y<128||(y=n[d++],x|=(15&y)<<28)))),o[u++]=x}return e.set(d),o}function gd(n,e,i){const o=new BigInt64Array(i);for(let u=0;u<o.length;u++)o[u]=Tm(n,e);return o}function gs(n,e){let i,o;return o=n[e.get()],e.increment(),i=127&o,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<7,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<14,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<21,o<128?i:(o=n[e.get()],i|=(15&o)<<28,(function(u,d,p){let y,x;if(x=d[p.get()],p.increment(),y=(112&x)>>4,x<128||(x=d[p.get()],p.increment(),y|=(127&x)<<3,x<128)||(x=d[p.get()],p.increment(),y|=(127&x)<<10,x<128)||(x=d[p.get()],p.increment(),y|=(127&x)<<17,x<128)||(x=d[p.get()],p.increment(),y|=(127&x)<<24,x<128)||(x=d[p.get()],p.increment(),y|=(1&x)<<31,x<128))return 4294967296*y+(u>>>0);throw new Error("Expected varint not more than 10 bytes")})(i,n,e)))))}function _d(n,e,i,o){throw new Error("FastPFor is not implemented yet.")}function tu(n){return n>>>1^-(1&n)}function tc(n){return n>>1n^-(1n&n)}function Tm(n,e){let i=0n,o=0,u=e.get();for(;u<n.length;){const d=n[u++];if(i|=BigInt(127&d)<<BigInt(o),!(128&d))break;if(o+=7,o>=64)throw new Error("Varint too long")}return e.set(u),i}function th(n,e,i){const o=new Int32Array(i);let u=0;for(let d=0;d<e;d++){const p=n[d];o.fill(n[d+e],u,u+p),u+=p}return o}function qa(n,e,i){const o=new BigInt64Array(i);let u=0;for(let d=0;d<e;d++){const p=Number(n[d]);o.fill(n[d+e],u,u+p),u+=p}return o}function Sp(n,e,i){const o=new Float64Array(i);let u=0;for(let d=0;d<e;d++){const p=n[d];o.fill(n[d+e],u,u+p),u+=p}return o}function ih(n){const e=n.length/4*4;let i=1;if(e>=4)for(let o=n[0];i<e-4;i+=4)o=n[i]+=o,o=n[i+1]+=o,o=n[i+2]+=o,o=n[i+3]+=o;for(;i!=n.length;)n[i]+=n[i-1],++i}function So(n){n[0]=n[0]>>>1^-(1&n[0]),n[1]=n[1]>>>1^-(1&n[1]);const e=n.length/4*4;let i=2;if(e>=4)for(;i<e-4;i+=4){const o=n[i],u=n[i+1],d=n[i+2],p=n[i+3];n[i]=(o>>>1^-(1&o))+n[i-2],n[i+1]=(u>>>1^-(1&u))+n[i-1],n[i+2]=(d>>>1^-(1&d))+n[i],n[i+3]=(p>>>1^-(1&p))+n[i+1]}for(;i!=n.length;i+=2)n[i]=(n[i]>>>1^-(1&n[i]))+n[i-2],n[i+1]=(n[i+1]>>>1^-(1&n[i+1]))+n[i-1]}(function(n){n.NONE="NONE",n.DELTA="DELTA",n.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",n.RLE="RLE",n.MORTON="MORTON",n.PDE="PDE"})(Gt||(Gt={})),(function(n){n.NONE="NONE",n.FAST_PFOR="FAST_PFOR",n.VARINT="VARINT",n.ALP="ALP"})(ol||(ol={})),(function(n){n.PRESENT="PRESENT",n.DATA="DATA",n.OFFSET="OFFSET",n.LENGTH="LENGTH"})(ln||(ln={}));class Mp{_dictionaryType;_offsetType;_lengthType;constructor(e,i,o){this._dictionaryType=e,this._offsetType=i,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Zr(n,e){const i=(function(o,u){const d=o[u.get()],p=Object.values(ln)[d>>4];let y=null;switch(p){case ln.DATA:y=new Mp(Object.values(ms)[15&d]);break;case ln.OFFSET:y=new Mp(null,Object.values(eu)[15&d]);break;case ln.LENGTH:y=new Mp(null,null,Object.values(qr)[15&d])}u.increment();const x=o[u.get()],T=Object.values(Gt)[x>>5],E=Object.values(Gt)[x>>2&7],C=Object.values(ol)[3&x];u.increment();const D=jn(o,u,2),P=D[0];return{physicalStreamType:p,logicalStreamType:y,logicalLevelTechnique1:T,logicalLevelTechnique2:E,physicalLevelTechnique:C,numValues:P,byteLength:D[1],decompressedCount:P}})(n,e);return i.logicalLevelTechnique1===Gt.MORTON?(function(o,u,d){const p=jn(u,d,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:o.decompressedCount,numBits:p[0],coordinateShift:p[1]}})(i,n,e):Gt.RLE!==i.logicalLevelTechnique1&&Gt.RLE!==i.logicalLevelTechnique2||ol.NONE===i.physicalLevelTechnique?i:(function(o,u,d){const p=jn(u,d,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:p[1],runs:p[0],numRleValues:p[1]}})(i,n,e)}(function(n){n.NONE="NONE",n.SINGLE="SINGLE",n.SHARED="SHARED",n.VERTEX="VERTEX",n.MORTON="MORTON",n.FSST="FSST"})(ms||(ms={})),(function(n){n.VERTEX="VERTEX",n.INDEX="INDEX",n.STRING="STRING",n.KEY="KEY"})(eu||(eu={})),(function(n){n.VAR_BINARY="VAR_BINARY",n.GEOMETRIES="GEOMETRIES",n.PARTS="PARTS",n.RINGS="RINGS",n.TRIANGLES="TRIANGLES",n.SYMBOL="SYMBOL",n.DICTIONARY="DICTIONARY"})(qr||(qr={})),(function(n){n[n.FLAT=0]="FLAT",n[n.CONST=1]="CONST",n[n.SEQUENCE=2]="SEQUENCE",n[n.DICTIONARY=3]="DICTIONARY",n[n.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(Qn||(Qn={}));class Hr{values;_size;constructor(e,i){this.values=e,this._size=i}get(e){const i=Math.floor(e/8);return(this.values[i]>>e%8&1)==1}set(e,i){const o=Math.floor(e/8);this.values[o]=this.values[o]|(i?1:0)<<e%8}getInt(e){const i=Math.floor(e/8);return this.values[i]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Rr(n,e,i,o,u){return(function(d,p,y){switch(p.logicalLevelTechnique1){case Gt.DELTA:return p.logicalLevelTechnique2===Gt.RLE?(function(x,T,E){const C=new Int32Array(E);let D=0,P=0;for(let O=0;O<T;O++){const k=x[O],N=tu(x[O+T]);for(let G=0;G<k;G++)P+=N,C[D++]=P}return C})(d,p.runs,p.numRleValues):((function(x){x[0]=x[0]>>>1^-(1&x[0]);const T=x.length/4*4;let E=1;if(T>=4)for(;E<T-4;E+=4){const C=x[E],D=x[E+1],P=x[E+2],O=x[E+3];x[E]=(C>>>1^-(1&C))+x[E-1],x[E+1]=(D>>>1^-(1&D))+x[E],x[E+2]=(P>>>1^-(1&P))+x[E+1],x[E+3]=(O>>>1^-(1&O))+x[E+2]}for(;E!=x.length;++E)x[E]=(x[E]>>>1^-(1&x[E]))+x[E-1]})(d),d);case Gt.RLE:return(function(x,T,E){return E?(function(C,D,P){const O=new Int32Array(P);let k=0;for(let N=0;N<D;N++){const G=C[N];let J=C[N+D];J=J>>>1^-(1&J),O.fill(J,k,k+G),k+=G}return O})(x,T.runs,T.numRleValues):th(x,T.runs,T.numRleValues)})(d,p,y);case Gt.MORTON:return ih(d),d;case Gt.COMPONENTWISE_DELTA:return So(d),d;case Gt.NONE:return y&&(function(x){for(let T=0;T<x.length;T++){const E=x[T];x[T]=E>>>1^-(1&E)}})(d),d;default:throw new Error(`The specified Logical level technique is not supported: ${p.logicalLevelTechnique1}`)}})(yd(n,e,i),i,o)}function iu(n,e,i){return(function(o,u){if(u.logicalLevelTechnique1===Gt.DELTA&&u.logicalLevelTechnique2===Gt.NONE)return(function(p){const y=new Int32Array(p.length+1);y[0]=0,y[1]=tu(p[0]);let x=y[1],T=2;for(;T!=y.length;++T){const E=p[T-1];x+=E>>>1^-(1&E),y[T]=y[T-1]+x}return y})(o);if(u.logicalLevelTechnique1===Gt.RLE&&u.logicalLevelTechnique2===Gt.NONE)return(function(p,y,x){const T=new Int32Array(x+1);T[0]=0;let E=1,C=T[0];for(let D=0;D<y;D++){const P=p[D],O=p[D+y];for(let k=E;k<E+P;k++)T[k]=O+C,C=T[k];E+=P}return T})(o,u.runs,u.numRleValues);if(u.logicalLevelTechnique1===Gt.NONE&&u.logicalLevelTechnique2===Gt.NONE){(function(p){let y=0;for(let x=0;x<p.length;x++)p[x]+=y,y=p[x]})(o);const d=new Int32Array(u.numValues+1);return d[0]=0,d.set(o,1),d}if(u.logicalLevelTechnique1===Gt.DELTA&&u.logicalLevelTechnique2===Gt.RLE){const d=(function(p,y,x){const T=new Int32Array(x+1);T[0]=0;let E=1,C=T[0];for(let D=0;D<y;D++){const P=p[D];let O=p[D+y];O=O>>>1^-(1&O);for(let k=E;k<E+P;k++)T[k]=O+C,C=T[k];E+=P}return T})(o,u.runs,u.numRleValues);return ih(d),d}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(yd(n,e,i),i)}function yd(n,e,i){const o=i.physicalLevelTechnique;if(o===ol.FAST_PFOR)return _d();if(o===ol.VARINT)return jn(n,e,i.numValues);if(o===ol.NONE){const u=e.get();e.add(i.byteLength);const d=n.subarray(u,e.get());return new Int32Array(d)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Ep(n,e,i,o){const u=yd(n,e,i);if(u.length===1){const d=u[0];return o?tu(d):d}return o?(function(d){return tu(d[1])})(u):(function(d){return d[1]})(u)}function Sm(n,e,i){return(function(o){if(o.length==2){const u=tu(o[1]);return[u,u]}return[tu(o[2]),tu(o[3])]})(yd(n,e,i))}function Mm(n,e,i){return(function(o){if(o.length==2){const u=tc(o[1]);return[u,u]}return[tc(o[2]),tc(o[3])]})(gd(n,e,i.numValues))}function Em(n,e,i,o){return(function(u,d,p){switch(d.logicalLevelTechnique1){case Gt.DELTA:return d.logicalLevelTechnique2===Gt.RLE?(function(y,x,T){const E=new BigInt64Array(T);let C=0,D=0n;for(let P=0;P<x;P++){const O=Number(y[P]),k=tc(y[P+x]);for(let N=0;N<O;N++)D+=k,E[C++]=D}return E})(u,d.runs,d.numRleValues):((function(y){y[0]=y[0]>>1n^-(1n&y[0]);const x=y.length/4*4;let T=1;if(x>=4)for(;T<x-4;T+=4){const E=y[T],C=y[T+1],D=y[T+2],P=y[T+3];y[T]=(E>>1n^-(1n&E))+y[T-1],y[T+1]=(C>>1n^-(1n&C))+y[T],y[T+2]=(D>>1n^-(1n&D))+y[T+1],y[T+3]=(P>>1n^-(1n&P))+y[T+2]}for(;T!=y.length;++T)y[T]=(y[T]>>1n^-(1n&y[T]))+y[T-1]})(u),u);case Gt.RLE:return(function(y,x,T){return T?(function(E,C,D){const P=new BigInt64Array(D);let O=0;for(let k=0;k<C;k++){const N=Number(E[k]);let G=E[k+C];G=G>>1n^-(1n&G),P.fill(G,O,O+N),O+=N}return P})(y,x.runs,x.numRleValues):qa(y,x.runs,x.numRleValues)})(u,d,p);case Gt.NONE:return p&&(function(y){for(let x=0;x<y.length;x++){const T=y[x];y[x]=T>>1n^-(1n&T)}})(u),u;default:throw new Error(`The specified Logical level technique is not supported: ${d.logicalLevelTechnique1}`)}})(gd(n,e,i.numValues),i,o)}function Am(n,e,i,o){const u=gd(n,e,i.numValues);if(u.length===1){const d=u[0];return o?tc(d):d}return o?(function(d){return tc(d[1])})(u):(function(d){return d[1]})(u)}function vd(n,e,i,o,u){return(function(d,p,y,x){switch(p.logicalLevelTechnique1){case Gt.DELTA:return p.logicalLevelTechnique2===Gt.RLE&&(d=th(d,p.runs,p.numRleValues)),(function(T,E){const C=new Int32Array(T.size());let D=0;T.get(0)?(C[0]=T.get(0)?E[0]>>>1^-(1&E[0]):0,D=1):C[0]=0;let P=1;for(;P!=C.length;++P)C[P]=T.get(P)?C[P-1]+(E[D]>>>1^-(1&E[D++])):C[P-1];return C})(x,d);case Gt.RLE:return(function(T,E,C,D){const P=E;return C?(function(O,k,N){const G=new Int32Array(O.size());let J=0;for(let q=0;q<N;q++){const $=k[q];let te=k[q+N];te=te>>>1^-(1&te);for(let ne=J;ne<J+$;ne++)O.get(ne)?G[ne]=te:(G[ne]=0,J++);J+=$}return G})(D,T,P.runs):(function(O,k,N){const G=new Int32Array(O.size());let J=0;for(let q=0;q<N;q++){const $=k[q],te=k[q+N];for(let ne=J;ne<J+$;ne++)O.get(ne)?G[ne]=te:(G[ne]=0,J++);J+=$}return G})(D,T,P.runs)})(d,p,y,x);case Gt.MORTON:return ih(d),d;case Gt.COMPONENTWISE_DELTA:return So(d),d;case Gt.NONE:return d=y?(function(T,E){const C=new Int32Array(T.size());let D=0,P=0;for(;P!=C.length;++P)if(T.get(P)){const O=E[D++];C[P]=O>>>1^-(1&O)}else C[P]=0;return C})(x,d):(function(T,E){const C=new Int32Array(T.size());let D=0,P=0;for(;P!=C.length;++P)C[P]=T.get(P)?E[D++]:0;return C})(x,d),d;default:throw new Error("The specified Logical level technique is not supported")}})(i.physicalLevelTechnique===ol.FAST_PFOR?_d():jn(n,e,i.numValues),i,o,u)}function ll(n,e,i,o){const u=n.logicalLevelTechnique1;if(u===Gt.RLE)return n.runs===1?Qn.CONST:Qn.FLAT;const d=e instanceof Hr?e.size():e;if(u===Gt.DELTA&&n.logicalLevelTechnique2===Gt.RLE){const p=n.runs,y=2;if(n.numRleValues!==d)return Qn.FLAT;if(p===1)return Qn.SEQUENCE;if(p===2){const x=o.get();let T;if(n.physicalLevelTechnique===ol.VARINT)T=jn(i,o,4);else{const E=o.get();T=new Int32Array(i.buffer,i.byteOffset+E,4)}if(o.set(x),T[2]===y&&T[3]===y)return Qn.SEQUENCE}}return n.numValues===1?Qn.CONST:Qn.FLAT}class nh extends cf{getValueFromBuffer(e){return this.dataBuffer[e]}}class Ap extends pd{constructor(e,i,o,u){super(e,BigInt64Array.of(i),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class rh{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,i,o){this._geometryOffsets=e,this._partOffsets=i,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function nu(n,e,i){return{x:ah(n,e)-i,y:ah(n>>1,e)-i}}function ah(n,e){let i=0;for(let o=0;o<e;o++)i|=(n&1<<2*o)>>o;return i}(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON",n[n.MULTIPOINT=3]="MULTIPOINT",n[n.MULTILINESTRING=4]="MULTILINESTRING",n[n.MULTIPOLYGON=5]="MULTIPOLYGON"})(Wn||(Wn={})),(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON"})(Tp||(Tp={})),(function(n){n[n.MORTON=0]="MORTON",n[n.VEC_2=1]="VEC_2",n[n.VEC_3=2]="VEC_3"})(da||(da={}));class Cm{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((i=>[i]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,i){return[e].concat(i)}createMultiPolygon(e){return e.flat()}}function ff(n){const e=new Array(n.numGeometries);let i=1,o=1,u=1,d=0;const p=new Cm;let y=0,x=0;const T=n.mortonSettings,E=n.topologyVector,C=E.geometryOffsets,D=E.partOffsets,P=E.ringOffsets,O=n.vertexOffsets,k=n.containsPolygonGeometry(),N=n.vertexBuffer;for(let G=0;G<n.numGeometries;G++){const J=n.geometryType(G);if(J===Wn.POINT){if(O&&O.length!==0)if(n.vertexBufferType===da.VEC_2){const q=2*O[x++],$=new me(N[q],N[q+1]);e[d++]=p.createPoint($)}else{const q=nu(N[O[x++]],T.numBits,T.coordinateShift),$=new me(q.x,q.y);e[d++]=p.createPoint($)}else{const q=new me(N[y++],N[y++]);e[d++]=p.createPoint(q)}C&&u++,D&&i++,P&&o++}else if(J===Wn.MULTIPOINT){const q=C[u]-C[u-1];u++;const $=new Array(q);if(O&&O.length!==0){for(let te=0;te<q;te++){const ne=2*O[x++];$[te]=new me(N[ne],N[ne+1])}e[d++]=p.createMultiPoint($)}else{for(let te=0;te<q;te++){const ne=N[y++],be=N[y++];$[te]=new me(ne,be)}e[d++]=p.createMultiPoint($)}}else if(J===Wn.LINESTRING){let q,$=0;k?($=P[o]-P[o-1],o++):$=D[i]-D[i-1],i++,O&&O.length!==0?(q=n.vertexBufferType===da.VEC_2?bd(N,O,x,$,!1):Cp(N,O,x,$,!1,T),x+=$):(q=xd(N,y,$,!1),y+=2*$),e[d++]=p.createLineString(q),C&&u++}else if(J===Wn.POLYGON){const q=D[i]-D[i-1];i++;const $=new Array(q-1);let te=P[o]-P[o-1];if(o++,O&&O.length!==0){const ne=n.vertexBufferType===da.VEC_2?oh(N,O,x,te):ic(N,O,x,te,0,T);x+=te;for(let be=0;be<$.length;be++)te=P[o]-P[o-1],o++,$[be]=n.vertexBufferType===da.VEC_2?oh(N,O,x,te):ic(N,O,x,te,0,T),x+=te;e[d++]=p.createPolygon(ne,$)}else{const ne=sh(N,y,te);y+=2*te;for(let be=0;be<$.length;be++)te=P[o]-P[o-1],o++,$[be]=sh(N,y,te),y+=2*te;e[d++]=p.createPolygon(ne,$)}C&&u++}else if(J===Wn.MULTILINESTRING){const q=C[u]-C[u-1];u++;const $=new Array(q);if(O&&O.length!==0){for(let te=0;te<q;te++){let ne=0;k?(ne=P[o]-P[o-1],o++):ne=D[i]-D[i-1],i++;const be=n.vertexBufferType===da.VEC_2?bd(N,O,x,ne,!1):Cp(N,O,x,ne,!1,T);$[te]=be,x+=ne}e[d++]=p.createMultiLineString($)}else{for(let te=0;te<q;te++){let ne=0;k?(ne=P[o]-P[o-1],o++):ne=D[i]-D[i-1],i++,$[te]=xd(N,y,ne,!1),y+=2*ne}e[d++]=p.createMultiLineString($)}}else{if(J!==Wn.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const q=C[u]-C[u-1];u++;const $=new Array(q);let te=0;if(O&&O.length!==0){for(let ne=0;ne<q;ne++){const be=D[i]-D[i-1];i++;const Ne=new Array(be-1);te=P[o]-P[o-1],o++;const Oe=n.vertexBufferType===da.VEC_2?oh(N,O,x,te):ic(N,O,x,te,0,T);x+=te;for(let $e=0;$e<Ne.length;$e++)te=P[o]-P[o-1],o++,Ne[$e]=n.vertexBufferType===da.VEC_2?oh(N,O,x,te):ic(N,O,x,te,0,T),x+=te;$[ne]=p.createPolygon(Oe,Ne)}e[d++]=p.createMultiPolygon($)}else{for(let ne=0;ne<q;ne++){const be=D[i]-D[i-1];i++;const Ne=new Array(be-1);te=P[o]-P[o-1],o++;const Oe=sh(N,y,te);y+=2*te;for(let $e=0;$e<Ne.length;$e++){const tt=P[o]-P[o-1];o++,Ne[$e]=sh(N,y,tt),y+=2*tt}$[ne]=p.createPolygon(Oe,Ne)}e[d++]=p.createMultiPolygon($)}}}}return e}function sh(n,e,i){return xd(n,e,i,!0)}function oh(n,e,i,o){return bd(n,e,i,o,!0)}function ic(n,e,i,o,u,d){return Cp(n,e,i,o,!0,d)}function xd(n,e,i,o){const u=new Array(o?i+1:i);for(let d=0;d<2*i;d+=2)u[d/2]=new me(n[e+d],n[e+d+1]);return o&&(u[u.length-1]=u[0]),u}function bd(n,e,i,o,u){const d=new Array(u?o+1:o);for(let p=0;p<2*o;p+=2){const y=2*e[i+p/2];d[p/2]=new me(n[y],n[y+1])}return u&&(d[d.length-1]=d[0]),d}function Cp(n,e,i,o,u,d){const p=new Array(u?o+1:o);for(let y=0;y<o;y++){const x=nu(n[e[i+y]],d.numBits,d.coordinateShift);p[y]=new me(x.x,x.y)}return u&&(p[p.length-1]=p[0]),p}class zp{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,i,o,u,d){this._vertexBufferType=e,this._topologyVector=i,this._vertexOffsets=o,this._vertexBuffer=u,this._mortonSettings=d}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=ff(this);let i=0;for(;i<this.numGeometries;)yield{coordinates:e[i],type:this.geometryType(i)},i++}getSimpleEncodedVertex(e){const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const o=nu(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getGeometries(){return ff(this)}get mortonSettings(){return this._mortonSettings}}class zm extends zp{_numGeometries;_geometryType;constructor(e,i,o,u,d,p,y){super(o,u,d,p,y),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===Wn.POLYGON||this._geometryType===Wn.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class wd extends zp{_geometryTypes;constructor(e,i,o,u,d,p){super(e,o,u,d,p),this._geometryTypes=i}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===Wn.POLYGON||this.geometryType(e)===Wn.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Dm{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,i,o,u){this._triangleOffsets=e,this._indexBuffer=i,this._vertexBuffer=o,this._topologyVector=u}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),i=this._topologyVector,o=i.partOffsets,u=i.ringOffsets,d=i.geometryOffsets;let p=0,y=1,x=1,T=1;for(let E=0;E<this.numGeometries;E++)switch(this.geometryType(E)){case Wn.POLYGON:{const C=o[y]-o[y-1];y++;const D=[];for(let P=0;P<C;P++){const O=u[x]-u[x-1];x++;const k=[];for(let N=0;N<O;N++){const G=this._vertexBuffer[p++],J=this._vertexBuffer[p++];k.push(new me(G,J))}k.length>0&&k.push(k[0]),D.push(k)}e[E]=D,d&&T++}break;case Wn.MULTIPOLYGON:{const C=d[T]-d[T-1];T++;const D=[];for(let P=0;P<C;P++){const O=o[y]-o[y-1];y++;for(let k=0;k<O;k++){const N=u[x]-u[x-1];x++;const G=[];for(let J=0;J<N;J++){const q=this._vertexBuffer[p++],$=this._vertexBuffer[p++];G.push(new me(q,$))}G.length>0&&G.push(G[0]),D.push(G)}}e[E]=D}}return e}[Symbol.iterator](){return null}}function df(n,e,i,o,u,d){return new Td(n,e,i,o,u,d)}class Td extends Dm{_numGeometries;_geometryType;constructor(e,i,o,u,d,p){super(o,u,d,p),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function pf(n,e,i,o,u){return new lg(n,e,i,o,u)}class lg extends Dm{_geometryTypes;constructor(e,i,o,u,d){super(i,o,u,d),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function mf(n,e,i,o,u){const d=Zr(n,i);let p=null,y=null,x=null,T=null,E=null,C=null,D=null,P=null;if(ll(d,o,n,i)===Qn.CONST){const k=Ep(n,i,d,!1);for(let N=0;N<e-1;N++){const G=Zr(n,i);switch(G.physicalStreamType){case ln.LENGTH:switch(G.logicalStreamType.lengthType){case qr.GEOMETRIES:p=iu(n,i,G);break;case qr.PARTS:y=iu(n,i,G);break;case qr.RINGS:x=iu(n,i,G);break;case qr.TRIANGLES:D=iu(n,i,G)}break;case ln.OFFSET:switch(G.logicalStreamType.offsetType){case eu.VERTEX:T=Rr(n,i,G,!1);break;case eu.INDEX:P=Rr(n,i,G,!1)}break;case ln.DATA:ms.VERTEX===G.logicalStreamType.dictionaryType?E=Rr(n,i,G,!0):(C={numBits:G.numBits,coordinateShift:G.coordinateShift},E=Rr(n,i,G,!1))}}return P!==null?p!=null||y!=null?df(o,k,D,P,E,new rh(p,y,x)):df(o,k,D,P,E):C===null?(function(N,G,J,q,$){return new zm(N,G,da.VEC_2,J,q,$)})(o,k,new rh(p,y,x),T,E):(function(N,G,J,q,$,te){return new zm(N,G,da.MORTON,J,q,$,te)})(o,k,new rh(p,y,x),T,E,C)}const O=Rr(n,i,d,!1);for(let k=0;k<e-1;k++){const N=Zr(n,i);switch(N.physicalStreamType){case ln.LENGTH:switch(N.logicalStreamType.lengthType){case qr.GEOMETRIES:p=Rr(n,i,N,!1);break;case qr.PARTS:y=Rr(n,i,N,!1);break;case qr.RINGS:x=Rr(n,i,N,!1);break;case qr.TRIANGLES:D=iu(n,i,N)}break;case ln.OFFSET:switch(N.logicalStreamType.offsetType){case eu.VERTEX:T=Rr(n,i,N,!1);break;case eu.INDEX:P=Rr(n,i,N,!1)}break;case ln.DATA:ms.VERTEX===N.logicalStreamType.dictionaryType?E=Rr(n,i,N,!0):(C={numBits:N.numBits,coordinateShift:N.coordinateShift},E=Rr(n,i,N,!1))}}return P!==null&&y===null?pf(O,D,P,E):(p!==null?(p=Dp(O,p,2),y!==null&&x!==null?(y=Pp(O,p,y,!1),x=(function(k,N,G,J){const q=new Int32Array(G[G.length-1]+1);let $=0;q[0]=$;let te=1,ne=1,be=0;for(let Ne=0;Ne<k.length;Ne++){const Oe=k[Ne],$e=N[Ne+1]-N[Ne];if(Oe!==0&&Oe!==3)for(let tt=0;tt<$e;tt++){const Ye=G[te]-G[te-1];te++;for(let ke=0;ke<Ye;ke++)$=q[ne++]=$+J[be++]}else for(let tt=0;tt<$e;tt++)q[ne++]=++$,te++}return q})(O,p,y,x)):y!==null&&(y=(function(k,N,G){const J=new Int32Array(N[N.length-1]+1);let q=0;J[0]=q;let $=1,te=0;for(let ne=0;ne<k.length;ne++){const be=k[ne],Ne=N[ne+1]-N[ne];if(be===4||be===1)for(let Oe=0;Oe<Ne;Oe++)q=J[$++]=q+G[te++];else for(let Oe=0;Oe<Ne;Oe++)J[$++]=++q}return J})(O,p,y))):y!==null&&x!==null?(y=Dp(O,y,1),x=Pp(O,y,x,!0)):y!==null&&(y=Dp(O,y,0)),P!==null?pf(O,D,P,E,new rh(p,y,x)):C===null?(function(k,N,G,J){return new wd(da.VEC_2,k,N,G,J)})(O,new rh(p,y,x),T,E):(function(k,N,G,J,q){return new wd(da.MORTON,k,N,G,J,q)})(O,new rh(p,y,x),T,E,C))}function Dp(n,e,i){const o=new Int32Array(n.length+1);let u=0;o[0]=u;let d=0;for(let p=0;p<n.length;p++)u=o[p+1]=u+(n[p]>i?e[d++]:1);return o}function Pp(n,e,i,o){const u=new Int32Array(e[e.length-1]+1);let d=0;u[0]=d;let p=1,y=0;for(let x=0;x<n.length;x++){const T=n[x],E=e[x+1]-e[x];if(T===5||T===2||o&&(T===4||T===1))for(let C=0;C<E;C++)d=u[p++]=d+i[y++];else for(let C=0;C<E;C++)u[p++]=++d}return u}class Pm extends sl{dataVector;constructor(e,i,o){super(e,i.getBuffer(),o),this.dataVector=i}getValueFromBuffer(e){return this.dataVector.get(e)}}class Im extends cf{getValueFromBuffer(e){return this.dataBuffer[e]}}class Ip extends sl{constructor(e,i,o){super(e,BigInt64Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}function nc(n,e,i){return Rp(n,Math.ceil(e/8),i)}function Rp(n,e,i){const o=new Uint8Array(e);let u=0;for(;u<e;){const d=n[i.increment()];if(d<=127){const p=d+3,y=n[i.increment()],x=u+p;o.fill(y,u,x),u=x}else{const p=256-d;for(let y=0;y<p;y++)o[u++]=n[i.increment()]}}return o}const Rm=new TextDecoder;function lh(n,e,i){return i-e>=12?Rm.decode(n.subarray(e,i)):(function(o,u,d){let p="",y=u;for(;y<d;){const x=o[y];let T,E,C,D=null,P=x>239?4:x>223?3:x>191?2:1;if(y+P>d)break;P===1?x<128&&(D=x):P===2?(T=o[y+1],(192&T)==128&&(D=(31&x)<<6|63&T,D<=127&&(D=null))):P===3?(T=o[y+1],E=o[y+2],(192&T)==128&&(192&E)==128&&(D=(15&x)<<12|(63&T)<<6|63&E,(D<=2047||D>=55296&&D<=57343)&&(D=null))):P===4&&(T=o[y+1],E=o[y+2],C=o[y+3],(192&T)==128&&(192&E)==128&&(192&C)==128&&(D=(15&x)<<18|(63&T)<<12|(63&E)<<6|63&C,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,P=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),y+=P}return p})(n,e,i)}class Lp extends sl{offsetBuffer;constructor(e,i,o,u){super(e,o,u),this.offsetBuffer=i}}class Lm extends Lp{textEncoder;constructor(e,i,o,u){super(e,i,o,u??i.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return lh(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class ru extends Lp{indexBuffer;textEncoder;constructor(e,i,o,u,d){super(e,o,u,d??i.length),this.indexBuffer=i,this.indexBuffer=i,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const i=this.indexBuffer[e];return lh(this.dataBuffer,this.offsetBuffer[i],this.offsetBuffer[i+1])}}class Sd extends Lp{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,i,o,u,d,p,y){super(e,o,u,y),this.indexBuffer=i,this.symbolOffsetBuffer=d,this.symbolTableBuffer=p,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(o,u,d){const p=[],y=new Array(u.length).fill(0);for(let x=1;x<u.length;x++)y[x]=y[x-1]+u[x-1];for(let x=0;x<d.length;x++)if(d[x]===255)p.push(d[++x]);else{const T=u[d[x]],E=y[d[x]];for(let C=0;C<T;C++)p.push(o[E+C])}return new Uint8Array(p)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const i=this.indexBuffer[e];return lh(this.decodedDictionary,this.offsetBuffer[i],this.offsetBuffer[i+1])}offsetToLengthBuffer(e){const i=new Uint32Array(e.length-1);let o=e[0];for(let u=1;u<e.length;u++){const d=e[u];i[u-1]=d-o,o=d}return i}}function Md(n,e,i,o,u,d){return i.type==="scalarType"?(function(p,y,x,T,E,C){let D=null,P=0;if(p===0)return null;if(C.nullable){const k=Zr(y,x);P=k.numValues;const N=x.get(),G=nc(y,P,x);x.set(N+k.byteLength),D=new Hr(G,k.numValues)}const O=D??T;switch(E.physicalType){case 4:case 3:return(function(k,N,G,J,q){const $=Zr(k,N),te=ll($,q,k,N),ne=J.physicalType===3;if(te===Qn.FLAT){const be=rc(q)?vd(k,N,$,ne,q):Rr(k,N,$,ne);return new dd(G.name,be,q)}if(te===Qn.SEQUENCE){const be=Sm(k,N,$);return new wp(G.name,be[0],be[1],$.numRleValues)}{const be=Ep(k,N,$,ne);return new md(G.name,be,q)}})(y,x,C,E,O);case 9:return(function(k,N,G,J,q){let $=null,te=null,ne=null,be=null,Ne=null,Oe=null,$e=null,tt=null;for(let Ye=0;Ye<J;Ye++){const ke=Zr(N,G);if(ke.byteLength!==0)switch(ke.physicalStreamType){case ln.PRESENT:{const ze=nc(N,ke.numValues,G);Oe=new Hr(ze,ke.numValues);break}case ln.OFFSET:te=q!=null||Oe!=null?vd(N,G,ke,!1,q??Oe):Rr(N,G,ke,!1);break;case ln.LENGTH:{const ze=iu(N,G,ke);qr.DICTIONARY===ke.logicalStreamType.lengthType?$=ze:qr.SYMBOL===ke.logicalStreamType.lengthType?be=ze:$e=ze;break}case ln.DATA:{const ze=N.subarray(G.get(),G.get()+ke.byteLength);G.add(ke.byteLength);const ut=ke.logicalStreamType.dictionaryType;ms.FSST===ut?Ne=ze:ms.SINGLE===ut||ms.SHARED===ut?ne=ze:ms.NONE===ut&&(tt=ze);break}}}return(function(Ye,ke,ze,ut,ot,ht,at){return ke?new Sd(Ye,ze,ut,ot,ht,ke,at):null})(k,Ne,te,$,ne,be,q??Oe)??(function(Ye,ke,ze,ut,ot){return ke?ot?new ru(Ye,ze,ut,ke,ot):new ru(Ye,ze,ut,ke):null})(k,ne,te,$,q??Oe)??(function(Ye,ke,ze,ut,ot){if(!ke||!ze)return null;if(ut)return ot?new ru(Ye,ut,ke,ze,ot):new ru(Ye,ut,ke,ze);if(ot&&ot.size()!==ke.length-1){const ht=new Int32Array(ot.size());let at=0;for(let yt=0;yt<ot.size();yt++)ht[yt]=ot.get(yt)?at++:0;return new ru(Ye,ht,ke,ze,ot)}return ot?new Lm(Ye,ke,ze,ot):new Lm(Ye,ke,ze)})(k,$e,tt,te,q??Oe)})(C.name,y,x,C.nullable?p-1:p,D);case 0:return(function(k,N,G,J,q){const $=Zr(k,N),te=$.numValues,ne=N.get(),be=rc(q)?(function(Oe,$e,tt,Ye){const ke=Rp(Oe,Math.ceil($e/8),tt),ze=new Hr(ke,$e),ut=Ye.size(),ot=new Hr(new Uint8Array(ut),ut);let ht=0;for(let at=0;at<Ye.size();at++){const yt=!!Ye.get(at)&&ze.get(ht++);ot.set(at,yt)}return ot.getBuffer()})(k,te,N,q):nc(k,te,N);N.set(ne+$.byteLength);const Ne=new Hr(be,te);return new Pm(G.name,Ne,q)})(y,x,C,0,O);case 6:case 5:return(function(k,N,G,J,q){const $=Zr(k,N),te=ll($,J,k,N),ne=q.physicalType===5;if(te===Qn.FLAT){const be=rc(J)?(function(Ne,Oe,$e,tt,Ye){return(function(ke,ze,ut,ot){switch(ze.logicalLevelTechnique1){case Gt.DELTA:return ze.logicalLevelTechnique2===Gt.RLE&&(ke=qa(ke,ze.runs,ze.numRleValues)),(function(ht,at){const yt=new BigInt64Array(ht.size());let oi=0;ht.get(0)?(yt[0]=ht.get(0)?at[0]>>1n^-(1n&at[0]):0n,oi=1):yt[0]=0n;let Ht=1;for(;Ht!=yt.length;++Ht)yt[Ht]=ht.get(Ht)?yt[Ht-1]+(at[oi]>>1n^-(1n&at[oi++])):yt[Ht-1];return yt})(ot,ke);case Gt.RLE:return(function(ht,at,yt,oi){const Ht=at;return yt?(function(un,$r,Kn){const cn=new BigInt64Array(un.size());let Ki=0;for(let Ti=0;Ti<Kn;Ti++){const wn=Number($r[Ti]);let On=$r[Ti+Kn];On=On>>1n^-(1n&On);for(let qi=Ki;qi<Ki+wn;qi++)un.get(qi)?cn[qi]=On:(cn[qi]=0n,Ki++);Ki+=wn}return cn})(oi,ht,Ht.runs):(function(un,$r,Kn){const cn=new BigInt64Array(un.size());let Ki=0;for(let Ti=0;Ti<Kn;Ti++){const wn=Number($r[Ti]),On=$r[Ti+Kn];for(let qi=Ki;qi<Ki+wn;qi++)un.get(qi)?cn[qi]=On:(cn[qi]=0n,Ki++);Ki+=wn}return cn})(oi,ht,Ht.runs)})(ke,ze,ut,ot);case Gt.NONE:return ke=ut?(function(ht,at){const yt=new BigInt64Array(ht.size());let oi=0,Ht=0;for(;Ht!=yt.length;++Ht)if(ht.get(Ht)){const un=at[oi++];yt[Ht]=un>>1n^-(1n&un)}else yt[Ht]=0n;return yt})(ot,ke):(function(ht,at){const yt=new BigInt64Array(ht.size());let oi=0,Ht=0;for(;Ht!=yt.length;++Ht)yt[Ht]=ht.get(Ht)?at[oi++]:0n;return yt})(ot,ke),ke;default:throw new Error("The specified Logical level technique is not supported")}})(gd(Ne,Oe,$e.numValues),$e,tt,Ye)})(k,N,$,ne,J):Em(k,N,$,ne);return new nh(G.name,be,J)}if(te===Qn.SEQUENCE){const be=Mm(k,N,$);return new Ap(G.name,be[0],be[1],$.numRleValues)}{const be=Am(k,N,$,ne);return new Ip(G.name,be,J)}})(y,x,C,O,E);case 7:return(function(k,N,G,J){const q=Zr(k,N),$=rc(J)?(function(te,ne,be,Ne){const Oe=ne.get(),$e=Oe+Ne*Float32Array.BYTES_PER_ELEMENT,tt=new Uint8Array(te.subarray(Oe,$e)).buffer,Ye=new Float32Array(tt);ne.set($e);const ke=be.size(),ze=new Float32Array(ke);let ut=0;for(let ot=0;ot<ke;ot++)ze[ot]=be.get(ot)?Ye[ut++]:0;return ze})(k,N,J,q.numValues):(function(te,ne,be){const Ne=ne.get(),Oe=Ne+be*Float32Array.BYTES_PER_ELEMENT,$e=new Uint8Array(te.subarray(Ne,Oe)).buffer,tt=new Float32Array($e);return ne.set(Oe),tt})(k,N,q.numValues);return new Im(G.name,$,J)})(y,x,C,O);case 8:return(function(k,N,G,J){const q=Zr(k,N),$=rc(J)?(function(te,ne,be,Ne){const Oe=ne.get(),$e=Oe+Ne*Float64Array.BYTES_PER_ELEMENT,tt=new Uint8Array(te.subarray(Oe,$e)).buffer,Ye=new Float64Array(tt);ne.set($e);const ke=be.size(),ze=new Float64Array(ke);let ut=0;for(let ot=0;ot<ke;ot++)ze[ot]=be.get(ot)?Ye[ut++]:0;return ze})(k,N,J,q.numValues):(function(te,ne,be){const Ne=ne.get(),Oe=Ne+be*Float64Array.BYTES_PER_ELEMENT,$e=new Uint8Array(te.subarray(Ne,Oe)).buffer,tt=new Float64Array($e);return ne.set(Oe),tt})(k,N,q.numValues);return new hf(G.name,$,J)})(y,x,C,O);default:throw new Error(`The specified data type for the field is currently not supported: ${E}`)}})(o,n,e,u,i.scalarType,i):o!=1?null:(function(p,y,x,T){let E=null,C=null,D=null,P=null,O=!1;for(;!O;){const J=Zr(p,y);switch(J.physicalStreamType){case ln.LENGTH:qr.DICTIONARY===J.logicalStreamType.lengthType?E=iu(p,y,J):D=iu(p,y,J);break;case ln.DATA:ms.SINGLE===J.logicalStreamType.dictionaryType||ms.SHARED===J.logicalStreamType.dictionaryType?(C=p.subarray(y.get(),y.get()+J.byteLength),O=!0):P=p.subarray(y.get(),y.get()+J.byteLength),y.add(J.byteLength)}}const k=x.complexType.children,N=[];let G=0;for(const J of k){const q=jn(p,y,1)[0];if(q==0)continue;const $=`${x.name}${J.name==="default"?"":":"+J.name}`;if(q!==2||J.type!=="scalarField"||J.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const te=Zr(p,y),ne=nc(p,te.numValues,y),be=Zr(p,y),Ne=be.decompressedCount!==T?vd(p,y,be,!1,new Hr(ne,te.numValues)):Rr(p,y,be,!1);N[G++]=P?new Sd($,Ne,E,C,D,P,new Hr(ne,te.numValues)):new ru($,Ne,E,C,new Hr(ne,te.numValues))}return N})(n,e,i,u)}function rc(n){return n instanceof Hr}function Om(n){if(n.name==="id")return!1;if(n.type==="scalarType"){const e=n.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(n.type==="complexType"){const e=n.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",n),!1}const Op=new TextDecoder;function ul(n,e){const i=jn(n,e,1)[0];if(i===0)return"";const o=e.get(),u=n.subarray(o,o+i);return e.add(i),Op.decode(u)}function cl(n,e){const i=jn(n,e,1)[0]>>>0,o=!!(4&i),u=!!(2&i),d=jn(n,e,1)[0]>>>0,p={};if(1&i&&(p.nullable=!0),u){const y={};if(o?(y.type="logicalType",y.logicalType=d):(y.type="physicalType",y.physicalType=d),8&i){const x=jn(n,e,1)[0]>>>0;y.children=new Array(x);for(let T=0;T<x;T++)y.children[T]=cl(n,e)}p.type="complexField",p.complexField=y}else{const y={};o?(y.type="logicalType",y.logicalType=d):(y.type="physicalType",y.physicalType=d),p.type="scalarField",p.scalarField=y}return p}function au(n,e){const i=jn(n,e,1)[0]>>>0,o=(function(u){switch(u){case 0:case 1:case 2:case 3:{const d={};d.nullable=!!(1&u),d.columnScope=0;const p={};return p.physicalType=u>1?6:4,p.type="physicalType",d.scalarType=p,d.type="scalarType",d}case 4:{const d={nullable:!1,columnScope:0},p={type:"physicalType",physicalType:0};return d.type="complexType",d.complexType=p,d}case 30:{const d={nullable:!1,columnScope:0},p={type:"physicalType",physicalType:1};return d.type="complexType",d.complexType=p,d}default:return(function(d){let p=null;switch(d){case 10:case 11:p=0;break;case 12:case 13:p=1;break;case 14:case 15:p=2;break;case 16:case 17:p=3;break;case 18:case 19:p=4;break;case 20:case 21:p=5;break;case 22:case 23:p=6;break;case 24:case 25:p=7;break;case 26:case 27:p=8;break;case 28:case 29:p=9;break;default:return null}const y={};y.nullable=!!(1&d),y.columnScope=0;const x={type:"physicalType"};return x.physicalType=p,y.type="scalarType",y.scalarType=x,y})(u)}})(i);if(!o)throw new Error(`Unsupported column type code: ${i}`);if((function(u){return u>=10})(i)?o.name=ul(n,e):i>=0&&i<=3?o.name="id":i===4&&(o.name="geometry"),(function(u){return u===30})(i)){const u=jn(n,e,1)[0]>>>0,d=o.complexType;d.children=new Array(u);for(let p=0;p<u;p++)d.children[p]=cl(n,e)}return o}function gf(n,e){const i={featureTables:[]},o={};o.name=ul(n,e);const u=jn(n,e,1)[0]>>>0,d=jn(n,e,1)[0]>>>0;o.columns=new Array(d);for(let p=0;p<d;p++)o.columns[p]=au(n,e);return i.featureTables.push(o),[i,u]}function _f(n,e,i,o,u,d,p=!1){const y=e.scalarType.physicalType,x=ll(u,d,n,i);if(y===4)switch(x){case Qn.FLAT:{const T=Rr(n,i,u,!1);return new dd(o,T,d)}case Qn.SEQUENCE:{const T=Sm(n,i,u);return new wp(o,T[0],T[1],u.numRleValues)}case Qn.CONST:{const T=Ep(n,i,u,!1);return new md(o,T,d)}}else switch(x){case Qn.FLAT:{if(p){const E=(function(C,D,P,O){const k=(function(N,G,J){const q=new Float64Array(G);for(let $=0;$<G;$++)q[$]=gs(N,J);return q})(C,P.numValues,D);return(function(N,G,J){switch(G.logicalLevelTechnique1){case Gt.DELTA:return G.logicalLevelTechnique2===Gt.RLE&&(N=Sp(N,G.runs,G.numRleValues)),(function(q){q[0]=q[0]%2==1?(q[0]+1)/-2:q[0]/2;const $=q.length/4*4;let te=1;if($>=4)for(;te<$-4;te+=4){const ne=q[te],be=q[te+1],Ne=q[te+2],Oe=q[te+3];q[te]=(ne%2==1?(ne+1)/-2:ne/2)+q[te-1],q[te+1]=(be%2==1?(be+1)/-2:be/2)+q[te],q[te+2]=(Ne%2==1?(Ne+1)/-2:Ne/2)+q[te+1],q[te+3]=(Oe%2==1?(Oe+1)/-2:Oe/2)+q[te+2]}for(;te!=q.length;++te)q[te]=(q[te]%2==1?(q[te]+1)/-2:q[te]/2)+q[te-1]})(N),N;case Gt.RLE:return(function(q,$,te){return Sp(q,$.runs,$.numRleValues)})(N,G);case Gt.NONE:return N;default:throw new Error(`The specified Logical level technique is not supported: ${G.logicalLevelTechnique1}`)}})(k,P)})(n,i,u);return new hf(o,E,d)}const T=Em(n,i,u,!1);return new nh(o,T,d)}case Qn.SEQUENCE:{const T=Mm(n,i,u);return new Ap(o,T[0],T[1],u.numRleValues)}case Qn.CONST:{const T=Am(n,i,u,!1);return new Ip(o,T,d)}}throw new Error("Vector type not supported for id column.")}class su{constructor(e,i){var o;switch(this._featureData=e,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case Wn.POINT:case Wn.MULTIPOINT:this.type=1;break;case Wn.LINESTRING:case Wn.MULTILINESTRING:this.type=2;break;case Wn.POLYGON:case Wn.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=i,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const i of this._featureData.geometry.coordinates){const o=[];for(const u of i)o.push(new me(u.x,u.y));e.push(o)}return e}}class ug{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new su(this.features[e],this.extent)}}class Bp{constructor(e){this.layers={};const i=(function(o,u,d=!0){const p=new wm(0),y=[];for(;p.get()<o.length;){const x=jn(o,p,1)[0]>>>0,T=p.get()+x;if(T>o.length)throw new Error(`Block overruns tile: ${T} > ${o.length}`);if(jn(o,p,1)[0]>>>0!=1){p.set(T);continue}const E=gf(o,p),C=E[1],D=E[0].featureTables[0];let P=null,O=null;const k=[];let N=0;for(const J of D.columns){const q=J.name;if(q==="id"){let $=null;if(J.nullable){const ne=Zr(o,p),be=p.get(),Ne=nc(o,ne.numValues,p);p.set(be+ne.byteLength),$=new Hr(Ne,ne.numValues)}const te=Zr(o,p);N=te.decompressedCount,P=_f(o,J,p,q,te,$??N,d)}else if(q==="geometry"){const $=jn(o,p,1)[0];if(N===0){const te=p.get();N=Zr(o,p).decompressedCount,p.set(te)}O=mf(o,$,p,N)}else{const $=Om(J)?jn(o,p,1)[0]:1;if($===0&&J.type==="scalarType")continue;const te=Md(o,p,J,$,N);if(te)if(Array.isArray(te))for(const ne of te)k.push(ne);else k.push(te)}}const G=new og(D.name,O,P,k,C);y.push(G),p.set(T)}return y})(new Uint8Array(e));this.layers=i.reduce(((o,u)=>Object.assign(Object.assign({},o),{[u.name]:new ug(u)})),{})}}class Gs{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const i=new Gs;return i.extend(e(new me(this.minX,this.minY))),i.extend(e(new me(this.maxX,this.minY))),i.extend(e(new me(this.minX,this.maxY))),i.extend(e(new me(this.maxX,this.maxY))),i}static fromPoints(e){const i=new Gs;for(const o of e)i.extend(o);return i}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class cg{constructor(e,i){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=i,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],i=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const o of i){const u=[];for(const d of o)u.push(new me(d[0],d[1]));e.push(u)}return e}}const uh="_geojsonTileLayer";function Ed(n,e){e.writeVarintField(15,n.version||1),e.writeStringField(1,n.name||""),e.writeVarintField(5,n.extent||4096);const i={keys:[],values:[],keycache:{},valuecache:{}};for(let d=0;d<n.length;d++)i.feature=n.feature(d),e.writeMessage(2,Bm,i);const o=i.keys;for(const d of o)e.writeStringField(3,d);const u=i.values;for(const d of u)e.writeMessage(4,hh,d)}function Bm(n,e){if(!n.feature)return;const i=n.feature;i.id!==void 0&&e.writeVarintField(1,i.id),e.writeMessage(2,hg,n),e.writeVarintField(3,i.type),e.writeMessage(4,km,i)}function hg(n,e){for(const i in n.feature?.properties){let o=n.feature.properties[i],u=n.keycache[i];if(o===null)continue;u===void 0&&(n.keys.push(i),u=n.keys.length-1,n.keycache[i]=u),e.writeVarint(u),typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"&&(o=JSON.stringify(o));const d=typeof o+":"+o;let p=n.valuecache[d];p===void 0&&(n.values.push(o),p=n.values.length-1,n.valuecache[d]=p),e.writeVarint(p)}}function ch(n,e){return(e<<3)+(7&n)}function yf(n){return n<<1^n>>31}function km(n,e){const i=n.loadGeometry(),o=n.type;let u=0,d=0;for(const p of i){let y=1;o===1&&(y=p.length),e.writeVarint(ch(1,y));const x=o===3?p.length-1:p.length;for(let T=0;T<x;T++){T===1&&o!==1&&e.writeVarint(ch(2,x-1));const E=p[T].x-u,C=p[T].y-d;e.writeVarint(yf(E)),e.writeVarint(yf(C)),u+=E,d+=C}n.type===3&&e.writeVarint(ch(7,1))}}function hh(n,e){const i=typeof n;i==="string"?e.writeStringField(1,n):i==="boolean"?e.writeBooleanField(7,n):i==="number"&&(n%1!=0?e.writeDoubleField(3,n):n<0?e.writeSVarintField(6,n):e.writeVarintField(5,n))}class kp{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new fo(wt,16,0),this.grid3D=new fo(wt,16,0),this.featureIndexArray=new R,this.promoteId=i}insert(e,i,o,u,d,p){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,d);const x=p?this.grid3D:this.grid;for(let T=0;T<i.length;T++){const E=i[T],C=[1/0,1/0,-1/0,-1/0];for(let D=0;D<E.length;D++){const P=E[D];C[0]=Math.min(C[0],P.x),C[1]=Math.min(C[1],P.y),C[2]=Math.max(C[2],P.x),C[3]=Math.max(C[3],P.y)}C[0]<wt&&C[1]<wt&&C[2]>=0&&C[3]>=0&&x.insert(y,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new vi(new Jh(this.rawTileData)).layers:new Bp(this.rawTileData).layers,this.sourceLayerCoder=new hd(this.vtLayers?Object.keys(this.vtLayers).sort():[uh])),this.vtLayers}query(e,i,o,u){this.loadVTLayers();const d=e.params,p=wt/e.tileSize/e.scale,y=Fr(d.filter,d.globalState),x=e.queryGeometry,T=e.queryPadding*p,E=Gs.fromPoints(x),C=this.grid.query(E.minX-T,E.minY-T,E.maxX+T,E.maxY+T),D=Gs.fromPoints(e.cameraQueryGeometry).expandBy(T),P=this.grid3D.query(D.minX,D.minY,D.maxX,D.maxY,((N,G,J,q)=>(function($,te,ne,be,Ne){for(const $e of $)if(te<=$e.x&&ne<=$e.y&&be>=$e.x&&Ne>=$e.y)return!0;const Oe=[new me(te,ne),new me(te,Ne),new me(be,Ne),new me(be,ne)];if($.length>2){for(const $e of Oe)if(Hu($,$e))return!0}for(let $e=0;$e<$.length-1;$e++)if(Hp($[$e],$[$e+1],Oe))return!0;return!1})(e.cameraQueryGeometry,N-T,G-T,J+T,q+T)));for(const N of P)C.push(N);C.sort(Cd);const O={};let k;for(let N=0;N<C.length;N++){const G=C[N];if(G===k)continue;k=G;const J=this.featureIndexArray.get(G);let q=null;this.loadMatchingFeature(O,J.bucketIndex,J.sourceLayerIndex,J.featureIndex,y,d.layers,d.availableImages,i,o,u,(($,te,ne)=>(q||(q=ca($)),te.queryIntersectsFeature({queryGeometry:x,feature:$,featureState:ne,geometry:q,zoom:this.z,transform:e.transform,pixelsToTileUnits:p,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return O}loadMatchingFeature(e,i,o,u,d,p,y,x,T,E,C){const D=this.bucketLayerIDs[i];if(p&&!D.some((N=>p.has(N))))return;const P=this.sourceLayerCoder.decode(o),O=this.vtLayers[P].feature(u);if(d.needGeometry){const N=xo(O,!0);if(!d.filter(new Qt(this.tileID.overscaledZ),N,this.tileID.canonical))return}else if(!d.filter(new Qt(this.tileID.overscaledZ),O))return;const k=this.getId(O,P);for(let N=0;N<D.length;N++){const G=D[N];if(p&&!p.has(G))continue;const J=x[G];if(!J)continue;let q={};k&&E&&(q=E.getState(J.sourceLayer||uh,k));const $=Si({},T[G]);$.paint=Ad($.paint,J.paint,O,q,y),$.layout=Ad($.layout,J.layout,O,q,y);const te=!C||C(O,J,q);if(!te)continue;const ne=new fd(O,this.z,this.x,this.y,k);ne.layer=$;let be=e[G];be===void 0&&(be=e[G]=[]),be.push({featureIndex:u,feature:ne,intersectionZ:te})}}lookupSymbolFeatures(e,i,o,u,d,p,y,x){const T={};this.loadVTLayers();const E=Fr(d.filterSpec,d.globalState);for(const C of e)this.loadMatchingFeature(T,o,u,C,E,p,y,x,i);return T}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){var o;let u=e.id;return this.promoteId&&(u=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(u=Number(e.properties.cluster_id))),u}}function Ad(n,e,i,o,u){return vr(n,((d,p)=>{const y=e instanceof $o?e.get(p):null;return y&&y.evaluate?y.evaluate(i,o,u):y}))}function Cd(n,e){return e-n}function Fp(n,e,i,o,u){const d=[];for(let p=0;p<n.length;p++){const y=n[p];let x;for(let T=0;T<y.length-1;T++){let E=y[T],C=y[T+1];E.x<e&&C.x<e||(E.x<e?E=new me(e,E.y+(e-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x<e&&(C=new me(e,E.y+(e-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y<i&&C.y<i||(E.y<i?E=new me(E.x+(i-E.y)/(C.y-E.y)*(C.x-E.x),i)._round():C.y<i&&(C=new me(E.x+(i-E.y)/(C.y-E.y)*(C.x-E.x),i)._round()),E.x>=o&&C.x>=o||(E.x>=o?E=new me(o,E.y+(o-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x>=o&&(C=new me(o,E.y+(o-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y>=u&&C.y>=u||(E.y>=u?E=new me(E.x+(u-E.y)/(C.y-E.y)*(C.x-E.x),u)._round():C.y>=u&&(C=new me(E.x+(u-E.y)/(C.y-E.y)*(C.x-E.x),u)._round()),x&&E.equals(x[x.length-1])||(x=[E],d.push(x)),x.push(C)))))}}return d}function Fm(n,e,i,o,u){switch(e){case 1:return(function(d,p,y,x){const T=[];for(const E of d)for(const C of E){const D=x===0?C.x:C.y;D>=p&&D<=y&&T.push([C])}return T})(n,i,o,u);case 2:return r(n,i,o,u,!1);case 3:return r(n,i,o,u,!0)}return[]}function zd(n,e,i,o,u){const d=o===0?s:c;let p=[];const y=[];for(let E=0;E<n.length-1;E++){const C=n[E],D=n[E+1],P=o===0?C.x:C.y,O=o===0?D.x:D.y;let k=!1;P<e?O>e&&p.push(d(C,D,e)):P>i?O<i&&p.push(d(C,D,i)):p.push(C),O<e&&P>=e&&(p.push(d(C,D,e)),k=!0),O>i&&P<=i&&(p.push(d(C,D,i)),k=!0),!u&&k&&(y.push(p),p=[])}const x=n.length-1,T=o===0?n[x].x:n[x].y;return T>=e&&T<=i&&p.push(n[x]),u&&p.length>0&&!p[0].equals(p[p.length-1])&&p.push(new me(p[0].x,p[0].y)),p.length>0&&y.push(p),y}function r(n,e,i,o,u){const d=[];for(const p of n){const y=zd(p,e,i,o,u);y.length>0&&d.push(...y)}return d}function s(n,e,i){return new me(i,n.y+(i-n.x)/(e.x-n.x)*(e.y-n.y))}function c(n,e,i){return new me(n.x+(i-n.y)/(e.y-n.y)*(e.x-n.x),i)}nt("FeatureIndex",kp,{omit:["rawTileData","sourceLayerCoder"]});class g extends me{constructor(e,i,o,u){super(e,i),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new g(this.x,this.y,this.angle,this.segment)}}function b(n,e,i,o,u){if(e.segment===void 0||i===0)return!0;let d=e,p=e.segment+1,y=0;for(;y>-i/2;){if(p--,p<0)return!1;y-=n[p].dist(d),d=n[p]}y+=n[p].dist(n[p+1]),p++;const x=[];let T=0;for(;y<i/2;){const E=n[p],C=n[p+1];if(!C)return!1;let D=n[p-1].angleTo(E)-E.angleTo(C);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:D}),T+=D;y-x[0].distance>o;)T-=x.shift().angleDelta;if(T>u)return!1;p++,y+=E.dist(C)}return!0}function M(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function B(n,e,i){return n?.6*e*i:0}function Z(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function ue(n,e,i,o,u,d){const p=B(i,u,d),y=Z(i,o)*d;let x=0;const T=M(n)/2;for(let E=0;E<n.length-1;E++){const C=n[E],D=n[E+1],P=C.dist(D);if(x+P>T){const O=(T-x)/P,k=Ni.number(C.x,D.x,O),N=Ni.number(C.y,D.y,O),G=new g(k,N,D.angleTo(C),E);return G._round(),!p||b(n,G,y,p,e)?G:void 0}x+=P}}function Pe(n,e,i,o,u,d,p,y,x){const T=B(o,d,p),E=Z(o,u),C=E*p,D=n[0].x===0||n[0].x===x||n[0].y===0||n[0].y===x;return e-C<e/4&&(e=C+e/4),Ge(n,D?e/2*y%e:(E/2+2*d)*p*y%e,e,T,i,C,D,!1,x)}function Ge(n,e,i,o,u,d,p,y,x){const T=d/2,E=M(n);let C=0,D=e-i,P=[];for(let O=0;O<n.length-1;O++){const k=n[O],N=n[O+1],G=k.dist(N),J=N.angleTo(k);for(;D+i<C+G;){D+=i;const q=(D-C)/G,$=Ni.number(k.x,N.x,q),te=Ni.number(k.y,N.y,q);if($>=0&&$<x&&te>=0&&te<x&&D-T>=0&&D+T<=E){const ne=new g($,te,J,O);ne._round(),o&&!b(n,ne,d,o,u)||P.push(ne)}}C+=G}return y||P.length||p||(P=Ge(n,C/2,i,o,u,d,p,!0,x)),P}function We(n,e,i,o){const u=[],d=n.image,p=d.pixelRatio,y=d.paddedRect.w-2,x=d.paddedRect.h-2;let T={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const E=d.stretchX||[[0,y]],C=d.stretchY||[[0,x]],D=(ze,ut)=>ze+ut[1]-ut[0],P=E.reduce(D,0),O=C.reduce(D,0),k=y-P,N=x-O;let G=0,J=P,q=0,$=O,te=0,ne=k,be=0,Ne=N;if(d.content&&o){const ze=d.content,ut=ze[2]-ze[0],ot=ze[3]-ze[1];(d.textFitWidth||d.textFitHeight)&&(T=rd(n)),G=Re(E,0,ze[0]),q=Re(C,0,ze[1]),J=Re(E,ze[0],ze[2]),$=Re(C,ze[1],ze[3]),te=ze[0]-G,be=ze[1]-q,ne=ut-J,Ne=ot-$}const Oe=T.x1,$e=T.y1,tt=T.x2-Oe,Ye=T.y2-$e,ke=(ze,ut,ot,ht)=>{const at=_t(ze.stretch-G,J,tt,Oe),yt=Dt(ze.fixed-te,ne,ze.stretch,P),oi=_t(ut.stretch-q,$,Ye,$e),Ht=Dt(ut.fixed-be,Ne,ut.stretch,O),un=_t(ot.stretch-G,J,tt,Oe),$r=Dt(ot.fixed-te,ne,ot.stretch,P),Kn=_t(ht.stretch-q,$,Ye,$e),cn=Dt(ht.fixed-be,Ne,ht.stretch,O),Ki=new me(at,oi),Ti=new me(un,oi),wn=new me(un,Kn),On=new me(at,Kn),qi=new me(yt/p,Ht/p),Za=new me($r/p,cn/p),Xr=e*Math.PI/180;if(Xr){const gr=Math.sin(Xr),gn=Math.cos(Xr),Jn=[gn,-gr,gr,gn];Ki._matMult(Jn),Ti._matMult(Jn),On._matMult(Jn),wn._matMult(Jn)}const Ha=ze.stretch+ze.fixed,Mo=ut.stretch+ut.fixed;return{tl:Ki,tr:Ti,bl:On,br:wn,tex:{x:d.paddedRect.x+1+Ha,y:d.paddedRect.y+1+Mo,w:ot.stretch+ot.fixed-Ha,h:ht.stretch+ht.fixed-Mo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qi,pixelOffsetBR:Za,minFontScaleX:ne/p/tt,minFontScaleY:Ne/p/Ye,isSDF:i}};if(o&&(d.stretchX||d.stretchY)){const ze=Be(E,k,P),ut=Be(C,N,O);for(let ot=0;ot<ze.length-1;ot++){const ht=ze[ot],at=ze[ot+1];for(let yt=0;yt<ut.length-1;yt++)u.push(ke(ht,ut[yt],at,ut[yt+1]))}}else u.push(ke({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return u}function Re(n,e,i){let o=0;for(const u of n)o+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return o}function Be(n,e,i){const o=[{fixed:-1,stretch:0}];for(const[u,d]of n){const p=o[o.length-1];o.push({fixed:u-p.stretch,stretch:p.stretch}),o.push({fixed:u-p.stretch,stretch:p.stretch+(d-u)})}return o.push({fixed:e+1,stretch:i}),o}function _t(n,e,i,o){return n/e*i+o}function Dt(n,e,i,o){return n-e*i/o}nt("Anchor",g);class Pi{constructor(e,i,o,u,d,p,y,x,T,E){var C;if(this.boxStartIndex=e.length,T){let D=p.top,P=p.bottom;const O=p.collisionPadding;O&&(D-=O[1],P+=O[3]);let k=P-D;k>0&&(k=Math.max(10,k),this.circleDiameter=k)}else{const D=!((C=p.image)===null||C===void 0)&&C.content&&(p.image.textFitWidth||p.image.textFitHeight)?rd(p):{x1:p.left,y1:p.top,x2:p.right,y2:p.bottom};D.y1=D.y1*y-x[0],D.y2=D.y2*y+x[2],D.x1=D.x1*y-x[3],D.x2=D.x2*y+x[1];const P=p.collisionPadding;if(P&&(D.x1-=P[0]*y,D.y1-=P[1]*y,D.x2+=P[2]*y,D.y2+=P[3]*y),E){const O=new me(D.x1,D.y1),k=new me(D.x2,D.y1),N=new me(D.x1,D.y2),G=new me(D.x2,D.y2),J=E*Math.PI/180;O._rotate(J),k._rotate(J),N._rotate(J),G._rotate(J),D.x1=Math.min(O.x,k.x,N.x,G.x),D.x2=Math.max(O.x,k.x,N.x,G.x),D.y1=Math.min(O.y,k.y,N.y,G.y),D.y2=Math.max(O.y,k.y,N.y,G.y)}e.emplaceBack(i.x,i.y,D.x1,D.y1,D.x2,D.y2,o,u,d)}this.boxEndIndex=e.length}}class _e{constructor(e=[],i=(o,u)=>o<u?-1:o>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,u=i[e];for(;e>0;){const d=e-1>>1,p=i[d];if(o(u,p)>=0)break;i[e]=p,e=d}i[e]=u}_down(e){const{data:i,compare:o}=this,u=this.length>>1,d=i[e];for(;e<u;){let p=1+(e<<1);const y=p+1;if(y<this.length&&o(i[y],i[p])<0&&(p=y),o(i[p],d)>=0)break;i[e]=i[p],e=p}i[e]=d}}function pe(n,e=1,i=!1){const o=Gs.fromPoints(n[0]),u=Math.min(o.width(),o.height());let d=u/2;const p=new _e([],De),{minX:y,minY:x,maxX:T,maxY:E}=o;if(u===0)return new me(y,x);for(let P=y;P<T;P+=u)for(let O=x;O<E;O+=u)p.push(new Ze(P+d,O+d,d,n));let C=(function(P){let O=0,k=0,N=0;const G=P[0];for(let J=0,q=G.length,$=q-1;J<q;$=J++){const te=G[J],ne=G[$],be=te.x*ne.y-ne.x*te.y;k+=(te.x+ne.x)*be,N+=(te.y+ne.y)*be,O+=3*be}return new Ze(k/O,N/O,0,P)})(n),D=p.length;for(;p.length;){const P=p.pop();(P.d>C.d||!C.d)&&(C=P,i&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,D)),P.max-C.d<=e||(d=P.h/2,p.push(new Ze(P.p.x-d,P.p.y-d,d,n)),p.push(new Ze(P.p.x+d,P.p.y-d,d,n)),p.push(new Ze(P.p.x-d,P.p.y+d,d,n)),p.push(new Ze(P.p.x+d,P.p.y+d,d,n)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${C.d}`)),C.p}function De(n,e){return e.max-n.max}function Ze(n,e,i,o){this.p=new me(n,e),this.h=i,this.d=(function(u,d){let p=!1,y=1/0;for(let x=0;x<d.length;x++){const T=d[x];for(let E=0,C=T.length,D=C-1;E<C;D=E++){const P=T[E],O=T[D];P.y>u.y!=O.y>u.y&&u.x<(O.x-P.x)*(u.y-P.y)/(O.y-P.y)+P.x&&(p=!p),y=Math.min(y,pr(u,P,O))}}return(p?1:-1)*Math.sqrt(y)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var pt;L.aQ=void 0,(pt=L.aQ||(L.aQ={}))[pt.center=1]="center",pt[pt.left=2]="left",pt[pt.right=3]="right",pt[pt.top=4]="top",pt[pt.bottom=5]="bottom",pt[pt["top-left"]=6]="top-left",pt[pt["top-right"]=7]="top-right",pt[pt["bottom-left"]=8]="bottom-left",pt[pt["bottom-right"]=9]="bottom-right";const di=Number.POSITIVE_INFINITY;function bt(n,e){return e[1]!==di?(function(i,o,u){let d=0,p=0;switch(o=Math.abs(o),u=Math.abs(u),i){case"top-right":case"top-left":case"top":p=u-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-u}switch(i){case"top-right":case"bottom-right":case"right":d=-o;break;case"top-left":case"bottom-left":case"left":d=o}return[d,p]})(n,e[0],e[1]):(function(i,o){let u=0,d=0;o<0&&(o=0);const p=o/Math.SQRT2;switch(i){case"top-right":case"top-left":d=p-7;break;case"bottom-right":case"bottom-left":d=7-p;break;case"bottom":d=7-o;break;case"top":d=o-7}switch(i){case"top-right":case"bottom-right":u=-p;break;case"top-left":case"bottom-left":u=p;break;case"left":u=o;break;case"right":u=-o}return[u,d]})(n,e[0])}function qt(n,e,i){var o;const u=n.layout,d=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},i);if(d){const y=d.values,x=[];for(let T=0;T<y.length;T+=2){const E=x[T]=y[T],C=y[T+1].map((D=>D*xi));E.startsWith("top")?C[1]-=7:E.startsWith("bottom")&&(C[1]+=7),x[T+1]=C}return new rn(x)}const p=u.get("text-variable-anchor");if(p){let y;y=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},i)*xi,di]:u.get("text-offset").evaluate(e,{},i).map((T=>T*xi));const x=[];for(const T of p)x.push(T,bt(T,y));return new rn(x)}return null}function ii(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wi(n,e,i,o,u,d,p,y,x,T,E,C){let D=d.textMaxSize.evaluate(e,{});D===void 0&&(D=p);const P=n.layers[0].layout,O=P.get("icon-offset").evaluate(e,{},E),k=Nm(i.horizontal),N=p/24,G=n.tilePixelRatio*N,J=n.tilePixelRatio*D/24,q=n.tilePixelRatio*y,$=n.tilePixelRatio*P.get("symbol-spacing"),te=P.get("text-padding")*n.tilePixelRatio,ne=(function(ot,ht,at,yt=1){const oi=ot.get("icon-padding").evaluate(ht,{},at),Ht=oi&&oi.values;return[Ht[0]*yt,Ht[1]*yt,Ht[2]*yt,Ht[3]*yt]})(P,e,E,n.tilePixelRatio),be=P.get("text-max-angle")/180*Math.PI,Ne=P.get("text-rotation-alignment")!=="viewport"&&P.get("symbol-placement")!=="point",Oe=P.get("icon-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",$e=P.get("symbol-placement"),tt=$/2,Ye=P.get("icon-text-fit");let ke;o&&Ye!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(ke=tf(o,i.vertical,Ye,P.get("icon-text-fit-padding"),O,N)),k&&(o=tf(o,k,Ye,P.get("icon-text-fit-padding"),O,N)));const ze=E?C.line.getGranularityForZoomLevel(E.z):1,ut=(ot,ht)=>{ht.x<0||ht.x>=wt||ht.y<0||ht.y>=wt||(function(at,yt,oi,Ht,un,$r,Kn,cn,Ki,Ti,wn,On,qi,Za,Xr,Ha,Mo,gr,gn,Jn,Tn,_r,ac,fl,jp){const fh=at.addToLineVertexArray(yt,oi);let vf,Dd,Pd,Id,Rg=0,Lg=0,Og=0,Bg=0,vg=-1,xg=-1;const sc={};let kg=Li("");if(at.allowVerticalPlacement&&Ht.vertical){const pa=cn.layout.get("text-rotate").evaluate(Tn,{},fl)+90;Pd=new Pi(Ki,yt,Ti,wn,On,Ht.vertical,qi,Za,Xr,pa),Kn&&(Id=new Pi(Ki,yt,Ti,wn,On,Kn,Mo,gr,Xr,pa))}if(un){const pa=cn.layout.get("icon-rotate").evaluate(Tn,{}),qs=cn.layout.get("icon-text-fit")!=="none",xf=We(un,pa,ac,qs),pl=Kn?We(Kn,pa,ac,qs):void 0;Dd=new Pi(Ki,yt,Ti,wn,On,un,Mo,gr,!1,pa),Rg=4*xf.length;const bf=at.iconSizeData;let ou=null;bf.kind==="source"?(ou=[Vs*cn.layout.get("icon-size").evaluate(Tn,{})],ou[0]>ha&&Zi(`${at.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):bf.kind==="composite"&&(ou=[Vs*_r.compositeIconSizes[0].evaluate(Tn,{},fl),Vs*_r.compositeIconSizes[1].evaluate(Tn,{},fl)],(ou[0]>ha||ou[1]>ha)&&Zi(`${at.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),at.addSymbols(at.icon,xf,ou,Jn,gn,Tn,L.aA.none,yt,fh.lineStartIndex,fh.lineLength,-1,fl),vg=at.icon.placedSymbolArray.length-1,pl&&(Lg=4*pl.length,at.addSymbols(at.icon,pl,ou,Jn,gn,Tn,L.aA.vertical,yt,fh.lineStartIndex,fh.lineLength,-1,fl),xg=at.icon.placedSymbolArray.length-1)}const Fg=Object.keys(Ht.horizontal);for(const pa of Fg){const qs=Ht.horizontal[pa];if(!vf){kg=Li(qs.text);const pl=cn.layout.get("text-rotate").evaluate(Tn,{},fl);vf=new Pi(Ki,yt,Ti,wn,On,qs,qi,Za,Xr,pl)}const xf=qs.positionedLines.length===1;if(Og+=hl(at,yt,qs,$r,cn,Xr,Tn,Ha,fh,Ht.vertical?L.aA.horizontal:L.aA.horizontalOnly,xf?Fg:[pa],sc,vg,_r,fl),xf)break}Ht.vertical&&(Bg+=hl(at,yt,Ht.vertical,$r,cn,Xr,Tn,Ha,fh,L.aA.vertical,["vertical"],sc,xg,_r,fl));const f_=vf?vf.boxStartIndex:at.collisionBoxArray.length,d_=vf?vf.boxEndIndex:at.collisionBoxArray.length,p_=Pd?Pd.boxStartIndex:at.collisionBoxArray.length,m_=Pd?Pd.boxEndIndex:at.collisionBoxArray.length,g_=Dd?Dd.boxStartIndex:at.collisionBoxArray.length,__=Dd?Dd.boxEndIndex:at.collisionBoxArray.length,y_=Id?Id.boxStartIndex:at.collisionBoxArray.length,v_=Id?Id.boxEndIndex:at.collisionBoxArray.length;let dl=-1;const jm=(pa,qs)=>pa&&pa.circleDiameter?Math.max(pa.circleDiameter,qs):qs;dl=jm(vf,dl),dl=jm(Pd,dl),dl=jm(Dd,dl),dl=jm(Id,dl);const Ng=dl>-1?1:0;Ng&&(dl*=jp/xi),at.glyphOffsetArray.length>=Jl.MAX_GLYPHS&&Zi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Tn.sortKey!==void 0&&at.addToSortKeyRanges(at.symbolInstances.length,Tn.sortKey);const x_=qt(cn,Tn,fl),[b_,w_]=(function(pa,qs){const xf=pa.length,pl=qs?.values;if(pl?.length>0)for(let bf=0;bf<pl.length;bf+=2){const ou=pl[bf+1];pa.emplaceBack(L.aQ[pl[bf]],ou[0],ou[1])}return[xf,pa.length]})(at.textAnchorOffsets,x_);at.symbolInstances.emplaceBack(yt.x,yt.y,sc.right>=0?sc.right:-1,sc.center>=0?sc.center:-1,sc.left>=0?sc.left:-1,sc.vertical||-1,vg,xg,kg,f_,d_,p_,m_,g_,__,y_,v_,Ti,Og,Bg,Rg,Lg,Ng,0,qi,dl,b_,w_)})(n,ht,ot,i,o,u,ke,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,G,[te,te,te,te],Ne,x,q,ne,Oe,O,e,d,T,E,p)};if($e==="line")for(const ot of Fp(e.geometry,0,0,wt,wt)){const ht=Va(ot,ze),at=Pe(ht,$,be,i.vertical||k,o,24,J,n.overscaling,wt);for(const yt of at)k&&c_(n,k.text,tt,yt)||ut(ht,yt)}else if($e==="line-center"){for(const ot of e.geometry)if(ot.length>1){const ht=Va(ot,ze),at=ue(ht,be,i.vertical||k,o,24,J);at&&ut(ht,at)}}else if(e.type==="Polygon")for(const ot of wu(e.geometry,0)){const ht=pe(ot,16);ut(Va(ot[0],ze,!0),new g(ht.x,ht.y,0))}else if(e.type==="LineString")for(const ot of e.geometry){const ht=Va(ot,ze);ut(ht,new g(ht[0].x,ht[0].y,0))}else if(e.type==="Point")for(const ot of e.geometry)for(const ht of ot)ut([ht],new g(ht.x,ht.y,0))}function hl(n,e,i,o,u,d,p,y,x,T,E,C,D,P,O){const k=(function(J,q,$,te,ne,be,Ne,Oe){const $e=te.layout.get("text-rotate").evaluate(be,{})*Math.PI/180,tt=[];for(const Ye of q.positionedLines)for(const ke of Ye.positionedGlyphs){if(!ke.rect)continue;const ze=ke.rect||{};let ut=4,ot=!0,ht=1,at=0;const yt=(ne||Oe)&&ke.vertical,oi=ke.metrics.advance*ke.scale/2;if(Oe&&q.verticalizable&&(at=Ye.lineOffset/2-(ke.imageName?-(xi-ke.metrics.width*ke.scale)/2:(ke.scale-1)*xi)),ke.imageName){const gr=Ne[ke.imageName];ot=gr.sdf,ht=gr.pixelRatio,ut=1/ht}const Ht=ne?[ke.x+oi,ke.y]:[0,0];let un=ne?[0,0]:[ke.x+oi+$[0],ke.y+$[1]-at],$r=[0,0];yt&&($r=un,un=[0,0]);const Kn=ke.metrics.isDoubleResolution?2:1,cn=(ke.metrics.left-ut)*ke.scale-oi+un[0],Ki=(-ke.metrics.top-ut)*ke.scale+un[1],Ti=cn+ze.w/Kn*ke.scale/ht,wn=Ki+ze.h/Kn*ke.scale/ht,On=new me(cn,Ki),qi=new me(Ti,Ki),Za=new me(cn,wn),Xr=new me(Ti,wn);if(yt){const gr=new me(-oi,oi- -17),gn=-Math.PI/2,Jn=12-oi,Tn=new me(22-Jn,-(ke.imageName?Jn:0)),_r=new me(...$r);On._rotateAround(gn,gr)._add(Tn)._add(_r),qi._rotateAround(gn,gr)._add(Tn)._add(_r),Za._rotateAround(gn,gr)._add(Tn)._add(_r),Xr._rotateAround(gn,gr)._add(Tn)._add(_r)}if($e){const gr=Math.sin($e),gn=Math.cos($e),Jn=[gn,-gr,gr,gn];On._matMult(Jn),qi._matMult(Jn),Za._matMult(Jn),Xr._matMult(Jn)}const Ha=new me(0,0),Mo=new me(0,0);tt.push({tl:On,tr:qi,bl:Za,br:Xr,tex:ze,writingMode:q.writingMode,glyphOffset:Ht,sectionIndex:ke.sectionIndex,isSDF:ot,pixelOffsetTL:Ha,pixelOffsetBR:Mo,minFontScaleX:0,minFontScaleY:0})}return tt})(0,i,y,u,d,p,o,n.allowVerticalPlacement),N=n.textSizeData;let G=null;N.kind==="source"?(G=[Vs*u.layout.get("text-size").evaluate(p,{})],G[0]>ha&&Zi(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):N.kind==="composite"&&(G=[Vs*P.compositeTextSizes[0].evaluate(p,{},O),Vs*P.compositeTextSizes[1].evaluate(p,{},O)],(G[0]>ha||G[1]>ha)&&Zi(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,k,G,y,d,p,T,e,x.lineStartIndex,x.lineLength,D,O);for(const J of E)C[J]=n.text.placedSymbolArray.length-1;return 4*k.length}function Nm(n){for(const e in n)return n[e];return null}function c_(n,e,i,o){const u=n.compareText;if(e in u){const d=u[e];for(let p=d.length-1;p>=0;p--)if(o.dist(d[p])<i)return!0}else u[e]=[];return u[e].push(o),!1}const Dg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class fg{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const d=Dg[15&o];if(!d)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new fg(y,p,d,e)}constructor(e,i=64,o=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=Dg.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return dg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:p,nodeSize:y}=this,x=[0,d.length-1,0],T=[];for(;x.length;){const E=x.pop()||0,C=x.pop()||0,D=x.pop()||0;if(C-D<=y){for(let N=D;N<=C;N++){const G=p[2*N],J=p[2*N+1];G>=e&&G<=o&&J>=i&&J<=u&&T.push(d[N])}continue}const P=D+C>>1,O=p[2*P],k=p[2*P+1];O>=e&&O<=o&&k>=i&&k<=u&&T.push(d[P]),(E===0?e<=O:i<=k)&&(x.push(D),x.push(P-1),x.push(1-E)),(E===0?o>=O:u>=k)&&(x.push(P+1),x.push(C),x.push(1-E))}return T}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:d,nodeSize:p}=this,y=[0,u.length-1,0],x=[],T=o*o;for(;y.length;){const E=y.pop()||0,C=y.pop()||0,D=y.pop()||0;if(C-D<=p){for(let N=D;N<=C;N++)Ig(d[2*N],d[2*N+1],e,i)<=T&&x.push(u[N]);continue}const P=D+C>>1,O=d[2*P],k=d[2*P+1];Ig(O,k,e,i)<=T&&x.push(u[P]),(E===0?e-o<=O:i-o<=k)&&(y.push(D),y.push(P-1),y.push(1-E)),(E===0?e+o>=O:i+o>=k)&&(y.push(P+1),y.push(C),y.push(1-E))}return x}}function dg(n,e,i,o,u,d){if(u-o<=i)return;const p=o+u>>1;Pg(n,e,p,o,u,d),dg(n,e,i,o,p-1,1-d),dg(n,e,i,p+1,u,1-d)}function Pg(n,e,i,o,u,d){for(;u>o;){if(u-o>600){const T=u-o+1,E=i-o+1,C=Math.log(T),D=.5*Math.exp(2*C/3),P=.5*Math.sqrt(C*D*(T-D)/T)*(E-T/2<0?-1:1);Pg(n,e,i,Math.max(o,Math.floor(i-E*D/T+P)),Math.min(u,Math.floor(i+(T-E)*D/T+P)),d)}const p=e[2*i+d];let y=o,x=u;for(Np(n,e,o,i),e[2*u+d]>p&&Np(n,e,o,u);y<x;){for(Np(n,e,y,x),y++,x--;e[2*y+d]<p;)y++;for(;e[2*x+d]>p;)x--}e[2*o+d]===p?Np(n,e,o,x):(x++,Np(n,e,x,u)),x<=i&&(o=x+1),i<=x&&(u=x-1)}}function Np(n,e,i,o){pg(n,i,o),pg(e,2*i,2*o),pg(e,2*i+1,2*o+1)}function pg(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function Ig(n,e,i,o){const u=n-i,d=e-o;return u*u+d*d}var mg;L.cI=void 0,(mg=L.cI||(L.cI={})).create="create",mg.load="load",mg.fullLoad="fullLoad";let Vm=null,Vp=[];const gg=1e3/60,_g="loadTime",yg="fullLoadTime",h_={mark(n){performance.mark(n)},frame(n){const e=n;Vm!=null&&Vp.push(e-Vm),Vm=e},clearMetrics(){Vm=null,Vp=[],performance.clearMeasures(_g),performance.clearMeasures(yg);for(const n in L.cI)performance.clearMarks(L.cI[n])},getPerformanceMetrics(){performance.measure(_g,L.cI.create,L.cI.load),performance.measure(yg,L.cI.create,L.cI.fullLoad);const n=performance.getEntriesByName(_g)[0].duration,e=performance.getEntriesByName(yg)[0].duration,i=Vp.length,o=1/(Vp.reduce(((d,p)=>d+p),0)/i/1e3),u=Vp.filter((d=>d>gg)).reduce(((d,p)=>d+(p-gg)/gg),0);return{loadTime:n,fullLoadTime:e,fps:o,percentDroppedFrames:u/(i+u)*100,totalFrames:i}}};L.$=Ae,L.A=Ut,L.B=Bu,L.C=kl,L.D=dt,L.E=Jt,L.F=function([n,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:n*Math.cos(e)*Math.sin(i),y:n*Math.sin(e)*Math.sin(i),z:n*Math.cos(i)}},L.G=Ni,L.H=Qt,L.I=Wc,L.J=Ou,L.K=function(n){if(tn==null){const e=n.navigator?n.navigator.userAgent:null;tn=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return tn},L.L=class{constructor(n,e){this.target=n,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new _m((()=>this.process())),this.subscription=_l(this.target,"message",(i=>this.receive(i)),!1),this.globalScope=ma(self)?n:window}registerMessageHandler(n,e){this.messageHandlers[n]=e}unregisterMessageHandler(n){delete this.messageHandlers[n]}sendAsync(n,e){return new Promise(((i,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),d=e?_l(e.signal,"abort",(()=>{d?.unsubscribe(),delete this.resolveRejects[u];const x={id:u,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)}),ri):null;this.resolveRejects[u]={resolve:x=>{d?.unsubscribe(),i(x)},reject:x=>{d?.unsubscribe(),o(x)}};const p=[],y=Object.assign(Object.assign({},n),{id:u,sourceMapId:this.mapId,origin:location.origin,data:mo(n.data,p)});this.target.postMessage(y,{transfer:p})}))}receive(n){const e=n.data,i=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[i];const o=this.abortControllers[i];return delete this.abortControllers[i],void(o&&o.abort())}if(ma(self)||e.mustQueue)return this.tasks[i]=e,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,e)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),e=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(n,e)}processTask(n,e){return f(this,void 0,void 0,(function*(){if(e.type==="<response>"){const u=this.resolveRejects[n];return delete this.resolveRejects[n],u?void(e.error?u.reject(Nl(e.error)):u.resolve(Nl(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=Nl(e.data),o=new AbortController;this.abortControllers[n]=o;try{const u=yield this.messageHandlers[e.type](e.sourceMapId,i,o);this.completeTask(n,null,u)}catch(u){this.completeTask(n,u)}}))}completeTask(n,e,i){const o=[];delete this.abortControllers[n];const u={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?mo(e):null,data:mo(i,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},L.M=ge,L.N=function(){var n=new Ut(16);return Ut!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},L.O=function(n,e,i){var o,u,d,p,y,x,T,E,C,D,P,O,k=i[0],N=i[1],G=i[2];return e===n?(n[12]=e[0]*k+e[4]*N+e[8]*G+e[12],n[13]=e[1]*k+e[5]*N+e[9]*G+e[13],n[14]=e[2]*k+e[6]*N+e[10]*G+e[14],n[15]=e[3]*k+e[7]*N+e[11]*G+e[15]):(u=e[1],d=e[2],p=e[3],y=e[4],x=e[5],T=e[6],E=e[7],C=e[8],D=e[9],P=e[10],O=e[11],n[0]=o=e[0],n[1]=u,n[2]=d,n[3]=p,n[4]=y,n[5]=x,n[6]=T,n[7]=E,n[8]=C,n[9]=D,n[10]=P,n[11]=O,n[12]=o*k+y*N+C*G+e[12],n[13]=u*k+x*N+D*G+e[13],n[14]=d*k+T*N+P*G+e[14],n[15]=p*k+E*N+O*G+e[15]),n},L.P=me,L.Q=function(n,e,i){var o=i[0],u=i[1],d=i[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*d,n[9]=e[9]*d,n[10]=e[10]*d,n[11]=e[11]*d,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},L.R=bn,L.S=function(n,e,i){var o=e[0],u=e[1],d=e[2],p=e[3],y=e[4],x=e[5],T=e[6],E=e[7],C=e[8],D=e[9],P=e[10],O=e[11],k=e[12],N=e[13],G=e[14],J=e[15],q=i[0],$=i[1],te=i[2],ne=i[3];return n[0]=q*o+$*y+te*C+ne*k,n[1]=q*u+$*x+te*D+ne*N,n[2]=q*d+$*T+te*P+ne*G,n[3]=q*p+$*E+te*O+ne*J,n[4]=(q=i[4])*o+($=i[5])*y+(te=i[6])*C+(ne=i[7])*k,n[5]=q*u+$*x+te*D+ne*N,n[6]=q*d+$*T+te*P+ne*G,n[7]=q*p+$*E+te*O+ne*J,n[8]=(q=i[8])*o+($=i[9])*y+(te=i[10])*C+(ne=i[11])*k,n[9]=q*u+$*x+te*D+ne*N,n[10]=q*d+$*T+te*P+ne*G,n[11]=q*p+$*E+te*O+ne*J,n[12]=(q=i[12])*o+($=i[13])*y+(te=i[14])*C+(ne=i[15])*k,n[13]=q*u+$*x+te*D+ne*N,n[14]=q*d+$*T+te*P+ne*G,n[15]=q*p+$*E+te*O+ne*J,n},L.T=Ui,L.U=function(n,e){const i={};for(let o=0;o<e.length;o++){const u=e[o];u in n&&(i[u]=n[u])}return i},L.V=Us,L.W=$t,L.X=eh,L.Y=ud,L.Z=ae,L._=f,L.a=H,L.a$=vm,L.a0=Ji,L.a1=$s,L.a2=fa,L.a3=ym,L.a4=of,L.a5=wt,L.a6=function(n,e,i){if(!n)return e||{};if(!e)return n||{};const o=bm(n),u=bm(e);(function(p,y){y.removeAll&&(p.add.clear(),p.update.clear(),p.remove.clear(),y.remove.clear());for(const x of y.remove)p.add.delete(x),p.update.delete(x);for(const[x,T]of y.update){const E=p.update.get(x);E&&(y.update.set(x,xm(E,T)),p.update.delete(x))}})(o,u);const d={};if((o.removeAll||u.removeAll)&&(d.removeAll=!0),d.remove=new Set([...o.remove,...u.remove]),d.add=new Map([...o.add,...u.add]),d.update=new Map([...o.update,...u.update]),d.remove.size&&d.add.size)for(const p of d.add.keys())d.remove.delete(p);return(function(p){const y={};return p.removeAll&&(y.removeAll=p.removeAll),p.remove&&(y.remove=Array.from(p.remove)),p.add&&(y.add=Array.from(p.add.values())),p.update&&(y.update=Array.from(p.update.values())),y})(d)},L.a7=function(n,e){if(n==null||n.type==null)return!0;if(n.type==="Feature")return uf(n,e)!=null;if(n.type==="FeatureCollection"){const i=new Set;for(const o of n.features){const u=uf(o,e);if(u==null||i.has(u))return!1;i.add(u)}return!0}return!1},L.a8=function(n,e){const i=new Map;if(!(n==null||n.type==null))if(n.type==="Feature")i.set(uf(n,e),n);else for(const o of n.features)i.set(uf(o,e),o);return i},L.a9=function(n,e,i){var o,u;if(e.removeAll)n.clear();else if(e.remove)for(const d of e.remove)n.delete(d);if(e.add)for(const d of e.add){const p=uf(d,i);p!=null&&n.set(p,d)}if(e.update)for(const d of e.update){let p=n.get(d.id);if(!p)continue;const y=!!d.newGeometry,x=d.removeAllProperties||((o=d.removeProperties)===null||o===void 0?void 0:o.length)>0||((u=d.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0;if((y||x)&&(p=Object.assign({},p),n.set(d.id,p),y&&(p.geometry=d.newGeometry),x)){if(p.properties=d.removeAllProperties?{}:Object.assign({},p.properties||{}),d.removeProperties)for(const T of d.removeProperties)delete p.properties[T];if(d.addOrUpdateProperties)for(const{key:T,value:E}of d.addOrUpdateProperties)p.properties[T]=E}}},L.aB=function(n,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:u}){return n.kind==="source"?o/Vs:n.kind==="composite"?Ni.number(o/Vs,u/Vs,i):e},L.aC=function(n,e){var i=e[0],o=e[1],u=e[2],d=e[3],p=e[4],y=e[5],x=e[6],T=e[7],E=e[8],C=e[9],D=e[10],P=e[11],O=e[12],k=e[13],N=e[14],G=e[15],J=i*y-o*p,q=i*x-u*p,$=i*T-d*p,te=o*x-u*y,ne=o*T-d*y,be=u*T-d*x,Ne=E*k-C*O,Oe=E*N-D*O,$e=E*G-P*O,tt=C*N-D*k,Ye=C*G-P*k,ke=D*G-P*N,ze=J*ke-q*Ye+$*tt+te*$e-ne*Oe+be*Ne;return ze?(n[0]=(y*ke-x*Ye+T*tt)*(ze=1/ze),n[1]=(u*Ye-o*ke-d*tt)*ze,n[2]=(k*be-N*ne+G*te)*ze,n[3]=(D*ne-C*be-P*te)*ze,n[4]=(x*$e-p*ke-T*Oe)*ze,n[5]=(i*ke-u*$e+d*Oe)*ze,n[6]=(N*$-O*be-G*q)*ze,n[7]=(E*be-D*$+P*q)*ze,n[8]=(p*Ye-y*$e+T*Ne)*ze,n[9]=(o*$e-i*Ye-d*Ne)*ze,n[10]=(O*ne-k*$+G*J)*ze,n[11]=(C*$-E*ne-P*J)*ze,n[12]=(y*Oe-p*tt-x*Ne)*ze,n[13]=(i*tt-o*Oe+u*Ne)*ze,n[14]=(k*q-O*te-N*J)*ze,n[15]=(E*te-C*q+D*J)*ze,n):null},L.aD=rt,L.aE=function(n){var e=n[0],i=n[1];return Math.sqrt(e*e+i*i)},L.aF=function(n){return n[0]=0,n[1]=0,n},L.aG=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n},L.aH=ad,L.aI=Qr,L.aJ=function(n,e,i,o){const u=e.y-n.y,d=e.x-n.x,p=o.y-i.y,y=o.x-i.x,x=p*d-y*u;if(x===0)return null;const T=(y*(n.y-i.y)-p*(n.x-i.x))/x;return new me(n.x+T*d,n.y+T*u)},L.aK=Fp,L.aL=Fc,L.aM=function(n){let e=1/0,i=1/0,o=-1/0,u=-1/0;for(const d of n)e=Math.min(e,d.x),i=Math.min(i,d.y),o=Math.max(o,d.x),u=Math.max(u,d.y);return[e,i,o,u]},L.aN=xi,L.aO=ui,L.aP=function(n,e,i,o,u=!1){if(!i[0]&&!i[1])return[0,0];const d=u?o==="map"?-n.bearingInRadians:0:o==="viewport"?n.bearingInRadians:0;if(d){const p=Math.sin(d),y=Math.cos(d);i=[i[0]*y-i[1]*p,i[0]*p+i[1]*y]}return[u?i[0]:ui(e,i[0],n.zoom),u?i[1]:ui(e,i[1],n.zoom)]},L.aR=ec,L.aS=ii,L.aT=ef,L.aU=fg,L.aV=vt,L.aW=Ma,L.aX=I,L.aY=He,L.aZ=Me,L.a_=Br,L.aa=uh,L.ab=lf,L.ac=Gs,L.ad=25,L.ae=cd,L.af=n=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((i=>{e.onloadstart=()=>{i(e)};for(const o of n){const u=window.document.createElement("source");je(o)||(e.crossOrigin="Anonymous"),u.src=o,e.appendChild(u)}}))},L.ag=Ke,L.ah=function(){return Ri++},L.ai=t,L.aj=Jl,L.ak=Fr,L.al=xo,L.am=fd,L.an=function(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,o,u,d)=>{const p=u||d;return e[o]=!p||p.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e},L.ao=kt,L.ap=85.051129,L.aq=Gn,L.ar=function(n){return Math.pow(2,n)},L.as=yr,L.at=sf,L.au=function(n){return Math.log(n)/Math.LN2},L.av=function(n){var e=n[0],i=n[1];return e*e+i*i},L.aw=function(n){if(!n.length)return new Set;const e=Math.max(...n.map((x=>x.canonical.z)));let i=1/0,o=-1/0,u=1/0,d=-1/0;const p=[];for(const x of n){const{x:T,y:E,z:C}=x.canonical,D=Math.pow(2,e-C),P=T*D,O=E*D;p.push({id:x,x:P,y:O}),P<i&&(i=P),P>o&&(o=P),O<u&&(u=O),O>d&&(d=O)}const y=new Set;for(const x of p)x.x!==i&&x.x!==o&&x.y!==u&&x.y!==d||y.add(x.id);return y},L.ax=function(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||o-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x},L.ay=class{constructor(n,e){this.max=n,this.onRemove=e,this.reset()}reset(){for(const n in this.data)for(const e of this.data[n])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(n,e,i){const o=n.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const u={value:e,timeout:void 0};if(i!==void 0&&(u.timeout=setTimeout((()=>{this.remove(n,u)}),i)),this.data[o].push(u),this.order.push(o),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const e=this.data[n].shift();return e.timeout&&clearTimeout(e.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),e.value}getByKey(n){const e=this.data[n];return e?e[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,e){if(!this.has(n))return this;const i=n.wrapped().key,o=e===void 0?0:this.data[i].indexOf(e),u=this.data[i][o];return this.data[i].splice(o,1),u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(u.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(n){const e=[];for(const i in this.data)for(const o of this.data[i])n(o.value)||e.push(o);for(const i of e)this.remove(i.value.tileID,i)}},L.az=function(n,e){let i=0,o=0;if(n.kind==="constant")o=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:u,minZoom:d,maxZoom:p}=n,y=u?kt(Sr.interpolationFactor(u,e,d,p),0,1):0;n.kind==="camera"?o=Ni.number(n.minSize,n.maxSize,y):i=y}return{uSizeT:i,uSize:o}},L.b=_s,L.b$=class extends ar{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},L.b0=Lr,L.b1=ir,L.b2=function(n){var e=new Ut(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},L.b3=function(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n},L.b4=function(n,e){var i=e[0],o=e[1],u=e[2],d=i*i+o*o+u*u;return d>0&&(d=1/Math.sqrt(d)),n[0]=e[0]*d,n[1]=e[1]*d,n[2]=e[2]*d,n},L.b5=or,L.b6=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]},L.b7=function(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n[3]=e[3]*i[3],n},L.b8=Lt,L.b9=function(n,e,i){const o=e[0]*i[0]+e[1]*i[1]+e[2]*i[2];return o===0?null:(-(n[0]*i[0]+n[1]*i[1]+n[2]*i[2])-i[3])/o},L.bA=function(){return new Float64Array(3)},L.bB=function(n,e,i,o){return n[0]=e[0]+i[0]*o,n[1]=e[1]+i[1]*o,n[2]=e[2]+i[2]*o,n},L.bC=Ue,L.bD=function(n,e,i){var o=i[0],u=i[1],d=i[2],p=i[3],y=e[0],x=e[1],T=e[2],E=u*T-d*x,C=d*y-o*T,D=o*x-u*y;return n[0]=y+p*(E+=E)+u*(D+=D)-d*(C+=C),n[1]=x+p*C+d*E-o*D,n[2]=T+p*D+o*C-u*E,n},L.bE=function(n,e,i){const o=(function(x){var T=x[3],E=x[4],C=x[5],D=x[6],P=x[7],O=x[8];return x[0]*(O*E-C*P)+x[1]*(-O*T+C*D)+x[2]*(P*T-E*D)})([n[0],n[1],n[2],e[0],e[1],e[2],i[0],i[1],i[2]]);if(o===0)return null;const u=or([],[e[0],e[1],e[2]],[i[0],i[1],i[2]]),d=or([],[i[0],i[1],i[2]],[n[0],n[1],n[2]]),p=or([],[n[0],n[1],n[2]],[e[0],e[1],e[2]]),y=Lr([],u,-n[3]);return ir(y,y,Lr([],d,-e[3])),ir(y,y,Lr([],p,-i[3])),Lr(y,y,1/o),y},L.bF=af,L.bG=function(){return new Float64Array(4)},L.bH=function(n,e,i,o){var u=[],d=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],d[0]=u[0]*Math.cos(o)-u[1]*Math.sin(o),d[1]=u[0]*Math.sin(o)+u[1]*Math.cos(o),d[2]=u[2],n[0]=d[0]+i[0],n[1]=d[1]+i[1],n[2]=d[2]+i[2],n},L.bI=function(n,e,i,o){var u=[],d=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],d[0]=u[0],d[1]=u[1]*Math.cos(o)-u[2]*Math.sin(o),d[2]=u[1]*Math.sin(o)+u[2]*Math.cos(o),n[0]=d[0]+i[0],n[1]=d[1]+i[1],n[2]=d[2]+i[2],n},L.bJ=function(n,e,i,o){var u=[],d=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],d[0]=u[2]*Math.sin(o)+u[0]*Math.cos(o),d[1]=u[1],d[2]=u[2]*Math.cos(o)-u[0]*Math.sin(o),n[0]=d[0]+i[0],n[1]=d[1]+i[1],n[2]=d[2]+i[2],n},L.bK=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),d=e[0],p=e[1],y=e[2],x=e[3],T=e[8],E=e[9],C=e[10],D=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*u-T*o,n[1]=p*u-E*o,n[2]=y*u-C*o,n[3]=x*u-D*o,n[8]=d*o+T*u,n[9]=p*o+E*u,n[10]=y*o+C*u,n[11]=x*o+D*u,n},L.bL=function(n,e){const i=de(n,360),o=de(e,360),u=o-i,d=o>i?u-360:u+360;return Math.abs(u)<Math.abs(d)?u:d},L.bM=function(n){return n[0]=0,n[1]=0,n[2]=0,n},L.bN=function(n,e,i,o){const u=Math.sqrt(n*n+e*e),d=Math.sqrt(i*i+o*o);n/=u,e/=u,i/=d,o/=d;const p=Math.acos(n*i+e*o);return-e*i+n*o>0?p:-p},L.bO=function(n,e){const i=de(n,2*Math.PI),o=de(e,2*Math.PI);return Math.min(Math.abs(i-o),Math.abs(i-o+2*Math.PI),Math.abs(i-o-2*Math.PI))},L.bP=function(){const n={},e=ve.$version;for(const i in ve.$root){const o=ve.$root[i];if(o.required){let u=null;u=i==="version"?e:o.type==="array"?[]:{},u!=null&&(n[i]=u)}}return n},L.bQ=Se,L.bR=oa,L.bS=function n(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let o=0;o<e.length;o++)if(!n(e[o],i[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&i!==null){if(typeof i!="object"||Object.keys(e).length!==Object.keys(i).length)return!1;for(const o in e)if(!n(e[o],i[o]))return!1;return!0}return e===i},L.bT=function(n){n=n.slice();const e=Object.create(null);for(let i=0;i<n.length;i++)e[n[i].id]=n[i];for(let i=0;i<n.length;i++)"ref"in n[i]&&(n[i]=_n(n[i],e[n[i].ref]));return n},L.bU=function(n,e){if(n.type==="custom")return new sg(n,e);switch(n.type){case"background":return new rf(n,e);case"circle":return new Zd(n,e);case"color-relief":return new Kp(n,e);case"fill":return new Hh(n,e);case"fill-extrusion":return new In(n,e);case"heatmap":return new Xp(n,e);case"hillshade":return new Yp(n,e);case"line":return new Wl(n,e);case"raster":return new jr(n,e);case"symbol":return new Jc(n,e)}},L.bV=n=>n.type==="raster",L.bW=Wr,L.bX=function(n,e){if(!n)return[{command:"setStyle",args:[e]}];let i=[];try{if(!It(n.version,e.version))return[{command:"setStyle",args:[e]}];It(n.center,e.center)||i.push({command:"setCenter",args:[e.center]}),It(n.state,e.state)||i.push({command:"setGlobalState",args:[e.state]}),It(n.centerAltitude,e.centerAltitude)||i.push({command:"setCenterAltitude",args:[e.centerAltitude]}),It(n.zoom,e.zoom)||i.push({command:"setZoom",args:[e.zoom]}),It(n.bearing,e.bearing)||i.push({command:"setBearing",args:[e.bearing]}),It(n.pitch,e.pitch)||i.push({command:"setPitch",args:[e.pitch]}),It(n.roll,e.roll)||i.push({command:"setRoll",args:[e.roll]}),It(n.sprite,e.sprite)||i.push({command:"setSprite",args:[e.sprite]}),It(n.glyphs,e.glyphs)||i.push({command:"setGlyphs",args:[e.glyphs]}),It(n.transition,e.transition)||i.push({command:"setTransition",args:[e.transition]}),It(n.light,e.light)||i.push({command:"setLight",args:[e.light]}),It(n.terrain,e.terrain)||i.push({command:"setTerrain",args:[e.terrain]}),It(n.sky,e.sky)||i.push({command:"setSky",args:[e.sky]}),It(n.projection,e.projection)||i.push({command:"setProjection",args:[e.projection]});const o={},u=[];(function(p,y,x,T){let E;for(E in y=y||{},p=p||{})Object.prototype.hasOwnProperty.call(p,E)&&(Object.prototype.hasOwnProperty.call(y,E)||gi(E,x,T));for(E in y)Object.prototype.hasOwnProperty.call(y,E)&&(Object.prototype.hasOwnProperty.call(p,E)?It(p[E],y[E])||(p[E].type==="geojson"&&y[E].type==="geojson"&&Mi(p,y,E)?mi(x,{command:"setGeoJSONSourceData",args:[E,y[E].data]}):hn(E,y,x,T)):kn(E,y,x))})(n.sources,e.sources,u,o);const d=[];n.layers&&n.layers.forEach((p=>{"source"in p&&o[p.source]?i.push({command:"removeLayer",args:[p.id]}):d.push(p)})),i=i.concat(u),(function(p,y,x){y=y||[];const T=(p=p||[]).map(yl),E=y.map(yl),C=p.reduce(Eo,{}),D=y.reduce(Eo,{}),P=T.slice(),O=Object.create(null);let k,N,G,J,q;for(let $=0,te=0;$<T.length;$++)k=T[$],Object.prototype.hasOwnProperty.call(D,k)?te++:(mi(x,{command:"removeLayer",args:[k]}),P.splice(P.indexOf(k,te),1));for(let $=0,te=0;$<E.length;$++)k=E[E.length-1-$],P[P.length-1-$]!==k&&(Object.prototype.hasOwnProperty.call(C,k)?(mi(x,{command:"removeLayer",args:[k]}),P.splice(P.lastIndexOf(k,P.length-te),1)):te++,J=P[P.length-$],mi(x,{command:"addLayer",args:[D[k],J]}),P.splice(P.length-$,0,k),O[k]=!0);for(let $=0;$<E.length;$++)if(k=E[$],N=C[k],G=D[k],!O[k]&&!It(N,G))if(It(N.source,G.source)&&It(N["source-layer"],G["source-layer"])&&It(N.type,G.type)){for(q in yn(N.layout,G.layout,x,k,null,"setLayoutProperty"),yn(N.paint,G.paint,x,k,null,"setPaintProperty"),It(N.filter,G.filter)||mi(x,{command:"setFilter",args:[k,G.filter]}),It(N.minzoom,G.minzoom)&&It(N.maxzoom,G.maxzoom)||mi(x,{command:"setLayerZoomRange",args:[k,G.minzoom,G.maxzoom]}),N)Object.prototype.hasOwnProperty.call(N,q)&&q!=="layout"&&q!=="paint"&&q!=="filter"&&q!=="metadata"&&q!=="minzoom"&&q!=="maxzoom"&&(q.indexOf("paint.")===0?yn(N[q],G[q],x,k,q.slice(6),"setPaintProperty"):It(N[q],G[q])||mi(x,{command:"setLayerProperty",args:[k,q,G[q]]}));for(q in G)Object.prototype.hasOwnProperty.call(G,q)&&!Object.prototype.hasOwnProperty.call(N,q)&&q!=="layout"&&q!=="paint"&&q!=="filter"&&q!=="metadata"&&q!=="minzoom"&&q!=="maxzoom"&&(q.indexOf("paint.")===0?yn(N[q],G[q],x,k,q.slice(6),"setPaintProperty"):It(N[q],G[q])||mi(x,{command:"setLayerProperty",args:[k,q,G[q]]}))}else mi(x,{command:"removeLayer",args:[k]}),J=P[P.lastIndexOf(k)+1],mi(x,{command:"addLayer",args:[G,J]})})(d,e.layers,i)}catch(o){console.warn("Unable to compute style diff:",o),i=[{command:"setStyle",args:[e]}]}return i},L.bY=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},L.bZ=vr,L.b_=Hs,L.ba=lr,L.bb=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n},L.bc=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]},L.bd=Oi,L.be=Ln,L.bf=function(n,e,i,o,u){var d=1/Math.tan(e/2);if(n[0]=d/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,u!=null&&u!==1/0){var p=1/(o-u);n[10]=(u+o)*p,n[14]=2*u*o*p}else n[10]=-1,n[14]=-2*o;return n},L.bg=function(n){var e=new Ut(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},L.bh=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),d=e[0],p=e[1],y=e[2],x=e[3],T=e[4],E=e[5],C=e[6],D=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*u+T*o,n[1]=p*u+E*o,n[2]=y*u+C*o,n[3]=x*u+D*o,n[4]=T*u-d*o,n[5]=E*u-p*o,n[6]=C*u-y*o,n[7]=D*u-x*o,n},L.bi=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),d=e[4],p=e[5],y=e[6],x=e[7],T=e[8],E=e[9],C=e[10],D=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=d*u+T*o,n[5]=p*u+E*o,n[6]=y*u+C*o,n[7]=x*u+D*o,n[8]=T*u-d*o,n[9]=E*u-p*o,n[10]=C*u-y*o,n[11]=D*u-x*o,n},L.bj=function(){const n=new Float32Array(16);return yr(n),n},L.bk=function(){const n=new Float64Array(16);return yr(n),n},L.bl=function(){return new Float64Array(16)},L.bm=function(n,e,i){const o=new Float64Array(4);return Ue(o,n,e-90,i),o},L.bn=function(n,e,i,o){var u,d,p,y,x,T=e[0],E=e[1],C=e[2],D=e[3],P=i[0],O=i[1],k=i[2],N=i[3];return(d=T*P+E*O+C*k+D*N)<0&&(d=-d,P=-P,O=-O,k=-k,N=-N),1-d>ni?(u=Math.acos(d),p=Math.sin(u),y=Math.sin((1-o)*u)/p,x=Math.sin(o*u)/p):(y=1-o,x=o),n[0]=y*T+x*P,n[1]=y*E+x*O,n[2]=y*C+x*k,n[3]=y*D+x*N,n},L.bo=function(n){const e=new Float64Array(9);(function(d,p){var y=p[0],x=p[1],T=p[2],E=p[3],C=y+y,D=x+x,P=T+T,O=y*C,k=x*C,N=x*D,G=T*C,J=T*D,q=T*P,$=E*C,te=E*D,ne=E*P;d[0]=1-N-q,d[3]=k-ne,d[6]=G+te,d[1]=k+ne,d[4]=1-O-q,d[7]=J-$,d[2]=G-te,d[5]=J+$,d[8]=1-O-N})(e,n);const i=Br(-Math.asin(kt(e[2],-1,1)));let o,u;return Math.hypot(e[5],e[8])<.001?(o=0,u=-Br(Math.atan2(e[3],e[4]))):(o=Br(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),u=Br(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:o,pitch:i+90,bearing:u}},L.bp=function(n,e){return n.roll==e.roll&&n.pitch==e.pitch&&n.bearing==e.bearing},L.bq=Ft,L.br=Na,L.bs=Yu,L.bt=mr,L.bu=sr,L.bv=Qe,L.bw=ct,L.bx=Nn,L.by=function(n,e,i,o,u){return Qe(o,u,kt((n-e)/(i-e),0,1))},L.bz=de,L.c=le,L.c$=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},L.c0=Qo,L.c1=class extends ar{constructor(n,e){super(n,e),this.current=Oc}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},L.c2=ks,L.c3=class extends ar{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},L.c4=class extends ar{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},L.c5=tr,L.c6=function(n,e){var i=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=i,n[2]=0,n[3]=-i,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},L.c7=function(n,e,i){var o=e[0],u=e[1],d=e[2];return n[0]=o*i[0]+u*i[3]+d*i[6],n[1]=o*i[1]+u*i[4]+d*i[7],n[2]=o*i[2]+u*i[5]+d*i[8],n},L.c8=function(n,e,i,o,u,d,p){var y=1/(e-i),x=1/(o-u),T=1/(d-p);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*T,n[11]=0,n[12]=(e+i)*y,n[13]=(u+o)*x,n[14]=(p+d)*T,n[15]=1,n},L.c9=class extends ar{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(4*n.length);for(let i=0;i<n.length;i++)e[4*i]=n[i].r,e[4*i+1]=n[i].g,e[4*i+2]=n[i].b,e[4*i+3]=n[i].a;this.gl.uniform4fv(this.location,e)}}},L.cA=function(n,e){return j[e]&&(n instanceof MouseEvent||n instanceof WheelEvent)},L.cB=function(n,e){return ye[e]&&"touches"in n},L.cC=function(n){return ye[n]||j[n]},L.cD=function(n,e,i){var o=e[0],u=e[1];return n[0]=i[0]*o+i[4]*u+i[12],n[1]=i[1]*o+i[5]*u+i[13],n},L.cE=function(n,e){const{x:i,y:o}=lf.fromLngLat(e);return!(n<0||n>25||o<0||o>=1||i<0||i>=1)},L.cF=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},L.cG=class extends Xo{},L.cH=h_,L.cJ=he,L.cK=function(n,e){le.REGISTERED_PROTOCOLS[n]=e},L.cL=function(n){delete le.REGISTERED_PROTOCOLS[n]},L.cM=function(n,e){const i={};for(let u=0;u<n.length;u++){const d=e&&e[n[u].id]||Ss(n[u]);e&&(e[n[u].id]=d);let p=i[d];p||(p=i[d]=[]),p.push(n[u])}const o=[];for(const u in i)o.push(i[u]);return o},L.cN=nt,L.cO=hd,L.cP=kp,L.cQ=pp,L.cR=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=wt/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const e=n.bucket.layers[0],i=e.layout,o=e._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new Qt(n.bucket.zoom+1),n.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Qt(n.bucket.zoom+1),n.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Qt(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=n.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Qt(T),n.canonical),o["text-size"].possiblyEvaluate(new Qt(E),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=n.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Qt(T),n.canonical),o["icon-size"].possiblyEvaluate(new Qt(E),n.canonical)]}const d=i.get("text-line-height")*xi,p=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",y=i.get("text-keep-upright"),x=i.get("text-size");for(const T of n.bucket.features){const E=i.get("text-font").evaluate(T,{},n.canonical).join(","),C=x.evaluate(T,{},n.canonical),D=u.layoutTextSize.evaluate(T,{},n.canonical),P=u.layoutIconSize.evaluate(T,{},n.canonical),O={horizontal:{},vertical:void 0},k=T.text;let N,G=[0,0];if(k){const $=k.toString(),te=i.get("text-letter-spacing").evaluate(T,{},n.canonical)*xi,ne=Nu($)?te:0,be=i.get("text-anchor").evaluate(T,{},n.canonical),Ne=qt(e,T,n.canonical);if(!Ne){const Ye=i.get("text-radial-offset").evaluate(T,{},n.canonical);G=Ye?bt(be,[Ye*xi,di]):i.get("text-offset").evaluate(T,{},n.canonical).map((ke=>ke*xi))}let Oe=p?"center":i.get("text-justify").evaluate(T,{},n.canonical);const $e=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(T,{},n.canonical)*xi:1/0,tt=()=>{n.bucket.allowVerticalPlacement&&Sa($)&&(O.vertical=bi(k,n.glyphMap,n.glyphPositions,n.imagePositions,E,$e,d,be,"left",ne,G,L.aA.vertical,!0,D,C))};if(!p&&Ne){const Ye=new Set;if(Oe==="auto")for(let ze=0;ze<Ne.values.length;ze+=2)Ye.add(ii(Ne.values[ze]));else Ye.add(Oe);let ke=!1;for(const ze of Ye)if(!O.horizontal[ze])if(ke)O.horizontal[ze]=O.horizontal[0];else{const ut=bi(k,n.glyphMap,n.glyphPositions,n.imagePositions,E,$e,d,"center",ze,ne,G,L.aA.horizontal,!1,D,C);ut&&(O.horizontal[ze]=ut,ke=ut.positionedLines.length===1)}tt()}else{Oe==="auto"&&(Oe=ii(be));const Ye=bi(k,n.glyphMap,n.glyphPositions,n.imagePositions,E,$e,d,be,Oe,ne,G,L.aA.horizontal,!1,D,C);Ye&&(O.horizontal[Oe]=Ye),tt(),Sa($)&&p&&y&&(O.vertical=bi(k,n.glyphMap,n.glyphPositions,n.imagePositions,E,$e,d,be,Oe,ne,G,L.aA.vertical,!1,D,C))}}let J=!1;if(T.icon&&T.icon.name){const $=n.imageMap[T.icon.name];$&&(N=Kc(n.imagePositions[T.icon.name],i.get("icon-offset").evaluate(T,{},n.canonical),i.get("icon-anchor").evaluate(T,{},n.canonical)),J=!!$.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=J:n.bucket.sdfIcons!==J&&Zi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),($.pixelRatio!==n.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const q=Nm(O.horizontal)||O.vertical;n.bucket.iconsInText=!!q&&q.iconsInText,(q||N)&&wi(n.bucket,T,O,N,n.imageMap,u,D,P,G,J,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},L.cS=ja,L.cT=Di,L.cU=Xc,L.cV=function(n){const e=new Jh;return(function(i,o){for(const u in i.layers)o.writeMessage(3,Ed,i.layers[u])})(n,e),e.finish()},L.cW=function(n,e,i,o,u,d){let p=Fm(n,e,i,u,0);return p=Fm(p,e,o,d,1),p},L.cX=class{constructor(n){this.maxEntries=n,this.map=new Map}get(n){const e=this.map.get(n);return e!==void 0&&(this.map.delete(n),this.map.set(n,e)),e}set(n,e){if(this.map.has(n))this.map.delete(n);else if(this.map.size>=this.maxEntries){const i=this.map.keys().next().value;this.map.delete(i)}this.map.set(n,e)}clear(){this.map.clear()}},L.cY=vi,L.cZ=Jh,L.c_=Bp,L.ca=class extends ar{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(n);this.gl.uniform1fv(this.location,e)}}},L.cb=class extends qu{},L.cc=Wh,L.cd=class extends Os{},L.ce=Xd,L.cf=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},L.cg=$f,L.ch=function(n,e,i){var o=e[0],u=e[1],d=e[2],p=i[3]*o+i[7]*u+i[11]*d+i[15];return n[0]=(i[0]*o+i[4]*u+i[8]*d+i[12])/(p=p||1),n[1]=(i[1]*o+i[5]*u+i[9]*d+i[13])/p,n[2]=(i[2]*o+i[6]*u+i[10]*d+i[14])/p,n},L.ci=class extends la{},L.cj=class extends Zl{},L.ck=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15]},L.cl=function(n,e){var i=n[0],o=n[1],u=n[2],d=n[3],p=n[4],y=n[5],x=n[6],T=n[7],E=n[8],C=n[9],D=n[10],P=n[11],O=n[12],k=n[13],N=n[14],G=n[15],J=e[0],q=e[1],$=e[2],te=e[3],ne=e[4],be=e[5],Ne=e[6],Oe=e[7],$e=e[8],tt=e[9],Ye=e[10],ke=e[11],ze=e[12],ut=e[13],ot=e[14],ht=e[15];return Math.abs(i-J)<=ni*Math.max(1,Math.abs(i),Math.abs(J))&&Math.abs(o-q)<=ni*Math.max(1,Math.abs(o),Math.abs(q))&&Math.abs(u-$)<=ni*Math.max(1,Math.abs(u),Math.abs($))&&Math.abs(d-te)<=ni*Math.max(1,Math.abs(d),Math.abs(te))&&Math.abs(p-ne)<=ni*Math.max(1,Math.abs(p),Math.abs(ne))&&Math.abs(y-be)<=ni*Math.max(1,Math.abs(y),Math.abs(be))&&Math.abs(x-Ne)<=ni*Math.max(1,Math.abs(x),Math.abs(Ne))&&Math.abs(T-Oe)<=ni*Math.max(1,Math.abs(T),Math.abs(Oe))&&Math.abs(E-$e)<=ni*Math.max(1,Math.abs(E),Math.abs($e))&&Math.abs(C-tt)<=ni*Math.max(1,Math.abs(C),Math.abs(tt))&&Math.abs(D-Ye)<=ni*Math.max(1,Math.abs(D),Math.abs(Ye))&&Math.abs(P-ke)<=ni*Math.max(1,Math.abs(P),Math.abs(ke))&&Math.abs(O-ze)<=ni*Math.max(1,Math.abs(O),Math.abs(ze))&&Math.abs(k-ut)<=ni*Math.max(1,Math.abs(k),Math.abs(ut))&&Math.abs(N-ot)<=ni*Math.max(1,Math.abs(N),Math.abs(ot))&&Math.abs(G-ht)<=ni*Math.max(1,Math.abs(G),Math.abs(ht))},L.cm=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},L.cn=n=>n.type==="symbol",L.co=n=>n.type==="circle",L.cp=n=>n.type==="heatmap",L.cq=n=>n.type==="line",L.cr=n=>n.type==="fill",L.cs=n=>n.type==="fill-extrusion",L.ct=n=>n.type==="hillshade",L.cu=n=>n.type==="color-relief",L.cv=n=>n.type==="background",L.cw=n=>n.type==="custom",L.cx=gt,L.cy=function(n,e,i){const o=Ct(e.x-i.x,e.y-i.y),u=Ct(n.x-i.x,n.y-i.y),d=Math.atan2(o[0]*u[1]-o[1]*u[0],(function(p,y){return p[0]*y[0]+p[1]*y[1]})(o,u));return Br(d)},L.cz=Tt,L.d=je,L.d0=function(n,e,i,o,u){return f(this,void 0,void 0,(function*(){if(Ji())try{return yield $s(n,e,i,o,u)}catch{}return(function(d,p,y,x,T){const E=d.width,C=d.height;$a&&Da||($a=new OffscreenCanvas(E,C),Da=$a.getContext("2d",{willReadFrequently:!0})),$a.width=E,$a.height=C,Da.drawImage(d,0,0,E,C);const D=Da.getImageData(p,y,x,T);return Da.clearRect(0,0,E,C),D.data})(n,e,i,o,u)}))},L.d1=Qp,L.d2=we,L.d3=class{constructor(n,e){this.layers={[uh]:this},this.name=uh,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=n.length,this.features=n}feature(n){return new cg(this.features[n],this.extent)}},L.d4=Iu,L.d5=Ba,L.e=Si,L.f=n=>f(void 0,void 0,void 0,(function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(e)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),L.g=Te,L.h=n=>new Promise(((e,i)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=ys}))},o.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(n)],{type:"image/png"});o.src=n.byteLength?URL.createObjectURL(u):ys})),L.i=ma,L.j=(n,e)=>Ve(Si(n,{type:"json"}),e),L.k=ci,L.l=zt,L.m=Ve,L.n=(n,e)=>Ve(Si(n,{type:"arrayBuffer"}),e),L.o=function(n){return new Jh(n).readFields(fm,[])},L.p=dp,L.q=function(n){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))},L.r=jc,L.s=_l,L.t=dn,L.u=ve,L.v=Bl,L.w=Zi,L.x=Ho,L.y=Fl,L.z=_o})),Fe("worker",["./shared"],(function(L){class f{constructor(j,V){this.keyCache={},j&&this.replace(j,V)}replace(j,V){this._layerConfigs={},this._layers={},this.update(j,[],V)}update(j,V,H){for(const le of j){this._layerConfigs[le.id]=le;const Te=this._layers[le.id]=L.bU(le,H);Te._featureFilter=L.ak(Te.filter,H),this.keyCache[le.id]&&delete this.keyCache[le.id]}for(const le of V)delete this.keyCache[le],delete this._layerConfigs[le],delete this._layers[le];this.familiesBySource={};const ae=L.cM(Object.values(this._layerConfigs),this.keyCache);for(const le of ae){const Te=le.map((lt=>this._layers[lt.id])),ge=Te[0];if(ge.visibility==="none")continue;const he=ge.source||"";let Se=this.familiesBySource[he];Se||(Se=this.familiesBySource[he]={});const Ve=ge.sourceLayer||L.aa;let je=Se[Ve];je||(je=Se[Ve]=[]),je.push(Te)}}}class me{constructor(j){const V={},H=[];for(const ge in j){const he=j[ge],Se=V[ge]={};for(const Ve in he){const je=he[+Ve];if(!je||je.bitmap.width===0||je.bitmap.height===0)continue;const lt={x:0,y:0,w:je.bitmap.width+2,h:je.bitmap.height+2};H.push(lt),Se[Ve]={rect:lt,metrics:je.metrics}}}const{w:ae,h:le}=L.p(H),Te=new L.r({width:ae||1,height:le||1});for(const ge in j){const he=j[ge];for(const Se in he){const Ve=he[+Se];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;const je=V[ge][Se].rect;L.r.copy(Ve.bitmap,Te,{x:0,y:0},{x:je.x+1,y:je.y+1},Ve.bitmap)}}this.image=Te,this.positions=V}}L.cN("GlyphAtlas",me);class we{constructor(j){this.tileID=new L.a2(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[]}parse(j,V,H,ae,le){return L._(this,void 0,void 0,(function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new L.ai;const Te=new L.cO(Object.keys(j.layers).sort()),ge=new L.cP(this.tileID,this.promoteId);ge.bucketLayerIDs=[];const he={},Se={featureIndex:ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:H,subdivisionGranularity:le},Ve=V.familiesBySource[this.source];for(const Mi in Ve){const yn=j.layers[Mi];if(!yn)continue;yn.version===1&&L.w(`Vector tile source "${this.source}" layer "${Mi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const yl=Te.encode(Mi),Eo=[];for(let Ke=0;Ke<yn.length;Ke++){const ur=yn.feature(Ke),cr=ge.getId(ur,Mi);Eo.push({feature:ur,id:cr,index:Ke,sourceLayerIndex:yl})}for(const Ke of Ve[Mi]){const ur=Ke[0];ur.source!==this.source&&L.w(`layer.source = ${ur.source} does not equal this.source = ${this.source}`),ur.isHidden(this.zoom,!0)||(st(Ke,this.zoom,H),(he[ur.id]=ur.createBucket({index:ge.bucketLayerIDs.length,layers:Ke,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:yl,sourceID:this.source})).populate(Eo,Se,this.tileID.canonical),ge.bucketLayerIDs.push(Ke.map((cr=>cr.id))))}}const je=L.bZ(Se.glyphDependencies,(Mi=>Object.keys(Mi).map(Number)));this.inFlightDependencies.forEach((Mi=>Mi?.abort())),this.inFlightDependencies=[];let lt=Promise.resolve({});if(Object.keys(je).length){const Mi=new AbortController;this.inFlightDependencies.push(Mi),lt=ae.sendAsync({type:"GG",data:{stacks:je,source:this.source,tileID:this.tileID,type:"glyphs"}},Mi)}const mt=Object.keys(Se.iconDependencies);let zt=Promise.resolve({});if(mt.length){const Mi=new AbortController;this.inFlightDependencies.push(Mi),zt=ae.sendAsync({type:"GI",data:{icons:mt,source:this.source,tileID:this.tileID,type:"icons"}},Mi)}const ci=Object.keys(Se.patternDependencies);let Jt=Promise.resolve({});if(ci.length){const Mi=new AbortController;this.inFlightDependencies.push(Mi),Jt=ae.sendAsync({type:"GI",data:{icons:ci,source:this.source,tileID:this.tileID,type:"patterns"}},Mi)}const ve=Se.dashDependencies;let pi=Promise.resolve({});if(Object.keys(ve).length){const Mi=new AbortController;this.inFlightDependencies.push(Mi),pi=ae.sendAsync({type:"GDA",data:{dashes:ve}},Mi)}const[_n,It,mi,kn]=yield Promise.all([lt,zt,Jt,pi]),gi=new me(_n),hn=new L.cQ(It,mi);for(const Mi in he){const yn=he[Mi];yn instanceof L.aj?(st(yn.layers,this.zoom,H),L.cR({bucket:yn,glyphMap:_n,glyphPositions:gi.positions,imageMap:It,imagePositions:hn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Se.subdivisionGranularity})):yn.hasDependencies&&(yn instanceof L.cS||yn instanceof L.cT||yn instanceof L.cU)&&(st(yn.layers,this.zoom,H),yn.addFeatures(Se,this.tileID.canonical,hn.patternPositions,kn))}return this.status="done",{buckets:Object.values(he).filter((Mi=>!Mi.isEmpty())),featureIndex:ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:gi.image,imageAtlas:hn,dashPositions:kn,glyphMap:this.returnDependencies?_n:null,iconMap:this.returnDependencies?It:null,glyphPositions:this.returnDependencies?gi.positions:null}}))}}function st(ye,j,V){const H=new L.H(j);for(const ae of ye)ae.recalculate(H,V)}class it{constructor(j,V,H,ae,le){this.type=j,this.properties=H||{},this.extent=le,this.pointsArray=V,this.id=ae}loadGeometry(){return this.pointsArray.map((j=>j.map((V=>new L.P(V.x,V.y)))))}}class St{constructor(j,V,H){this.version=2,this._myFeatures=j,this.name=V,this.length=j.length,this.extent=H}feature(j){return this._myFeatures[j]}}class Mt{constructor(){this.layers={}}addLayer(j){this.layers[j.name]=j}}function Kt(ye){let j=L.cV(ye);return j.byteOffset===0&&j.byteLength===j.buffer.byteLength||(j=new Uint8Array(j)),{vectorTile:ye,rawData:j.buffer}}function Et(ye,j,V){const{extent:H}=ye,ae=Math.pow(2,V.z-j.z),le=(V.x-j.x*ae)*H,Te=(V.y-j.y*ae)*H,ge=[];for(let he=0;he<ye.length;he++){const Se=ye.feature(he);let Ve=Se.loadGeometry();for(const lt of Ve)for(const mt of lt)mt.x=mt.x*ae-le,mt.y=mt.y*ae-Te;const je=128;Ve=L.cW(Ve,Se.type,-je,-je,H+je,H+je),Ve.length!==0&&ge.push(new it(Se.type,Ve,Se.properties,Se.id,H))}return new St(ge,ye.name,H)}class Ae{constructor(j,V,H){this.actor=j,this.layerIndex=V,this.availableImages=H,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new L.cX(1e3)}loadVectorTile(j,V){return L._(this,void 0,void 0,(function*(){const H=yield L.n(j.request,V);try{return{vectorTile:j.encoding!=="mlt"?new L.cY(new L.cZ(H.data)):new L.c_(H.data),rawData:H.data,cacheControl:H.cacheControl,expires:H.expires}}catch(ae){const le=new Uint8Array(H.data);let Te=`Unable to parse the tile at ${j.request.url}, `;throw Te+=le[0]===31&&le[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ae.message}`,new Error(Te)}}))}loadTile(j){return L._(this,void 0,void 0,(function*(){const{uid:V,overzoomParameters:H}=j;H&&(j.request=H.overzoomRequest);const ae=!!(j&&j.request&&j.request.collectResourceTiming)&&new L.c$(j.request),le=new we(j);this.loading[V]=le;const Te=new AbortController;le.abort=Te;try{const ge=yield this.loadVectorTile(j,Te);if(delete this.loading[V],!ge)return null;if(H){const lt=this._getOverzoomTile(j,ge.vectorTile);ge.rawData=lt.rawData,ge.vectorTile=lt.vectorTile}const he=ge.rawData,Se={};ge.expires&&(Se.expires=ge.expires),ge.cacheControl&&(Se.cacheControl=ge.cacheControl);const Ve={};if(ae){const lt=ae.finish();lt&&(Ve.resourceTiming=JSON.parse(JSON.stringify(lt)))}le.vectorTile=ge.vectorTile;const je=le.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity);this.loaded[V]=le,this.fetching[V]={rawTileData:he,cacheControl:Se,resourceTiming:Ve};try{const lt=yield je;return L.e({rawTileData:he.slice(0),encoding:j.encoding},lt,Se,Ve)}finally{delete this.fetching[V]}}catch(ge){throw delete this.loading[V],le.status="done",this.loaded[V]=le,ge}}))}_getOverzoomTile(j,V){const{tileID:H,source:ae,overzoomParameters:le}=j,{maxZoomTileID:Te}=le,ge=`${Te.key}_${H.key}`,he=this.overzoomedTileResultCache.get(ge);if(he)return he;const Se=new Mt,Ve=this.layerIndex.familiesBySource[ae];for(const lt in Ve){const mt=V.layers[lt];if(!mt)continue;const zt=Et(mt,Te,H.canonical);zt.length>0&&Se.addLayer(zt)}const je=Kt(Se);return this.overzoomedTileResultCache.set(ge,je),je}reloadTile(j){return L._(this,void 0,void 0,(function*(){const V=j.uid;if(!this.loaded||!this.loaded[V])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const H=this.loaded[V];if(H.showCollisionBoxes=j.showCollisionBoxes,H.status==="parsing"){const ae=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity);let le;if(this.fetching[V]){const{rawTileData:Te,cacheControl:ge,resourceTiming:he}=this.fetching[V];delete this.fetching[V],le=L.e({rawTileData:Te.slice(0),encoding:j.encoding},ae,ge,he)}else le=ae;return le}if(H.status==="done"&&H.vectorTile)return H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity)}))}abortTile(j){return L._(this,void 0,void 0,(function*(){const V=this.loading,H=j.uid;V&&V[H]&&V[H].abort&&(V[H].abort.abort(),delete V[H])}))}removeTile(j){return L._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]}))}}class Ji{constructor(){this.loaded={}}loadTile(j){return L._(this,void 0,void 0,(function*(){const{uid:V,encoding:H,rawImageData:ae,redFactor:le,greenFactor:Te,blueFactor:ge,baseShift:he}=j,Se=ae.width+2,Ve=ae.height+2,je=L.b(ae)?new L.R({width:Se,height:Ve},yield L.d0(ae,-1,-1,Se,Ve)):ae,lt=new L.d1(V,je,H,le,Te,ge,he);return this.loaded=this.loaded||{},this.loaded[V]=lt,lt}))}removeTile(j){const V=this.loaded,H=j.uid;V&&V[H]&&delete V[H]}}var ni,Ut,tr=(function(){if(Ut)return ni;function ye(V,H){if(V.length!==0){j(V[0],H);for(var ae=1;ae<V.length;ae++)j(V[ae],!H)}}function j(V,H){for(var ae=0,le=0,Te=0,ge=V.length,he=ge-1;Te<ge;he=Te++){var Se=(V[Te][0]-V[he][0])*(V[he][1]+V[Te][1]),Ve=ae+Se;le+=Math.abs(ae)>=Math.abs(Se)?ae-Ve+Se:Se-Ve+ae,ae=Ve}ae+le>=0!=!!H&&V.reverse()}return Ut=1,ni=function V(H,ae){var le,Te=H&&H.type;if(Te==="FeatureCollection")for(le=0;le<H.features.length;le++)V(H.features[le],ae);else if(Te==="GeometryCollection")for(le=0;le<H.geometries.length;le++)V(H.geometries[le],ae);else if(Te==="Feature")V(H.geometry,ae);else if(Te==="Polygon")ye(H.coordinates,ae);else if(Te==="MultiPolygon")for(le=0;le<H.coordinates.length;le++)ye(H.coordinates[le],ae);return H}})(),yr=L.d2(tr);const Un={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ye=>ye},Lt=Math.fround||(Bn=new Float32Array(1),ye=>(Bn[0]=+ye,Bn[0]));var Bn;class ir{constructor(j){this.options=Object.assign(Object.create(Un),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:V,minZoom:H,maxZoom:ae}=this.options;V&&console.time("total time");const le=`prepare ${j.length} points`;V&&console.time(le),this.points=j;const Te=[];for(let he=0;he<j.length;he++){const Se=j[he];if(!Se.geometry)continue;const[Ve,je]=Se.geometry.coordinates,lt=Lt(en(Ve)),mt=Lt(lr(je));Te.push(lt,mt,1/0,he,-1,1),this.options.reduce&&Te.push(0)}let ge=this.trees[ae+1]=this._createTree(Te);V&&console.timeEnd(le);for(let he=ae;he>=H;he--){const Se=+Date.now();ge=this.trees[he]=this._createTree(this._cluster(ge,he)),V&&console.log("z%d: %d clusters in %dms",he,ge.numItems,+Date.now()-Se)}return V&&console.timeEnd("total time"),this}getClusters(j,V){let H=((j[0]+180)%360+360)%360-180;const ae=Math.max(-90,Math.min(90,j[1]));let le=j[2]===180?180:((j[2]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)H=-180,le=180;else if(H>le){const je=this.getClusters([H,ae,180,Te],V),lt=this.getClusters([-180,ae,le,Te],V);return je.concat(lt)}const ge=this.trees[this._limitZoom(V)],he=ge.range(en(H),lr(Te),en(le),lr(ae)),Se=ge.data,Ve=[];for(const je of he){const lt=this.stride*je;Ve.push(Se[lt+5]>1?Lr(Se,lt,this.clusterProps):this.points[Se[lt+3]])}return Ve}getChildren(j){const V=this._getOriginId(j),H=this._getOriginZoom(j),ae="No cluster with the specified id.",le=this.trees[H];if(!le)throw new Error(ae);const Te=le.data;if(V*this.stride>=Te.length)throw new Error(ae);const ge=this.options.radius/(this.options.extent*Math.pow(2,H-1)),he=le.within(Te[V*this.stride],Te[V*this.stride+1],ge),Se=[];for(const Ve of he){const je=Ve*this.stride;Te[je+4]===j&&Se.push(Te[je+5]>1?Lr(Te,je,this.clusterProps):this.points[Te[je+3]])}if(Se.length===0)throw new Error(ae);return Se}getLeaves(j,V,H){const ae=[];return this._appendLeaves(ae,j,V=V||10,H=H||0,0),ae}getTile(j,V,H){const ae=this.trees[this._limitZoom(j)],le=Math.pow(2,j),{extent:Te,radius:ge}=this.options,he=ge/Te,Se=(H-he)/le,Ve=(H+1+he)/le,je={features:[]};return this._addTileFeatures(ae.range((V-he)/le,Se,(V+1+he)/le,Ve),ae.data,V,H,le,je),V===0&&this._addTileFeatures(ae.range(1-he/le,Se,1,Ve),ae.data,le,H,le,je),V===le-1&&this._addTileFeatures(ae.range(0,Se,he/le,Ve),ae.data,-1,H,le,je),je.features.length?je:null}getClusterExpansionZoom(j){let V=this._getOriginZoom(j)-1;for(;V<=this.options.maxZoom;){const H=this.getChildren(j);if(V++,H.length!==1)break;j=H[0].properties.cluster_id}return V}_appendLeaves(j,V,H,ae,le){const Te=this.getChildren(V);for(const ge of Te){const he=ge.properties;if(he&&he.cluster?le+he.point_count<=ae?le+=he.point_count:le=this._appendLeaves(j,he.cluster_id,H,ae,le):le<ae?le++:j.push(ge),j.length===H)break}return le}_createTree(j){const V=new L.aU(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<j.length;H+=this.stride)V.add(j[H],j[H+1]);return V.finish(),V.data=j,V}_addTileFeatures(j,V,H,ae,le,Te){for(const ge of j){const he=ge*this.stride,Se=V[he+5]>1;let Ve,je,lt;if(Se)Ve=or(V,he,this.clusterProps),je=V[he],lt=V[he+1];else{const ci=this.points[V[he+3]];Ve=ci.properties;const[Jt,ve]=ci.geometry.coordinates;je=en(Jt),lt=lr(ve)}const mt={type:1,geometry:[[Math.round(this.options.extent*(je*le-H)),Math.round(this.options.extent*(lt*le-ae))]],tags:Ve};let zt;zt=Se||this.options.generateId?V[he+3]:this.points[V[he+3]].id,zt!==void 0&&(mt.id=zt),Te.features.push(mt)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,V){const{radius:H,extent:ae,reduce:le,minPoints:Te}=this.options,ge=H/(ae*Math.pow(2,V)),he=j.data,Se=[],Ve=this.stride;for(let je=0;je<he.length;je+=Ve){if(he[je+2]<=V)continue;he[je+2]=V;const lt=he[je],mt=he[je+1],zt=j.within(he[je],he[je+1],ge),ci=he[je+5];let Jt=ci;for(const ve of zt){const pi=ve*Ve;he[pi+2]>V&&(Jt+=he[pi+5])}if(Jt>ci&&Jt>=Te){let ve,pi=lt*ci,_n=mt*ci,It=-1;const mi=(je/Ve<<5)+(V+1)+this.points.length;for(const kn of zt){const gi=kn*Ve;if(he[gi+2]<=V)continue;he[gi+2]=V;const hn=he[gi+5];pi+=he[gi]*hn,_n+=he[gi+1]*hn,he[gi+4]=mi,le&&(ve||(ve=this._map(he,je,!0),It=this.clusterProps.length,this.clusterProps.push(ve)),le(ve,this._map(he,gi)))}he[je+4]=mi,Se.push(pi/Jt,_n/Jt,1/0,mi,-1,Jt),le&&Se.push(It)}else{for(let ve=0;ve<Ve;ve++)Se.push(he[je+ve]);if(Jt>1)for(const ve of zt){const pi=ve*Ve;if(!(he[pi+2]<=V)){he[pi+2]=V;for(let _n=0;_n<Ve;_n++)Se.push(he[pi+_n])}}}}return Se}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,V,H){if(j[V+5]>1){const Te=this.clusterProps[j[V+6]];return H?Object.assign({},Te):Te}const ae=this.points[j[V+3]].properties,le=this.options.map(ae);return H&&le===ae?Object.assign({},le):le}}function Lr(ye,j,V){return{type:"Feature",id:ye[j+3],properties:or(ye,j,V),geometry:{type:"Point",coordinates:[(H=ye[j],360*(H-.5)),Qr(ye[j+1])]}};var H}function or(ye,j,V){const H=ye[j+5],ae=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,le=ye[j+6],Te=le===-1?{}:Object.assign({},V[le]);return Object.assign(Te,{cluster:!0,cluster_id:ye[j+3],point_count:H,point_count_abbreviated:ae})}function en(ye){return ye/360+.5}function lr(ye){const j=Math.sin(ye*Math.PI/180),V=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return V<0?0:V>1?1:V}function Qr(ye){const j=(180-360*ye)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function nr(ye,j,V,H){let ae=H;const le=j+(V-j>>1);let Te,ge=V-j;const he=ye[j],Se=ye[j+1],Ve=ye[V],je=ye[V+1];for(let lt=j+3;lt<V;lt+=3){const mt=Ue(ye[lt],ye[lt+1],he,Se,Ve,je);if(mt>ae)Te=lt,ae=mt;else if(mt===ae){const zt=Math.abs(lt-le);zt<ge&&(Te=lt,ge=zt)}}ae>H&&(Te-j>3&&nr(ye,j,Te,H),ye[Te+2]=ae,V-Te>3&&nr(ye,Te,V,H))}function Ue(ye,j,V,H,ae,le){let Te=ae-V,ge=le-H;if(Te!==0||ge!==0){const he=((ye-V)*Te+(j-H)*ge)/(Te*Te+ge*ge);he>1?(V=ae,H=le):he>0&&(V+=Te*he,H+=ge*he)}return Te=ye-V,ge=j-H,Te*Te+ge*ge}function rt(ye,j,V,H){const ae={id:ye??null,type:j,geometry:V,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")Ct(ae,V);else if(j==="Polygon")Ct(ae,V[0]);else if(j==="MultiLineString")for(const le of V)Ct(ae,le);else if(j==="MultiPolygon")for(const le of V)Ct(ae,le[0]);return ae}function Ct(ye,j){for(let V=0;V<j.length;V+=3)ye.minX=Math.min(ye.minX,j[V]),ye.minY=Math.min(ye.minY,j[V+1]),ye.maxX=Math.max(ye.maxX,j[V]),ye.maxY=Math.max(ye.maxY,j[V+1])}function wt(ye,j,V,H){if(!j.geometry)return;const ae=j.geometry.coordinates;if(ae&&ae.length===0)return;const le=j.geometry.type,Te=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2);let ge=[],he=j.id;if(V.promoteId?he=j.properties[V.promoteId]:V.generateId&&(he=H||0),le==="Point")ui(ae,ge);else if(le==="MultiPoint")for(const Se of ae)ui(Se,ge);else if(le==="LineString")de(ae,ge,Te,!1);else if(le==="MultiLineString"){if(V.lineMetrics){for(const Se of ae)ge=[],de(Se,ge,Te,!1),ye.push(rt(he,"LineString",ge,j.properties));return}Qe(ae,ge,Te,!1)}else if(le==="Polygon")Qe(ae,ge,Te,!0);else{if(le!=="MultiPolygon"){if(le==="GeometryCollection"){for(const Se of j.geometry.geometries)wt(ye,{id:he,geometry:Se,properties:j.properties},V,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Se of ae){const Ve=[];Qe(Se,Ve,Te,!0),ge.push(Ve)}}ye.push(rt(he,le,ge,j.properties))}function ui(ye,j){j.push(ct(ye[0]),gt(ye[1]),0)}function de(ye,j,V,H){let ae,le,Te=0;for(let he=0;he<ye.length;he++){const Se=ct(ye[he][0]),Ve=gt(ye[he][1]);j.push(Se,Ve,0),he>0&&(Te+=H?(ae*Ve-Se*le)/2:Math.sqrt(Math.pow(Se-ae,2)+Math.pow(Ve-le,2))),ae=Se,le=Ve}const ge=j.length-3;j[2]=1,nr(j,0,ge,V),j[ge+2]=1,j.size=Math.abs(Te),j.start=0,j.end=j.size}function Qe(ye,j,V,H){for(let ae=0;ae<ye.length;ae++){const le=[];de(ye[ae],le,V,H),j.push(le)}}function ct(ye){return ye/360+.5}function gt(ye){const j=Math.sin(ye*Math.PI/180),V=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return V<0?0:V>1?1:V}function Tt(ye,j,V,H,ae,le,Te,ge){if(H/=j,le>=(V/=j)&&Te<H)return ye;if(Te<V||le>=H)return null;const he=[];for(const Se of ye){const Ve=Se.geometry;let je=Se.type;const lt=ae===0?Se.minX:Se.minY,mt=ae===0?Se.maxX:Se.maxY;if(lt>=V&&mt<H){he.push(Se);continue}if(mt<V||lt>=H)continue;let zt=[];if(je==="Point"||je==="MultiPoint")kt(Ve,zt,V,H,ae);else if(je==="LineString")$t(Ve,zt,V,H,ae,!1,ge.lineMetrics);else if(je==="MultiLineString")Ri(Ve,zt,V,H,ae,!1);else if(je==="Polygon")Ri(Ve,zt,V,H,ae,!0);else if(je==="MultiPolygon")for(const ci of Ve){const Jt=[];Ri(ci,Jt,V,H,ae,!0),Jt.length&&zt.push(Jt)}if(zt.length){if(ge.lineMetrics&&je==="LineString"){for(const ci of zt)he.push(rt(Se.id,je,ci,Se.tags));continue}je!=="LineString"&&je!=="MultiLineString"||(zt.length===1?(je="LineString",zt=zt[0]):je="MultiLineString"),je!=="Point"&&je!=="MultiPoint"||(je=zt.length===3?"Point":"MultiPoint"),he.push(rt(Se.id,je,zt,Se.tags))}}return he.length?he:null}function kt(ye,j,V,H,ae){for(let le=0;le<ye.length;le+=3){const Te=ye[le+ae];Te>=V&&Te<=H&&vr(j,ye[le],ye[le+1],ye[le+2])}}function $t(ye,j,V,H,ae,le,Te){let ge=Si(ye);const he=ae===0?Hs:Wr;let Se,Ve,je=ye.start;for(let Jt=0;Jt<ye.length-3;Jt+=3){const ve=ye[Jt],pi=ye[Jt+1],_n=ye[Jt+2],It=ye[Jt+3],mi=ye[Jt+4],kn=ae===0?ve:pi,gi=ae===0?It:mi;let hn=!1;Te&&(Se=Math.sqrt(Math.pow(ve-It,2)+Math.pow(pi-mi,2))),kn<V?gi>V&&(Ve=he(ge,ve,pi,It,mi,V),Te&&(ge.start=je+Se*Ve)):kn>H?gi<H&&(Ve=he(ge,ve,pi,It,mi,H),Te&&(ge.start=je+Se*Ve)):vr(ge,ve,pi,_n),gi<V&&kn>=V&&(Ve=he(ge,ve,pi,It,mi,V),hn=!0),gi>H&&kn<=H&&(Ve=he(ge,ve,pi,It,mi,H),hn=!0),!le&&hn&&(Te&&(ge.end=je+Se*Ve),j.push(ge),ge=Si(ye)),Te&&(je+=Se)}let lt=ye.length-3;const mt=ye[lt],zt=ye[lt+1],ci=ae===0?mt:zt;ci>=V&&ci<=H&&vr(ge,mt,zt,ye[lt+2]),lt=ge.length-3,le&&lt>=3&&(ge[lt]!==ge[0]||ge[lt+1]!==ge[1])&&vr(ge,ge[0],ge[1],ge[2]),ge.length&&j.push(ge)}function Si(ye){const j=[];return j.size=ye.size,j.start=ye.start,j.end=ye.end,j}function Ri(ye,j,V,H,ae,le){for(const Te of ye)$t(Te,j,V,H,ae,le,!1)}function vr(ye,j,V,H){ye.push(j,V,H)}function Hs(ye,j,V,H,ae,le){const Te=(le-j)/(H-j);return vr(ye,le,V+(ae-V)*Te,1),Te}function Wr(ye,j,V,H,ae,le){const Te=(le-V)/(ae-V);return vr(ye,j+(H-j)*Te,le,1),Te}function gl(ye,j){const V=[];for(let H=0;H<ye.length;H++){const ae=ye[H],le=ae.type;let Te;if(le==="Point"||le==="MultiPoint"||le==="LineString")Te=Zi(ae.geometry,j);else if(le==="MultiLineString"||le==="Polygon"){Te=[];for(const ge of ae.geometry)Te.push(Zi(ge,j))}else if(le==="MultiPolygon"){Te=[];for(const ge of ae.geometry){const he=[];for(const Se of ge)he.push(Zi(Se,j));Te.push(he)}}V.push(rt(ae.id,le,Te,ae.tags))}return V}function Zi(ye,j){const V=[];V.size=ye.size,ye.start!==void 0&&(V.start=ye.start,V.end=ye.end);for(let H=0;H<ye.length;H+=3)V.push(ye[H]+j,ye[H+1],ye[H+2]);return V}function Or(ye,j){if(ye.transformed)return ye;const V=1<<ye.z,H=ye.x,ae=ye.y;for(const le of ye.features){const Te=le.geometry,ge=le.type;if(le.geometry=[],ge===1)for(let he=0;he<Te.length;he+=2)le.geometry.push(ma(Te[he],Te[he+1],j,V,H,ae));else for(let he=0;he<Te.length;he++){const Se=[];for(let Ve=0;Ve<Te[he].length;Ve+=2)Se.push(ma(Te[he][Ve],Te[he][Ve+1],j,V,H,ae));le.geometry.push(Se)}}return ye.transformed=!0,ye}function ma(ye,j,V,H,ae,le){return[Math.round(V*(ye*H-ae)),Math.round(V*(j*H-le))]}function tn(ye,j,V,H,ae){const le=j===ae.maxZoom?0:ae.tolerance/((1<<j)*ae.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:ye.length,source:null,x:V,y:H,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ge of ye)_s(Te,ge,le,ae);return Te}function _s(ye,j,V,H){const ae=j.geometry,le=j.type,Te=[];if(ye.minX=Math.min(ye.minX,j.minX),ye.minY=Math.min(ye.minY,j.minY),ye.maxX=Math.max(ye.maxX,j.maxX),ye.maxY=Math.max(ye.maxY,j.maxY),le==="Point"||le==="MultiPoint")for(let ge=0;ge<ae.length;ge+=3)Te.push(ae[ge],ae[ge+1]),ye.numPoints++,ye.numSimplified++;else if(le==="LineString")ys(Te,ae,ye,V,!1,!1);else if(le==="MultiLineString"||le==="Polygon")for(let ge=0;ge<ae.length;ge++)ys(Te,ae[ge],ye,V,le==="Polygon",ge===0);else if(le==="MultiPolygon")for(let ge=0;ge<ae.length;ge++){const he=ae[ge];for(let Se=0;Se<he.length;Se++)ys(Te,he[Se],ye,V,!0,Se===0)}if(Te.length){let ge=j.tags||null;if(le==="LineString"&&H.lineMetrics){ge={};for(const Se in j.tags)ge[Se]=j.tags[Se];ge.mapbox_clip_start=ae.start/ae.size,ge.mapbox_clip_end=ae.end/ae.size}const he={geometry:Te,type:le==="Polygon"||le==="MultiPolygon"?3:le==="LineString"||le==="MultiLineString"?2:1,tags:ge};j.id!==null&&(he.id=j.id),ye.features.push(he)}}function ys(ye,j,V,H,ae,le){const Te=H*H;if(H>0&&j.size<(ae?Te:H))return void(V.numPoints+=j.length/3);const ge=[];for(let he=0;he<j.length;he+=3)(H===0||j[he+2]>Te)&&(V.numSimplified++,ge.push(j[he],j[he+1])),V.numPoints++;ae&&(function(he,Se){let Ve=0;for(let je=0,lt=he.length,mt=lt-2;je<lt;mt=je,je+=2)Ve+=(he[je]-he[mt])*(he[je+1]+he[mt+1]);if(Ve>0===Se)for(let je=0,lt=he.length;je<lt/2;je+=2){const mt=he[je],zt=he[je+1];he[je]=he[lt-2-je],he[je+1]=he[lt-1-je],he[lt-2-je]=mt,he[lt-1-je]=zt}})(ge,le),ye.push(ge)}const $s={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class $a{constructor(j,V){const H=(V=this.options=(function(le,Te){for(const ge in Te)le[ge]=Te[ge];return le})(Object.create($s),V)).debug;if(H&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");let ae=(function(le,Te){const ge=[];if(le.type==="FeatureCollection")for(let he=0;he<le.features.length;he++)wt(ge,le.features[he],Te,he);else wt(ge,le.type==="Feature"?le:{geometry:le},Te);return ge})(j,V);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ae=(function(le,Te){const ge=Te.buffer/Te.extent;let he=le;const Se=Tt(le,1,-1-ge,ge,0,-1,2,Te),Ve=Tt(le,1,1-ge,2+ge,0,-1,2,Te);return(Se||Ve)&&(he=Tt(le,1,-ge,1+ge,0,-1,2,Te)||[],Se&&(he=gl(Se,1).concat(he)),Ve&&(he=he.concat(gl(Ve,-1)))),he})(ae,V),ae.length&&this.splitTile(ae,0,0,0),H&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,V,H,ae,le,Te,ge){const he=[j,V,H,ae],Se=this.options,Ve=Se.debug;for(;he.length;){ae=he.pop(),H=he.pop(),V=he.pop(),j=he.pop();const je=1<<V,lt=Da(V,H,ae);let mt=this.tiles[lt];if(!mt&&(Ve>1&&console.time("creation"),mt=this.tiles[lt]=tn(j,V,H,ae,Se),this.tileCoords.push({z:V,x:H,y:ae}),Ve)){Ve>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,H,ae,mt.numFeatures,mt.numPoints,mt.numSimplified),console.timeEnd("creation"));const hn=`z${V}`;this.stats[hn]=(this.stats[hn]||0)+1,this.total++}if(mt.source=j,le==null){if(V===Se.indexMaxZoom||mt.numPoints<=Se.indexMaxPoints)continue}else{if(V===Se.maxZoom||V===le)continue;if(le!=null){const hn=le-V;if(H!==Te>>hn||ae!==ge>>hn)continue}}if(mt.source=null,j.length===0)continue;Ve>1&&console.time("clipping");const zt=.5*Se.buffer/Se.extent,ci=.5-zt,Jt=.5+zt,ve=1+zt;let pi=null,_n=null,It=null,mi=null,kn=Tt(j,je,H-zt,H+Jt,0,mt.minX,mt.maxX,Se),gi=Tt(j,je,H+ci,H+ve,0,mt.minX,mt.maxX,Se);j=null,kn&&(pi=Tt(kn,je,ae-zt,ae+Jt,1,mt.minY,mt.maxY,Se),_n=Tt(kn,je,ae+ci,ae+ve,1,mt.minY,mt.maxY,Se),kn=null),gi&&(It=Tt(gi,je,ae-zt,ae+Jt,1,mt.minY,mt.maxY,Se),mi=Tt(gi,je,ae+ci,ae+ve,1,mt.minY,mt.maxY,Se),gi=null),Ve>1&&console.timeEnd("clipping"),he.push(pi||[],V+1,2*H,2*ae),he.push(_n||[],V+1,2*H,2*ae+1),he.push(It||[],V+1,2*H+1,2*ae),he.push(mi||[],V+1,2*H+1,2*ae+1)}}getTile(j,V,H){j=+j,V=+V,H=+H;const ae=this.options,{extent:le,debug:Te}=ae;if(j<0||j>24)return null;const ge=1<<j,he=Da(j,V=V+ge&ge-1,H);if(this.tiles[he])return Or(this.tiles[he],le);Te>1&&console.log("drilling down to z%d-%d-%d",j,V,H);let Se,Ve=j,je=V,lt=H;for(;!Se&&Ve>0;)Ve--,je>>=1,lt>>=1,Se=this.tiles[Da(Ve,je,lt)];return Se&&Se.source?(Te>1&&(console.log("found parent tile z%d-%d-%d",Ve,je,lt),console.time("drilling down")),this.splitTile(Se.source,Ve,je,lt,j,V,H),Te>1&&console.timeEnd("drilling down"),this.tiles[he]?Or(this.tiles[he],le):null):null}}function Da(ye,j,V){return 32*((1<<ye)*V+j)+ye}class _l extends Ae{constructor(j,V,H,ae=Gn){super(j,V,H),this._dataUpdateable=new Map,this._createGeoJSONIndex=ae}loadVectorTile(j,V){return L._(this,void 0,void 0,(function*(){const H=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ae=this._geoJSONIndex.getTile(H.z,H.x,H.y);return ae?Kt(new L.d3(ae.features,{version:2,extent:L.a5})):null}))}loadData(j){return L._(this,void 0,void 0,(function*(){var V;(V=this._pendingRequest)===null||V===void 0||V.abort();const H=this._startPerformance(j);this._pendingRequest=new AbortController;try{(!this._pendingData||j.request||j.data||j.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(j,this._pendingRequest));const ae=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(ae,j),this.loaded={};const le={};return this._finishPerformance(H,j,le),le}catch(ae){if(delete this._pendingRequest,L.Z(ae))return{abandoned:!0};throw ae}}))}_startPerformance(j){var V;if(!((V=j?.request)===null||V===void 0)&&V.collectResourceTiming)return new L.c$(j.request)}_finishPerformance(j,V,H){if(!j)return;const ae=j.finish();ae&&(H.resourceTiming={},H.resourceTiming[V.source]=JSON.parse(JSON.stringify(ae)))}getData(){return L._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(j){const V=this.loaded;return V&&V[j.uid]?super.reloadTile(j):this.loadTile(j)}loadAndProcessGeoJSON(j,V){return L._(this,void 0,void 0,(function*(){let H;if(j.request?H=yield this.loadGeoJSONFromUrl(j.request,j.promoteId,V):j.data?H=this._loadGeoJSONFromObject(j.data,j.promoteId):j.dataDiff&&(H=this._loadGeoJSONFromDiff(j.dataDiff,j.promoteId,j.source)),delete this._pendingRequest,typeof H!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);return yr(H,!0),j.filter&&(H=this._filterGeoJSON(H,j.filter)),H}))}loadGeoJSONFromUrl(j,V,H){return L._(this,void 0,void 0,(function*(){const ae=yield L.j(j,H);return this._dataUpdateable=L.a7(ae.data,V)?L.a8(ae.data,V):void 0,ae.data}))}_loadGeoJSONFromObject(j,V){return this._dataUpdateable=L.a7(j,V)?L.a8(j,V):void 0,j}_loadGeoJSONFromDiff(j,V,H){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${H}`);L.a9(this._dataUpdateable,j,V);const ae=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(ae)}_filterGeoJSON(j,V){const H=L.d4(V,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(H.result==="error")throw new Error(H.value.map((le=>`${le.key}: ${le.message}`)).join(", "));const ae=j.features.filter((le=>H.value.evaluate({zoom:0},le)));return this._toFeatureCollection(ae)}_toFeatureCollection(j){return{type:"FeatureCollection",features:j}}removeSource(j){return L._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}function Gn(ye,j){return j.cluster?new ir((function({superclusterOptions:V,clusterProperties:H}){if(!H||!V)return V;const ae={},le={},Te={accumulated:null,zoom:0},ge={properties:null},he=Object.keys(H);for(const Se of he){const[Ve,je]=H[Se],lt=L.d4(je),mt=L.d4(typeof Ve=="string"?[Ve,["accumulated"],["get",Se]]:Ve);ae[Se]=lt.value,le[Se]=mt.value}return V.map=Se=>{ge.properties=Se;const Ve={};for(const je of he)Ve[je]=ae[je].evaluate(Te,ge);return Ve},V.reduce=(Se,Ve)=>{ge.properties=Ve;for(const je of he)Te.accumulated=Se[je],Se[je]=le[je].evaluate(Te,ge)},V})(j)).load(ye.features):(function(V,H){return new $a(V,H)})(ye,j.geojsonVtOptions)}class Br{constructor(j){this.self=j,this.actor=new L.L(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(V,H)=>{if(this.externalWorkerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.externalWorkerSourceTypes[V]=H},this.self.addProtocol=L.cK,this.self.removeProtocol=L.cL,this.self.registerRTLTextPlugin=V=>{L.d5.setMethods(V)},this.actor.registerMessageHandler("LDT",((V,H)=>this._getDEMWorkerSource(V,H.source).loadTile(H))),this.actor.registerMessageHandler("RDT",((V,H)=>L._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(V,H.source).removeTile(H)})))),this.actor.registerMessageHandler("GCEZ",((V,H)=>L._(this,void 0,void 0,(function*(){return this._getWorkerSource(V,H.type,H.source).getClusterExpansionZoom(H)})))),this.actor.registerMessageHandler("GCC",((V,H)=>L._(this,void 0,void 0,(function*(){return this._getWorkerSource(V,H.type,H.source).getClusterChildren(H)})))),this.actor.registerMessageHandler("GCL",((V,H)=>L._(this,void 0,void 0,(function*(){return this._getWorkerSource(V,H.type,H.source).getClusterLeaves(H)})))),this.actor.registerMessageHandler("LD",((V,H)=>this._getWorkerSource(V,H.type,H.source).loadData(H))),this.actor.registerMessageHandler("GD",((V,H)=>this._getWorkerSource(V,H.type,H.source).getData())),this.actor.registerMessageHandler("LT",((V,H)=>this._getWorkerSource(V,H.type,H.source).loadTile(H))),this.actor.registerMessageHandler("RT",((V,H)=>this._getWorkerSource(V,H.type,H.source).reloadTile(H))),this.actor.registerMessageHandler("AT",((V,H)=>this._getWorkerSource(V,H.type,H.source).abortTile(H))),this.actor.registerMessageHandler("RMT",((V,H)=>this._getWorkerSource(V,H.type,H.source).removeTile(H))),this.actor.registerMessageHandler("RS",((V,H)=>L._(this,void 0,void 0,(function*(){if(!this.workerSources[V]||!this.workerSources[V][H.type]||!this.workerSources[V][H.type][H.source])return;const ae=this.workerSources[V][H.type][H.source];delete this.workerSources[V][H.type][H.source],ae.removeSource!==void 0&&ae.removeSource(H)})))),this.actor.registerMessageHandler("RM",(V=>L._(this,void 0,void 0,(function*(){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],this.globalStates.delete(V)})))),this.actor.registerMessageHandler("SR",((V,H)=>L._(this,void 0,void 0,(function*(){this.referrer=H})))),this.actor.registerMessageHandler("SRPS",((V,H)=>this._syncRTLPluginState(V,H))),this.actor.registerMessageHandler("IS",((V,H)=>L._(this,void 0,void 0,(function*(){this.self.importScripts(H)})))),this.actor.registerMessageHandler("SI",((V,H)=>this._setImages(V,H))),this.actor.registerMessageHandler("UL",((V,H)=>L._(this,void 0,void 0,(function*(){this._getLayerIndex(V).update(H.layers,H.removedIds,this._getGlobalState(V))})))),this.actor.registerMessageHandler("UGS",((V,H)=>L._(this,void 0,void 0,(function*(){const ae=this._getGlobalState(V);for(const le in H)ae[le]=H[le]})))),this.actor.registerMessageHandler("SL",((V,H)=>L._(this,void 0,void 0,(function*(){this._getLayerIndex(V).replace(H,this._getGlobalState(V))}))))}_getGlobalState(j){let V=this.globalStates.get(j);return V||(V={},this.globalStates.set(j,V)),V}_setImages(j,V){return L._(this,void 0,void 0,(function*(){this.availableImages[j]=V;for(const H in this.workerSources[j]){const ae=this.workerSources[j][H];for(const le in ae)ae[le].availableImages=V}}))}_syncRTLPluginState(j,V){return L._(this,void 0,void 0,(function*(){return yield L.d5.syncState(V,this.self.importScripts)}))}_getAvailableImages(j){let V=this.availableImages[j];return V||(V=[]),V}_getLayerIndex(j){let V=this.layerIndexes[j];return V||(V=this.layerIndexes[j]=new f),V}_getWorkerSource(j,V,H){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][V]||(this.workerSources[j][V]={}),!this.workerSources[j][V][H]){const ae={sendAsync:(le,Te)=>(le.targetMapId=j,this.actor.sendAsync(le,Te))};switch(V){case"vector":this.workerSources[j][V][H]=new Ae(ae,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][V][H]=new _l(ae,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][V][H]=new this.externalWorkerSourceTypes[V](ae,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][V][H]}_getDEMWorkerSource(j,V){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][V]||(this.demWorkerSources[j][V]=new Ji),this.demWorkerSources[j][V]}}return L.i(self)&&(self.worker=new Br(self)),Br})),Fe("index",["exports","./shared"],(function(L,f){var me="5.14.0";function we(){var m=new f.A(4);return f.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let st,it,St;const Mt={frame(m,t,a){const l=requestAnimationFrame((_=>{h(),t(_)})),{unsubscribe:h}=f.s(m.signal,"abort",(()=>{h(),cancelAnimationFrame(l),a(new f.a(m.signal.reason))}),!1)},frameAsync(m){return new Promise(((t,a)=>{this.frame(m,t,a)}))},getImageData(m,t=0){return this.getImageCanvasContext(m).getImageData(-t,-t,m.width+2*t,m.height+2*t)},getImageCanvasContext(m){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=m.width,t.height=m.height,a.drawImage(m,0,0,m.width,m.height),a},resolveURL:m=>(st||(st=document.createElement("a")),st.href=m,st.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return St!==void 0?St:!!matchMedia&&(it==null&&(it=matchMedia("(prefers-reduced-motion: reduce)")),it.matches)},set prefersReducedMotion(m){St=m}},Kt=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(m){this._frozenAt=m}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function Et(){return Kt.getCurrentTime()}class Ae{static testProp(t){if(!Ae.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in Ae.docStyle)return t[a];return t[0]}static create(t,a,l){const h=window.document.createElement(t);return a!==void 0&&(h.className=a),l&&l.appendChild(h),h}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){Ae.docStyle&&Ae.selectProp&&(Ae.userSelect=Ae.docStyle[Ae.selectProp],Ae.docStyle[Ae.selectProp]="none")}static enableDrag(){Ae.docStyle&&Ae.selectProp&&(Ae.docStyle[Ae.selectProp]=Ae.userSelect)}static setTransform(t,a){t.style[Ae.transformProp]=a}static addEventListener(t,a,l,h={}){t.addEventListener(a,l,"passive"in h?h:h.capture)}static removeEventListener(t,a,l,h={}){t.removeEventListener(a,l,"passive"in h?h:h.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Ae.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Ae.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",Ae.suppressClickInternal,!0)}),0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,l){const h=a.boundingClientRect;return new f.P((l.clientX-h.left)/a.x-t.clientLeft,(l.clientY-h.top)/a.y-t.clientTop)}static mousePos(t,a){const l=Ae.getScale(t);return Ae.getPoint(t,l,a)}static touchPos(t,a){const l=[],h=Ae.getScale(t);for(let _=0;_<a.length;_++)l.push(Ae.getPoint(t,h,a[_]));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const a=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),l=a.querySelectorAll("script");for(const h of l)h.remove();return Ae.clean(a),a.innerHTML}static isPossiblyDangerous(t,a){const l=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!l.includes("javascript:")&&!l.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const a=t.children;for(const l of a)Ae.removeAttributes(l),Ae.clean(l)}static removeAttributes(t){for(const{name:a,value:l}of t.attributes)Ae.isPossiblyDangerous(a,l)&&t.removeAttribute(a)}}Ae.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Ae.selectProp=Ae.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Ae.transformProp=Ae.testProp(["transform","WebkitTransform"]);const Ji={supported:!1,testSupport:function(m){!tr&&Ut&&(yr?Un(m):ni=m)}};let ni,Ut,tr=!1,yr=!1;function Un(m){const t=m.createTexture();m.bindTexture(m.TEXTURE_2D,t);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,Ut),m.isContextLost())return;Ji.supported=!0}catch{}m.deleteTexture(t),tr=!0}var Lt;typeof document<"u"&&(Ut=document.createElement("img"),Ut.onload=()=>{ni&&Un(ni),ni=null,yr=!0},Ut.onerror=()=>{tr=!0,ni=null},Ut.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(m){let t,a,l,h;m.resetRequestQueue=()=>{t=[],a=0,l=0,h={}},m.addThrottleControl=S=>{const A=l++;return h[A]=S,A},m.removeThrottleControl=S=>{delete h[S],v()},m.getImage=(S,A,z=!0)=>new Promise(((R,I)=>{Ji.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),f.e(S,{type:"image"}),t.push({abortController:A,requestParameters:S,supportImageRefresh:z,state:"queued",onError:F=>{I(F)},onSuccess:F=>{R(F)}}),v()}));const _=S=>f._(this,void 0,void 0,(function*(){S.state="running";const{requestParameters:A,supportImageRefresh:z,onError:R,onSuccess:I,abortController:F}=S,U=z===!1&&!f.i(self)&&!f.g(A.url)&&(!A.headers||Object.keys(A.headers).reduce(((Y,W)=>Y&&W==="accept"),!0));a++;const X=U?w(A,F):f.m(A,F);try{const Y=yield X;delete S.abortController,S.state="completed",Y.data instanceof HTMLImageElement||f.b(Y.data)?I(Y):Y.data&&I({data:yield(Q=Y.data,typeof createImageBitmap=="function"?f.f(Q):f.h(Q)),cacheControl:Y.cacheControl,expires:Y.expires})}catch(Y){delete S.abortController,R(Y)}finally{a--,v()}var Q})),v=()=>{const S=(()=>{for(const A of Object.keys(h))if(h[A]())return!0;return!1})()?f.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:f.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=a;A<S&&t.length>0;A++){const z=t.shift();z.abortController.signal.aborted?A--:_(z)}},w=(S,A)=>new Promise(((z,R)=>{const I=new Image,F=S.url,U=S.credentials;U&&U==="include"?I.crossOrigin="use-credentials":(U&&U==="same-origin"||!f.d(F))&&(I.crossOrigin="anonymous"),A.signal.addEventListener("abort",(()=>{I.src="",R(new f.a(A.signal.reason))})),I.fetchPriority="high",I.onload=()=>{I.onerror=I.onload=null,z({data:I})},I.onerror=()=>{I.onerror=I.onload=null,A.signal.aborted||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},I.src=F}))})(Lt||(Lt={})),Lt.resetRequestQueue();class Bn{constructor(t){this._transformRequestFn=t??null}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function ir(m){const t=[];if(typeof m=="string")t.push({id:"default",url:m});else if(m&&m.length>0){const a=[];for(const{id:l,url:h}of m){const _=`${l}${h}`;a.indexOf(_)===-1&&(a.push(_),t.push({id:l,url:h}))}}return t}function Lr(m,t,a){try{const l=new URL(m);return l.pathname+=`${t}${a}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function or(m){const{userImage:t}=m;return!!(t&&t.render&&t.render())&&(m.data.replace(new Uint8Array(t.data.buffer)),!0)}class en extends f.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new f.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new f.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:l}of this.requestors)l(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const l=a.spriteData;a.data=new f.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let l=!0;const h=a.data||a.spriteData;return this._validateStretch(a.stretchX,h&&h.width)||(this.fire(new f.k(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(a.stretchY,h&&h.height)||(this.fire(new f.k(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(a.content,a)||(this.fire(new f.k(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,a){if(!t)return!0;let l=0;for(const h of t){if(h[0]<l||h[1]<h[0]||a<h[1])return!1;l=h[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const l=a.spriteData,h=l&&l.width||a.data.width,_=l&&l.height||a.data.height;return!(t[0]<0||h<t[0]||t[1]<0||_<t[1]||t[2]<0||h<t[2]||t[3]<0||_<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,l=!0){const h=this.getImage(t);if(l&&(h.data.width!==a.data.width||h.data.height!==a.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=h.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((a,l)=>{let h=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(h=!1);this.isLoaded()||h?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})}))}_getImagesForIds(t){const a={};for(const l of t){let h=this.getImage(l);h||(this.fire(new f.l("styleimagemissing",{id:l})),h=this.getImage(l)),h?a[l]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:f.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],l=this.getImage(t);if(!l)return null;if(a&&a.position.version===l.version)return a.position;if(a)a.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},_=new f.I(h,l);this.patterns[t]={bin:h,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new f.T(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:a,h:l}=f.p(t),h=this.atlasImage;h.resize({width:a||1,height:l||1});for(const _ in this.patterns){const{bin:v}=this.patterns[_],w=v.x+1,S=v.y+1,A=this.getImage(_).data,z=A.width,R=A.height;f.R.copy(A,h,{x:0,y:0},{x:w,y:S},{width:z,height:R}),f.R.copy(A,h,{x:0,y:R-1},{x:w,y:S-1},{width:z,height:1}),f.R.copy(A,h,{x:0,y:0},{x:w,y:S+R},{width:z,height:1}),f.R.copy(A,h,{x:z-1,y:0},{x:w-1,y:S},{width:1,height:R}),f.R.copy(A,h,{x:0,y:0},{x:w+z,y:S},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const l=this.getImage(a);l||f.w(`Image with ID: "${a}" was not found`),or(l)&&this.updateImage(a,l)}}cloneImages(){const t={};for(const a in this.images){const l=this.images[a];t[a]=Object.assign(Object.assign({},l),{data:l.data?l.data.clone():null})}return t}}const lr=1e20;function Qr(m,t,a,l,h,_,v,w,S){for(let A=t;A<t+l;A++)nr(m,a*_+A,_,h,v,w,S);for(let A=a;A<a+h;A++)nr(m,A*_+t,1,l,v,w,S)}function nr(m,t,a,l,h,_,v){_[0]=0,v[0]=-lr,v[1]=lr,h[0]=m[t];for(let w=1,S=0,A=0;w<l;w++){h[w]=m[t+w*a];const z=w*w;do{const R=_[S];A=(h[w]-h[R]+z-R*R)/(w-R)/2}while(A<=v[S]&&--S>-1);S++,_[S]=w,v[S]=A,v[S+1]=lr}for(let w=0,S=0;w<l;w++){for(;v[S+1]<w;)S++;const A=_[S],z=w-A;m[t+w*a]=h[A]+z*z}}const Ue=f.v.layout_symbol["text-font"].default.join(",");class rt{constructor(t,a,l){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={},this.lang=l}setURL(t){this.url=t}getGlyphs(t){return f._(this,void 0,void 0,(function*(){const a=[];for(const _ in t)for(const v of t[_])a.push(this._getAndCacheGlyphsPromise(_,v));const l=yield Promise.all(a),h={};for(const{stack:_,id:v,glyph:w}of l)h[_]||(h[_]={}),h[_][v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return h}))}_getAndCacheGlyphsPromise(t,a){return f._(this,void 0,void 0,(function*(){let l=this.entries[t];l||(l=this.entries[t]={glyphs:{},requests:{},ranges:{}});let h=l.glyphs[a];return h!==void 0?{stack:t,id:a,glyph:h}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(h=l.glyphs[a]=this._drawGlyph(l,t,a),{stack:t,id:a,glyph:h}):yield this._downloadAndCacheRangePromise(t,a)}))}_downloadAndCacheRangePromise(t,a){return f._(this,void 0,void 0,(function*(){const l=this.entries[t],h=Math.floor(a/256);if(l.ranges[h])return{stack:t,id:a,glyph:null};if(!l.requests[h]){const _=rt.loadGlyphRange(t,h,this.url,this.requestManager);l.requests[h]=_}try{const _=yield l.requests[h];for(const v in _)l.glyphs[+v]=_[+v];return l.ranges[h]=!0,{stack:t,id:a,glyph:_[a]||null}}catch(_){const v=l.glyphs[a]=this._drawGlyph(l,t,a);return this._warnOnMissingGlyphRange(v,h,a,_),{stack:t,id:a,glyph:v}}}))}_warnOnMissingGlyphRange(t,a,l,h){const _=256*a,v=_+255,w=l.toString(16).padStart(4,"0").toUpperCase();f.w(`Unable to load glyph range ${a}, ${_}-${v}. Rendering codepoint U+${w} locally instead. ${h}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&f.q(t)}_drawGlyph(t,a,l){const h=a===Ue&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(l),_=h?"ideographTinySDF":"tinySDF";t[_]||(t[_]=this._createTinySDF(h?this.localIdeographFontFamily:a));const v=t[_].draw(String.fromCodePoint(l));return{id:l,bitmap:new f.r({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const a=t?t.split(","):[];a.push("sans-serif");const l=a.map((h=>/[-\w]+/.test(h)?h:`'${CSS.escape(h)}'`)).join(",");return new rt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let l;for(const[h,_]of Object.entries(a))new RegExp(`\\b${h}\\b`,"i").test(t)&&(l=`${_}`);return l}destroy(){for(const t in this.entries){const a=this.entries[t];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}rt.loadGlyphRange=function(m,t,a,l){return f._(this,void 0,void 0,(function*(){const h=256*t,_=h+255,v=l.transformRequest(a.replace("{fontstack}",m).replace("{range}",`${h}-${_}`),"Glyphs"),w=yield f.n(v,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${t}, ${h}-${_}`);const S={};for(const A of f.o(w.data))S[A.id]=A;return S}))},rt.TinySDF=class{constructor({fontSize:m=24,buffer:t=3,radius:a=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:_="normal",fontStyle:v="normal",lang:w=null}={}){this.buffer=t,this.cutoff=l,this.radius=a,this.lang=w;const S=this.size=m+4*t,A=this._createCanvas(S),z=this.ctx=A.getContext("2d",{willReadFrequently:!0});z.font=`${v} ${_} ${m}px ${h}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){const t=document.createElement("canvas");return t.width=t.height=m,t}draw(m){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:_}=this.ctx.measureText(m),v=Math.ceil(a),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-h))),S=Math.min(this.size-this.buffer,v+Math.ceil(l)),A=w+2*this.buffer,z=S+2*this.buffer,R=Math.max(A*z,0),I=new Uint8ClampedArray(R),F={data:I,width:A,height:z,glyphWidth:w,glyphHeight:S,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(w===0||S===0)return F;const{ctx:U,buffer:X,gridInner:Q,gridOuter:Y}=this;this.lang&&(U.lang=this.lang),U.clearRect(X,X,w,S),U.fillText(m,X,X+v);const W=U.getImageData(X,X,w,S);Y.fill(lr,0,R),Q.fill(0,0,R);for(let ie=0;ie<S;ie++)for(let K=0;K<w;K++){const re=W.data[4*(ie*w+K)+3]/255;if(re===0)continue;const se=(ie+X)*A+K+X;if(re===1)Y[se]=0,Q[se]=lr;else{const ee=.5-re;Y[se]=ee>0?ee*ee:0,Q[se]=ee<0?ee*ee:0}}Qr(Y,0,0,A,z,A,this.f,this.v,this.z),Qr(Q,X,X,w,S,A,this.f,this.v,this.z);for(let ie=0;ie<R;ie++){const K=Math.sqrt(Y[ie])-Math.sqrt(Q[ie]);I[ie]=Math.round(255-255*(K/this.radius+this.cutoff))}return F}};class Ct{constructor(){this.specification=f.u.light.position}possiblyEvaluate(t,a){return f.F(t.expression.evaluate(a))}interpolate(t,a,l){return{x:f.G.number(t.x,a.x,l),y:f.G.number(t.y,a.y,l),z:f.G.number(t.z,a.z,l)}}}let wt;class ui extends f.E{constructor(t){super(),wt=wt||new f.t({anchor:new f.D(f.u.light.anchor),position:new Ct,color:new f.D(f.u.light.color),intensity:new f.D(f.u.light.intensity)}),this._transitionable=new f.x(wt,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(f.y,t,a))for(const l in t){const h=t[l];l.endsWith(f.z)?this._transitionable.setTransition(l.slice(0,-f.z.length),h):this._transitionable.setValue(l,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,l){return(!l||l.validate!==!1)&&f.B(this,t.call(f.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:f.u}))}}const de=new f.t({"sky-color":new f.D(f.u.sky["sky-color"]),"horizon-color":new f.D(f.u.sky["horizon-color"]),"fog-color":new f.D(f.u.sky["fog-color"]),"fog-ground-blend":new f.D(f.u.sky["fog-ground-blend"]),"horizon-fog-blend":new f.D(f.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new f.D(f.u.sky["sky-horizon-blend"]),"atmosphere-blend":new f.D(f.u.sky["atmosphere-blend"])});class Qe extends f.E{constructor(t){super(),this._transitionable=new f.x(de,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new f.H(0))}setSky(t,a={}){if(!this._validate(f.J,t,a)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in t){const h=t[l];l.endsWith(f.z)?this._transitionable.setTransition(l.slice(0,-f.z.length),h):this._transitionable.setValue(l,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,l={}){return l?.validate!==!1&&f.B(this,t.call(f.C,f.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:f.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class ct{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const l=t.join(",")+String(a);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,a)),this.dashEntry[l]}getDashRanges(t,a,l){const h=[];let _=t.length%2==1?-t[t.length-1]*l:0,v=t[0]*l,w=!0;h.push({left:_,right:v,isDash:w,zeroLength:t[0]===0});let S=t[0];for(let A=1;A<t.length;A++){w=!w;const z=t[A];_=S*l,S+=z,v=S*l,h.push({left:_,right:v,isDash:w,zeroLength:z===0})}return h}addRoundDash(t,a,l){const h=a/2;for(let _=-l;_<=l;_++){const v=this.width*(this.nextRow+l+_);let w=0,S=t[w];for(let A=0;A<this.width;A++){A/S.right>1&&(S=t[++w]);const z=Math.abs(A-S.left),R=Math.abs(A-S.right),I=Math.min(z,R);let F;const U=_/l*(h+1);if(S.isDash){const X=h-Math.abs(U);F=Math.sqrt(I*I+X*X)}else F=h-Math.sqrt(I*I+U*U);this.data[v+A]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(t){for(let w=t.length-1;w>=0;--w){const S=t[w],A=t[w+1];S.zeroLength?t.splice(w,1):A&&A.isDash===S.isDash&&(A.left=S.left,t.splice(w,1))}const a=t[0],l=t[t.length-1];a.isDash===l.isDash&&(a.left=l.left-this.width,l.right=a.right+this.width);const h=this.width*this.nextRow;let _=0,v=t[_];for(let w=0;w<this.width;w++){w/v.right>1&&(v=t[++_]);const S=Math.abs(w-v.left),A=Math.abs(w-v.right),z=Math.min(S,A);this.data[h+w]=Math.max(0,Math.min(255,(v.isDash?z:-z)+128))}}addDash(t,a){const l=a?7:0,h=2*l+1;if(this.nextRow+h>this.height)return f.w("LineAtlas out of space"),null;let _=0;for(let w=0;w<t.length;w++)_+=t[w];if(_!==0){const w=this.width/_,S=this.getDashRanges(t,this.width,w);a?this.addRoundDash(S,w,l):this.addRegularDash(S)}const v={y:this.nextRow+l,height:2*l,width:_};return this.nextRow+=h,this.dirty=!0,v}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const gt="maplibre_preloaded_worker_pool";class Tt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Tt.workerCount;)this.workers.push(new Worker(f.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[gt]}numActive(){return Object.keys(this.active).length}}const kt=Math.floor(Mt.hardwareConcurrency/2);let $t,Si;function Ri(){return $t||($t=new Tt),$t}Tt.workerCount=f.K(globalThis)?Math.max(Math.min(kt,3),1):1;class vr{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const l=this.workerPool.acquire(a);for(let h=0;h<l.length;h++){const _=new f.L(l[h],a);_.name=`Worker ${h}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const l=[];for(const h of this.actors)l.push(h.sendAsync({type:t,data:a}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const l of this.actors)l.registerMessageHandler(t,a)}unregisterMessageHandler(t){for(const a of this.actors)a.unregisterMessageHandler(t)}}function Hs(){return Si||(Si=new vr(Ri(),f.M),Si.registerMessageHandler("GR",((m,t,a)=>f.m(t,a)))),Si}function Wr(m,t){const a=f.N();return f.O(a,a,[1,1,0]),f.Q(a,a,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?f.S(a,a,m.calculatePosMatrix(t.toUnwrapped())):a}function gl(m,t,a,l,h,_,v){var w;const S=(function(I,F,U){if(I)for(const X of I){const Q=F[X];if(Q&&Q.source===U&&Q.type==="fill-extrusion")return!0}else for(const X in F){const Q=F[X];if(Q.source===U&&Q.type==="fill-extrusion")return!0}return!1})((w=h?.layers)!==null&&w!==void 0?w:null,t,m.id),A=_.maxPitchScaleFactor(),z=m.tilesIn(l,A,S);z.sort(Zi);const R=[];for(const I of z)R.push({wrappedTileID:I.tileID.wrapped().key,queryResults:I.tile.queryRenderedFeatures(t,a,m.getState(),I.queryGeometry,I.cameraQueryGeometry,I.scale,h,_,A,Wr(_,I.tileID),v?(F,U)=>v(I.tileID,F,U):void 0)});return(function(I,F){for(const U in I)for(const X of I[U])Or(X,F);return I})((function(I){const F={},U={};for(const X of I){const Q=X.queryResults,Y=X.wrappedTileID,W=U[Y]=U[Y]||{};for(const ie in Q){const K=Q[ie],re=W[ie]=W[ie]||{},se=F[ie]=F[ie]||[];for(const ee of K)re[ee.featureIndex]||(re[ee.featureIndex]=!0,se.push(ee))}}return F})(R),m)}function Zi(m,t){const a=m.tileID,l=t.tileID;return a.overscaledZ-l.overscaledZ||a.canonical.y-l.canonical.y||a.wrap-l.wrap||a.canonical.x-l.canonical.x}function Or(m,t){const a=m.feature,l=t.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=l}function ma(m,t,a){return f._(this,void 0,void 0,(function*(){let l=m;if(m.url?l=(yield f.j(t.transformRequest(m.url,"Source"),a)).data:yield Mt.frameAsync(a),!l)return null;const h=f.U(f.e(l,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(h.vectorLayerIds=l.vector_layers.map((_=>_.id))),h}))}class tn{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof f.V?new f.V(t.lng,t.lat):f.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof f.V?new f.V(t.lng,t.lat):f.V.convert(t),this}extend(t){const a=this._sw,l=this._ne;let h,_;if(t instanceof f.V)h=t,_=t;else{if(!(t instanceof tn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(tn.convert(t)):this.extend(f.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(f.V.convert(t)):this;if(h=t._sw,_=t._ne,!h||!_)return this}return a||l?(a.lng=Math.min(h.lng,a.lng),a.lat=Math.min(h.lat,a.lat),l.lng=Math.max(_.lng,l.lng),l.lat=Math.max(_.lat,l.lat)):(this._sw=new f.V(h.lng,h.lat),this._ne=new f.V(_.lng,_.lat)),this}getCenter(){return new f.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new f.V(this.getWest(),this.getNorth())}getSouthEast(){return new f.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:l}=f.V.convert(t);let h=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}intersects(t){if(!((t=tn.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const a=f.W(this.getWest(),-180,180),l=f.W(this.getEast(),-180,180),h=f.W(t.getWest(),-180,180),_=f.W(t.getEast(),-180,180),v=a>=l,w=h>=_;return!(!v||!w)||(v?_>=a||h<=l:w?l>=h||a<=_:h<=l&&_>=a)}static convert(t){return t instanceof tn?t:t&&new tn(t)}static fromLngLat(t,a=0){const l=360*a/40075017,h=l/Math.cos(Math.PI/180*t.lat);return new tn(new f.V(t.lng-h,t.lat-l),new f.V(t.lng+h,t.lat+l))}adjustAntiMeridian(){const t=new f.V(this._sw.lng,this._sw.lat),a=new f.V(this._ne.lng,this._ne.lat);return new tn(t,t.lng>a.lng?new f.V(a.lng+360,a.lat):a)}}class _s{constructor(t,a,l){this.bounds=tn.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),l=Math.floor(f.Y(this.bounds.getWest())*a),h=Math.floor(f.X(this.bounds.getNorth())*a),_=Math.ceil(f.Y(this.bounds.getEast())*a),v=Math.ceil(f.X(this.bounds.getSouth())*a);return t.x>=l&&t.x<_&&t.y>=h&&t.y<v}}class ys extends f.E{constructor(t,a,l,h){if(super(),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.e(this,f.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=f.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return f._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new f.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield ma(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(f.e(this,t),t.bounds&&(this.tileBounds=new _s(t.bounds,this.minzoom,this.maxzoom)),this.fire(new f.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,f.Z(t)||this.fire(new f.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return f.e({},this._options)}loadTile(t){return f._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(a,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};l.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((_,v)=>{t.reloadPromise={resolve:_,reject:v}}))}else t.actor=this.dispatcher.getActor(),h="LT";t.abortController=new AbortController;try{const _=yield t.actor.sendAsync({type:h,data:l},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,_)}catch(_){if(delete t.abortController,t.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const a=t.tileID.scaledTo(this.maxzoom).canonical,l=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(l,"Tile")}}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const l=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(l.resolve).catch(l.reject)}}abortTile(t){return f._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return f._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class $s extends f.E{constructor(t,a,l,h){super(),this.id=t,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.e({type:"raster"},a),f.e(this,f.U(a,["url","scheme","tileSize"]))}load(){return f._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new f.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield ma(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(f.e(this,a),a.bounds&&(this.tileBounds=new _s(a.bounds,this.minzoom,this.maxzoom)),this.fire(new f.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,f.Z(a)||this.fire(new f.k(a))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return f.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return f._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const l=yield Lt.getImage(this.map._requestManager.transformRequest(a,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const h=this.map.painter.context,_=h.gl,v=l.data;t.texture=this.map.painter.getTileTexture(v.width),t.texture?t.texture.update(v,{useMipmap:!0}):(t.texture=new f.T(h,v,_.RGBA,{useMipmap:!0}),t.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}}))}abortTile(t){return f._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return f._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class $a extends $s{constructor(t,a,l,h){super(t,a,l,h),this.type="raster-dem",this.maxzoom=22,this._options=f.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return f._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(a,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const h=yield Lt.getImage(l,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(h&&h.data){const _=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&t.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const v=f.b(_)&&f.$()?_:yield this.readImageNow(_),w={type:this.type,uid:t.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const S=yield t.actor.sendAsync({type:"LDT",data:w});t.dem=S,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(h){if(delete t.abortController,t.aborted)t.state="unloaded";else if(h)throw t.state="errored",h}}))}readImageNow(t){return f._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&f.a0()){const a=t.width+2,l=t.height+2;try{return new f.R({width:a,height:l},yield f.a1(t,-1,-1,a,l))}catch{}}return Mt.getImageData(t,1)}))}_getNeighboringTiles(t){const a=t.canonical,l=Math.pow(2,a.z),h=(a.x-1+l)%l,_=a.x===0?t.wrap-1:t.wrap,v=(a.x+1+l)%l,w=a.x+1===l?t.wrap+1:t.wrap,S={};return S[new f.a2(t.overscaledZ,_,a.z,h,a.y).key]={backfilled:!1},S[new f.a2(t.overscaledZ,w,a.z,v,a.y).key]={backfilled:!1},a.y>0&&(S[new f.a2(t.overscaledZ,_,a.z,h,a.y-1).key]={backfilled:!1},S[new f.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},S[new f.a2(t.overscaledZ,w,a.z,v,a.y-1).key]={backfilled:!1}),a.y+1<l&&(S[new f.a2(t.overscaledZ,_,a.z,h,a.y+1).key]={backfilled:!1},S[new f.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},S[new f.a2(t.overscaledZ,w,a.z,v,a.y+1).key]={backfilled:!1}),S}unloadTile(t){return f._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Da(m){return m.type==="GeometryCollection"?m.geometries.map((t=>t.coordinates)).flat(1/0):m.coordinates.flat(1/0)}function _l(m){const t=new tn;let a;switch(m.type){case"FeatureCollection":a=m.features.map((l=>Da(l.geometry))).flat(1/0);break;case"Feature":a=Da(m.geometry);break;default:a=Da(m)}if(a.length==0)return t;for(let l=0;l<a.length-1;l+=2)t.extend([a[l],a[l+1]]);return t}class Gn extends f.E{constructor(t,a,l,h){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=l.getActor(),this.setEventedParent(h),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=f.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&f.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=f.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:f.a5,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:f.a5,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(f.a5/this.tileSize)}_getClusterMaxZoom(t){const a=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||f.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${a}"`),a}load(){return f._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,a){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const l=this._updateWorkerData();return a?l:this}updateData(t,a){this._pendingWorkerUpdate.diff=f.a6(this._pendingWorkerUpdate.diff,t);const l=this._updateWorkerData();return a?l:this}getData(){return f._(this,void 0,void 0,(function*(){const t=f.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return f._(this,void 0,void 0,(function*(){return _l(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:l}})}_updateWorkerData(){return f._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void f.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:a}=this._pendingWorkerUpdate,l=f.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(l.request=this.map._requestManager.transformRequest(Mt.resolveURL(t),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=t,this._pendingWorkerUpdate.data=void 0):a&&(l.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new f.l("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:l});if(this._isUpdatingWorker=!1,this._removed||h.abandoned)return void this.fire(new f.l("dataabort",{dataType:"source"}));a&&this._applyDiff(a);let _=null;h.resourceTiming&&h.resourceTiming[this.id]&&(_=h.resourceTiming[this.id].slice(0));const v={dataType:"source"};this._collectResourceTiming&&_&&_.length>0&&f.e(v,{resourceTiming:_}),this.fire(new f.l("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new f.l("data",Object.assign(Object.assign({},v),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(a)})))}catch(h){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new f.l("dataabort",{dataType:"source"}));this.fire(new f.k(h))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiff(t){const a=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){if(!f.a7(this._data.geojson,a))throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:f.a8(this._data.geojson,a)}}this._data.updateable&&f.a9(this._data.updateable,t,a)}_getShouldReloadTileOptions(t){if(this._options.cluster||!t||t.removeAll)return;const{add:a=[],update:l=[],remove:h=[]}=t||{},_=new Set([...l.map((v=>v.id)),...h]);for(const v of _.values())if(typeof v!="number"&&this.promoteId==null)return void f.w(`GeoJSONSource "${this.id}": updateData is slower when using string GeoJSON feature IDs. Consider using promoteId or numeric IDs for better performance.`);return{nextBounds:[...l.map((v=>v.newGeometry)),...a.map((v=>v.geometry))].filter(Boolean).map((v=>_l(v))),prevIds:_}}shouldReloadTile(t,{nextBounds:a,prevIds:l}){if(!t.latestFeatureIndex)return t.state!=="unloaded";const h=t.latestFeatureIndex.loadVTLayers();for(let S=0;S<t.latestFeatureIndex.featureIndexArray.length;S++){const A=t.latestFeatureIndex.featureIndexArray.get(S),z=h[f.aa].feature(A.featureIndex),R=t.latestFeatureIndex.getId(z,f.aa);if(l.has(R))return!0}const{buffer:_,extent:v}=this.workerOptions.geojsonVtOptions,w=(function({x:S,y:A,z},R=0){const I=f.a3((S-R)/Math.pow(2,z)),F=f.a4((A+1+R)/Math.pow(2,z)),U=f.a3((S+1+R)/Math.pow(2,z)),X=f.a4((A-R)/Math.pow(2,z));return new tn([I,F],[U,X])})(t.tileID.canonical,_/v);for(const S of a)if(w.intersects(S))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return f._(this,void 0,void 0,(function*(){const a=t.actor?"RT":"LT";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const h=yield this.actor.sendAsync({type:a,data:l},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(h,this.map.painter,a==="RT")}))}abortTile(t){return f._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return f._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return f.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Br extends f.E{constructor(t,a,l,h){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=l,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=a}load(t){return f._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new f.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield Lt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,f.Z(a)||this.fire(new f.k(a))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new f.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(f.ab.fromLngLat);var l;return this.tileID=(function(h){const _=f.ac.fromPoints(h),v=_.width(),w=_.height(),S=Math.max(v,w),A=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),z=Math.pow(2,A);return new f.ae(A,Math.floor((_.minX+_.maxX)/2*z),Math.floor((_.minY+_.maxY)/2*z))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((h=>this.tileID.getTilePoint(h)._round())),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new f.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture||(this.texture=new f.T(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const _=this.tiles[h];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,l=!0)}l&&this.fire(new f.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return f._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:a,minY:l,maxX:h,maxY:_}=f.ac.fromPoints(t),v={};for(let w=0;w<=f.ad;w++){const S=Math.pow(2,w),A=Math.floor(a*S),z=Math.floor(l*S),R=Math.floor(h*S),I=Math.floor(_*S);v[w]={minTileX:A,minTileY:z,maxTileX:R,maxTileY:I}}return v}}class ye extends Br{constructor(t,a,l,h){super(t,a,l,h),this.roundZoom=!0,this.type="video",this.options=a}load(){return f._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield f.af(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new f.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new f.k(new f.ag(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new f.T(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const _=this.tiles[h];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,l=!0)}l&&this.fire(new f.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class j extends Br{constructor(t,a,l,h){super(t,a,l,h),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((_=>!Array.isArray(_)||_.length!==2||_.some((v=>typeof v!="number"))))||this.fire(new f.k(new f.ag(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.k(new f.ag(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new f.k(new f.ag(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new f.k(new f.ag(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.k(new f.ag(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return f._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,l=a.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new f.T(a,this.canvas,l.RGBA,{premultiply:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let h=!1;for(const _ in this.tiles){const v=this.tiles[_];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,h=!0)}h&&this.fire(new f.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const V={},H=m=>{switch(m){case"geojson":return Gn;case"image":return Br;case"raster":return $s;case"raster-dem":return $a;case"vector":return ys;case"video":return ye;case"canvas":return j}return V[m]},ae="RTLPluginLoaded";class le extends f.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Hs()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return f._(this,arguments,void 0,(function*(a,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Mt.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return f._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new f.l(ae))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Te=null;function ge(){return Te||(Te=new le),Te}var he,Se;(function(m){m[m.Base=0]="Base",m[m.Parent=1]="Parent"})(he||(he={})),(function(m){m[m.Departing=0]="Departing",m[m.Incoming=1]="Incoming"})(Se||(Se={}));class Ve{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=f.ah(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:a,fadingParentID:l,fadeEndTime:h}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=a,this.fadingParentID=l,this.fadeEndTime=h}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=Et(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(h,_){const v={};if(!_)return v;for(const w of h){const S=w.layerIds.map((A=>_.getLayer(A))).filter(Boolean);if(S.length!==0){w.layers=S,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map((A=>S.filter((z=>z.id===A))[0])));for(const A of S)v[A.id]=w}}return v})(t.buckets,a?.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const _=this.buckets[h];if(_ instanceof f.aj){if(this.hasSymbolBuckets=!0,!l)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const _=this.buckets[h];if(_ instanceof f.aj&&_.hasRTLText){this.hasRTLText=!0,ge().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const _=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(h).queryRadius(_))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new f.ai}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new f.T(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new f.T(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,l,h,_,v,w,S,A,z,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:_,scale:v,tileSize:this.tileSize,pixelPosMatrix:z,transform:S,params:w,queryPadding:this.queryPadding*A,getElevation:R},t,a,l):{}}querySourceFeatures(t,a){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),_=a&&a.sourceLayer?a.sourceLayer:"",v=h[f.aa]||h[_];if(!v)return;const w=f.ak(a?.filter,a?.globalState),{z:S,x:A,y:z}=this.tileID.canonical,R={z:S,x:A,y:z};for(let I=0;I<v.length;I++){const F=v.feature(I);if(w.needGeometry){const Q=f.al(F,!0);if(!w.filter(new f.H(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!w.filter(new f.H(this.tileID.overscaledZ),F))continue;const U=l.getId(F,_),X=new f.am(F,S,A,z,U);X.tile=R,t.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const l=f.an(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(a)if(this.expirationTime<a)h=!0;else{const _=this.expirationTime-a;_?this.expirationTime=l+Math.max(_,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!a.style.hasLayer(h))continue;const _=this.buckets[h],v=_.layers[0].sourceLayer||f.aa,w=l[v],S=t[v];if(!w||!S||Object.keys(S).length===0)continue;_.update(S,w,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const A=a&&a.style&&a.style.getLayer(h);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(_)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Et()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=Et()+t}setDependencies(t,a){const l={};for(const h of a)l[h]=!0;this.dependencies[t]=l}hasDependency(t,a){for(const l of t){const h=this.dependencies[l];if(h){for(const _ of a)if(h[_])return!0}}return!1}}class je{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,l){const h=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},f.e(this.stateChanges[t][h],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==h&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const _ in this.state[t][h])l[_]||(this.deletedStates[t][h][_]=null)}else for(const _ in l)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][_]===null&&delete this.deletedStates[t][h][_]}removeFeatureState(t,a,l){if(this.deletedStates[t]===null)return;const h=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&a!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][l]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(l in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][l]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,a){const l=String(a),h=f.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const _=this.deletedStates[t][a];if(_===null)return{};for(const v in _)delete h[v]}return h}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const _={};for(const v in this.stateChanges[h])this.state[h][v]||(this.state[h][v]={}),f.e(this.state[h][v],this.stateChanges[h][v]),_[v]=this.state[h][v];l[h]=_}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const _={};if(this.deletedStates[h]===null)for(const v in this.state[h])_[v]={},this.state[h][v]={};else for(const v in this.deletedStates[h]){if(this.deletedStates[h][v]===null)this.state[h][v]={};else for(const w of Object.keys(this.deletedStates[h][v]))delete this.state[h][v][w];_[v]=this.state[h][v]}l[h]=l[h]||{},f.e(l[h],_)}this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0&&t.setFeatureState(l,a)}}const lt=89.25;function mt(m,t){const a=f.ao(t.lat,-f.ap,f.ap);return new f.P(f.Y(t.lng)*m,f.X(a)*m)}function zt(m,t){return new f.ab(t.x/m,t.y/m).toLngLat()}function ci(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(f.aq(90-m.pitch)),Math.tan(f.aq(lt-m.pitch)))}function Jt(m,t){const a=m.canonical,l=t/f.ar(a.z),h=a.x+Math.pow(2,a.z)*m.wrap,_=f.as(new Float64Array(16));return f.O(_,_,[h*l,a.y*l,0]),f.Q(_,_,[l/f.a5,l/f.a5,1]),_}function ve(m,t,a,l,h){const _=f.ab.fromLngLat(m,t),v=h*f.at(1,m.lat),{x:w,y:S,z:A}=pi(a,l);return new f.ab(_.x+v*-w,_.y+v*-S,_.z+v*-A)}function pi(m,t){const a=f.aq(m),l=f.aq(t),h=Math.cos(-a),_=Math.sin(a);return{x:_*Math.sin(l),y:-_*Math.cos(l),z:h}}function _n(m,t,a){const l=t.intersectsFrustum(m);if(!a||l===0)return l;const h=t.intersectsPlane(a);return h===0?0:l===2&&h===2?2:1}function It(m,t,a){let l=0;const h=(a-t)/10;for(let _=0;_<10;_++)l+=h*Math.pow(Math.cos(t+(_+.5)/10*(a-t)),m);return l}function mi(m,t){return function(a,l,h,_,v){const w=2*((m-1)/f.au(Math.cos(f.aq(lt-v))/Math.cos(f.aq(lt)))-1),S=Math.acos(h/_),A=2*It(w-1,0,f.aq(v/2)),z=Math.min(f.aq(lt),S+f.aq(v/2)),R=It(w-1,Math.min(z,S-f.aq(v/2)),z),I=Math.atan(l/h),F=Math.hypot(l,h);let U=a;return U+=f.au(_/F/Math.max(.5,Math.cos(f.aq(v/2)))),U+=w*f.au(Math.cos(I))/2,U-=f.au(Math.max(1,R/A/t))/2,U}}const kn=mi(9.314,3);function gi(m,t){const a=(t.roundZoom?Math.round:Math.floor)(m.zoom+f.au(m.tileSize/t.tileSize));return Math.max(0,a)}function hn(m,t){const a=m.getCameraFrustum(),l=m.getClippingPlane(),h=m.screenPointToMercatorCoordinate(m.getCameraPoint()),_=f.ab.fromLngLat(m.center,m.elevation);h.z=_.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const v=m.getCoveringTilesDetailsProvider(),w=v.allowVariableZoom(m,t),S=gi(m,t),A=t.minzoom||0,z=t.maxzoom!==void 0?t.maxzoom:m.maxZoom,R=Math.min(Math.max(0,S),z),I=Math.pow(2,R),F=[I*h.x,I*h.y,0],U=[I*_.x,I*_.y,0],X=Math.hypot(_.x-h.x,_.y-h.y),Q=Math.abs(_.z-h.z),Y=Math.hypot(X,Q),W=re=>({zoom:0,x:0,y:0,wrap:re,fullyVisible:!1}),ie=[],K=[];if(m.renderWorldCopies&&v.allowWorldCopies())for(let re=1;re<=3;re++)ie.push(W(-re)),ie.push(W(re));for(ie.push(W(0));ie.length>0;){const re=ie.pop(),se=re.x,ee=re.y;let fe=re.fullyVisible;const Me={x:se,y:ee,z:re.zoom},xe=v.getTileBoundingVolume(Me,re.wrap,m.elevation,t);if(!fe){const Je=_n(a,xe,l);if(Je===0)continue;fe=Je===2}const Ee=v.distanceToTile2d(h.x,h.y,Me,xe);let Ce=S;w&&(Ce=(t.calculateTileZoom||kn)(m.zoom+f.au(m.tileSize/t.tileSize),Ee,Q,Y,m.fov)),Ce=(t.roundZoom?Math.round:Math.floor)(Ce),Ce=Math.max(0,Ce);const He=Math.min(Ce,z);if(re.wrap=v.getWrap(_,Me,re.wrap),re.zoom>=He){if(re.zoom<A)continue;const Je=R-re.zoom,qe=F[0]-.5-(se<<Je),ft=F[1]-.5-(ee<<Je),Pt=t.reparseOverscaled?Math.max(re.zoom,Ce):re.zoom;K.push({tileID:new f.a2(re.zoom===z?Pt:re.zoom,re.wrap,re.zoom,se,ee),distanceSq:f.av([U[0]-.5-se,U[1]-.5-ee]),tileDistanceToCamera:Math.sqrt(qe*qe+ft*ft)})}else for(let Je=0;Je<4;Je++)ie.push({zoom:re.zoom+1,x:(se<<1)+Je%2,y:(ee<<1)+(Je>>1),wrap:re.wrap,fullyVisible:fe})}return K.sort(((re,se)=>re.distanceSq-se.distanceSq)).map((re=>re.tileID))}const Mi=f.ac.fromPoints([new f.P(0,0),new f.P(f.a5,f.a5)]);function yn(m){return m==="raster"||m==="image"||m==="video"}function yl(m,t,a,l,h,_,v){if(!t.hasData())return!1;const{tileID:w,fadingRole:S,fadingDirection:A,fadingParentID:z}=t;if(S===he.Base&&A===Se.Incoming&&z)return a[z.key]=z,!0;const R=Math.max(w.overscaledZ-h,_);for(let I=w.overscaledZ-1;I>=R;I--){const F=w.scaledTo(I),U=m.getLoadedTile(F);if(U)return t.setCrossFadeLogic({fadingRole:he.Base,fadingDirection:Se.Incoming,fadingParentID:U.tileID,fadeEndTime:l+v}),U.setCrossFadeLogic({fadingRole:he.Parent,fadingDirection:Se.Departing,fadeEndTime:l+v}),a[F.key]=F,!0}return!1}function Eo(m,t,a,l,h,_){if(!t.hasData())return!1;const v=t.tileID.children(h);let w=Ke(m,t,v,a,l,h,_);if(w)return!0;for(const S of v)Ke(m,t,S.children(h),a,l,h,_)&&(w=!0);return w}function Ke(m,t,a,l,h,_,v){if(a[0].overscaledZ>=_)return!1;let w=!1;for(const S of a){const A=m.getLoadedTile(S);if(!A)continue;const{fadingRole:z,fadingDirection:R,fadingParentID:I}=A;z===he.Base&&R===Se.Departing&&I||(A.setCrossFadeLogic({fadingRole:he.Base,fadingDirection:Se.Departing,fadingParentID:t.tileID,fadeEndTime:h+v}),t.setCrossFadeLogic({fadingRole:he.Parent,fadingDirection:Se.Incoming,fadeEndTime:h+v})),l[S.key]=S,w=!0}return w}function ur(m,t,a,l){const h=m.tileID;return!!m.selfFading||!m.hasData()&&!!t.has(h)&&(m.setSelfFadeLogic(a+l),!0)}function cr(m,t){var a;m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let l=t.tileID.canonical.x-m.tileID.canonical.x;const h=t.tileID.canonical.y-m.tileID.canonical.y,_=Math.pow(2,m.tileID.canonical.z),v=t.tileID.key;l===0&&h===0||Math.abs(h)>1||(Math.abs(l)>1&&(Math.abs(l+_)===1?l+=_:Math.abs(l-_)===1&&(l-=_)),t.dem&&m.dem&&(m.dem.backfillBorder(t.dem,l,h),!((a=m.neighboringTiles)===null||a===void 0)&&a[v]&&(m.neighboringTiles[v].backfilled=!0)))}class Pa{constructor(){this._tiles={}}handleWrapJump(t){const a={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+t),a[h.tileID.key]=h}this._tiles=a}setFeatureState(t,a){for(const l in this._tiles)this._tiles[l].setFeatureState(t,a)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((a=>a.tileID)).sort(f.ax).map((a=>a.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,a){this._tiles[t]=a}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const a=this.getTileById(t.key);return a?.hasData()?a:null}isIdRenderable(t,a=!1){var l;return(l=this.getTileById(t))===null||l===void 0?void 0:l.isRenderable(a)}getRenderableIds(t=0,a){const l=[];for(const h of this.getAllIds())this.isIdRenderable(h,a)&&l.push(this.getTileById(h));return a?l.sort(((h,_)=>{const v=h.tileID,w=_.tileID,S=new f.P(v.canonical.x,v.canonical.y)._rotate(-t),A=new f.P(w.canonical.x,w.canonical.y)._rotate(-t);return v.overscaledZ-w.overscaledZ||A.y-S.y||A.x-S.x})).map((h=>h.tileID.key)):l.map((h=>h.tileID)).sort(f.ax).map((h=>h.key))}}class Ii extends f.E{constructor(t,a,l){super(),this.id=t,this.dispatcher=l,this.on("data",(h=>this._dataHandler(h))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((h,_,v,w)=>{const S=new(H(_.type))(h,_,v,w);if(S.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${S.id}`);return S})(t,a,l,this),this._inViewTiles=new Pa,this._outOfViewCache=new f.ay(0,(h=>this._unloadTile(h))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new je,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const a of this._inViewTiles.getAllTiles())a.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Pa}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,l){return f._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,l)}catch(h){t.state="errored",h.status!==404?this._source.fire(new f.k(h,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new f.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const a of this._inViewTiles.getAllTiles())a.upload(t),a.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var a;return this._inViewTiles.getRenderableIds((a=this.transform)===null||a===void 0?void 0:a.bearingInRadians,t)}hasRenderableParent(t){const a=t.overscaledZ-1;if(a>=this._source.minzoom){const l=this.getLoadedTile(t.scaledTo(a));if(l)return this._inViewTiles.isIdRenderable(l.tileID.key)}return!1}reload(t,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const l of this._inViewTiles.getAllIds()){const h=this._inViewTiles.getTileById(l);a&&!this._source.shouldReloadTile(h,a)||(t?this._reloadTile(l,"expired"):h.state!=="errored"&&this._reloadTile(l,"reloading"))}}}_reloadTile(t,a){return f._(this,void 0,void 0,(function*(){const l=this._inViewTiles.getTileById(t);l&&(l.state!=="loading"&&(l.state=a),yield this._loadTile(l,t,a))}))}_tileLoaded(t,a,l){t.timeAdded=Et(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&(function(h,_){var v,w;const S=_.getRenderableIds();for(const A of S){if(!h.neighboringTiles||!h.neighboringTiles[A])continue;const z=_.getTileById(A);h.neighboringTiles[A].backfilled||cr(h,z),!((w=(v=z.neighboringTiles)===null||v===void 0?void 0:v[h.tileID.key])===null||w===void 0)&&w.backfilled||cr(z,h)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new f.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,a){const l=this._getLoadedDescendents(a),h=new Set;for(const _ of a){const v=l[_.key];if(!v?.length){h.add(_);continue}const w=_.overscaledZ+Ii.maxOverzooming,S=v.filter((R=>R.tileID.overscaledZ<=w));if(!S.length){h.add(_);continue}const A=Math.min(...S.map((R=>R.tileID.overscaledZ))),z=S.filter((R=>R.tileID.overscaledZ===A)).map((R=>R.tileID));for(const R of z)t[R.key]=R;this._areDescendentsComplete(z,A,_.overscaledZ)||h.add(_)}return h}_getLoadedDescendents(t){var a;const l={};for(const h of this._inViewTiles.getAllTiles().filter((_=>_.hasData())))for(const _ of t)h.tileID.isChildOf(_)&&(l[a=_.key]||(l[a]=[])).push(h);return l}_areDescendentsComplete(t,a,l){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===a:Math.pow(4,a-l)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,h=Math.floor(a*l*(this._maxTileCacheZoomLevels===null?f.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._outOfViewCache.setMaxSize(_)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,a&&(this._inViewTiles.handleWrapJump(a),this._resetTileReloadTimers())}update(t,a){if(!this._sourceLoaded||this._paused)return;let l;this.transform=t,this.terrain=a,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((S=>new f.a2(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y))):(l=hn(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter((S=>this._source.hasTile(S))))):l=[],this.usedForTerrain&&(l=this._addTerrainIdealTiles(l));const h=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,h&&this.fire(new f.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const _=gi(t,this._source),v=this._updateRetainedTiles(l,_),w=yn(this._source.type);w&&this._rasterFadeDuration>0&&!a&&(function(S,A,z,R,I,F,U){const X=Et(),Q=f.aw(A);for(const Y of A){const W=S.getTileById(Y.key);W.fadingDirection!==Se.Departing&&W.fadeOpacity!==0||W.resetFadeLogic(),yl(S,W,z,X,R,I,U)||Eo(S,W,z,X,F,U)||ur(W,Q,X,U)||W.resetFadeLogic()}})(this._inViewTiles,l,v,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),w?this._cleanUpRasterTiles(v):this._cleanUpVectorTiles(v)}_cleanUpRasterTiles(t){for(const a of this._inViewTiles.getAllIds())t[a]||this._removeTile(a)}_cleanUpVectorTiles(t){for(const a of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(a);t[a]?l.clearSymbolFadeHold():l.hasSymbolBuckets?l.holdingForSymbolFade()?l.symbolFadeFinished()&&this._removeTile(a):l.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(t){const a=[];for(const l of t)if(l.canonical.z>this._source.minzoom){const h=l.scaledTo(l.canonical.z-1);a.push(h);const _=l.scaledTo(Math.max(this._source.minzoom,Math.min(l.canonical.z,5)));a.push(_)}return t.concat(a)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){var l;const h=new Set;for(const A of t)this._addTile(A).hasData()||h.add(A);const _=t.reduce(((A,z)=>(A[z.key]=z,A)),{}),v=this._retainLoadedChildren(_,h),w={},S=Math.max(a-Ii.maxUnderzooming,this._source.minzoom);for(const A of v){let z=this._inViewTiles.getTileById(A.key),R=z?.wasRequested();for(let I=A.overscaledZ-1;I>=S;--I){const F=A.scaledTo(I);if(w[F.key])break;if(w[F.key]=!0,z=this.getTile(F),!z&&R&&(z=this._addTile(F)),z){const U=z.hasData();if((U||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||R)&&(_[F.key]=F),R=z.wasRequested(),U)break}}}return _}_addTile(t){let a=this._inViewTiles.getTileById(t.key);if(a)return a;a=this._outOfViewCache.getAndRemove(t),a&&(a.resetFadeLogic(),this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null));const l=a;return a||(a=new Ve(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._inViewTiles.setTile(t.key,a),l||this._source.fire(new f.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){this._clearTileReloadTimer(t);const l=a.getExpiryTimeout();l&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),l))}_clearTileReloadTimer(t){const a=this._timers[t];a&&(clearTimeout(a),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const a=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,a)}}refreshTiles(t){for(const a of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(a);(this._inViewTiles.isIdRenderable(a)||l.state=="errored")&&t.some((h=>h.equals(l.tileID.canonical)))&&this._reloadTile(a,"expired")}}_removeTile(t){const a=this._inViewTiles.getTileById(t);a&&(a.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._outOfViewCache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,a,l){const h=[],_=this.transform;if(!_)return h;const v=_.getCoveringTilesDetailsProvider().allowWorldCopies(),w=l?_.getCameraQueryGeometry(t):t,S=F=>_.screenPointToMercatorCoordinate(F,this.terrain),A=this.transformBbox(t,S,!v),z=this.transformBbox(w,S,!v),R=this.getIds(),I=f.ac.fromPoints(z);for(let F=0;F<R.length;F++){const U=this._inViewTiles.getTileById(R[F]);if(U.holdingForSymbolFade())continue;const X=v?[U.tileID]:[U.tileID.unwrapTo(-1),U.tileID.unwrapTo(0)],Q=Math.pow(2,_.zoom-U.tileID.overscaledZ),Y=a*U.queryPadding*f.a5/U.tileSize/Q;for(const W of X){const ie=I.map((K=>W.getTilePoint(new f.ab(K.x,K.y))));if(ie.expandBy(Y),ie.intersects(Mi)){const K=A.map((se=>W.getTilePoint(se))),re=z.map((se=>W.getTilePoint(se)));h.push({tile:U,tileID:v?W:W.unwrapTo(0),queryGeometry:K,cameraQueryGeometry:re,scale:Q})}}}return h}transformBbox(t,a,l){let h=t.map(a);if(l){const _=f.ac.fromPoints(t);_.shrinkBy(.001*Math.min(_.width(),_.height()));const v=_.map(a);f.ac.fromPoints(h).covers(v)||(h=h.map((w=>w.x>.5?new f.ab(w.x-1,w.y,w.z):w)))}return h}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map((l=>this._inViewTiles.getTileById(l).tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){return!!this._source.hasTransition()||!(!yn(this._source.type)||!(function(t,a){if(a<=0)return!1;const l=Et();for(const h of t.getAllTiles())if(h.fadeEndTime>=l)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,a,l){this._state.updateState(t=t||f.aa,a,l)}removeFeatureState(t,a,l){this._state.removeFeatureState(t=t||f.aa,a,l)}getFeatureState(t,a){return this._state.getState(t=t||f.aa,a)}setDependencies(t,a,l){const h=this._inViewTiles.getTileById(t);h&&h.setDependencies(a,l)}reloadTilesForDependencies(t,a){for(const l of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(l).hasDependency(t,a)&&this._reloadTile(l,"reloading");this._outOfViewCache.filter((l=>!l.hasDependency(t,a)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}Ii.maxUnderzooming=10,Ii.maxOverzooming=3;class et{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=f.ao(t,0,1);let a=1,l=this._distances[a];const h=t*this.paddedLength+this.padding;for(;l<h&&a<this._distances.length;)l=this._distances[++a];const _=a-1,v=this._distances[_],w=l-v,S=w>0?(h-v)/w:0;return this.points[_].mult(1-S).add(this.points[a].mult(S))}}function Ot(m,t){let a=!0;return m==="always"||m!=="never"&&t!=="never"||(a=!1),a}class Nt{constructor(t,a,l){const h=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(a/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)h.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,l,h,_){this._forEachCell(a,l,h,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(_)}insertCircle(t,a,l,h){this._forEachCell(a-h,l-h,a+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(l),this.circles.push(h)}_insertBoxCell(t,a,l,h,_,v){this.boxCells[_].push(v)}_insertCircleCell(t,a,l,h,_,v){this.circleCells[_].push(v)}_query(t,a,l,h,_,v,w){if(l<0||t>this.width||h<0||a>this.height)return[];const S=[];if(t<=0&&a<=0&&this.width<=l&&this.height<=h){if(_)return[{key:null,x1:t,y1:a,x2:l,y2:h}];for(let A=0;A<this.boxKeys.length;A++)S.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const z=this.circles[3*A],R=this.circles[3*A+1],I=this.circles[3*A+2];S.push({key:this.circleKeys[A],x1:z-I,y1:R-I,x2:z+I,y2:R+I})}}else this._forEachCell(t,a,l,h,this._queryCell,S,{hitTest:_,overlapMode:v,seenUids:{box:{},circle:{}}},w);return S}query(t,a,l,h){return this._query(t,a,l,h,!1,null)}hitTest(t,a,l,h,_,v){return this._query(t,a,l,h,!0,_,v).length>0}hitTestCircle(t,a,l,h,_){const v=t-l,w=t+l,S=a-l,A=a+l;if(w<0||v>this.width||A<0||S>this.height)return!1;const z=[];return this._forEachCell(v,S,w,A,this._queryCellCircle,z,{hitTest:!0,overlapMode:h,circle:{x:t,y:a,radius:l},seenUids:{box:{},circle:{}}},_),z.length>0}_queryCell(t,a,l,h,_,v,w,S){const{seenUids:A,hitTest:z,overlapMode:R}=w,I=this.boxCells[_];if(I!==null){const U=this.bboxes;for(const X of I)if(!A.box[X]){A.box[X]=!0;const Q=4*X,Y=this.boxKeys[X];if(t<=U[Q+2]&&a<=U[Q+3]&&l>=U[Q+0]&&h>=U[Q+1]&&(!S||S(Y))&&(!z||!Ot(R,Y.overlapMode))&&(v.push({key:Y,x1:U[Q],y1:U[Q+1],x2:U[Q+2],y2:U[Q+3]}),z))return!0}}const F=this.circleCells[_];if(F!==null){const U=this.circles;for(const X of F)if(!A.circle[X]){A.circle[X]=!0;const Q=3*X,Y=this.circleKeys[X];if(this._circleAndRectCollide(U[Q],U[Q+1],U[Q+2],t,a,l,h)&&(!S||S(Y))&&(!z||!Ot(R,Y.overlapMode))){const W=U[Q],ie=U[Q+1],K=U[Q+2];if(v.push({key:Y,x1:W-K,y1:ie-K,x2:W+K,y2:ie+K}),z)return!0}}}return!1}_queryCellCircle(t,a,l,h,_,v,w,S){const{circle:A,seenUids:z,overlapMode:R}=w,I=this.boxCells[_];if(I!==null){const U=this.bboxes;for(const X of I)if(!z.box[X]){z.box[X]=!0;const Q=4*X,Y=this.boxKeys[X];if(this._circleAndRectCollide(A.x,A.y,A.radius,U[Q+0],U[Q+1],U[Q+2],U[Q+3])&&(!S||S(Y))&&!Ot(R,Y.overlapMode))return v.push(!0),!0}}const F=this.circleCells[_];if(F!==null){const U=this.circles;for(const X of F)if(!z.circle[X]){z.circle[X]=!0;const Q=3*X,Y=this.circleKeys[X];if(this._circlesCollide(U[Q],U[Q+1],U[Q+2],A.x,A.y,A.radius)&&(!S||S(Y))&&!Ot(R,Y.overlapMode))return v.push(!0),!0}}}_forEachCell(t,a,l,h,_,v,w,S){const A=this._convertToXCellCoord(t),z=this._convertToYCellCoord(a),R=this._convertToXCellCoord(l),I=this._convertToYCellCoord(h);for(let F=A;F<=R;F++)for(let U=z;U<=I;U++)if(_.call(this,t,a,l,h,this.xCellCount*U+F,v,w,S))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,l,h,_,v){const w=h-t,S=_-a,A=l+v;return A*A>w*w+S*S}_circleAndRectCollide(t,a,l,h,_,v,w){const S=(v-h)/2,A=Math.abs(t-(h+S));if(A>S+l)return!1;const z=(w-_)/2,R=Math.abs(a-(_+z));if(R>z+l)return!1;if(A<=S||R<=z)return!0;const I=A-S,F=R-z;return I*I+F*F<=l*l}}function Kr(m,t,a){const l=f.N();if(!m){const{vecSouth:R,vecEast:I}=Xa(t),F=we();F[0]=I[0],F[1]=I[1],F[2]=R[0],F[3]=R[1],h=F,(z=(v=(_=F)[0])*(A=_[3])-(S=_[2])*(w=_[1]))&&(h[0]=A*(z=1/z),h[1]=-w*z,h[2]=-S*z,h[3]=v*z),l[0]=F[0],l[1]=F[1],l[4]=F[2],l[5]=F[3]}var h,_,v,w,S,A,z;return f.Q(l,l,[1/a,1/a,1]),l}function lc(m,t,a,l){if(m){const h=f.N();if(!t){const{vecSouth:_,vecEast:v}=Xa(a);h[0]=v[0],h[1]=v[1],h[4]=_[0],h[5]=_[1]}return f.Q(h,h,[l,l,1]),h}return a.pixelsToClipSpaceMatrix}function Xa(m){const t=Math.cos(m.rollInRadians),a=Math.sin(m.rollInRadians),l=Math.cos(m.pitchInRadians),h=Math.cos(m.bearingInRadians),_=Math.sin(m.bearingInRadians),v=f.aD();v[0]=-h*l*a-_*t,v[1]=-_*l*a+h*t;const w=f.aE(v);w<1e-9?f.aF(v):f.aG(v,v,1/w);const S=f.aD();S[0]=h*l*t-_*a,S[1]=_*l*t+h*a;const A=f.aE(S);return A<1e-9?f.aF(S):f.aG(S,S,1/A),{vecEast:S,vecSouth:v}}function Rt(m,t,a,l){let h;l?(h=[m,t,l(m,t),1],f.aI(h,h,a)):(h=[m,t,0,1],ga(h,h,a));const _=h[3];return{point:new f.P(h[0]/_,h[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}function Ao(m,t){return .5+m/t*.5}function Ya(m,t){return m.x>=-t[0]&&m.x<=t[0]&&m.y>=-t[1]&&m.y<=t[1]}function vs(m,t,a,l,h,_,v,w,S,A,z,R,I){const F=a?m.textSizeData:m.iconSizeData,U=f.az(F,t.transform.zoom),X=[256/t.width*2+1,256/t.height*2+1],Q=a?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;Q.clear();const Y=m.lineVertexArray,W=a?m.text.placedSymbolArray:m.icon.placedSymbolArray,ie=t.transform.width/t.transform.height;let K=!1;for(let re=0;re<W.length;re++){const se=W.get(re);if(se.hidden||se.writingMode===f.aA.vertical&&!K){Ka(se.numGlyphs,Q);continue}K=!1;const ee=new f.P(se.anchorX,se.anchorY),fe={getElevation:I,pitchedLabelPlaneMatrix:l,lineVertexArray:Y,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:ee,unwrappedTileID:S,width:A,height:z,translation:R},Me=xl(se.anchorX,se.anchorY,fe);if(!Ya(Me.point,X)){Ka(se.numGlyphs,Q);continue}const xe=Ao(t.transform.cameraToCenterDistance,Me.signedDistanceFromCamera),Ee=f.aB(F,U,se),Ce=_?Ee*t.transform.getPitchedTextCorrection(se.anchorX,se.anchorY,S)/xe:Ee*xe,He=nn({projectionContext:fe,pitchedLabelPlaneMatrixInverse:h,symbol:se,fontSize:Ce,flip:!1,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:Q,aspectRatio:ie,rotateToLine:w});K=He.useVertical,(He.notEnoughRoom||K||He.needsFlipping&&nn({projectionContext:fe,pitchedLabelPlaneMatrixInverse:h,symbol:se,fontSize:Ce,flip:!0,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:Q,aspectRatio:ie,rotateToLine:w}).notEnoughRoom)&&Ka(se.numGlyphs,Q)}a?m.text.dynamicLayoutVertexBuffer.updateData(Q):m.icon.dynamicLayoutVertexBuffer.updateData(Q)}function Qa(m,t,a,l,h,_,v,w){const S=_.glyphStartIndex+_.numGlyphs,A=_.lineStartIndex,z=_.lineStartIndex+_.lineLength,R=t.getoffsetX(_.glyphStartIndex),I=t.getoffsetX(S-1),F=Ia(m*R,a,l,h,_.segment,A,z,w,v);if(!F)return null;const U=Ia(m*I,a,l,h,_.segment,A,z,w,v);return U?w.projectionCache.anyProjectionOccluded?null:{first:F,last:U}:null}function Wa(m,t,a,l){return m===f.aA.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*l?{useVertical:!0}:(m===f.aA.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function nn(m){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:a,symbol:l,fontSize:h,flip:_,keepUpright:v,glyphOffsetArray:w,dynamicLayoutVertexArray:S,aspectRatio:A,rotateToLine:z}=m,R=h/24,I=l.lineOffsetX*R,F=l.lineOffsetY*R;let U;if(l.numGlyphs>1){const X=l.glyphStartIndex+l.numGlyphs,Q=l.lineStartIndex,Y=l.lineStartIndex+l.lineLength,W=Qa(R,w,I,F,_,l,z,t);if(!W)return{notEnoughRoom:!0};const ie=xs(W.first.point.x,W.first.point.y,t,a),K=xs(W.last.point.x,W.last.point.y,t,a);if(v&&!_){const re=Wa(l.writingMode,ie,K,A);if(re)return re}U=[W.first];for(let re=l.glyphStartIndex+1;re<X-1;re++){const se=Ia(R*w.getoffsetX(re),I,F,_,l.segment,Q,Y,t,z);if(!se)return{notEnoughRoom:!0};U.push(se)}U.push(W.last)}else{if(v&&!_){const Q=ei(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,Y=l.lineStartIndex+l.segment+1,W=new f.P(t.lineVertexArray.getx(Y),t.lineVertexArray.gety(Y)),ie=ei(W.x,W.y,t),K=ie.signedDistanceFromCamera>0?ie.point:vl(t.tileAnchorPoint,W,Q,1,t),re=xs(Q.x,Q.y,t,a),se=xs(K.x,K.y,t,a),ee=Wa(l.writingMode,re,se,A);if(ee)return ee}const X=Ia(R*w.getoffsetX(l.glyphStartIndex),I,F,_,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,t,z);if(!X||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};U=[X]}for(const X of U)f.aH(S,X.point,X.angle);return{}}function vl(m,t,a,l,h){const _=m.add(m.sub(t)._unit()),v=ei(_.x,_.y,h).point,w=a.sub(v);return a.add(w._mult(l/w.mag()))}function hr(m,t,a){const l=t.projectionCache;if(l.projections[m])return l.projections[m];const h=new f.P(t.lineVertexArray.getx(m),t.lineVertexArray.gety(m)),_=ei(h.x,h.y,t);if(_.signedDistanceFromCamera>0)return l.projections[m]=_.point,l.anyProjectionOccluded=l.anyProjectionOccluded||_.isOccluded,_.point;const v=m-a.direction;return vl(a.distanceFromAnchor===0?t.tileAnchorPoint:new f.P(t.lineVertexArray.getx(v),t.lineVertexArray.gety(v)),h,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,t)}function ei(m,t,a){const l=m+a.translation[0],h=t+a.translation[1];let _;return a.pitchWithMap?(_=Rt(l,h,a.pitchedLabelPlaneMatrix,a.getElevation),_.isOccluded=!1):(_=a.transform.projectTileCoordinates(l,h,a.unwrappedTileID,a.getElevation),_.point.x=(.5*_.point.x+.5)*a.width,_.point.y=(.5*-_.point.y+.5)*a.height),_}function xs(m,t,a,l){if(a.pitchWithMap){const h=[m,t,0,1];return f.aI(h,h,l),a.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],a.unwrappedTileID,a.getElevation).point}return{x:m/a.width*2-1,y:1-t/a.height*2}}function xl(m,t,a){return a.transform.projectTileCoordinates(m,t,a.unwrappedTileID,a.getElevation)}function bl(m,t,a){return m._unit()._perp()._mult(t*a)}function Xs(m,t,a,l,h,_,v,w,S){if(w.projectionCache.offsets[m])return w.projectionCache.offsets[m];const A=a.add(t);if(m+S.direction<l||m+S.direction>=h)return w.projectionCache.offsets[m]=A,A;const z=hr(m+S.direction,w,S),R=bl(z.sub(a),v,S.direction),I=a.add(R),F=z.add(R);return w.projectionCache.offsets[m]=f.aJ(_,A,I,F)||A,w.projectionCache.offsets[m]}function Ia(m,t,a,l,h,_,v,w,S){const A=l?m-t:m+t;let z=A>0?1:-1,R=0;l&&(z*=-1,R=Math.PI),z<0&&(R+=Math.PI);let I,F=z>0?_+h:_+h+1;w.projectionCache.cachedAnchorPoint?I=w.projectionCache.cachedAnchorPoint:(I=ei(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=I);let U,X,Q=I,Y=I,W=0,ie=0;const K=Math.abs(A),re=[];let se;for(;W+ie<=K;){if(F+=z,F<_||F>=v)return null;W+=ie,Y=Q,X=U;const Me={absOffsetX:K,direction:z,distanceFromAnchor:W,previousVertex:Y};if(Q=hr(F,w,Me),a===0)re.push(Y),se=Q.sub(Y);else{let xe;const Ee=Q.sub(Y);xe=Ee.mag()===0?bl(hr(F+z,w,Me).sub(Q),a,z):bl(Ee,a,z),X||(X=Y.add(xe)),U=Xs(F,xe,Q,_,v,X,a,w,Me),re.push(X),se=U.sub(X)}ie=se.mag()}const ee=se._mult((K-W)/ie)._add(X||Y),fe=R+Math.atan2(Q.y-Y.y,Q.x-Y.x);return re.push(ee),{point:ee,angle:S?fe:0,path:re}}const lu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ka(m,t){for(let a=0;a<m;a++){const l=t.length;t.resize(l+4),t.float32.set(lu,3*l)}}function ga(m,t,a){const l=t[0],h=t[1];return m[0]=a[0]*l+a[4]*h+a[12],m[1]=a[1]*l+a[5]*h+a[13],m[3]=a[3]*l+a[7]*h+a[15],m}const ai=100;class dh{constructor(t,a=new Nt(t.width+200,t.height+200,25),l=new Nt(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=l,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ai,this.screenBottomBoundary=t.height+ai,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,l,h,_,v,w,S,A,z,R,I){const F=this.projectAndGetPerspectiveRatio(t.anchorPointX+S[0],t.anchorPointY+S[1],_,z,I),U=l*F.perspectiveRatio;let X;if(v||w)X=this._projectCollisionBox(t,U,h,_,v,w,S,F,z,R,I);else{const se=F.x+(R?R.x*U:0),ee=F.y+(R?R.y*U:0);X={allPointsOccluded:!1,box:[se+t.x1*U,ee+t.y1*U,se+t.x2*U,ee+t.y2*U]}}const[Q,Y,W,ie]=X.box,K=v?X.allPointsOccluded:F.isOccluded;let re=K;return re||(re=F.perspectiveRatio<this.perspectiveRatioCutoff),re||(re=!this.isInsideGrid(Q,Y,W,ie)),re||a!=="always"&&this.grid.hitTest(Q,Y,W,ie,a,A)?{box:[Q,Y,W,ie],placeable:!1,offscreen:!1,occluded:K}:{box:[Q,Y,W,ie],placeable:!0,offscreen:this.isOffscreen(Q,Y,W,ie),occluded:K}}placeCollisionCircles(t,a,l,h,_,v,w,S,A,z,R,I,F,U){const X=[],Q=new f.P(a.anchorX,a.anchorY),Y=this.getPerspectiveRatio(Q.x,Q.y,v,U),W=(A?_*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,v)/Y:_*Y)/f.aN,ie={getElevation:U,pitchedLabelPlaneMatrix:w,lineVertexArray:l,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Q,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:F},K=Qa(W,h,a.lineOffsetX*W,a.lineOffsetY*W,!1,a,!1,ie);let re=!1,se=!1,ee=!0;if(K){const fe=.5*R*Y+I,Me=new f.P(-100,-100),xe=new f.P(this.screenRightBoundary,this.screenBottomBoundary),Ee=new et,Ce=K.first,He=K.last;let Je=[];for(let Pt=Ce.path.length-1;Pt>=1;Pt--)Je.push(Ce.path[Pt]);for(let Pt=1;Pt<He.path.length;Pt++)Je.push(He.path[Pt]);const qe=2.5*fe;if(A){const Pt=this.projectPathToScreenSpace(Je,ie);Je=Pt.some((li=>li.signedDistanceFromCamera<=0))?[]:Pt.map((li=>li.point))}let ft=[];if(Je.length>0){const Pt=Je[0].clone(),li=Je[0].clone();for(let zi=1;zi<Je.length;zi++)Pt.x=Math.min(Pt.x,Je[zi].x),Pt.y=Math.min(Pt.y,Je[zi].y),li.x=Math.max(li.x,Je[zi].x),li.y=Math.max(li.y,Je[zi].y);ft=Pt.x>=Me.x&&li.x<=xe.x&&Pt.y>=Me.y&&li.y<=xe.y?[Je]:li.x<Me.x||Pt.x>xe.x||li.y<Me.y||Pt.y>xe.y?[]:f.aK([Je],Me.x,Me.y,xe.x,xe.y)}for(const Pt of ft){Ee.reset(Pt,.25*fe);let li=0;li=Ee.length<=.5*fe?1:Math.ceil(Ee.paddedLength/qe)+1;for(let zi=0;zi<li;zi++){const fi=zi/Math.max(li-1,1),Bi=Ee.lerp(fi),yi=Bi.x+ai,Mn=Bi.y+ai;X.push(yi,Mn,fe,0);const Li=yi-fe,En=Mn-fe,Qi=yi+fe,sn=Mn+fe;if(ee=ee&&this.isOffscreen(Li,En,Qi,sn),se=se||this.isInsideGrid(Li,En,Qi,sn),t!=="always"&&this.grid.hitTestCircle(yi,Mn,fe,t,z)&&(re=!0,!S))return{circles:[],offscreen:!1,collisionDetected:re}}}}return{circles:!S&&re||!se||Y<this.perspectiveRatioCutoff?[]:X,offscreen:ee,collisionDetected:re}}projectPathToScreenSpace(t,a){const l=(function(h,_){const v=f.N();return f.aC(v,_.pitchedLabelPlaneMatrix),h.map((w=>{const S=Rt(w.x,w.y,v,_.getElevation),A=_.transform.projectTileCoordinates(S.point.x,S.point.y,_.unwrappedTileID,_.getElevation);return A.point.x=(.5*A.point.x+.5)*_.width,A.point.y=(.5*-A.point.y+.5)*_.height,A}))})(t,a);return(function(h){let _=0,v=0,w=0,S=0;for(let A=0;A<h.length;A++)h[A].isOccluded?(w=A+1,S=0):(S++,S>v&&(v=S,_=w));return h.slice(_,_+v)})(l)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],l=new f.ac;for(const R of t){const I=new f.P(R.x+ai,R.y+ai);l.extend(I),a.push(I)}const{minX:h,minY:_,maxX:v,maxY:w}=l,S=this.grid.query(h,_,v,w).concat(this.ignoredGrid.query(h,_,v,w)),A={},z={};for(const R of S){const I=R.key;if(A[I.bucketInstanceId]===void 0&&(A[I.bucketInstanceId]={}),A[I.bucketInstanceId][I.featureIndex])continue;const F=[new f.P(R.x1,R.y1),new f.P(R.x2,R.y1),new f.P(R.x2,R.y2),new f.P(R.x1,R.y2)];f.aL(a,F)&&(A[I.bucketInstanceId][I.featureIndex]=!0,z[I.bucketInstanceId]===void 0&&(z[I.bucketInstanceId]=[]),z[I.bucketInstanceId].push(I.featureIndex))}return z}insertCollisionBox(t,a,l,h,_,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:_,collisionGroupID:v,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,l,h,_,v){const w=l?this.ignoredGrid:this.grid,S={bucketInstanceId:h,featureIndex:_,collisionGroupID:v,overlapMode:a};for(let A=0;A<t.length;A+=4)w.insertCircle(S,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,a,l,h,_){if(_){let v;h?(v=[t,a,h(t,a),1],f.aI(v,v,_)):(v=[t,a,0,1],ga(v,v,_));const w=v[3];return{x:(v[0]/w+1)/2*this.transform.width+ai,y:(-v[1]/w+1)/2*this.transform.height+ai,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}{const v=this.transform.projectTileCoordinates(t,a,l,h);return{x:(v.point.x+1)/2*this.transform.width+ai,y:(1-v.point.y)/2*this.transform.height+ai,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}}getPerspectiveRatio(t,a,l,h){const _=this.transform.projectTileCoordinates(t,a,l,h);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(t,a,l,h){return l<ai||t>=this.screenRightBoundary||h<ai||a>this.screenBottomBoundary}isInsideGrid(t,a,l,h){return l>=0&&t<this.gridRightBoundary&&h>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=f.as([]);return f.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,a,l,h,_,v,w,S,A,z,R){let I=1,F=0,U=0,X=1;const Q=t.anchorPointX+w[0],Y=t.anchorPointY+w[1];if(v&&!_){const Je=this.projectAndGetPerspectiveRatio(Q+1,Y,h,A,R),qe=Je.x-S.x,ft=Math.atan((Je.y-S.y)/qe)+(qe<0?Math.PI:0),Pt=Math.sin(ft),li=Math.cos(ft);I=li,F=Pt,U=-Pt,X=li}else if(!v&&_){const Je=Xa(this.transform);I=Je.vecEast[0],F=Je.vecEast[1],U=Je.vecSouth[0],X=Je.vecSouth[1]}let W=S.x,ie=S.y,K=a;_&&(W=Q,ie=Y,K=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),K*=this.transform.getPitchedTextCorrection(Q,Y,h),z||(K*=f.ao(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),z&&(W+=I*z.x*K+U*z.y*K,ie+=F*z.x*K+X*z.y*K);const re=t.x1*K,se=t.x2*K,ee=(re+se)/2,fe=t.y1*K,Me=t.y2*K,xe=(fe+Me)/2,Ee=[{offsetX:re,offsetY:fe},{offsetX:ee,offsetY:fe},{offsetX:se,offsetY:fe},{offsetX:se,offsetY:xe},{offsetX:se,offsetY:Me},{offsetX:ee,offsetY:Me},{offsetX:re,offsetY:Me},{offsetX:re,offsetY:xe}];let Ce=[];for(const{offsetX:Je,offsetY:qe}of Ee)Ce.push(new f.P(W+I*Je+U*qe,ie+F*Je+X*qe));let He=!1;if(_){const Je=Ce.map((qe=>this.projectAndGetPerspectiveRatio(qe.x,qe.y,h,A,R)));He=Je.some((qe=>!qe.isOccluded)),Ce=Je.map((qe=>new f.P(qe.x,qe.y)))}else He=!0;return{box:f.aM(Ce),allPointsOccluded:!He}}}class Tf{constructor(t,a,l,h){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class Co{constructor(t,a,l,h,_){this.text=new Tf(t?t.text:null,a,l,_),this.icon=new Tf(t?t.icon:null,a,h,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ph{constructor(t,a,l){this.text=t,this.icon=a,this.skipFade=l}}class uu{constructor(t,a,l,h,_){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=_}}class Sf{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:l=>l.collisionGroupID===a}}return this.collisionGroups[t]}}function xr(m,t,a,l,h){const{horizontalAlign:_,verticalAlign:v}=f.aT(m);return new f.P(-(_-.5)*t+l[0]*h,-(v-.5)*a+l[1]*h)}class cu{constructor(t,a,l,h,_){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new dh(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Sf(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const a=this.terrain;return a?(l,h)=>a.getElevation(t,l,h):null}getBucketParts(t,a,l,h){const _=l.getBucket(a),v=l.latestFeatureIndex;if(!_||!v||a.id!==_.layerIds[0])return;const w=l.collisionBoxArray,S=_.layers[0].layout,A=_.layers[0].paint,z=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),R=l.tileSize/f.a5,I=l.tileID.toUnwrapped(),F=S.get("text-rotation-alignment")==="map",U=f.aO(l,1,this.transform.zoom),X=f.aP(this.collisionIndex.transform,l,A.get("text-translate"),A.get("text-translate-anchor")),Q=f.aP(this.collisionIndex.transform,l,A.get("icon-translate"),A.get("icon-translate-anchor")),Y=Kr(F,this.transform,U);this.retainedQueryData[_.bucketInstanceId]=new uu(_.bucketInstanceId,v,_.sourceLayerIndex,_.index,l.tileID);const W={bucket:_,layout:S,translationText:X,translationIcon:Q,unwrappedTileID:I,pitchedLabelPlaneMatrix:Y,scale:z,textPixelRatio:R,holdingForFade:l.holdingForSymbolFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:f.az(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(h)for(const ie of _.sortKeyRanges){const{sortKey:K,symbolInstanceStart:re,symbolInstanceEnd:se}=ie;t.push({sortKey:K,symbolInstanceStart:re,symbolInstanceEnd:se,parameters:W})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:W})}attemptAnchorPlacement(t,a,l,h,_,v,w,S,A,z,R,I,F,U,X,Q,Y,W,ie,K){const re=f.aQ[t.textAnchor],se=[t.textOffset0,t.textOffset1],ee=xr(re,l,h,se,_),fe=this.collisionIndex.placeCollisionBox(a,I,S,A,z,w,v,Q,R.predicate,ie,ee,K);if((!W||this.collisionIndex.placeCollisionBox(W,I,S,A,z,w,v,Y,R.predicate,ie,ee,K).placeable)&&fe.placeable){let Me;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(Me=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:se,width:l,height:h,anchor:re,textBoxScale:_,prevAnchor:Me},this.markUsedJustification(U,re,F,X),U.allowVerticalPlacement&&(this.markUsedOrientation(U,X,F),this.placedOrientations[F.crossTileID]=X),{shift:ee,placedGlyphBoxes:fe}}}placeLayerBucketPart(t,a,l){const{bucket:h,layout:_,translationText:v,translationIcon:w,unwrappedTileID:S,pitchedLabelPlaneMatrix:A,textPixelRatio:z,holdingForFade:R,collisionBoxArray:I,partiallyEvaluatedTextSize:F,collisionGroup:U}=t.parameters,X=_.get("text-optional"),Q=_.get("icon-optional"),Y=f.aR(_,"text-overlap","text-allow-overlap"),W=Y==="always",ie=f.aR(_,"icon-overlap","icon-allow-overlap"),K=ie==="always",re=_.get("text-rotation-alignment")==="map",se=_.get("text-pitch-alignment")==="map",ee=_.get("icon-text-fit")!=="none",fe=_.get("symbol-z-order")==="viewport-y",Me=W&&(K||!h.hasIconData()||Q),xe=K&&(W||!h.hasTextData()||X);!h.collisionArrays&&I&&h.deserializeCollisionBoxes(I);const Ee=this.retainedQueryData[h.bucketInstanceId].tileID,Ce=this._getTerrainElevationFunc(Ee),He=this.transform.getFastPathSimpleProjectionMatrix(Ee),Je=(qe,ft,Pt)=>{var li,zi;if(a[qe.crossTileID])return;if(R)return void(this.placements[qe.crossTileID]=new ph(!1,!1,!1));let fi=!1,Bi=!1,yi=!0,Mn=null,Li={box:null,placeable:!1,offscreen:null,occluded:!1},En={placeable:!1},Qi=null,sn=null,Xn=null,ar=0,Na=0,ks=0;ft.textFeatureIndex?ar=ft.textFeatureIndex:qe.useRuntimeCollisionCircles&&(ar=qe.featureIndex),ft.verticalTextFeatureIndex&&(Na=ft.verticalTextFeatureIndex);const Qo=ft.textBox;if(Qo){const An=Wi=>{let Cn=f.aA.horizontal;if(h.allowVerticalPlacement&&!Wi&&this.prevPlacement){const Pr=this.prevPlacement.placedOrientations[qe.crossTileID];Pr&&(this.placedOrientations[qe.crossTileID]=Pr,Cn=Pr,this.markUsedOrientation(h,Cn,qe))}return Cn},Vn=(Wi,Cn)=>{if(h.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&ft.verticalTextBox){for(const Pr of h.writingModes)if(Pr===f.aA.vertical?(Li=Cn(),En=Li):Li=Wi(),Li&&Li.placeable)break}else Li=Wi()},Yn=qe.textAnchorOffsetStartIndex,ua=qe.textAnchorOffsetEndIndex;if(ua===Yn){const Wi=(Cn,Pr)=>{const ji=this.collisionIndex.placeCollisionBox(Cn,Y,z,Ee,S,se,re,v,U.predicate,Ce,void 0,He);return ji&&ji.placeable&&(this.markUsedOrientation(h,Pr,qe),this.placedOrientations[qe.crossTileID]=Pr),ji};Vn((()=>Wi(Qo,f.aA.horizontal)),(()=>{const Cn=ft.verticalTextBox;return h.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&Cn?Wi(Cn,f.aA.vertical):{box:null,offscreen:null}})),An(Li&&Li.placeable)}else{let Wi=f.aQ[(zi=(li=this.prevPlacement)===null||li===void 0?void 0:li.variableOffsets[qe.crossTileID])===null||zi===void 0?void 0:zi.anchor];const Cn=(ji,Lh,Bc)=>{const kc=ji.x2-ji.x1,Oh=ji.y2-ji.y1,ca=qe.textBoxScale,xo=ee&&ie==="never"?Lh:null;let Fs=null,Bh=Y==="never"?1:2,Ko="never";Wi&&Bh++;for(let Fc=0;Fc<Bh;Fc++){for(let bo=Yn;bo<ua;bo++){const Nc=h.textAnchorOffsets.get(bo);if(Wi&&Nc.textAnchor!==Wi)continue;const Vc=this.attemptAnchorPlacement(Nc,ji,kc,Oh,ca,re,se,z,Ee,S,U,Ko,qe,h,Bc,v,w,xo,Ce);if(Vc&&(Fs=Vc.placedGlyphBoxes,Fs&&Fs.placeable))return fi=!0,Mn=Vc.shift,Fs}Wi?Wi=null:Ko=Y}return l&&!Fs&&(Fs={box:this.collisionIndex.placeCollisionBox(Qo,"always",z,Ee,S,se,re,v,U.predicate,Ce,void 0,He).box,offscreen:!1,placeable:!1,occluded:!1}),Fs};Vn((()=>Cn(Qo,ft.iconBox,f.aA.horizontal)),(()=>{const ji=ft.verticalTextBox;return h.allowVerticalPlacement&&(!Li||!Li.placeable)&&qe.numVerticalGlyphVertices>0&&ji?Cn(ji,ft.verticalIconBox,f.aA.vertical):{box:null,occluded:!0,offscreen:null}})),Li&&(fi=Li.placeable,yi=Li.offscreen);const Pr=An(Li&&Li.placeable);if(!fi&&this.prevPlacement){const ji=this.prevPlacement.variableOffsets[qe.crossTileID];ji&&(this.variableOffsets[qe.crossTileID]=ji,this.markUsedJustification(h,ji.anchor,qe,Pr))}}}if(Qi=Li,fi=Qi&&Qi.placeable,yi=Qi&&Qi.offscreen,qe.useRuntimeCollisionCircles&&qe.centerJustifiedTextSymbolIndex>=0){const An=h.text.placedSymbolArray.get(qe.centerJustifiedTextSymbolIndex),Vn=f.aB(h.textSizeData,F,An),Yn=_.get("text-padding");sn=this.collisionIndex.placeCollisionCircles(Y,An,h.lineVertexArray,h.glyphOffsetArray,Vn,S,A,l,se,U.predicate,qe.collisionCircleDiameter,Yn,v,Ce),sn.circles.length&&sn.collisionDetected&&!l&&f.w("Collisions detected, but collision boxes are not shown"),fi=W||sn.circles.length>0&&!sn.collisionDetected,yi=yi&&sn.offscreen}if(ft.iconFeatureIndex&&(ks=ft.iconFeatureIndex),ft.iconBox){const An=Vn=>this.collisionIndex.placeCollisionBox(Vn,ie,z,Ee,S,se,re,w,U.predicate,Ce,ee&&Mn?Mn:void 0,He);En&&En.placeable&&ft.verticalIconBox?(Xn=An(ft.verticalIconBox),Bi=Xn.placeable):(Xn=An(ft.iconBox),Bi=Xn.placeable),yi=yi&&Xn.offscreen}const Oc=X||qe.numHorizontalGlyphVertices===0&&qe.numVerticalGlyphVertices===0,Wo=Q||qe.numIconVertices===0;Oc||Wo?Wo?Oc||(Bi=Bi&&fi):fi=Bi&&fi:Bi=fi=Bi&&fi;const Ur=Bi&&Xn.placeable;if(fi&&Qi.placeable&&this.collisionIndex.insertCollisionBox(Qi.box,Y,_.get("text-ignore-placement"),h.bucketInstanceId,En&&En.placeable&&Na?Na:ar,U.ID),Ur&&this.collisionIndex.insertCollisionBox(Xn.box,ie,_.get("icon-ignore-placement"),h.bucketInstanceId,ks,U.ID),sn&&fi&&this.collisionIndex.insertCollisionCircles(sn.circles,Y,_.get("text-ignore-placement"),h.bucketInstanceId,ar,U.ID),l&&this.storeCollisionData(h.bucketInstanceId,Pt,ft,Qi,Xn,sn),qe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[qe.crossTileID]=new ph((fi||Me)&&!Qi?.occluded,(Bi||xe)&&!Xn?.occluded,yi||h.justReloaded),a[qe.crossTileID]=!0};if(fe){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const qe=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let ft=qe.length-1;ft>=0;--ft){const Pt=qe[ft];Je(h.symbolInstances.get(Pt),h.collisionArrays[Pt],Pt)}}else for(let qe=t.symbolInstanceStart;qe<t.symbolInstanceEnd;qe++)Je(h.symbolInstances.get(qe),h.collisionArrays[qe],qe);h.justReloaded=!1}storeCollisionData(t,a,l,h,_,v){if(l.textBox||l.iconBox){let w,S;this.collisionBoxArrays.has(t)?w=this.collisionBoxArrays.get(t):(w=new Map,this.collisionBoxArrays.set(t,w)),w.has(a)?S=w.get(a):(S={text:null,icon:null},w.set(a,S)),l.textBox&&(S.text=h.box),l.iconBox&&(S.icon=_.box)}if(v){let w=this.collisionCircleArrays[t];w===void 0&&(w=this.collisionCircleArrays[t]=[]);for(let S=0;S<v.circles.length;S+=4)w.push(v.circles[S+0]-ai),w.push(v.circles[S+1]-ai),w.push(v.circles[S+2]),w.push(v.collisionDetected?1:0)}}markUsedJustification(t,a,l,h){let _;_=h===f.aA.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[f.aS(a)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of v)w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=_>=0&&w!==_?0:l.crossTileID)}markUsedOrientation(t,a,l){const h=a===f.aA.horizontal||a===f.aA.horizontalOnly?a:0,_=a===f.aA.vertical?a:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of v)t.text.placedSymbolArray.get(w).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let l=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const h=a?a.symbolFadeChange(t):1,_=a?a.opacities:{},v=a?a.variableOffsets:{},w=a?a.placedOrientations:{};for(const S in this.placements){const A=this.placements[S],z=_[S];z?(this.opacities[S]=new Co(z,h,A.text,A.icon),l=l||A.text!==z.text.placed||A.icon!==z.icon.placed):(this.opacities[S]=new Co(null,h,A.text,A.icon,A.skipFade),l=l||A.text||A.icon)}for(const S in _){const A=_[S];if(!this.opacities[S]){const z=new Co(A,h,!1,!1);z.isHidden()||(this.opacities[S]=z,l=l||A.text.placed||A.icon.placed)}}for(const S in v)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=v[S]);for(const S in w)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=w[S]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const l={};for(const h of a){const _=h.getBucket(t);_&&h.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,h.tileID,l,h.collisionBoxArray)}}updateBucketOpacities(t,a,l,h){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0],v=_.layout,w=new Co(null,0,!1,!1,!0),S=v.get("text-allow-overlap"),A=v.get("icon-allow-overlap"),z=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=v.get("text-rotation-alignment")==="map",I=v.get("text-pitch-alignment")==="map",F=v.get("icon-text-fit")!=="none",U=new Co(null,0,S&&(A||!t.hasIconData()||v.get("icon-optional")),A&&(S||!t.hasTextData()||v.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const X=(Y,W,ie)=>{for(let K=0;K<W/4;K++)Y.opacityVertexArray.emplaceBack(ie);Y.hasVisibleVertices=Y.hasVisibleVertices||ie!==Do},Q=this.collisionBoxArrays.get(t.bucketInstanceId);for(let Y=0;Y<t.symbolInstances.length;Y++){const W=t.symbolInstances.get(Y),{numHorizontalGlyphVertices:ie,numVerticalGlyphVertices:K,crossTileID:re}=W;let se=this.opacities[re];l[re]?se=w:se||(se=U,this.opacities[re]=se),l[re]=!0;const ee=W.numIconVertices>0,fe=this.placedOrientations[W.crossTileID],Me=fe===f.aA.vertical,xe=fe===f.aA.horizontal||fe===f.aA.horizontalOnly;if(ie>0||K>0){const Ce=cc(se.text);X(t.text,ie,Me?Do:Ce),X(t.text,K,xe?Do:Ce);const He=se.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach((ft=>{ft>=0&&(t.text.placedSymbolArray.get(ft).hidden=He||Me?1:0)})),W.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=He||xe?1:0);const Je=this.variableOffsets[W.crossTileID];Je&&this.markUsedJustification(t,Je.anchor,W,fe);const qe=this.placedOrientations[W.crossTileID];qe&&(this.markUsedJustification(t,"left",W,qe),this.markUsedOrientation(t,qe,W))}if(ee){const Ce=cc(se.icon),He=!(F&&W.verticalPlacedIconSymbolIndex&&Me);W.placedIconSymbolIndex>=0&&(X(t.icon,W.numIconVertices,He?Ce:Do),t.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=se.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(X(t.icon,W.numVerticalIconVertices,He?Do:Ce),t.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=se.icon.isHidden())}const Ee=Q&&Q.has(Y)?Q.get(Y):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ce=t.collisionArrays[Y];if(Ce){let He=new f.P(0,0);if(Ce.textBox||Ce.verticalTextBox){let Je=!0;if(z){const qe=this.variableOffsets[re];qe?(He=xr(qe.anchor,qe.width,qe.height,qe.textOffset,qe.textBoxScale),R&&He._rotate(I?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Je=!1}if(Ce.textBox||Ce.verticalTextBox){let qe;Ce.textBox&&(qe=Me),Ce.verticalTextBox&&(qe=xe),uc(t.textCollisionBox.collisionVertexArray,se.text.placed,!Je||qe,Ee.text,He.x,He.y)}}if(Ce.iconBox||Ce.verticalIconBox){const Je=!!(!xe&&Ce.verticalIconBox);let qe;Ce.iconBox&&(qe=Je),Ce.verticalIconBox&&(qe=!Je),uc(t.iconCollisionBox.collisionVertexArray,se.icon.placed,qe,Ee.icon,F?He.x:0,F?He.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const l=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function uc(m,t,a,l,h,_){l&&l.length!==0||(l=[0,0,0,0]);const v=l[0]-ai,w=l[1]-ai,S=l[2]-ai,A=l[3]-ai;m.emplaceBack(t?1:0,a?1:0,h||0,_||0,v,w),m.emplaceBack(t?1:0,a?1:0,h||0,_||0,S,w),m.emplaceBack(t?1:0,a?1:0,h||0,_||0,S,A),m.emplaceBack(t?1:0,a?1:0,h||0,_||0,v,A)}const hu=Math.pow(2,25),Ys=Math.pow(2,24),Mf=Math.pow(2,17),wl=Math.pow(2,16),bs=Math.pow(2,9),Ef=Math.pow(2,8),zo=Math.pow(2,1);function cc(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const t=m.placed?1:0,a=Math.floor(127*m.opacity);return a*hu+t*Ys+a*Mf+t*wl+a*bs+t*Ef+a*zo+t}const Do=0;class Qs{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,l,h,_){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(v,h,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort(((w,S)=>w.sortKey-S.sortKey)));this._currentPartIndex<v.length;)if(a.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,_())return!0;return!1}}class Tl{constructor(t,a,l,h,_,v,w,S){this.placement=new cu(t,a,v,w,S),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,a,l){const h=Et(),_=()=>!this._forceFullPlacement&&Et()-h>2;for(;this._currentPlacementIndex>=0;){const v=a[t[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=w)&&(!v.maxzoom||v.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new Qs(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ft=512/f.a5/2;class Ra{constructor(t,a,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let _=0;_<a.length;_++){const v=a.get(_),w=v.key,S=h.get(w);S?S.push(v):h.set(w,[v])}for(const[_,v]of h){const w={positions:v.map((S=>({x:Math.floor(S.anchorX*Ft),y:Math.floor(S.anchorY*Ft)}))),crossTileIDs:v.map((S=>S.crossTileID))};if(w.positions.length>128){const S=new f.aU(w.positions.length,16,Uint16Array);for(const{x:A,y:z}of w.positions)S.add(A,z);S.finish(),delete w.positions,w.index=S}this._symbolsByKey[_]=w}}getScaledCoordinates(t,a){const{x:l,y:h,z:_}=this.tileID.canonical,{x:v,y:w,z:S}=a.canonical,A=Ft/Math.pow(2,S-_),z=(w*f.a5+t.anchorY)*A,R=h*f.a5*Ft;return{x:Math.floor((v*f.a5+t.anchorX)*A-l*f.a5*Ft),y:Math.floor(z-R)}}findMatches(t,a,l){const h=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let _=0;_<t.length;_++){const v=t.get(_);if(v.crossTileID)continue;const w=this._symbolsByKey[v.key];if(!w)continue;const S=this.getScaledCoordinates(v,a);if(w.index){const A=w.index.range(S.x-h,S.y-h,S.x+h,S.y+h).sort();for(const z of A){const R=w.crossTileIDs[z];if(!l[R]){l[R]=!0,v.crossTileID=R;break}}}else if(w.positions)for(let A=0;A<w.positions.length;A++){const z=w.positions[A],R=w.crossTileIDs[A];if(Math.abs(z.x-S.x)<=h&&Math.abs(z.y-S.y)<=h&&!l[R]){l[R]=!0,v.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class mh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class fu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const l in this.indexes){const h=this.indexes[l],_={};for(const v in h){const w=h[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+a),_[w.tileID.key]=w}this.indexes[l]=_}this.lng=t}addBucket(t,a,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<a.symbolInstances.length;_++)a.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const h=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const v=this.indexes[_];if(Number(_)>t.overscaledZ)for(const w in v){const S=v[w];S.tileID.isChildOf(t)&&S.findMatches(a.symbolInstances,t,h)}else{const w=v[t.scaledTo(Number(_)).key];w&&w.findMatches(a.symbolInstances,t,h)}}for(let _=0;_<a.symbolInstances.length;_++){const v=a.symbolInstances.get(_);v.crossTileID||(v.crossTileID=l.generate(),h[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ra(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const l of a.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[t][h]}removeStaleBuckets(t){let a=!1;for(const l in this.indexes){const h=this.indexes[l];for(const _ in h)t[h[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[_]),delete h[_],a=!0)}return a}}class Fn{constructor(){this.layerIndexes={},this.crossTileIDs=new mh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,l){let h=this.layerIndexes[t.id];h===void 0&&(h=this.layerIndexes[t.id]=new fu);let _=!1;const v={};h.handleWrapJump(l);for(const w of a){const S=w.getBucket(t);S&&t.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(w.tileID,S,this.crossTileIDs)&&(_=!0),v[S.bucketInstanceId]=!0)}return h.removeStaleBuckets(v)&&(_=!0),_}pruneUnusedLayers(t){const a={};t.forEach((l=>{a[l]=!0}));for(const l in this.layerIndexes)a[l]||delete this.layerIndexes[l]}}var vn="void main() {fragColor=vec4(1.0);}";const ki={prelude:At(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:At("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:At("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:At(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:At(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:At(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:At(vn,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:At(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:At(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:At("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:At("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:At(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:At("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:At(vn,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:At(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:At(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:At(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:At(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:At(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:At(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:At(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:At(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:At(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:At(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:At(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:At(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:At(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:At(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:At(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:At(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:At(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:At("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:At("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:At("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:At("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:At(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:At("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function At(m,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/in ([\w]+) ([\w]+)/g),h=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=_?_.concat(h):h,w={};return{fragmentSource:m=m.replace(a,((S,A,z,R,I)=>(w[I]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${I}
in ${z} ${R} ${I};
#else
uniform ${z} ${R} u_${I};
#endif
`:`
#ifdef HAS_UNIFORM_u_${I}
    ${z} ${R} ${I} = u_${I};
#endif
`))),vertexSource:t=t.replace(a,((S,A,z,R,I)=>{const F=R==="float"?"vec2":"vec4",U=I.match(/color/)?"color":F;return w[I]?A==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
in ${z} ${F} a_${I};
out ${z} ${R} ${I};
#else
uniform ${z} ${R} u_${I};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = a_${I};
#else
    ${z} ${R} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = unpack_mix_${U}(a_${I}, u_${I}_t);
#else
    ${z} ${R} ${I} = u_${I};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
in ${z} ${F} a_${I};
#else
uniform ${z} ${R} u_${I};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${z} ${R} ${I} = a_${I};
#else
    ${z} ${R} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${z} ${R} ${I} = unpack_mix_${U}(a_${I}, u_${I}_t);
#else
    ${z} ${R} ${I} = u_${I};
#endif
`})),staticAttributes:l,staticUniforms:v}}class Ei{constructor(t,a,l){this.vertexBuffer=t,this.indexBuffer=a,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var _a=f.aV([{name:"a_pos",type:"Int16",components:2}]);const rn="#define PROJECTION_MERCATOR",br="mercator";class Nn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return br}get shaderDefine(){return rn}get shaderPreludeCode(){return ki.projectionMercator}get vertexShaderPreludeCode(){return ki.projectionMercator.vertexSource}get subdivisionGranularity(){return f.aW.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,a,l,h,_){if(this._cachedMesh)return this._cachedMesh;const v=new f.aX;v.emplaceBack(0,0),v.emplaceBack(f.a5,0),v.emplaceBack(0,f.a5),v.emplaceBack(f.a5,f.a5);const w=t.createVertexBuffer(v,_a.members),S=f.aY.simpleSegment(0,0,4,2),A=new f.aZ;A.emplaceBack(1,0,2),A.emplaceBack(1,2,3);const z=t.createIndexBuffer(A);return this._cachedMesh=new Ei(w,z,S),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class Jr{constructor(t=0,a=0,l=0,h=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=l,this.right=h}interpolate(t,a,l){return a.top!=null&&t.top!=null&&(this.top=f.G.number(t.top,a.top,l)),a.bottom!=null&&t.bottom!=null&&(this.bottom=f.G.number(t.bottom,a.bottom,l)),a.left!=null&&t.left!=null&&(this.left=f.G.number(t.left,a.left,l)),a.right!=null&&t.right!=null&&(this.right=f.G.number(t.right,a.right,l)),this}getCenter(t,a){const l=f.ao((this.left+t-this.right)/2,0,t),h=f.ao((this.top+a-this.bottom)/2,0,a);return new f.P(l,h)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Jr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ja(m,t){if(!m.renderWorldCopies||m.lngRange)return;const a=t.lng-m.center.lng;t.lng+=a>180?-360:a<-180?360:0}function Fi(m){return Math.max(0,Math.floor(m))}class Ws{constructor(t,a){var l;this.applyConstrain=(h,_)=>this._constrainOverride!==null?this._constrainOverride(h,_):this._callbacks.defaultConstrain(h,_),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(l=a?.constrainOverride)!==null&&l!==void 0?l:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new f.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Fi(this._zoom),this._scale=f.ar(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Jr,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,a,l){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Fi(this._zoom),this._scale=f.ar(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Jr(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!l&&t.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const a=f.W(t,-180,180)*Math.PI/180;var l,h,_,v,w,S,A,z,R;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=we(),l=this._rotationMatrix,_=-this._bearingInRadians,v=(h=this._rotationMatrix)[0],w=h[1],S=h[2],A=h[3],z=Math.sin(_),R=Math.cos(_),l[0]=v*R+S*z,l[1]=w*R+A*z,l[2]=v*-z+S*R,l[3]=w*-z+A*R)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const a=f.ao(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const a=t/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return f.a_(this._fovInRadians)}setFov(t){t=f.ao(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=f.aq(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const a=this.applyConstrain(this._center,t).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=f.ar(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,a){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,l){this._unmodified=!1,this._edgeInsets.interpolate(t,a,l),this.constrainInternal(),this._calcMatrices()}resize(t,a,l=!0){this._width=t,this._height=a,l&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new tn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-f.ap,f.ap])}getCameraQueryGeometry(t,a){if(a.length===1)return[a[0],t];{const{minX:l,minY:h,maxX:_,maxY:v}=f.ac.fromPoints(a).extend(t);return[new f.P(l,h),new f.P(_,h),new f.P(_,v),new f.P(l,v),new f.P(l,h)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:l}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(l),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=f.as(new Float64Array(16));f.Q(t,t,[this._width/2,-this._height/2,1]),f.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=f.as(new Float64Array(16)),f.Q(t,t,[1,-1,1]),f.O(t,t,[-1,-1,0]),f.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,a,l,h){const _=l!==void 0?l:this.bearing,v=h=h!==void 0?h:this.pitch,{distanceToCenter:w,clampedElevation:S}=this._distanceToCenterFromAltElevationPitch(a,this.elevation,v),{x:A,y:z}=pi(v,_),R=f.ab.fromLngLat(t,a);let I,F,U=f.a$(1,R.y),X=0;do{if(X+=1,X>10)break;F=w/U,I=new f.ab(R.x+A*F,R.y+z*F),U=1/I.meterInMercatorCoordinateUnits()}while(Math.abs(w-F*U)>1e-12);return{center:I.toLngLat(),elevation:S,zoom:f.au(this.height/2/Math.tan(this.fovInRadians/2)/F/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const a=1/this.worldSize,l=f.at(1,this.center.lat)*this.worldSize,h=f.ab.fromLngLat(this.center,this.elevation),_=h.x/a,v=h.y/a,w=h.z/a,S=this.pitch,A=this.bearing,{x:z,y:R,z:I}=pi(S,A),F=this.cameraToCenterDistance,U=_+F*-z,X=v+F*-R,Q=w+F*I,{distanceToCenter:Y,clampedElevation:W}=this._distanceToCenterFromAltElevationPitch(Q/l,t,S),ie=Y*l,K=new f.ab((U+z*ie)*a,(X+R*ie)*a,0).toLngLat(),re=f.at(1,K.lat),se=f.au(this.height/2/Math.tan(this.fovInRadians/2)/Y/re/this.tileSize);this._elevation=W,this._center=K,this.setZoom(se)}_distanceToCenterFromAltElevationPitch(t,a,l){const h=-Math.cos(f.aq(l)),_=t-a;let v,w=a;return h*_>=0||Math.abs(h)<.1?(v=1e4,w=t+v*h):v=-_/h,{distanceToCenter:v,clampedElevation:w}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=f.at(1,this.center.lat)*this.worldSize;return ve(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const a=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/a,t.canonical.y/a,1/a/f.a5,1/a/f.a5]}}class ea{constructor(t,a){this.min=t,this.max=a,this.center=f.b0([],f.b1([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],l=f.b2(this.min),h=f.b2(this.max);for(let _=0;_<a.length;_++)l[_]=a[_]?this.min[_]:this.center[_],h[_]=a[_]?this.center[_]:this.max[_];return h[2]=this.max[2],new ea(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let a=!0;for(let l=0;l<t.planes.length;l++){const h=this.intersectsPlane(t.planes[l]);if(h===0)return 0;h===1&&(a=!1)}return a?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let a=t[3],l=t[3];for(let h=0;h<3;h++)t[h]>0?(a+=t[h]*this.min[h],l+=t[h]*this.max[h]):(l+=t[h]*this.min[h],a+=t[h]*this.max[h]);return a>=0?2:l<0?0:1}}class Po{distanceToTile2d(t,a,l,h){const _=h.distanceX([t,a]),v=h.distanceY([t,a]);return Math.hypot(_,v)}getWrap(t,a,l){return l}getTileBoundingVolume(t,a,l,h){var _,v;let w=0,S=0;if(h?.terrain){const z=new f.a2(t.z,a,t.z,t.x,t.y),R=h.terrain.getMinMaxElevation(z);w=(_=R.minElevation)!==null&&_!==void 0?_:Math.min(0,l),S=(v=R.maxElevation)!==null&&v!==void 0?v:Math.max(0,l)}const A=1<<t.z;return new ea([a+t.x/A,t.y/A,w],[a+(t.x+1)/A,(t.y+1)/A,S])}allowVariableZoom(t,a){const l=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,h=f.ao(78.5-l/2,0,60);return!!a.terrain||t.pitch>h}allowWorldCopies(){return!0}prepareNextFrame(){}}class wr{constructor(t,a,l){this.points=t,this.planes=a,this.aabb=l}static fromInvProjectionMatrix(t,a=1,l=0,h,_){const v=_?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],w=Math.pow(2,l),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((I=>(function(F,U,X,Q){const Y=f.aI([],F,U),W=1/Y[3]/X*Q;return f.b7(Y,Y,[W,W,1/Y[3],W])})(I,t,a,w)));h&&(function(I,F,U,X){const Q=X?4:0,Y=X?0:4;let W=0;const ie=[],K=[];for(let ee=0;ee<4;ee++){const fe=f.b3([],I[ee+Y],I[ee+Q]),Me=f.b8(fe);f.b0(fe,fe,1/Me),ie.push(Me),K.push(fe)}for(let ee=0;ee<4;ee++){const fe=f.b9(I[ee+Q],K[ee],U);W=fe!==null&&fe>=0?Math.max(W,fe):Math.max(W,ie[ee])}const re=(function(ee,fe){const Me=f.b3([],ee[fe[0]],ee[fe[1]]),xe=f.b3([],ee[fe[2]],ee[fe[1]]),Ee=[0,0,0,0];return f.b4(Ee,f.b5([],Me,xe)),Ee[3]=-f.b6(Ee,ee[fe[0]]),Ee})(I,F),se=(function(ee,fe){const Me=f.ba(ee),xe=f.bb([],ee,1/Me),Ee=f.b3([],fe,f.b0([],xe,f.b6(fe,xe))),Ce=f.ba(Ee);if(Ce>0){const He=Math.sqrt(1-xe[3]*xe[3]),Je=f.b0([],xe,-xe[3]),qe=f.b1([],Je,f.b0([],Ee,He/Ce));return f.bc(fe,qe)}return null})(U,re);if(se!==null){const ee=se/f.b6(K[0],re);W=Math.min(W,ee)}for(let ee=0;ee<4;ee++){const fe=Math.min(W,ie[ee]);I[ee+Y]=[I[ee+Q][0]+K[ee][0]*fe,I[ee+Q][1]+K[ee][1]*fe,I[ee+Q][2]+K[ee][2]*fe,1]}})(S,v[0],h,_);const A=v.map((I=>{const F=f.b3([],S[I[0]],S[I[1]]),U=f.b3([],S[I[2]],S[I[1]]),X=f.b4([],f.b5([],F,U)),Q=-f.b6(X,S[I[1]]);return X.concat(Q)})),z=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],R=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const I of S)for(let F=0;F<3;F++)z[F]=Math.min(z[F],I[F]),R[F]=Math.max(R[F],I[F]);return new wr(S,A,new ea(z,R))}}class Sn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,l){return this._helper.interpolatePadding(t,a,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,l=!0){this._helper.resize(t,a,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,a){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,l)=>{l=f.ao(+l,this.minZoom,this.maxZoom);const h={center:new f.V(a.lng,a.lat),zoom:l};let _=this._helper._lngRange;if(!this._helper._renderWorldCopies&&_===null){const K=179.9999999999;_=[-K,K]}const v=this.tileSize*f.ar(h.zoom);let w=0,S=v,A=0,z=v,R=0,I=0;const{x:F,y:U}=this.size;if(this._helper._latRange){const K=this._helper._latRange;w=f.X(K[1])*v,S=f.X(K[0])*v,S-w<U&&(R=U/(S-w))}_&&(A=f.W(f.Y(_[0])*v,0,v),z=f.W(f.Y(_[1])*v,0,v),z<A&&(z+=v),z-A<F&&(I=F/(z-A)));const{x:X,y:Q}=mt(v,a);let Y,W;const ie=Math.max(I||0,R||0);if(ie){const K=new f.P(I?(z+A)/2:X,R?(S+w)/2:Q);return h.center=zt(v,K).wrap(),h.zoom+=f.au(ie),h}if(this._helper._latRange){const K=U/2;Q-K<w&&(W=w+K),Q+K>S&&(W=S-K)}if(_){const K=(A+z)/2;let re=X;this._helper._renderWorldCopies&&(re=f.W(X,K-v/2,K+v/2));const se=F/2;re-se<A&&(Y=A+se),re+se>z&&(Y=z-se)}if(Y!==void 0||W!==void 0){const K=new f.P(Y??X,W??Q);h.center=zt(v,K).wrap()}return h},this.applyConstrain=(a,l)=>this._helper.applyConstrain(a,l),this._helper=new Ws({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,l)=>this.defaultConstrain(a,l)},t),this._coveringTilesDetailsProvider=new Po}clone(){const t=new Sn;return t.apply(this),t}apply(t,a,l){this._helper.apply(t,a,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const a=[new f.bd(0,t)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new f.P(0,0)),h=this.screenPointToMercatorCoordinate(new f.P(this._helper._width,0)),_=this.screenPointToMercatorCoordinate(new f.P(this._helper._width,this._helper._height)),v=this.screenPointToMercatorCoordinate(new f.P(0,this._helper._height)),w=Math.floor(Math.min(l.x,h.x,_.x,v.x)),S=Math.floor(Math.max(l.x,h.x,_.x,v.x)),A=1;for(let z=w-A;z<=S+A;z++)z!==0&&a.push(new f.bd(z,t))}return a}getCameraFrustum(){return wr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const a=this.screenPointToLocation(this.centerPoint,t),l=t?t.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(t,a){const l=f.at(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(a,l),_=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),v=f.ab.fromLngLat(t),w=new f.ab(v.x-(h.x-_.x),v.y-(h.y-_.y));this.setCenter(w?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,a){return a?this.coordinatePoint(f.ab.fromLngLat(t),a.getElevationForLngLat(t),this._pixelMatrix3D):this.coordinatePoint(f.ab.fromLngLat(t))}screenPointToLocation(t,a){var l;return(l=this.screenPointToMercatorCoordinate(t,a))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(t,a){if(a){const l=a.pointCoordinate(t);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,a){const l=a||0,h=[t.x,t.y,0,1],_=[t.x,t.y,1,1];f.aI(h,h,this._pixelMatrixInverse),f.aI(_,_,this._pixelMatrixInverse);const v=h[3],w=_[3],S=h[1]/v,A=_[1]/w,z=h[2]/v,R=_[2]/w,I=z===R?0:(l-z)/(R-z);return new f.ab(f.G.number(h[0]/v,_[0]/w,I)/this.worldSize,f.G.number(S,A,I)/this.worldSize,l)}coordinatePoint(t,a=0,l=this._pixelMatrix){const h=[t.x*this.worldSize,t.y*this.worldSize,a,1];return f.aI(h,h,l),new f.P(h[0]/h[3],h[1]/h[3])}getBounds(){const t=Math.max(0,this._helper._height/2-ci(this));return new tn().extend(this.screenPointToLocation(new f.P(0,t))).extend(this.screenPointToLocation(new f.P(this._helper._width,t))).extend(this.screenPointToLocation(new f.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new f.P(0,this._helper._height)))}isPointOnMapSurface(t,a){return a?a.pointCoordinate(t)!=null:t.y>this.height/2-ci(this)}calculatePosMatrix(t,a=!1,l){var h;const _=(h=t.key)!==null&&h!==void 0?h:f.be(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),v=a?this._alignedPosMatrixCache:this._posMatrixCache;if(v.has(_)){const A=v.get(_);return l?A.f32:A.f64}const w=Jt(t,this.worldSize);f.S(w,a?this._alignedProjMatrix:this._viewProjMatrix,w);const S={f64:w,f32:new Float32Array(w)};return v.set(_,S),l?S.f32:S.f64}calculateFogMatrix(t){const a=t.key,l=this._fogMatrixCacheF32;if(l.has(a))return l.get(a);const h=Jt(t,this.worldSize);return f.S(h,this._fogMatrix,h),l.set(a,new Float32Array(h)),l.get(a)}calculateCenterFromCameraLngLatAlt(t,a,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,l,h)}_calculateNearFarZIfNeeded(t,a,l){if(!this._helper.autoCalculateNearFarZ)return;const h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),_=t-h*this._helper._pixelPerMeter/Math.cos(a),v=h<0?_:t,w=Math.PI/2+this.pitchInRadians,S=f.aq(this.fov)*(Math.abs(Math.cos(f.aq(this.roll)))*this.height+Math.abs(Math.sin(f.aq(this.roll)))*this.width)/this.height*(.5+l.y/this.height),A=Math.sin(S)*v/Math.sin(f.ao(Math.PI-w-S,.01,Math.PI-.01)),z=ci(this),R=Math.atan(z/this._helper.cameraToCenterDistance),I=f.aq(.75),F=R>I?2*R*(.5+l.y/(2*z)):I,U=Math.sin(F)*v/Math.sin(f.ao(Math.PI-w-F,.01,Math.PI-.01)),X=Math.min(A,U);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*X+v),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,a=mt(this.worldSize,this.center),l=a.x,h=a.y;this._helper._pixelPerMeter=f.at(1,this.center.lat)*this.worldSize;const _=f.aq(Math.min(this.pitch,lt)),v=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(_));let w;this._calculateNearFarZIfNeeded(v,_,t),w=new Float64Array(16),f.bf(w,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),f.aC(this._invProjMatrix,w),w[8]=2*-t.x/this._helper._width,w[9]=2*t.y/this._helper._height,this._projectionMatrix=f.bg(w),f.Q(w,w,[1,-1,1]),f.O(w,w,[0,0,-this._helper.cameraToCenterDistance]),f.bh(w,w,-this.rollInRadians),f.bi(w,w,this.pitchInRadians),f.bh(w,w,-this.bearingInRadians),f.O(w,w,[-l,-h,0]),this._mercatorMatrix=f.Q([],w,[this.worldSize,this.worldSize,this.worldSize]),f.Q(w,w,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=f.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,w),f.O(w,w,[0,0,-this.elevation]),this._viewProjMatrix=w,this._invViewProjMatrix=f.aC([],w);const S=[0,0,-1,1];f.aI(S,S,this._invViewProjMatrix),this._cameraPosition=[S[0]/S[3],S[1]/S[3],S[2]/S[3]],this._fogMatrix=new Float64Array(16),f.bf(this._fogMatrix,this.fovInRadians,this.width/this.height,v,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,f.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),f.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),f.bh(this._fogMatrix,this._fogMatrix,-this.rollInRadians),f.bi(this._fogMatrix,this._fogMatrix,this.pitchInRadians),f.bh(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),f.O(this._fogMatrix,this._fogMatrix,[-l,-h,0]),f.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),f.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=f.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,w);const A=this._helper._width%2/2,z=this._helper._height%2/2,R=Math.cos(this.bearingInRadians),I=Math.sin(-this.bearingInRadians),F=l-Math.round(l)+R*A+I*z,U=h-Math.round(h)+R*z+I*A,X=new Float64Array(w);if(f.O(X,X,[F>.5?F-1:F,U>.5?U-1:U,0]),this._alignedProjMatrix=X,w=f.aC(new Float64Array(16),this._pixelMatrix),!w)throw new Error("failed to invert matrix");this._pixelMatrixInverse=w,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new f.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return f.aI(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=f.at(1,this.center.lat)*this.worldSize;return ve(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,a){const l=f.ab.fromLngLat(t),h=[l.x*this.worldSize,l.y*this.worldSize,a,1];return f.aI(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(t){const{overscaledTileID:a,aligned:l,applyTerrainMatrix:h}=t,_=this._helper.getMercatorTileCoordinates(a),v=a?this.calculatePosMatrix(a,l,!0):null;let w;return w=a&&a.terrainRttPosMatrix32f&&h?a.terrainRttPosMatrix32f:v||f.bj(),{mainMatrix:w,tileMercatorCoords:_,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:w}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,a,l){return 1}transformLightDirection(t){return f.b2(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,a,l,h){const _=this.calculatePosMatrix(l);let v;h?(v=[t,a,h(t,a),1],f.aI(v,v,_)):(v=[t,a,0,1],ga(v,v,_));const w=v[3];return{point:new f.P(v[0]/w,v[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}populateCache(t){for(const a of t)this.calculatePosMatrix(a)}getMatrixForModel(t,a){const l=f.ab.fromLngLat(t,a),h=l.meterInMercatorCoordinateUnits(),_=f.bk();return f.O(_,_,[l.x,l.y,l.z]),f.bh(_,_,Math.PI),f.bi(_,_,Math.PI/2),f.Q(_,_,[-h,h,h]),_}getProjectionDataForCustomLayer(t=!0){const a=new f.a2(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:t}),h=Jt(a,this.worldSize);f.S(h,this._viewProjMatrix,h),l.tileMercatorCoords=[0,0,1,1];const _=[f.a5,f.a5,this.worldSize/this._helper.pixelsPerMeter],v=f.bl();return f.Q(v,h,_),l.fallbackMatrix=v,l.mainMatrix=v,l}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Tr(){f.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function du(m){if(m.useSlerp)if(m.k<1){const t=f.bm(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),a=f.bm(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),l=new Float64Array(4);f.bn(l,t,a,m.k);const h=f.bo(l);m.tr.setRoll(h.roll),m.tr.setPitch(h.pitch),m.tr.setBearing(h.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(f.G.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(f.G.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(f.G.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function Io(m,t,a,l,h){const _=h.padding,v=mt(h.worldSize,a.getNorthWest()),w=mt(h.worldSize,a.getNorthEast()),S=mt(h.worldSize,a.getSouthEast()),A=mt(h.worldSize,a.getSouthWest()),z=f.aq(-l),R=v.rotate(z),I=w.rotate(z),F=S.rotate(z),U=A.rotate(z),X=new f.P(Math.max(R.x,I.x,U.x,F.x),Math.max(R.y,I.y,U.y,F.y)),Q=new f.P(Math.min(R.x,I.x,U.x,F.x),Math.min(R.y,I.y,U.y,F.y)),Y=X.sub(Q),W=(h.width-(_.left+_.right+t.left+t.right))/Y.x,ie=(h.height-(_.top+_.bottom+t.top+t.bottom))/Y.y;if(ie<0||W<0)return void Tr();const K=Math.min(f.au(h.scale*Math.min(W,ie)),m.maxZoom),re=f.P.convert(m.offset),se=new f.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(f.aq(l)),ee=re.add(se).mult(h.scale/f.ar(K));return{center:zt(h.worldSize,v.add(S).div(2).sub(ee)),zoom:K,bearing:l}}class Ro{get useGlobeControls(){return!1}handlePanInertia(t,a){const l=t.mag(),h=Math.abs(ci(a));return{easingOffset:t.mult(Math.min(.75*h/l,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(t,a){t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta),t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta)}handleMapControlsPan(t,a,l){t.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(l,t.around)}cameraForBoxAndBearing(t,a,l,h,_){return Io(t,a,l,h,_)}handleJumpToCenterZoom(t,a){t.zoom!==(a.zoom!==void 0?+a.zoom:t.zoom)&&t.setZoom(+a.zoom),a.center!==void 0&&t.setCenter(f.V.convert(a.center))}handleEaseTo(t,a){const l=t.zoom,h=t.padding,_={roll:t.roll,pitch:t.pitch,bearing:t.bearing},v={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},w=a.zoom!==void 0,S=!t.isPaddingEqual(a.padding);let A=!1;const z=w?+a.zoom:t.zoom;let R=t.centerPoint.add(a.offsetAsPoint);const I=t.screenPointToLocation(R),{center:F,zoom:U}=t.applyConstrain(f.V.convert(a.center||I),z??l);Ja(t,F);const X=mt(t.worldSize,I),Q=mt(t.worldSize,F).sub(X),Y=f.ar(U-l);return A=U!==l,{easeFunc:W=>{if(A&&t.setZoom(f.G.number(l,U,W)),f.bp(_,v)||du({startEulerAngles:_,endEulerAngles:v,tr:t,k:W,useSlerp:_.roll!=v.roll}),S&&(t.interpolatePadding(h,a.padding,W),R=t.centerPoint.add(a.offsetAsPoint)),a.around)t.setLocationAtPoint(a.around,a.aroundPoint);else{const ie=f.ar(t.zoom-l),K=U>l?Math.min(2,Y):Math.max(.5,Y),re=Math.pow(K,1-W),se=zt(t.worldSize,X.add(Q.mult(W*re)).mult(ie));t.setLocationAtPoint(t.renderWorldCopies?se.wrap():se,R)}},isZooming:A,elevationCenter:F}}handleFlyTo(t,a){const l=a.zoom!==void 0,h=t.zoom,_=t.applyConstrain(f.V.convert(a.center||a.locationAtOffset),l?+a.zoom:h),v=_.center,w=_.zoom;Ja(t,v);const S=mt(t.worldSize,a.locationAtOffset),A=mt(t.worldSize,v).sub(S),z=A.mag(),R=f.ar(w-h);let I;if(a.minZoom!==void 0){const F=Math.min(+a.minZoom,h,w),U=t.applyConstrain(v,F).zoom;I=f.ar(U-h)}return{easeFunc:(F,U,X,Q)=>{t.setZoom(F===1?w:h+f.au(U));const Y=F===1?v:zt(t.worldSize,S.add(A.mult(X)).mult(U));t.setLocationAtPoint(t.renderWorldCopies?Y.wrap():Y,Q)},scaleOfZoom:R,targetCenter:v,scaleOfMinZoom:I,pixelPathLength:z}}}class _i{constructor(t,a,l){this.blendFunction=t,this.blendColor=a,this.mask=l}}_i.Replace=[1,0],_i.disabled=new _i(_i.Replace,f.bq.transparent,[!1,!1,!1,!1]),_i.unblended=new _i(_i.Replace,f.bq.transparent,[!0,!0,!0,!0]),_i.alphaBlended=new _i([1,771],f.bq.transparent,[!0,!0,!0,!0]);const Ks=2305;class jt{constructor(t,a,l){this.enable=t,this.mode=a,this.frontFace=l}}jt.disabled=new jt(!1,1029,Ks),jt.backCCW=new jt(!0,1029,Ks),jt.frontCCW=new jt(!0,1028,Ks);class Bt{constructor(t,a,l){this.func=t,this.mask=a,this.range=l}}Bt.ReadOnly=!1,Bt.ReadWrite=!0,Bt.disabled=new Bt(519,Bt.ReadOnly,[0,1]);const Lo=7680;class ti{constructor(t,a,l,h,_,v){this.test=t,this.ref=a,this.mask=l,this.fail=h,this.depthFail=_,this.pass=v}}ti.disabled=new ti({func:519,mask:0},0,0,Lo,Lo,Lo);const pu=new WeakMap;function ya(m){var t;if(pu.has(m))return pu.get(m);{const a=(t=m.getParameter(m.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return pu.set(m,a),a}}class Js{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const a=t.context,l=a.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const h=new f.aX;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);const _=new f.aZ;_.emplaceBack(0,1,2),this._fullscreenTriangle=new Ei(a.createVertexBuffer(h,_a.members),a.createIndexBuffer(_),f.aY.simpleSegment(0,0,h.length,_.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(l.TEXTURE1);const v=l.createTexture();l.bindTexture(l.TEXTURE_2D,v),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(v),ya(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,a){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,a=t.gl;t.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,a){const l=this._cachedRenderContext.context,h=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:f.bq.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,h.TRIANGLES,Bt.disabled,ti.disabled,_i.unblended,jt.disabled,((_,v)=>({u_input:_,u_output_expected:v}))(t,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ya(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);const _=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:_}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ya(t)){const a=t.clientWaitSync(this._readbackQueue.sync,0,0);if(a===t.WAIT_FAILED)return f.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Js._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let a=0;return a+=t[0]/256,a+=t[1]/65536,a+=t[2]/16777216,t[3]<127&&(a=-a),a/128}}const eo=f.a5/128;function Af(m,t){const a=m.granularity!==void 0?Math.max(m.granularity,1):1,l=a+(m.generateBorders?2:0),h=a+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),_=l+1,v=h+1,w=m.generateBorders?-1:0,S=m.generateBorders||m.extendToNorthPole?-1:0,A=a+(m.generateBorders?1:0),z=a+(m.generateBorders||m.extendToSouthPole?1:0),R=_*v,I=l*h*6,F=_*v>65536;if(F&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const U=F||t==="32bit",X=new Int16Array(2*R);let Q=0;for(let ie=S;ie<=z;ie++)for(let K=w;K<=A;K++){let re=K/a*f.a5;K===-1&&(re=-eo),K===a+1&&(re=f.a5+eo);let se=ie/a*f.a5;ie===-1&&(se=m.extendToNorthPole?f.bs:-eo),ie===a+1&&(se=m.extendToSouthPole?f.bt:f.a5+eo),X[Q++]=re,X[Q++]=se}const Y=U?new Uint32Array(I):new Uint16Array(I);let W=0;for(let ie=0;ie<h;ie++)for(let K=0;K<l;K++){const re=K+1+ie*_,se=K+(ie+1)*_,ee=K+1+(ie+1)*_;Y[W++]=K+ie*_,Y[W++]=se,Y[W++]=re,Y[W++]=re,Y[W++]=se,Y[W++]=ee}return{vertices:X.buffer.slice(0),indices:Y.buffer.slice(0),uses32bitIndices:U}}const mu=new f.aW({fill:new f.bu(128,2),line:new f.bu(512,0),tile:new f.bu(128,32),stencil:new f.bu(128,1),circle:3});class gh{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return ki.projectionGlobe}get vertexShaderPreludeCode(){return ki.projectionMercator.vertexSource}get subdivisionGranularity(){return mu}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new Js(t));const a=f.X(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(a,l),_=Et();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=_);const v=Math.min(Math.max((_-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=f.bv(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,f.bw(v))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,a,l,h,_){const v=(_==="stencil"?mu.stencil:mu.tile).getGranularityForZoomLevel(a.z);return this._getMesh(t,{granularity:v,generateBorders:l,extendToNorthPole:a.y===0&&h,extendToSouthPole:a.y===(1<<a.z)-1&&h})}_getMesh(t,a){const l=this._getMeshKey(a);if(l in this._tileMeshCache)return this._tileMeshCache[l];const h=(function(_,v){const w=Af(v,"16bit"),S=f.aX.deserialize({arrayBuffer:w.vertices,length:w.vertices.byteLength/2/2}),A=f.aZ.deserialize({arrayBuffer:w.indices,length:w.indices.byteLength/2/3});return new Ei(_.createVertexBuffer(S,_a.members),_.createIndexBuffer(A),f.aY.simpleSegment(0,0,S.length,A.length))})(t,a);return this._tileMeshCache[l]=h,h}recalculate(t){}hasTransition(){const t=Et();let a=!1;return a=a||(t-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Od=new f.t({type:new f.D(f.u.projection.type)});class _h extends f.E{constructor(t){super(),this._transitionable=new f.x(Od,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new f.H(0)),this._mercatorProjection=new Nn,this._verticalPerspectiveProjection=new gh}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof f.bx){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,a,l,h,_){return this.currentProjection.getMeshFromTileID(t,a,l,h,_)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Sr(m){const t=Oo(m.worldSize,m.center.lat);return 2*Math.PI*t}function es(m,t,a,l,h){const _=1/(1<<h),v=t/f.a5*_+l*_,w=f.bz((m/f.a5*_+a*_)*Math.PI*2+Math.PI,2*Math.PI),S=2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI,A=Math.cos(S),z=new Float64Array(3);return z[0]=Math.sin(w)*A,z[1]=Math.sin(S),z[2]=Math.cos(w)*A,z}function Ni(m){return(function(t,a){const l=Math.cos(a),h=new Float64Array(3);return h[0]=Math.sin(t)*l,h[1]=Math.sin(a),h[2]=Math.cos(t)*l,h})(m.lng*Math.PI/180,m.lat*Math.PI/180)}function Oo(m,t){return m/(2*Math.PI)/Math.cos(t*Math.PI/180)}function gu(m){const t=Math.asin(m[1])/Math.PI*180,a=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(a>1e-6){const l=m[0]/a,h=Math.acos(m[2]/a),_=(l>0?h:-h)/Math.PI*180;return new f.V(f.W(_,-180,180),t)}return new f.V(0,t)}function _u(m){return Math.cos(m*Math.PI/180)}function an(m,t){const a=_u(m),l=_u(t);return f.au(l/a)}function Cf(m,t){const a=m.rotate(t.bearingInRadians),l=t.zoom+an(t.center.lat,0),h=f.bv(1/_u(t.center.lat),1/_u(Math.min(Math.abs(t.center.lat),60)),f.by(l,7,3,0,1)),_=360/Sr({worldSize:t.worldSize,center:{lat:t.center.lat}});return new f.V(t.center.lng-a.x*_*h,f.ao(t.center.lat+a.y*_,-f.ap,f.ap))}function hc(m){const t=.5*m,a=Math.sin(t),l=Math.cos(t);return Math.log(a+l)-Math.log(l-a)}function zf(m,t,a,l){const h=m.lat+a*l;if(Math.abs(a)>1){const _=(Math.sign(m.lat+a)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,v=Math.abs(m.lat+a)*Math.PI/180,w=hc(_+l*(v-_)),S=hc(_),A=hc(v);return new f.V(m.lng+t*((w-S)/(A-S)),h)}return new f.V(m.lng+t*l,h)}class Bd{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,a,l,h){const _=`${t.z}_${t.x}_${t.y}_${h?.terrain?"t":""}`,v=this._cache.get(_);if(v)return v;const w=this._cachePrevious.get(_);if(w)return this._cache.set(_,w),w;const S=this._boundingVolumeFactory(t,a,l,h);return this._cache.set(_,S),this._hadAnyChanges=!0,S}}class Sl{constructor(t,a,l,h){this.min=l,this.max=h,this.points=t,this.planes=a}static fromAabb(t,a){const l=[];for(let h=0;h<8;h++)l.push([1&~h?t[0]:a[0],(h>>1&1)==1?a[1]:t[1],(h>>2&1)==1?a[2]:t[2]]);return new Sl(l,[[-1,0,0,a[0]],[1,0,0,-t[0]],[0,-1,0,a[1]],[0,1,0,-t[1]],[0,0,-1,a[2]],[0,0,1,-t[2]]],t,a)}static fromCenterSizeAngles(t,a,l){const h=f.bC([],l[0],l[1],l[2]),_=f.bD([],[a[0],0,0],h),v=f.bD([],[0,a[1],0],h),w=f.bD([],[0,0,a[2]],h),S=[...t],A=[...t];for(let R=0;R<8;R++)for(let I=0;I<3;I++){const F=t[I]+_[I]*(1&~R?-1:1)+v[I]*((R>>1&1)==1?1:-1)+w[I]*((R>>2&1)==1?1:-1);S[I]=Math.min(S[I],F),A[I]=Math.max(A[I],F)}const z=[];for(let R=0;R<8;R++){const I=[...t];f.b1(I,I,f.b0([],_,1&~R?-1:1)),f.b1(I,I,f.b0([],v,(R>>1&1)==1?1:-1)),f.b1(I,I,f.b0([],w,(R>>2&1)==1?1:-1)),z.push(I)}return new Sl(z,[[..._,-f.b6(_,z[0])],[...v,-f.b6(v,z[0])],[...w,-f.b6(w,z[0])],[-_[0],-_[1],-_[2],-f.b6(_,z[7])],[-v[0],-v[1],-v[2],-f.b6(v,z[7])],[-w[0],-w[1],-w[2],-f.b6(w,z[7])]],S,A)}intersectsFrustum(t){let a=!0;const l=this.points.length,h=this.planes.length,_=t.planes.length,v=t.points.length;for(let w=0;w<_;w++){const S=t.planes[w];let A=0;for(let z=0;z<l;z++){const R=this.points[z];S[0]*R[0]+S[1]*R[1]+S[2]*R[2]+S[3]>=0&&A++}if(A===0)return 0;A<l&&(a=!1)}if(a)return 2;for(let w=0;w<h;w++){const S=this.planes[w];let A=0;for(let z=0;z<v;z++){const R=t.points[z];S[0]*R[0]+S[1]*R[1]+S[2]*R[2]+S[3]>=0&&A++}if(A===0)return 0}return 1}intersectsPlane(t){const a=this.points.length;let l=0;for(let h=0;h<a;h++){const _=this.points[h];t[0]*_[0]+t[1]*_[1]+t[2]*_[2]+t[3]>=0&&l++}return l===a?2:l===0?0:1}}function fc(m,t,a){const l=m-t;return l<0?-l:Math.max(0,l-a)}function Ml(m,t,a,l,h){const _=m-a;let v;return v=_<0?Math.min(-_,1+_-h):_>1?Math.min(Math.max(_-h,0),1-_):0,Math.max(v,fc(t,l,h))}class yh{constructor(){this._boundingVolumeCache=new Bd(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,a,l,h){const _=1<<l.z,v=1/_,w=l.x/_,S=l.y/_;let A=2;return A=Math.min(A,Ml(t,a,w,S,v)),A=Math.min(A,Ml(t,a,w+.5,-S-v,v)),A=Math.min(A,Ml(t,a,w+.5,2-S-v,v)),A}getWrap(t,a,l){const h=1<<a.z,_=1/h,v=a.x/h,w=fc(t.x,v,_),S=fc(t.x,v-1,_),A=fc(t.x,v+1,_),z=Math.min(w,S,A);return z===A?1:z===S?-1:0}allowVariableZoom(t,a){return gi(t,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,a,l,h){return this._boundingVolumeCache.getTileBoundingVolume(t,a,l,h)}_computeTileBoundingVolume(t,a,l,h){var _,v;let w=0,S=0;if(h?.terrain){const A=new f.a2(t.z,a,t.z,t.x,t.y),z=h.terrain.getMinMaxElevation(A);w=(_=z.minElevation)!==null&&_!==void 0?_:Math.min(0,l),S=(v=z.maxElevation)!==null&&v!==void 0?v:Math.max(0,l)}if(w/=f.bF,S/=f.bF,w+=1,S+=1,t.z<=0)return Sl.fromAabb([-S,-S,-S],[S,S,S]);if(t.z===1)return Sl.fromAabb([t.x===0?-S:0,t.y===0?0:-S,-S],[t.x===0?0:S,t.y===0?S:0,S]);{const A=[es(0,0,t.x,t.y,t.z),es(f.a5,0,t.x,t.y,t.z),es(f.a5,f.a5,t.x,t.y,t.z),es(0,f.a5,t.x,t.y,t.z)],z=[];for(const Ee of A)z.push(f.b0([],Ee,S));if(S!==w)for(const Ee of A)z.push(f.b0([],Ee,w));t.y===0&&z.push([0,1,0]),t.y===(1<<t.z)-1&&z.push([0,-1,0]);const R=[1,1,1],I=[-1,-1,-1];for(const Ee of z)for(let Ce=0;Ce<3;Ce++)R[Ce]=Math.min(R[Ce],Ee[Ce]),I[Ce]=Math.max(I[Ce],Ee[Ce]);const F=es(f.a5/2,f.a5/2,t.x,t.y,t.z),U=f.b5([],[0,1,0],F);f.b4(U,U);const X=f.b5([],F,U);f.b4(X,X);const Q=f.b5([],A[2],A[1]);f.b4(Q,Q);const Y=f.b5([],A[0],A[3]);f.b4(Y,Y),z.push(f.b0([],F,S)),t.y>=(1<<t.z)/2&&z.push(f.b0([],es(f.a5/2,0,t.x,t.y,t.z),S)),t.y<(1<<t.z)/2&&z.push(f.b0([],es(f.a5/2,f.a5,t.x,t.y,t.z),S));const W=yu(F,z),ie=yu(X,z),K=[-F[0],-F[1],-F[2],W.max],re=[F[0],F[1],F[2],-W.min],se=[-X[0],-X[1],-X[2],ie.max],ee=[X[0],X[1],X[2],-ie.min],fe=[...Q,0],Me=[...Y,0],xe=[];return t.y===0?xe.push(f.bE(Me,fe,K),f.bE(Me,fe,re)):xe.push(f.bE(se,fe,K),f.bE(se,fe,re),f.bE(se,Me,K),f.bE(se,Me,re)),t.y===(1<<t.z)-1?xe.push(f.bE(Me,fe,K),f.bE(Me,fe,re)):xe.push(f.bE(ee,fe,K),f.bE(ee,fe,re),f.bE(ee,Me,K),f.bE(ee,Me,re)),new Sl(xe,[K,re,se,ee,fe,Me],R,I)}}}function yu(m,t){let a=1/0,l=-1/0;for(const h of t){const _=f.b6(m,h);a=Math.min(a,_),l=Math.max(l,_)}return{min:a,max:l}}class El{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,l){return this._helper.interpolatePadding(t,a,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a){this._helper.resize(t,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=f.bG(),this._projectionMatrix=f.bk(),this._globeViewProjMatrix32f=f.bj(),this._globeViewProjMatrixNoCorrection=f.bk(),this._globeViewProjMatrixNoCorrectionInverted=f.bk(),this._globeProjMatrixInverted=f.bk(),this._cameraPosition=f.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,l)=>{const h=f.ao(a.lat,-f.ap,f.ap),_=f.ao(+l,this.minZoom+an(0,h),this.maxZoom);return{center:new f.V(a.lng,h),zoom:_}},this.applyConstrain=(a,l)=>this._helper.applyConstrain(a,l),this._helper=new Ws({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,l)=>this.defaultConstrain(a,l)},t),this._coveringTilesDetailsProvider=new yh}clone(){const t=new El;return t.apply(this),t}apply(t,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=f.bA();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:a,applyGlobeMatrix:l}=t,h=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const a=this.pitchInRadians,l=this.cameraToCenterDistance/t,h=Math.sin(a)*l,_=Math.cos(a)*l+1,v=1/Math.sqrt(h*h+_*_)*1;let w=-h,S=_;const A=Math.sqrt(w*w+S*S);w/=A,S/=A;const z=[0,w,S];f.bH(z,z,[0,0,0],-this.bearingInRadians),f.bI(z,z,[0,0,0],-1*this.center.lat*Math.PI/180),f.bJ(z,z,[0,0,0],this.center.lng*Math.PI/180);const R=1/f.b8(z);return f.b0(z,z,R),[...z,-v*R]}isLocationOccluded(t){return!this.isSurfacePointVisible(Ni(t))}transformLightDirection(t){const a=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,h=Math.cos(l),_=[Math.sin(a)*h,Math.sin(l),Math.cos(a)*h],v=[_[2],0,-_[0]],w=[0,0,0];f.b5(w,v,_),f.b4(v,v),f.b4(w,w);const S=[0,0,0];return f.b4(S,[v[0]*t[0]+w[0]*t[1]+_[0]*t[2],v[1]*t[0]+w[1]*t[1]+_[1]*t[2],v[2]*t[0]+w[2]*t[1]+_[2]*t[2]]),S}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,a,l){const h=(function(w,S,A){const z=1/(1<<A.z);return new f.ab(w/f.a5*z+A.x*z,S/f.a5*z+A.y*z)})(t,a,l.canonical),_=(v=h.y,[f.bz(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI]);var v;return this.getCircleRadiusCorrection()/Math.cos(_[1])}projectTileCoordinates(t,a,l,h){const _=l.canonical,v=es(t,a,_.x,_.y,_.z),w=1+(h?h(t,a):0)/f.bF,S=[v[0]*w,v[1]*w,v[2]*w,1];f.aI(S,S,this._globeViewProjMatrixNoCorrection);const A=this._cachedClippingPlane,z=A[0]*v[0]+A[1]*v[1]+A[2]*v[2]+A[3]<0;return{point:new f.P(S[0]/S[3],S[1]/S[3]),signedDistanceFromCamera:S[3],isOccluded:z}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Oo(this.worldSize,this.center.lat),a=f.bl(),l=f.bl();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),f.bf(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const h=this.centerOffset;a[8]=2*-h.x/this._helper._width,a[9]=2*h.y/this._helper._height,this._projectionMatrix=f.bg(a),this._globeProjMatrixInverted=f.bl(),f.aC(this._globeProjMatrixInverted,a),f.O(a,a,[0,0,-this.cameraToCenterDistance]),f.bh(a,a,this.rollInRadians),f.bi(a,a,-this.pitchInRadians),f.bh(a,a,this.bearingInRadians),f.O(a,a,[0,0,-t]);const _=f.bA();_[0]=t,_[1]=t,_[2]=t,f.bi(l,a,this.center.lat*Math.PI/180),f.bK(l,l,-this.center.lng*Math.PI/180),f.Q(l,l,_),this._globeViewProjMatrixNoCorrection=l,f.bi(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),f.bK(a,a,-this.center.lng*Math.PI/180),f.Q(a,a,_),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=f.bl(),f.aC(this._globeViewProjMatrixNoCorrectionInverted,l);const v=f.bA();this._cameraPosition=f.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/t,f.bH(this._cameraPosition,this._cameraPosition,v,-this.rollInRadians),f.bI(this._cameraPosition,this._cameraPosition,v,this.pitchInRadians),f.bH(this._cameraPosition,this._cameraPosition,v,-this.bearingInRadians),f.b1(this._cameraPosition,this._cameraPosition,[0,0,1]),f.bI(this._cameraPosition,this._cameraPosition,v,-this.center.lat*Math.PI/180),f.bJ(this._cameraPosition,this._cameraPosition,v,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const w=f.bg(this._globeViewProjMatrixNoCorrectionInverted);f.Q(w,w,[1,1,-1]),this._cachedFrustum=wr.fromInvProjectionMatrix(w,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){f.w("calculateFogMatrix is not supported on globe projection.");const a=f.bl();return f.as(a),a}getVisibleUnwrappedCoordinates(t){return[new f.bd(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&f.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=Ni(t);f.b0(l,l,1+a/f.bF);const h=f.bG();return f.aI(h,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(t){}getBounds(){const t=.5*this.width,a=.5*this.height,l=[new f.P(0,0),new f.P(t,0),new f.P(this.width,0),new f.P(this.width,a),new f.P(this.width,this.height),new f.P(t,this.height),new f.P(0,this.height),new f.P(0,a)],h=[];for(const R of l)h.push(this.unprojectScreenPoint(R));let _=0,v=0,w=0,S=0;const A=this.center;for(const R of h){const I=f.bL(A.lng,R.lng),F=f.bL(A.lat,R.lat);I<v&&(v=I),I>_&&(_=I),F<S&&(S=F),F>w&&(w=F)}const z=[A.lng+v,A.lat+S,A.lng+_,A.lat+w];return this.isSurfacePointOnScreen([0,1,0])&&(z[3]=90,z[0]=-180,z[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(z[1]=-90,z[0]=-180,z[2]=180),new tn(z)}calculateCenterFromCameraLngLatAlt(t,a,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,l,h)}setLocationAtPoint(t,a){const l=Ni(this.unprojectScreenPoint(a)),h=Ni(t),_=f.bA();f.bM(_);const v=f.bA();f.bJ(v,l,_,-this.center.lng*Math.PI/180),f.bI(v,v,_,this.center.lat*Math.PI/180);const w=h[0]*h[0]+h[2]*h[2],S=v[0]*v[0];if(w<S)return;const A=Math.sqrt(w-S),z=-A,R=f.bN(h[0],h[2],v[0],A),I=f.bN(h[0],h[2],v[0],z),F=f.bA();f.bJ(F,h,_,-R);const U=f.bN(F[1],F[2],v[1],v[2]),X=f.bA();f.bJ(X,h,_,-I);const Q=f.bN(X[1],X[2],v[1],v[2]),Y=.5*Math.PI,W=U>=-Y&&U<=Y,ie=Q>=-Y&&Q<=Y;let K,re;if(W&&ie){const Me=this.center.lng*Math.PI/180,xe=this.center.lat*Math.PI/180;f.bO(R,Me)+f.bO(U,xe)<f.bO(I,Me)+f.bO(Q,xe)?(K=R,re=U):(K=I,re=Q)}else if(W)K=R,re=U;else{if(!ie)return;K=I,re=Q}const se=K/Math.PI*180,ee=re/Math.PI*180,fe=this.center.lat;this.setCenter(new f.V(se,f.ao(ee,-90,90))),this.setZoom(this.zoom+an(fe,this.center.lat))}locationToScreenPoint(t,a){const l=Ni(t);if(a){const h=a.getElevationForLngLatZoom(t,this._helper._tileZoom);f.b0(l,l,1+h/f.bF)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(t){const a=f.bG();return f.aI(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new f.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,a){if(a){const l=a.pointCoordinate(t);if(l)return l}return f.ab.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,a){var l;return(l=this.screenPointToMercatorCoordinate(t,a))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(t,a){const l=this._cameraPosition,h=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(l,h)}getRayDirectionFromPixel(t){const a=f.bG();a[0]=t.x/this.width*2-1,a[1]=-1*(t.y/this.height*2-1),a[2]=1,a[3]=1,f.aI(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const l=f.bA();l[0]=a[0]-this._cameraPosition[0],l[1]=a[1]-this._cameraPosition[1],l[2]=a[2]-this._cameraPosition[2];const h=f.bA();return f.b4(h,l),h}isSurfacePointVisible(t){const a=this._cachedClippingPlane;return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const a=f.bG();return f.aI(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(t,a){const l=f.b6(t,a),h=f.bA(),_=f.bA();f.b0(_,a,l),f.b3(h,t,_);const v=1-f.b6(h,h);if(v<0)return null;const w=f.b6(t,t)-1,S=-l+(l<0?1:-1)*Math.sqrt(v),A=w/S,z=S;return{tMin:Math.min(A,z),tMax:Math.max(A,z)}}unprojectScreenPoint(t){const a=this._cameraPosition,l=this.getRayDirectionFromPixel(t),h=this.rayPlanetIntersection(a,l);if(h){const z=f.bA();f.b1(z,a,[l[0]*h.tMin,l[1]*h.tMin,l[2]*h.tMin]);const R=f.bA();return f.b4(R,z),gu(R)}const _=this._cachedClippingPlane,v=_[0]*l[0]+_[1]*l[1]+_[2]*l[2],w=-f.bc(_,a)/v,S=f.bA();if(w>0)f.b1(S,a,[l[0]*w,l[1]*w,l[2]*w]);else{const z=f.bA();f.b1(z,a,[2*l[0],2*l[1],2*l[2]]);const R=f.bc(this._cachedClippingPlane,z);f.b3(S,z,[this._cachedClippingPlane[0]*R,this._cachedClippingPlane[1]*R,this._cachedClippingPlane[2]*R])}const A=(function(z){const R=f.bA();return R[0]=z[0]*-z[3],R[1]=z[1]*-z[3],R[2]=z[2]*-z[3],{center:R,radius:Math.sqrt(1-z[3]*z[3])}})(_);return gu((function(z,R,I){const F=f.bA();f.b3(F,I,z);const U=f.bA();return f.bB(U,z,F,R/f.ba(F)),U})(A.center,A.radius,S))}getMatrixForModel(t,a){const l=f.V.convert(t),h=1/f.bF,_=f.bk();return f.bK(_,_,l.lng/180*Math.PI),f.bi(_,_,-l.lat/180*Math.PI),f.O(_,_,[0,0,1+a/f.bF]),f.bi(_,_,.5*Math.PI),f.Q(_,_,[h,h,h]),_}getProjectionDataForCustomLayer(t=!0){const a=this.getProjectionData({overscaledTileID:new f.a2(0,0,0,0,0),applyGlobeMatrix:t});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(t){}}class Al{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,l){return this._helper.interpolatePadding(t,a,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,l=!0){this._helper.resize(t,a,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,a){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,l)=>this.currentTransform.defaultConstrain(a,l),this.applyConstrain=(a,l)=>this._helper.applyConstrain(a,l),this._helper=new Ws({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,l)=>this.defaultConstrain(a,l)},t),this._globeness=1,this._mercatorTransform=new Sn,this._verticalPerspectiveTransform=new El}clone(){const t=new Al;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const a=this._mercatorTransform.getProjectionData(t),l=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:a.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return f.bv(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return f.bv(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,a,l){const h=this._mercatorTransform.getPitchedTextCorrection(t,a,l),_=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,a,l);return f.bv(h,_,this._globeness)}projectTileCoordinates(t,a,l,h){return this.currentTransform.projectTileCoordinates(t,a,l,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){return this.currentTransform.lngLatToCameraDepth(t,a)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,a,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,l,h)}setLocationAtPoint(t,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,a){return this.currentTransform.locationToScreenPoint(t,a)}screenPointToMercatorCoordinate(t,a){return this.currentTransform.screenPointToMercatorCoordinate(t,a)}screenPointToLocation(t,a){return this.currentTransform.screenPointToLocation(t,a)}isPointOnMapSurface(t,a){return this.currentTransform.isPointOnMapSurface(t,a)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,a){return this.currentTransform.getMatrixForModel(t,a)}getProjectionDataForCustomLayer(t=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return a;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return l.fallbackMatrix=a.mainMatrix,l}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class fn{get useGlobeControls(){return!0}handlePanInertia(t,a){const l=Cf(t,a);return Math.abs(l.lng-a.center.lng)>180&&(l.lng=a.center.lng+179.5*Math.sign(l.lng-a.center.lng)),{easingCenter:l,easingOffset:new f.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,a){const l=t.around,h=a.screenPointToLocation(l);t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta);const _=a.zoom;t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta);const v=a.zoom-_;if(v===0)return;const w=f.bL(a.center.lng,h.lng),S=w/(Math.abs(w/180)+1),A=f.bL(a.center.lat,h.lat),z=a.getRayDirectionFromPixel(l),R=a.cameraPosition,I=-1*f.b6(R,z),F=f.bA();f.b1(F,R,[z[0]*I,z[1]*I,z[2]*I]);const U=f.b8(F)-1,X=Math.exp(.5*-Math.max(U-.3,0)),Q=Oo(a.worldSize,a.center.lat)/Math.min(a.width,a.height),Y=f.by(Q,.9,.5,1,.25),W=(1-f.ar(-v))*Math.min(X,Y),ie=a.center.lat,K=a.zoom,re=new f.V(a.center.lng+S*W,f.ao(a.center.lat+A*W,-f.ap,f.ap));a.setLocationAtPoint(h,l);const se=a.center,ee=f.by(Math.abs(w),45,85,0,1),fe=f.by(Q,.75,.35,0,1),Me=Math.pow(Math.max(ee,fe),.25),xe=f.bL(se.lng,re.lng),Ee=f.bL(se.lat,re.lat);a.setCenter(new f.V(se.lng+xe*Me,se.lat+Ee*Me).wrap()),a.setZoom(K+an(ie,a.center.lat))}handleMapControlsPan(t,a,l){if(!t.panDelta)return;const h=a.center.lat,_=a.zoom;a.setCenter(Cf(t.panDelta,a).wrap()),a.setZoom(_+an(h,a.center.lat))}cameraForBoxAndBearing(t,a,l,h,_){const v=Io(t,a,l,h,_),w=a.left/_.width*2-1,S=(_.width-a.right)/_.width*2-1,A=a.top/_.height*-2+1,z=(_.height-a.bottom)/_.height*-2+1,R=f.bL(l.getWest(),l.getEast())<0,I=R?l.getEast():l.getWest(),F=R?l.getWest():l.getEast(),U=Math.max(l.getNorth(),l.getSouth()),X=Math.min(l.getNorth(),l.getSouth()),Q=I+.5*f.bL(I,F),Y=U+.5*f.bL(U,X),W=_.clone();W.setCenter(v.center),W.setBearing(v.bearing),W.setPitch(0),W.setRoll(0),W.setZoom(v.zoom);const ie=W.modelViewProjectionMatrix,K=[Ni(l.getNorthWest()),Ni(l.getNorthEast()),Ni(l.getSouthWest()),Ni(l.getSouthEast()),Ni(new f.V(F,Y)),Ni(new f.V(I,Y)),Ni(new f.V(Q,U)),Ni(new f.V(Q,X))],re=Ni(v.center);let se=Number.POSITIVE_INFINITY;for(const ee of K)w<0&&(se=fn.getLesserNonNegativeNonNull(se,fn.solveVectorScale(ee,re,ie,"x",w))),S>0&&(se=fn.getLesserNonNegativeNonNull(se,fn.solveVectorScale(ee,re,ie,"x",S))),A>0&&(se=fn.getLesserNonNegativeNonNull(se,fn.solveVectorScale(ee,re,ie,"y",A))),z<0&&(se=fn.getLesserNonNegativeNonNull(se,fn.solveVectorScale(ee,re,ie,"y",z)));if(Number.isFinite(se)&&se!==0)return v.zoom=W.zoom+f.au(se),v;Tr()}handleJumpToCenterZoom(t,a){const l=t.center.lat,h=t.applyConstrain(a.center?f.V.convert(a.center):t.center,t.zoom).center;t.setCenter(h.wrap());const _=a.zoom!==void 0?+a.zoom:t.zoom+an(l,h.lat);t.zoom!==_&&t.setZoom(_)}handleEaseTo(t,a){const l=t.zoom,h=t.center,_=t.padding,v={roll:t.roll,pitch:t.pitch,bearing:t.bearing},w={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},S=a.zoom!==void 0,A=!t.isPaddingEqual(a.padding);let z=!1;const R=a.center?f.V.convert(a.center):h,I=t.applyConstrain(R,l).center;Ja(t,I);const F=t.clone();F.setCenter(I),F.setZoom(S?+a.zoom:l+an(h.lat,R.lat)),F.setBearing(a.bearing);const U=new f.P(f.ao(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),f.ao(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));F.setLocationAtPoint(I,U);const X=(a.offset&&a.offsetAsPoint.mag())>0?F.center:I,Q=S?+a.zoom:l+an(h.lat,X.lat),Y=l+an(h.lat,0),W=Q+an(X.lat,0),ie=f.bL(h.lng,X.lng),K=f.bL(h.lat,X.lat),re=f.ar(W-Y);return z=Q!==l,{easeFunc:se=>{if(f.bp(v,w)||du({startEulerAngles:v,endEulerAngles:w,tr:t,k:se,useSlerp:v.roll!=w.roll}),A&&t.interpolatePadding(_,a.padding,se),a.around)f.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(a.around,a.aroundPoint);else{const ee=W>Y?Math.min(2,re):Math.max(.5,re),fe=Math.pow(ee,1-se),Me=zf(h,ie,K,se*fe);t.setCenter(Me.wrap())}if(z){const ee=f.G.number(Y,W,se)+an(0,t.center.lat);t.setZoom(ee)}},isZooming:z,elevationCenter:X}}handleFlyTo(t,a){const l=a.zoom!==void 0,h=t.center,_=t.zoom,v=t.padding,w=!t.isPaddingEqual(a.padding),S=t.applyConstrain(f.V.convert(a.center||a.locationAtOffset),_).center,A=l?+a.zoom:t.zoom+an(t.center.lat,S.lat),z=t.clone();z.setCenter(S),z.setZoom(A),z.setBearing(a.bearing);const R=new f.P(f.ao(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),f.ao(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));z.setLocationAtPoint(S,R);const I=z.center;Ja(t,I);const F=(function(K,re,se){const ee=Ni(re),fe=Ni(se),Me=f.b6(ee,fe),xe=Math.acos(Me),Ee=Sr(K);return xe/(2*Math.PI)*Ee})(t,h,I),U=_+an(h.lat,0),X=A+an(I.lat,0),Q=f.ar(X-U);let Y;if(typeof a.minZoom=="number"){const K=+a.minZoom+an(I.lat,0),re=Math.min(K,U,X)+an(0,I.lat),se=t.applyConstrain(I,re).zoom+an(I.lat,0);Y=f.ar(se-U)}const W=f.bL(h.lng,I.lng),ie=f.bL(h.lat,I.lat);return{easeFunc:(K,re,se,ee)=>{const fe=zf(h,W,ie,se);w&&t.interpolatePadding(v,a.padding,K);const Me=K===1?I:fe;t.setCenter(Me.wrap());const xe=U+f.au(re);t.setZoom(K===1?A:xe+an(0,Me.lat))},scaleOfZoom:Q,targetCenter:I,scaleOfMinZoom:Y,pixelPathLength:F}}static solveVectorScale(t,a,l,h,_){const v=h==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],w=[l[3],l[7],l[11],l[15]],S=t[0]*v[0]+t[1]*v[1]+t[2]*v[2],A=t[0]*w[0]+t[1]*w[1]+t[2]*w[2],z=a[0]*v[0]+a[1]*v[1]+a[2]*v[2],R=a[0]*w[0]+a[1]*w[1]+a[2]*w[2];return z+_*A===S+_*R||w[3]*(S-z)+v[3]*(R-A)+S*R==z*A?null:(z+v[3]-_*R-_*w[3])/(z-S-_*R+_*A)}static getLesserNonNegativeNonNull(t,a){return a!==null&&a>=0&&a<t?a:t}}class Cl{constructor(t){this._globe=t,this._mercatorCameraHelper=new Ro,this._verticalPerspectiveCameraHelper=new fn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,a){return this.currentHelper.handlePanInertia(t,a)}handleMapControlsRollPitchBearingZoom(t,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,a)}handleMapControlsPan(t,a,l){this.currentHelper.handleMapControlsPan(t,a,l)}cameraForBoxAndBearing(t,a,l,h,_){return this.currentHelper.cameraForBoxAndBearing(t,a,l,h,_)}handleJumpToCenterZoom(t,a){this.currentHelper.handleJumpToCenterZoom(t,a)}handleEaseTo(t,a){return this.currentHelper.handleEaseTo(t,a)}handleFlyTo(t,a){return this.currentHelper.handleFlyTo(t,a)}}const zl=(m,t)=>f.B(m,t&&t.filter((a=>a.identifier!=="source.canvas"))),Dl=f.bP();class to extends f.E{constructor(t,a={}){var l,h;super(),this._rtlPluginLoaded=()=>{for(const v in this.tileManagers){const w=this.tileManagers[v].getSource().type;w!=="vector"&&w!=="geojson"||this.tileManagers[v].reload()}},this.map=t,this.dispatcher=new vr(Ri(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((v,w)=>this.getGlyphs(v,w))),this.dispatcher.registerMessageHandler("GI",((v,w)=>this.getImages(v,w))),this.dispatcher.registerMessageHandler("GDA",((v,w)=>this.getDashes(v,w))),this.imageManager=new en,this.imageManager.setEventedParent(this);const _=((l=t._container)===null||l===void 0?void 0:l.lang)||typeof document<"u"&&((h=document.documentElement)===null||h===void 0?void 0:h.lang)||void 0;this.glyphManager=new rt(t._requestManager,a.localIdeographFontFamily,_),this.lineAtlas=new ct(256,512),this.crossTileSymbolIndex=new Fn,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",f.bQ()),ge().on(ae,this._rtlPluginLoaded),this.on("data",(v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const w=this.tileManagers[v.sourceId];if(!w)return;const S=w.getSource();if(S&&S.vectorLayerIds)for(const A in this._layers){const z=this._layers[A];z.source===S.id&&this._validateLayer(z)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new f.bR,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,a){var l,h,_;this._checkLoaded();const v=a===null?(_=(h=(l=this.stylesheet.state)===null||l===void 0?void 0:l[t])===null||h===void 0?void 0:h.default)!==null&&_!==void 0?_:null:a;if(f.bS(v,this._globalState[t]))return this;this._globalState[t]=v,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const a=[];for(const l in t)!f.bS(this._globalState[l],t[l].default)&&(a.push(l),this._globalState[l]=t[l].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(t){if(t.length===0)return;const a=new Set,l={};for(const h of t){l[h]=this._globalState[h];for(const _ in this._layers){const v=this._layers[_],w=v.getLayoutAffectingGlobalStateRefs(),S=v.getPaintAffectingGlobalStateRefs();if(w.has(h)&&a.add(v.source),S.has(h))for(const{name:A,value:z}of S.get(h))this._updatePaintProperty(v,A,z)}}this.dispatcher.broadcast("UGS",l);for(const h in this.tileManagers)a.has(h)&&(this._reloadSource(h),this._changed=!0)}loadURL(t,a={},l){this.fire(new f.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const h=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const _=this._loadStyleRequest;f.j(h,this._loadStyleRequest).then((v=>{this._loadStyleRequest=null,this._load(v.data,a,l)})).catch((v=>{this._loadStyleRequest=null,v&&!_.signal.aborted&&this.fire(new f.k(v))}))}loadJSON(t,a={},l){this.fire(new f.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Mt.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,l)})).catch((()=>{}))}loadEmpty(){this.fire(new f.l("dataloading",{dataType:"style"})),this._load(Dl,{validate:!1})}_load(t,a,l){var h,_;let v=a.transformStyle?a.transformStyle(l,t):t;if(!a.validate||!zl(this,f.C(v))){v=Object.assign({},v),this._loaded=!0,this.stylesheet=v;for(const w in v.sources)this.addSource(w,v.sources[w],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new ui(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new Qe(this.stylesheet.sky),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.fire(new f.l("data",{dataType:"style"})),this.fire(new f.l("style.load"))}}_createLayers(){var t,a,l;const h=f.bT(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",h),this._order=h.map((_=>_.id)),this._layers={},this._serializedLayers=null;for(const _ of h){const v=f.bU(_,this._globalState);if(v.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=v,f.bV(v)&&this.tileManagers[v.source]){const w=(l=(a=_.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&l!==void 0?l:v.paint.get("raster-fade-duration");this.tileManagers[v.source].setRasterFadeDuration(w)}}}_loadSprite(t,a=!1,l=void 0){this.imageManager.setLoaded(!1);const h=new AbortController;let _;this._spriteRequest=h,(function(v,w,S,A){return f._(this,void 0,void 0,(function*(){const z=ir(v),R=S>1?"@2x":"",I={},F={};for(const{id:U,url:X}of z){const Q=w.transformRequest(Lr(X,R,".json"),"SpriteJSON");I[U]=f.j(Q,A);const Y=w.transformRequest(Lr(X,R,".png"),"SpriteImage");F[U]=Lt.getImage(Y,A)}return yield Promise.all([...Object.values(I),...Object.values(F)]),(function(U,X){return f._(this,void 0,void 0,(function*(){const Q={};for(const Y in U){Q[Y]={};const W=Mt.getImageCanvasContext((yield X[Y]).data),ie=(yield U[Y]).data;for(const K in ie){const{width:re,height:se,x:ee,y:fe,sdf:Me,pixelRatio:xe,stretchX:Ee,stretchY:Ce,content:He,textFitWidth:Je,textFitHeight:qe}=ie[K];Q[Y][K]={data:null,pixelRatio:xe,sdf:Me,stretchX:Ee,stretchY:Ce,content:He,textFitWidth:Je,textFitHeight:qe,spriteData:{width:re,height:se,x:ee,y:fe,context:W}}}}return Q}))})(I,F)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((v=>{if(this._spriteRequest=null,v)for(const w in v){this._spritesImagesIds[w]=[];const S=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter((A=>!(A in v))):[];for(const A of S)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in v[w]){const z=w==="default"?A:`${w}:${A}`;this._spritesImagesIds[w].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,v[w][A],!1):this.imageManager.addImage(z,v[w][A]),a&&(this._changedImages[z]=!0)}}})).catch((v=>{this._spriteRequest=null,_=v,h.signal.aborted||this.fire(new f.k(_))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.l("data",{dataType:"style"})),l&&l(_)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.l("data",{dataType:"style"}))}_validateLayer(t){const a=this.tileManagers[t.source];if(!a)return;const l=t.sourceLayer;if(!l)return;const h=a.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new f.k(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,a=!1){const l=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a?f.bW(l):l);const h=[];for(const _ of t)if(l[_]){const v=a?f.bW(l[_]):l[_];h.push(v)}return h}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const l of a){const h=this._layers[l];h.type!=="custom"&&(t[l]=h.serialize())}return t}hasTransitions(){var t,a,l;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const h in this.tileManagers)if(this.tileManagers[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(a){const h=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(h.length||_.length)&&this._updateWorkerLayers(h,_);for(const v in this._updatedSources){const w=this._updatedSources[v];if(w==="reload")this._reloadSource(v);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const l={};for(const h in this.tileManagers){const _=this.tileManagers[h];l[h]=_.used,_.used=!1}for(const h of this._order){const _=this._layers[h];_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)&&_.source&&(this.tileManagers[_.source].used=!0)}for(const h in l){const _=this.tileManagers[h];!!l[h]!=!!_.used&&_.fire(new f.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,a&&this.fire(new f.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var l;this._checkLoaded();const h=this.serialize();if(t=a.transformStyle?a.transformStyle(h,t):t,((l=a.validate)===null||l===void 0||l)&&zl(this,f.C(t)))return!1;(t=f.bW(t)).layers=f.bT(t.layers);const _=f.bX(h,t),v=this._getOperationsToPerform(_);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const w of v.operations)w();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const a=[],l=[];for(const h of t)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,h.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,h.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,h.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,h.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,h.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,h.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,h.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,h.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,h.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,h.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,h.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,h.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,h.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,h.args)));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,h.args)));break;case"setTransition":a.push((()=>{}));break;default:l.push(h.command)}return{operations:a,unimplemented:l}}addImage(t,a){if(this.getImage(t))return this.fire(new f.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new f.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,l={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(f.C.source,`sources.${t}`,a,null,l))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const h=this.tileManagers[t]=new Ii(t,a,this.dispatcher);h.style=this,h.setEventedParent(this,(()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:t}))),h.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new f.k(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const a=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],a.fire(new f.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.tileManagers[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(a),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,a,l={}){this._checkLoaded();const h=t.id;if(this.getLayer(h))return void this.fire(new f.k(new Error(`Layer "${h}" already exists on this map.`)));let _;if(t.type==="custom"){if(zl(this,f.bY(t)))return;_=f.bU(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(h,t.source),t=f.bW(t),t=f.e(t,{source:h})),this._validate(f.C.layer,`layers.${h}`,t,{arrayIndex:-1},l))return;_=f.bU(t,this._globalState),this._validateLayer(_),_.setEventedParent(this,{layer:{id:h}})}const v=a?this._order.indexOf(a):this._order.length;if(a&&v===-1)this.fire(new f.k(new Error(`Cannot add layer "${h}" before non-existing layer "${a}".`)));else{if(this._order.splice(v,0,h),this._layerOrderChanged=!0,this._layers[h]=_,this._removedLayers[h]&&_.source&&_.type!=="custom"){const w=this._removedLayers[h];delete this._removedLayers[h],w.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.tileManagers[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new f.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const l=this._order.indexOf(t);this._order.splice(l,1);const h=a?this._order.indexOf(a):this._order.length;a&&h===-1?this.fire(new f.k(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(h,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new f.k(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,l){this._checkLoaded();const h=this.getLayer(t);h?h.minzoom===a&&h.maxzoom===l||(a!=null&&(h.minzoom=a),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new f.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,l={}){this._checkLoaded();const h=this.getLayer(t);if(h){if(!f.bS(h.filter,a))return a==null?(h.setFilter(void 0),void this._updateLayer(h)):void(this._validate(f.C.filter,`layers.${h.id}.filter`,a,null,l)||(h.setFilter(f.bW(a)),this._updateLayer(h)))}else this.fire(new f.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return f.bW(this.getLayer(t).filter)}setLayoutProperty(t,a,l,h={}){this._checkLoaded();const _=this.getLayer(t);_?f.bS(_.getLayoutProperty(a),l)||(_.setLayoutProperty(a,l,h),this._updateLayer(_)):this.fire(new f.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const l=this.getLayer(t);if(l)return l.getLayoutProperty(a);this.fire(new f.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,l,h={}){this._checkLoaded();const _=this.getLayer(t);_?f.bS(_.getPaintProperty(a),l)||this._updatePaintProperty(_,a,l,h):this.fire(new f.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,a,l,h={}){t.setPaintProperty(a,l,h)&&this._updateLayer(t),f.bV(t)&&a==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(l),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const l=t.source,h=t.sourceLayer,_=this.tileManagers[l];if(_===void 0)return void this.fire(new f.k(new Error(`The source '${l}' does not exist in the map's style.`)));const v=_.getSource().type;v==="geojson"&&h?this.fire(new f.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||h?(t.id===void 0&&this.fire(new f.k(new Error("The feature id parameter must be provided."))),_.setFeatureState(h,t.id,a)):this.fire(new f.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const l=t.source,h=this.tileManagers[l];if(h===void 0)return void this.fire(new f.k(new Error(`The source '${l}' does not exist in the map's style.`)));const _=h.getSource().type,v=_==="vector"?t.sourceLayer:void 0;_!=="vector"||v?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new f.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(v,t.id,a):this.fire(new f.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,l=t.sourceLayer,h=this.tileManagers[a];if(h!==void 0)return h.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new f.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,t.id)):void this.fire(new f.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new f.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return f.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=f.bZ(this.tileManagers,(_=>_.serialize())),a=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,h=this.stylesheet;return f.b_({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:t,layers:a,terrain:l},(_=>_!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=v=>this._layers[v].type==="fill-extrusion",l={},h=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(a(w)){l[w]=v;for(const S of t){const A=S[w];if(A)for(const z of A)h.push(z)}}}h.sort(((v,w)=>w.intersectionZ-v.intersectionZ));const _=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(a(w))for(let S=h.length-1;S>=0;S--){const A=h[S].feature;if(l[A.layer.id]<v)break;_.push(A),h.pop()}else for(const S of t){const A=S[w];if(A)for(const z of A)_.push(z.feature)}}return _}queryRenderedFeatures(t,a,l){a&&a.filter&&this._validate(f.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);const h={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new f.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const A of a.layers){const z=this._layers[A];if(!z)return this.fire(new f.k(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];h[z.source]=!0}}const _=[];a.availableImages=this._availableImages;const v=this._serializedAllLayers(),w=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,S=Object.assign(Object.assign({},a),{layers:w,globalState:this._globalState});for(const A in this.tileManagers)a.layers&&!h[A]||_.push(gl(this.tileManagers[A],this._layers,v,t,S,l,this.map.terrain?(z,R,I)=>this.map.terrain.getElevation(z,R,I):void 0));return this.placement&&_.push((function(A,z,R,I,F,U,X){const Q={},Y=U.queryRenderedSymbols(I),W=[];for(const ie of Object.keys(Y).map(Number))W.push(X[ie]);W.sort(Zi);for(const ie of W){const K=ie.featureIndex.lookupSymbolFeatures(Y[ie.bucketInstanceId],z,ie.bucketIndex,ie.sourceLayerIndex,{filterSpec:F.filter,globalState:F.globalState},F.layers,F.availableImages,A);for(const re in K){const se=Q[re]=Q[re]||[],ee=K[re];ee.sort(((fe,Me)=>{const xe=ie.featureSortOrder;if(xe){const Ee=xe.indexOf(fe.featureIndex);return xe.indexOf(Me.featureIndex)-Ee}return Me.featureIndex-fe.featureIndex}));for(const fe of ee)se.push(fe)}}return(function(ie,K,re){for(const se in ie)for(const ee of ie[se])Or(ee,re[K[se].source]);return ie})(Q,A,R)})(this._layers,v,this.tileManagers,t,S,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,a){a?.filter&&this._validate(f.C.filter,"querySourceFeatures.filter",a.filter,null,a);const l=this.tileManagers[t];return l?(function(h,_){const v=h.getRenderableIds().map((A=>h.getTileByID(A))),w=[],S={};for(let A=0;A<v.length;A++){const z=v[A],R=z.tileID.canonical.key;S[R]||(S[R]=!0,z.querySourceFeatures(w,_))}return w})(l,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const v in t)if(!f.bS(t[v],l[v])){h=!0;break}if(!h)return;const _={now:Et(),transition:f.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(_)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,a={}){this._checkLoaded();const l=this.getSky();let h=!1;if(!t&&!l)return;if(t&&!l)h=!0;else if(!t&&l)h=!0;else for(const v in t)if(!f.bS(t[v],l[v])){h=!0;break}if(!h)return;const _={now:Et(),transition:f.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,a),this.sky.updateTransitions(_)}_setProjectionInternal(t){const a=(function(l,h){const _={constrainOverride:h};if(Array.isArray(l)){const v=new _h({type:l});return{projection:v,transform:new Al(_),cameraHelper:new Cl(v)}}switch(l){case"mercator":return{projection:new Nn,transform:new Sn(_),cameraHelper:new Ro};case"globe":{const v=new _h({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:v,transform:new Al(_),cameraHelper:new Cl(v)}}case"vertical-perspective":return{projection:new gh,transform:new El(_),cameraHelper:new fn};default:return f.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new Nn,transform:new Sn(_),cameraHelper:new Ro}}})(t,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const l in this.tileManagers)this.tileManagers[l].reload()}_validate(t,a,l,h,_={}){return(!_||_.validate!==!1)&&zl(this,t.call(f.C,f.e({key:a,style:this.serialize(),value:l,styleSpec:f.u},h)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ge().off(ae,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.tileManagers){const l=this.tileManagers[a];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const a in this.tileManagers)this.tileManagers[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,a,l,h,_=!1){let v=!1,w=!1;const S={};for(const A of this._order){const z=this._layers[A];if(z.type!=="symbol")continue;if(!S[z.source]){const I=this.tileManagers[z.source];S[z.source]=I.getRenderableIds(!0).map((F=>I.getTileByID(F))).sort(((F,U)=>U.tileID.overscaledZ-F.tileID.overscaledZ||(F.tileID.isLessThan(U.tileID)?-1:1)))}const R=this.crossTileSymbolIndex.addLayer(z,S[z.source],t.center.lng);v=v||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Et(),t.zoom))&&(this.pauseablePlacement=new Tl(t,this.map.terrain,this._order,_,a,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Et()),w=!0),v&&this.pauseablePlacement.placement.setStale()),w||v)for(const A of this._order){const z=this._layers[A];z.type==="symbol"&&this.placement.updateLayerOpacities(z,S[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Et())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,a){return f._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const h=this.tileManagers[a.source];return h&&h.setDependencies(a.tileID.key,a.type,a.icons),l}))}getGlyphs(t,a){return f._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(a.stacks),h=this.tileManagers[a.source];return h&&h.setDependencies(a.tileID.key,a.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(f.C.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,a){return f._(this,void 0,void 0,(function*(){const l={};for(const[h,_]of Object.entries(a.dashes))l[h]=this.lineAtlas.getDash(_.dasharray,_.round);return l}))}addSprite(t,a,l={},h){this._checkLoaded();const _=[{id:t,url:a}],v=[...ir(this.stylesheet.sprite),..._];this._validate(f.C.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(_,!0,h))}removeSprite(t){this._checkLoaded();const a=ir(this.stylesheet.sprite);if(a.find((l=>l.id===t))){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;a.splice(a.findIndex((l=>l.id===t)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.l("data",{dataType:"style"}))}else this.fire(new f.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return ir(this.stylesheet.sprite)}setSprite(t,a={},l){this._checkLoaded(),t&&this._validate(f.C.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const a=this.tileManagers[t];a.setEventedParent(null),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const a=this._layers[t];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Df=f.aV([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class vu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,l,h,_,v,w,S,A){this.context=t;let z=this.boundPaintVertexBuffers.length!==h.length;for(let R=0;!z&&R<h.length;R++)this.boundPaintVertexBuffers[R]!==h[R]&&(z=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==l||z||this.boundIndexBuffer!==_||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==A?this.freshBind(a,l,h,_,v,w,S,A):(t.bindVertexArray.set(this.vao),w&&w.bind(),_&&_.dynamicDraw&&_.bind(),S&&S.bind(),A&&A.bind())}freshBind(t,a,l,h,_,v,w,S){const A=t.numAttributes,z=this.context,R=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=S,a.enableAttributes(R,t);for(const I of l)I.enableAttributes(R,t);v&&v.enableAttributes(R,t),w&&w.enableAttributes(R,t),S&&S.enableAttributes(R,t),a.bind(),a.setVertexAttribPointers(R,t,_);for(const I of l)I.bind(),I.setVertexAttribPointers(R,t,_);v&&(v.bind(),v.setVertexAttribPointers(R,t,_)),h&&h.bind(),w&&(w.bind(),w.setVertexAttribPointers(R,t,_)),S&&(S.bind(),S.setVertexAttribPointers(R,t,_)),z.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Pf=(m,t,a,l,h)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:t,u_fog_color:a?a.properties.get("fog-color"):f.bq.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:a?a.calculateFogBlendOpacity(l):0,u_horizon_color:a?a.properties.get("horizon-color"):f.bq.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),La={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function dc(m){const t=[];for(let a=0;a<m.length;a++){if(m[a]===null)continue;const l=m[a].split(" ");t.push(l.pop())}return t}class If{constructor(t,a,l,h,_,v,w,S,A=[]){const z=t.gl;this.program=z.createProgram();const R=dc(a.staticAttributes),I=l?l.getBinderAttributes():[],F=R.concat(I),U=ki.prelude.staticUniforms?dc(ki.prelude.staticUniforms):[],X=w.staticUniforms?dc(w.staticUniforms):[],Q=a.staticUniforms?dc(a.staticUniforms):[],Y=l?l.getBinderUniforms():[],W=U.concat(X).concat(Q).concat(Y),ie=[];for(const xe of W)ie.indexOf(xe)<0&&ie.push(xe);const K=l?l.defines():[];ya(z)&&K.unshift("#version 300 es"),_&&K.push("#define OVERDRAW_INSPECTOR;"),v&&K.push("#define TERRAIN3D;"),S&&K.push(S),A&&K.push(...A);let re=K.concat(ki.prelude.fragmentSource,w.fragmentSource,a.fragmentSource).join(`
`),se=K.concat(ki.prelude.vertexSource,w.vertexSource,a.vertexSource).join(`
`);ya(z)||(re=(function(xe){return xe.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(re),se=(function(xe){return xe.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(se));const ee=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(ee,re),z.compileShader(ee),!z.getShaderParameter(ee,z.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${z.getShaderInfoLog(ee)}`);z.attachShader(this.program,ee);const fe=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(fe,se),z.compileShader(fe),!z.getShaderParameter(fe,z.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${z.getShaderInfoLog(fe)}`);z.attachShader(this.program,fe),this.attributes={};const Me={};this.numAttributes=F.length;for(let xe=0;xe<this.numAttributes;xe++)F[xe]&&(z.bindAttribLocation(this.program,xe,F[xe]),this.attributes[F[xe]]=xe);if(z.linkProgram(this.program),!z.getProgramParameter(this.program,z.LINK_STATUS))throw new Error(`Program failed to link: ${z.getProgramInfoLog(this.program)}`);z.deleteShader(fe),z.deleteShader(ee);for(let xe=0;xe<ie.length;xe++){const Ee=ie[xe];if(Ee&&!Me[Ee]){const Ce=z.getUniformLocation(this.program,Ee);Ce&&(Me[Ee]=Ce)}}this.fixedUniforms=h(t,Me),this.terrainUniforms=((xe,Ee)=>({u_depth:new f.b$(xe,Ee.u_depth),u_terrain:new f.b$(xe,Ee.u_terrain),u_terrain_dim:new f.br(xe,Ee.u_terrain_dim),u_terrain_matrix:new f.c1(xe,Ee.u_terrain_matrix),u_terrain_unpack:new f.c2(xe,Ee.u_terrain_unpack),u_terrain_exaggeration:new f.br(xe,Ee.u_terrain_exaggeration)}))(t,Me),this.projectionUniforms=((xe,Ee)=>({u_projection_matrix:new f.c1(xe,Ee.u_projection_matrix),u_projection_tile_mercator_coords:new f.c2(xe,Ee.u_projection_tile_mercator_coords),u_projection_clipping_plane:new f.c2(xe,Ee.u_projection_clipping_plane),u_projection_transition:new f.br(xe,Ee.u_projection_transition),u_projection_fallback_matrix:new f.c1(xe,Ee.u_projection_fallback_matrix)}))(t,Me),this.binderUniforms=l?l.getUniforms(t,Me):[]}draw(t,a,l,h,_,v,w,S,A,z,R,I,F,U,X,Q,Y,W,ie){const K=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(h),t.setColorMode(_),t.setCullFace(v),S){t.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,S.depthTexture),t.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,S.texture);for(const se in this.terrainUniforms)this.terrainUniforms[se].set(S[se])}if(A)for(const se in A)this.projectionUniforms[La[se]].set(A[se]);if(w)for(const se in this.fixedUniforms)this.fixedUniforms[se].set(w[se]);Q&&Q.setUniforms(t,this.binderUniforms,U,{zoom:X});let re=0;switch(a){case K.LINES:re=2;break;case K.TRIANGLES:re=3;break;case K.LINE_STRIP:re=1}for(const se of F.get()){const ee=se.vaos||(se.vaos={});(ee[z]||(ee[z]=new vu)).bind(t,this,R,Q?Q.getPaintVertexBuffers():[],I,se.vertexOffset,Y,W,ie),K.drawElements(a,se.primitiveLength*re,K.UNSIGNED_SHORT,se.primitiveOffset*re*2)}}}function Rf(m,t,a){const l=1/f.aO(a,1,t.transform.tileZoom),h=Math.pow(2,a.tileID.overscaledZ),_=a.tileSize*Math.pow(2,t.transform.tileZoom)/h,v=_*(a.tileID.canonical.x+a.tileID.wrap*h),w=_*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[l,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const pc=(m,t,a,l)=>{const h=m.style.light,_=h.properties.get("position"),v=[_.x,_.y,_.z],w=f.c5();h.properties.get("anchor")==="viewport"&&f.c6(w,m.transform.bearingInRadians),f.c7(v,v,w);const S=m.transform.transformLightDirection(v),A=h.properties.get("color");return{u_lightpos:v,u_lightpos_globe:S,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+t,u_opacity:a,u_fill_translate:l}},mc=(m,t,a,l,h,_,v)=>f.e(pc(m,t,a,l),Rf(_,m,v),{u_height_factor:-Math.pow(2,h.overscaledZ)/v.tileSize/8}),Bo=(m,t,a,l)=>f.e(Rf(t,m,a),{u_fill_translate:l}),Pl=(m,t)=>({u_world:m,u_fill_translate:t}),Lf=(m,t,a,l,h)=>f.e(Bo(m,t,a,h),{u_world:l}),xu=(m,t,a,l,h)=>{const _=m.transform;let v,w,S=0;if(a.paint.get("circle-pitch-alignment")==="map"){const A=f.aO(t,1,_.zoom);v=!0,w=[A,A],S=A/(f.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*h}else v=!1,w=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+v,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:w,u_globe_extrude_scale:S,u_translate:l}},io=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),vh=m=>({u_viewport_size:[m.width,m.height]}),bu=(m,t=1)=>({u_color:m,u_overlay:0,u_overlay_scale:t}),no=(m,t,a,l)=>{const h=f.aO(m,1,t)/(f.a5*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:f.aO(m,1,t),u_intensity:a,u_globe_extrude_scale:h}},xh=(m,t,a,l)=>{const h=f.N();f.c8(h,0,m.width,m.height,0,0,1);const _=m.context.gl;return{u_matrix:h,u_world:[_.drawingBufferWidth,_.drawingBufferHeight],u_image:a,u_color_ramp:l,u_opacity:t.paint.get("heatmap-opacity")}},wu=(m,t,a)=>{const l=a.paint.get("hillshade-accent-color");let h;switch(a.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}const _=a.getIlluminationProperties();for(let v=0;v<_.directionRadians.length;v++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(_.directionRadians[v]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:kd(0,t.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:_.altitudeRadians,u_azimuths:_.directionRadians,u_accent:l,u_method:h,u_highlights:_.highlightColor,u_shadows:_.shadowColor}},Of=(m,t)=>{const a=t.stride,l=f.N();return f.c8(l,0,f.a5,-f.a5,0,0,1),f.O(l,l,[0,-f.a5,0]),{u_matrix:l,u_image:1,u_dimension:[a,a],u_zoom:m.overscaledZ,u_unpack:t.getUnpackVector()}};function kd(m,t){const a=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new f.ab(0,l/a).toLngLat().lat,new f.ab(0,(l+1)/a).toLngLat().lat]}const Bf=(m,t,a=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:m.paint.get("color-relief-opacity")}),Tu=(m,t,a,l)=>{const h=m.transform;return{u_translation:Su(m,t,a),u_ratio:l/f.aO(t,1,h.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},kf=(m,t,a,l,h)=>f.e(Tu(m,t,a,l),{u_image:0,u_image_height:h}),bh=(m,t,a,l,h)=>{const _=m.transform,v=va(t,_);return{u_translation:Su(m,t,a),u_texsize:t.imageAtlasTexture.size,u_ratio:l/f.aO(t,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[v,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},kr=(m,t,a,l,h)=>{const _=va(t,m.transform);return f.e(Tu(m,t,a,l),{u_tileratio:_,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image:0,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})},ro=(m,t,a,l,h,_)=>{const v=va(t,m.transform);return f.e(Tu(m,t,a,l),{u_image:0,u_image_height:_,u_tileratio:v,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image_dash:1,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})};function va(m,t){return 1/f.aO(m,1,t.tileZoom)}function Su(m,t,a){return f.aP(m.transform,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const gc=(m,t,a,l,h)=>{return{u_tl_parent:m,u_scale_parent:t,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(v=l.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(_=l.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:_c(l.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var _,v};function _c(m){m*=Math.PI/180;const t=Math.sin(m),a=Math.cos(m);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const Mu=(m,t,a,l,h,_,v,w,S,A,z,R,I)=>{const F=v.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:F.width/F.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_label_plane_matrix:w,u_coord_matrix:S,u_is_text:+z,u_pitch_with_map:+l,u_is_along_line:h,u_is_variable_anchor:_,u_texsize:R,u_texture:0,u_translation:A,u_pitched_scale:I}},yc=(m,t,a,l,h,_,v,w,S,A,z,R,I,F)=>{const U=v.transform;return f.e(Mu(m,t,a,l,h,_,v,w,S,A,z,R,F),{u_gamma_scale:l?Math.cos(U.pitch*Math.PI/180)*U.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},xa=(m,t,a,l,h,_,v,w,S,A,z,R,I)=>f.e(yc(m,t,a,l,h,_,v,w,S,A,!0,z,0,I),{u_texsize_icon:R,u_texture_icon:1}),Eu=(m,t)=>({u_opacity:m,u_color:t}),Au=(m,t,a,l,h)=>f.e((function(_,v,w,S){const A=w.imageManager.getPattern(_.from.toString()),z=w.imageManager.getPattern(_.to.toString()),{width:R,height:I}=w.imageManager.getPixelSize(),F=Math.pow(2,S.tileID.overscaledZ),U=S.tileSize*Math.pow(2,w.transform.tileZoom)/F,X=U*(S.tileID.canonical.x+S.tileID.wrap*F),Q=U*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[R,I],u_mix:v.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/f.aO(S,1,w.transform.tileZoom),u_pixel_coord_upper:[X>>16,Q>>16],u_pixel_coord_lower:[65535&X,65535&Q]}})(a,h,t,l),{u_opacity:m}),vc=(m,t)=>{},Ff={fillExtrusion:(m,t)=>({u_lightpos:new f.c3(m,t.u_lightpos),u_lightpos_globe:new f.c3(m,t.u_lightpos_globe),u_lightintensity:new f.br(m,t.u_lightintensity),u_lightcolor:new f.c3(m,t.u_lightcolor),u_vertical_gradient:new f.br(m,t.u_vertical_gradient),u_opacity:new f.br(m,t.u_opacity),u_fill_translate:new f.c4(m,t.u_fill_translate)}),fillExtrusionPattern:(m,t)=>({u_lightpos:new f.c3(m,t.u_lightpos),u_lightpos_globe:new f.c3(m,t.u_lightpos_globe),u_lightintensity:new f.br(m,t.u_lightintensity),u_lightcolor:new f.c3(m,t.u_lightcolor),u_vertical_gradient:new f.br(m,t.u_vertical_gradient),u_height_factor:new f.br(m,t.u_height_factor),u_opacity:new f.br(m,t.u_opacity),u_fill_translate:new f.c4(m,t.u_fill_translate),u_image:new f.b$(m,t.u_image),u_texsize:new f.c4(m,t.u_texsize),u_pixel_coord_upper:new f.c4(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new f.c4(m,t.u_pixel_coord_lower),u_scale:new f.c3(m,t.u_scale),u_fade:new f.br(m,t.u_fade)}),fill:(m,t)=>({u_fill_translate:new f.c4(m,t.u_fill_translate)}),fillPattern:(m,t)=>({u_image:new f.b$(m,t.u_image),u_texsize:new f.c4(m,t.u_texsize),u_pixel_coord_upper:new f.c4(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new f.c4(m,t.u_pixel_coord_lower),u_scale:new f.c3(m,t.u_scale),u_fade:new f.br(m,t.u_fade),u_fill_translate:new f.c4(m,t.u_fill_translate)}),fillOutline:(m,t)=>({u_world:new f.c4(m,t.u_world),u_fill_translate:new f.c4(m,t.u_fill_translate)}),fillOutlinePattern:(m,t)=>({u_world:new f.c4(m,t.u_world),u_image:new f.b$(m,t.u_image),u_texsize:new f.c4(m,t.u_texsize),u_pixel_coord_upper:new f.c4(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new f.c4(m,t.u_pixel_coord_lower),u_scale:new f.c3(m,t.u_scale),u_fade:new f.br(m,t.u_fade),u_fill_translate:new f.c4(m,t.u_fill_translate)}),circle:(m,t)=>({u_camera_to_center_distance:new f.br(m,t.u_camera_to_center_distance),u_scale_with_map:new f.b$(m,t.u_scale_with_map),u_pitch_with_map:new f.b$(m,t.u_pitch_with_map),u_extrude_scale:new f.c4(m,t.u_extrude_scale),u_device_pixel_ratio:new f.br(m,t.u_device_pixel_ratio),u_globe_extrude_scale:new f.br(m,t.u_globe_extrude_scale),u_translate:new f.c4(m,t.u_translate)}),collisionBox:(m,t)=>({u_pixel_extrude_scale:new f.c4(m,t.u_pixel_extrude_scale)}),collisionCircle:(m,t)=>({u_viewport_size:new f.c4(m,t.u_viewport_size)}),debug:(m,t)=>({u_color:new f.c0(m,t.u_color),u_overlay:new f.b$(m,t.u_overlay),u_overlay_scale:new f.br(m,t.u_overlay_scale)}),depth:vc,clippingMask:vc,heatmap:(m,t)=>({u_extrude_scale:new f.br(m,t.u_extrude_scale),u_intensity:new f.br(m,t.u_intensity),u_globe_extrude_scale:new f.br(m,t.u_globe_extrude_scale)}),heatmapTexture:(m,t)=>({u_matrix:new f.c1(m,t.u_matrix),u_world:new f.c4(m,t.u_world),u_image:new f.b$(m,t.u_image),u_color_ramp:new f.b$(m,t.u_color_ramp),u_opacity:new f.br(m,t.u_opacity)}),hillshade:(m,t)=>({u_image:new f.b$(m,t.u_image),u_latrange:new f.c4(m,t.u_latrange),u_exaggeration:new f.br(m,t.u_exaggeration),u_altitudes:new f.ca(m,t.u_altitudes),u_azimuths:new f.ca(m,t.u_azimuths),u_accent:new f.c0(m,t.u_accent),u_method:new f.b$(m,t.u_method),u_shadows:new f.c9(m,t.u_shadows),u_highlights:new f.c9(m,t.u_highlights)}),hillshadePrepare:(m,t)=>({u_matrix:new f.c1(m,t.u_matrix),u_image:new f.b$(m,t.u_image),u_dimension:new f.c4(m,t.u_dimension),u_zoom:new f.br(m,t.u_zoom),u_unpack:new f.c2(m,t.u_unpack)}),colorRelief:(m,t)=>({u_image:new f.b$(m,t.u_image),u_unpack:new f.c2(m,t.u_unpack),u_dimension:new f.c4(m,t.u_dimension),u_elevation_stops:new f.b$(m,t.u_elevation_stops),u_color_stops:new f.b$(m,t.u_color_stops),u_color_ramp_size:new f.b$(m,t.u_color_ramp_size),u_opacity:new f.br(m,t.u_opacity)}),line:(m,t)=>({u_translation:new f.c4(m,t.u_translation),u_ratio:new f.br(m,t.u_ratio),u_device_pixel_ratio:new f.br(m,t.u_device_pixel_ratio),u_units_to_pixels:new f.c4(m,t.u_units_to_pixels)}),lineGradient:(m,t)=>({u_translation:new f.c4(m,t.u_translation),u_ratio:new f.br(m,t.u_ratio),u_device_pixel_ratio:new f.br(m,t.u_device_pixel_ratio),u_units_to_pixels:new f.c4(m,t.u_units_to_pixels),u_image:new f.b$(m,t.u_image),u_image_height:new f.br(m,t.u_image_height)}),linePattern:(m,t)=>({u_translation:new f.c4(m,t.u_translation),u_texsize:new f.c4(m,t.u_texsize),u_ratio:new f.br(m,t.u_ratio),u_device_pixel_ratio:new f.br(m,t.u_device_pixel_ratio),u_image:new f.b$(m,t.u_image),u_units_to_pixels:new f.c4(m,t.u_units_to_pixels),u_scale:new f.c3(m,t.u_scale),u_fade:new f.br(m,t.u_fade)}),lineSDF:(m,t)=>({u_translation:new f.c4(m,t.u_translation),u_ratio:new f.br(m,t.u_ratio),u_device_pixel_ratio:new f.br(m,t.u_device_pixel_ratio),u_units_to_pixels:new f.c4(m,t.u_units_to_pixels),u_image:new f.b$(m,t.u_image),u_mix:new f.br(m,t.u_mix),u_tileratio:new f.br(m,t.u_tileratio),u_crossfade_from:new f.br(m,t.u_crossfade_from),u_crossfade_to:new f.br(m,t.u_crossfade_to),u_lineatlas_width:new f.br(m,t.u_lineatlas_width),u_lineatlas_height:new f.br(m,t.u_lineatlas_height)}),lineGradientSDF:(m,t)=>({u_translation:new f.c4(m,t.u_translation),u_ratio:new f.br(m,t.u_ratio),u_device_pixel_ratio:new f.br(m,t.u_device_pixel_ratio),u_units_to_pixels:new f.c4(m,t.u_units_to_pixels),u_image:new f.b$(m,t.u_image),u_image_height:new f.br(m,t.u_image_height),u_tileratio:new f.br(m,t.u_tileratio),u_crossfade_from:new f.br(m,t.u_crossfade_from),u_crossfade_to:new f.br(m,t.u_crossfade_to),u_image_dash:new f.b$(m,t.u_image_dash),u_mix:new f.br(m,t.u_mix),u_lineatlas_width:new f.br(m,t.u_lineatlas_width),u_lineatlas_height:new f.br(m,t.u_lineatlas_height)}),raster:(m,t)=>({u_tl_parent:new f.c4(m,t.u_tl_parent),u_scale_parent:new f.br(m,t.u_scale_parent),u_buffer_scale:new f.br(m,t.u_buffer_scale),u_fade_t:new f.br(m,t.u_fade_t),u_opacity:new f.br(m,t.u_opacity),u_image0:new f.b$(m,t.u_image0),u_image1:new f.b$(m,t.u_image1),u_brightness_low:new f.br(m,t.u_brightness_low),u_brightness_high:new f.br(m,t.u_brightness_high),u_saturation_factor:new f.br(m,t.u_saturation_factor),u_contrast_factor:new f.br(m,t.u_contrast_factor),u_spin_weights:new f.c3(m,t.u_spin_weights),u_coords_top:new f.c2(m,t.u_coords_top),u_coords_bottom:new f.c2(m,t.u_coords_bottom)}),symbolIcon:(m,t)=>({u_is_size_zoom_constant:new f.b$(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new f.b$(m,t.u_is_size_feature_constant),u_size_t:new f.br(m,t.u_size_t),u_size:new f.br(m,t.u_size),u_camera_to_center_distance:new f.br(m,t.u_camera_to_center_distance),u_pitch:new f.br(m,t.u_pitch),u_rotate_symbol:new f.b$(m,t.u_rotate_symbol),u_aspect_ratio:new f.br(m,t.u_aspect_ratio),u_fade_change:new f.br(m,t.u_fade_change),u_label_plane_matrix:new f.c1(m,t.u_label_plane_matrix),u_coord_matrix:new f.c1(m,t.u_coord_matrix),u_is_text:new f.b$(m,t.u_is_text),u_pitch_with_map:new f.b$(m,t.u_pitch_with_map),u_is_along_line:new f.b$(m,t.u_is_along_line),u_is_variable_anchor:new f.b$(m,t.u_is_variable_anchor),u_texsize:new f.c4(m,t.u_texsize),u_texture:new f.b$(m,t.u_texture),u_translation:new f.c4(m,t.u_translation),u_pitched_scale:new f.br(m,t.u_pitched_scale)}),symbolSDF:(m,t)=>({u_is_size_zoom_constant:new f.b$(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new f.b$(m,t.u_is_size_feature_constant),u_size_t:new f.br(m,t.u_size_t),u_size:new f.br(m,t.u_size),u_camera_to_center_distance:new f.br(m,t.u_camera_to_center_distance),u_pitch:new f.br(m,t.u_pitch),u_rotate_symbol:new f.b$(m,t.u_rotate_symbol),u_aspect_ratio:new f.br(m,t.u_aspect_ratio),u_fade_change:new f.br(m,t.u_fade_change),u_label_plane_matrix:new f.c1(m,t.u_label_plane_matrix),u_coord_matrix:new f.c1(m,t.u_coord_matrix),u_is_text:new f.b$(m,t.u_is_text),u_pitch_with_map:new f.b$(m,t.u_pitch_with_map),u_is_along_line:new f.b$(m,t.u_is_along_line),u_is_variable_anchor:new f.b$(m,t.u_is_variable_anchor),u_texsize:new f.c4(m,t.u_texsize),u_texture:new f.b$(m,t.u_texture),u_gamma_scale:new f.br(m,t.u_gamma_scale),u_device_pixel_ratio:new f.br(m,t.u_device_pixel_ratio),u_is_halo:new f.b$(m,t.u_is_halo),u_translation:new f.c4(m,t.u_translation),u_pitched_scale:new f.br(m,t.u_pitched_scale)}),symbolTextAndIcon:(m,t)=>({u_is_size_zoom_constant:new f.b$(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new f.b$(m,t.u_is_size_feature_constant),u_size_t:new f.br(m,t.u_size_t),u_size:new f.br(m,t.u_size),u_camera_to_center_distance:new f.br(m,t.u_camera_to_center_distance),u_pitch:new f.br(m,t.u_pitch),u_rotate_symbol:new f.b$(m,t.u_rotate_symbol),u_aspect_ratio:new f.br(m,t.u_aspect_ratio),u_fade_change:new f.br(m,t.u_fade_change),u_label_plane_matrix:new f.c1(m,t.u_label_plane_matrix),u_coord_matrix:new f.c1(m,t.u_coord_matrix),u_is_text:new f.b$(m,t.u_is_text),u_pitch_with_map:new f.b$(m,t.u_pitch_with_map),u_is_along_line:new f.b$(m,t.u_is_along_line),u_is_variable_anchor:new f.b$(m,t.u_is_variable_anchor),u_texsize:new f.c4(m,t.u_texsize),u_texsize_icon:new f.c4(m,t.u_texsize_icon),u_texture:new f.b$(m,t.u_texture),u_texture_icon:new f.b$(m,t.u_texture_icon),u_gamma_scale:new f.br(m,t.u_gamma_scale),u_device_pixel_ratio:new f.br(m,t.u_device_pixel_ratio),u_is_halo:new f.b$(m,t.u_is_halo),u_translation:new f.c4(m,t.u_translation),u_pitched_scale:new f.br(m,t.u_pitched_scale)}),background:(m,t)=>({u_opacity:new f.br(m,t.u_opacity),u_color:new f.c0(m,t.u_color)}),backgroundPattern:(m,t)=>({u_opacity:new f.br(m,t.u_opacity),u_image:new f.b$(m,t.u_image),u_pattern_tl_a:new f.c4(m,t.u_pattern_tl_a),u_pattern_br_a:new f.c4(m,t.u_pattern_br_a),u_pattern_tl_b:new f.c4(m,t.u_pattern_tl_b),u_pattern_br_b:new f.c4(m,t.u_pattern_br_b),u_texsize:new f.c4(m,t.u_texsize),u_mix:new f.br(m,t.u_mix),u_pattern_size_a:new f.c4(m,t.u_pattern_size_a),u_pattern_size_b:new f.c4(m,t.u_pattern_size_b),u_scale_a:new f.br(m,t.u_scale_a),u_scale_b:new f.br(m,t.u_scale_b),u_pixel_coord_upper:new f.c4(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new f.c4(m,t.u_pixel_coord_lower),u_tile_units_to_pixels:new f.br(m,t.u_tile_units_to_pixels)}),terrain:(m,t)=>({u_texture:new f.b$(m,t.u_texture),u_ele_delta:new f.br(m,t.u_ele_delta),u_fog_matrix:new f.c1(m,t.u_fog_matrix),u_fog_color:new f.c0(m,t.u_fog_color),u_fog_ground_blend:new f.br(m,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new f.br(m,t.u_fog_ground_blend_opacity),u_horizon_color:new f.c0(m,t.u_horizon_color),u_horizon_fog_blend:new f.br(m,t.u_horizon_fog_blend),u_is_globe_mode:new f.br(m,t.u_is_globe_mode)}),terrainDepth:(m,t)=>({u_ele_delta:new f.br(m,t.u_ele_delta)}),terrainCoords:(m,t)=>({u_texture:new f.b$(m,t.u_texture),u_terrain_coords_id:new f.br(m,t.u_terrain_coords_id),u_ele_delta:new f.br(m,t.u_ele_delta)}),projectionErrorMeasurement:(m,t)=>({u_input:new f.br(m,t.u_input),u_output_expected:new f.br(m,t.u_output_expected)}),atmosphere:(m,t)=>({u_sun_pos:new f.c3(m,t.u_sun_pos),u_atmosphere_blend:new f.br(m,t.u_atmosphere_blend),u_globe_position:new f.c3(m,t.u_globe_position),u_globe_radius:new f.br(m,t.u_globe_radius),u_inv_proj_matrix:new f.c1(m,t.u_inv_proj_matrix)}),sky:(m,t)=>({u_sky_color:new f.c0(m,t.u_sky_color),u_horizon_color:new f.c0(m,t.u_horizon_color),u_horizon:new f.c4(m,t.u_horizon),u_horizon_normal:new f.c4(m,t.u_horizon_normal),u_sky_horizon_blend:new f.br(m,t.u_sky_horizon_blend),u_sky_blend:new f.br(m,t.u_sky_blend)})};class ko{constructor(t,a,l){this.context=t;const h=t.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Fo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class wh{constructor(t,a,l,h){this.length=a.length,this.attributes=l,this.itemSize=a.bytesPerElement,this.dynamicDraw=h,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let l=0;l<this.attributes.length;l++){const h=a.attributes[this.attributes[l].name];h!==void 0&&t.enableVertexAttribArray(h)}}setVertexAttribPointers(t,a,l){for(let h=0;h<this.attributes.length;h++){const _=this.attributes[h],v=a.attributes[_.name];v!==void 0&&t.vertexAttribPointer(v,_.components,t[Fo[_.type]],!1,this.itemSize,_.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class si{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ts extends si{getDefault(){return f.bq.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Cu extends si{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class zu extends si{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class xc extends si{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class No extends si{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Du extends si{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Il extends si{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ta extends si{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Th extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class bc extends si{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ia extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class is extends si{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Mr extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class ws extends si{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Vo extends si{getDefault(){return f.bq.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class jo extends si{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Pu extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class ao extends si{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ba extends si{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Sh extends si{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Rl extends si{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Vt extends si{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class wc extends si{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class na extends si{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Tc extends si{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ra extends si{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Nf extends si{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Sc extends si{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const l=this.gl;ya(l)?l.bindVertexArray(t):(a=l.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class so extends si{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Mh extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Mc extends si{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class oo extends si{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Iu extends oo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Er extends oo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class lo extends oo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const uo="Framebuffer is not complete";class Uo{constructor(t,a,l,h,_){this.context=t,this.width=a,this.height=l;const v=t.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new Iu(t,w),h)this.depthAttachment=_?new lo(t,w):new Er(t,w);else if(_)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error(uo)}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class co{constructor(t){var a,l;if(this.gl=t,this.clearColor=new ts(this),this.clearDepth=new Cu(this),this.clearStencil=new zu(this),this.colorMask=new xc(this),this.depthMask=new No(this),this.stencilMask=new Du(this),this.stencilFunc=new Il(this),this.stencilOp=new ta(this),this.stencilTest=new Th(this),this.depthRange=new bc(this),this.depthTest=new ia(this),this.depthFunc=new is(this),this.blend=new Mr(this),this.blendFunc=new ws(this),this.blendColor=new Vo(this),this.blendEquation=new jo(this),this.cullFace=new Pu(this),this.cullFaceSide=new ao(this),this.frontFace=new ba(this),this.program=new Sh(this),this.activeTexture=new Rl(this),this.viewport=new Vt(this),this.bindFramebuffer=new wc(this),this.bindRenderbuffer=new na(this),this.bindTexture=new Tc(this),this.bindVertexBuffer=new ra(this),this.bindElementBuffer=new Nf(this),this.bindVertexArray=new Sc(this),this.pixelStoreUnpack=new so(this),this.pixelStoreUnpackPremultiplyAlpha=new Mh(this),this.pixelStoreUnpackFlipY=new Mc(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),ya(t)){this.HALF_FLOAT=t.HALF_FLOAT;const h=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:h?.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:h?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const h=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=h?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new ko(this,t,a)}createVertexBuffer(t,a,l){return new wh(this,t,a,l)}createRenderbuffer(t,a,l){const h=this.gl,_=h.createRenderbuffer();return this.bindRenderbuffer.set(_),h.renderbufferStorage(h.RENDERBUFFER,t,a,l),this.bindRenderbuffer.set(null),_}createFramebuffer(t,a,l,h){return new Uo(this,t,a,l,h)}clear({color:t,depth:a,stencil:l}){const h=this.gl;let _=0;t&&(_|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(_|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),l!==void 0&&(_|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){f.bS(t.blendFunction,_i.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return ya(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return ya(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let qn;function Zn(m,t,a,l,h){const _=m.context,v=m.transform,w=_.gl,S=m.useProgram("collisionBox"),A=[];let z=0,R=0;for(let Y=0;Y<l.length;Y++){const W=l[Y],ie=t.getTile(W).getBucket(a);if(!ie)continue;const K=h?ie.textCollisionBox:ie.iconCollisionBox,re=ie.collisionCircleArray;re.length>0&&(A.push({circleArray:re,circleOffset:R,coord:W}),z+=re.length/4,R=z),K&&S.draw(_,w.LINES,Bt.disabled,ti.disabled,m.colorModeForRenderPass(),jt.disabled,io(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(W),v.getProjectionData({overscaledTileID:W,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,null,m.transform.zoom,null,null,K.collisionVertexBuffer)}if(!h||!A.length)return;const I=m.useProgram("collisionCircle"),F=new f.cb;F.resize(4*z),F._trim();let U=0;for(const Y of A)for(let W=0;W<Y.circleArray.length/4;W++){const ie=4*W,K=Y.circleArray[ie+0],re=Y.circleArray[ie+1],se=Y.circleArray[ie+2],ee=Y.circleArray[ie+3];F.emplace(U++,K,re,se,ee,0),F.emplace(U++,K,re,se,ee,1),F.emplace(U++,K,re,se,ee,2),F.emplace(U++,K,re,se,ee,3)}(!qn||qn.length<2*z)&&(qn=(function(Y){const W=2*Y,ie=new f.cd;ie.resize(W),ie._trim();for(let K=0;K<W;K++){const re=6*K;ie.uint16[re+0]=4*K+0,ie.uint16[re+1]=4*K+1,ie.uint16[re+2]=4*K+2,ie.uint16[re+3]=4*K+2,ie.uint16[re+4]=4*K+3,ie.uint16[re+5]=4*K+0}return ie})(z));const X=_.createIndexBuffer(qn,!0),Q=_.createVertexBuffer(F,f.cc.members,!0);for(const Y of A){const W=vh(m.transform);I.draw(_,w.TRIANGLES,Bt.disabled,ti.disabled,m.colorModeForRenderPass(),jt.disabled,W,m.style.map.terrain&&m.style.map.terrain.getTerrainData(Y.coord),null,a.id,Q,X,f.aY.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,m.transform.zoom,null,null,null)}Q.destroy(),X.destroy()}const ns=f.as(new Float32Array(16));function rs(m,t,a,l,h,_){const{horizontalAlign:v,verticalAlign:w}=f.aT(m);return new f.P((-(v-.5)*t/h+l[0])*_,(-(w-.5)*a/h+l[1])*_)}function Fr(m,t,a,l,h,_){const v=t.tileAnchorPoint.add(new f.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let w=l.mult(_);a||(w=w.rotate(-h));const S=v.add(w);return Rt(S.x,S.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(a){const w=ei(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(m),S=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return m.add(l.rotate(S))}return m.add(l)}function Ts(m,t,a,l,h,_,v,w,S,A,z,R){const I=m.text.placedSymbolArray,F=m.text.dynamicLayoutVertexArray,U=m.icon.dynamicLayoutVertexArray,X={};F.clear();for(let Q=0;Q<I.length;Q++){const Y=I.get(Q),W=Y.hidden||!Y.crossTileID||m.allowVerticalPlacement&&!Y.placedOrientation?null:l[Y.crossTileID];if(W){const ie=new f.P(Y.anchorX,Y.anchorY),K={getElevation:R,width:h.width,height:h.height,pitchedLabelPlaneMatrix:_,pitchWithMap:a,transform:h,tileAnchorPoint:ie,translation:A,unwrappedTileID:z},re=a?xl(ie.x,ie.y,K):ei(ie.x,ie.y,K),se=Ao(h.cameraToCenterDistance,re.signedDistanceFromCamera);let ee=f.aB(m.textSizeData,w,Y)*se/f.aN;a&&(ee*=m.tilePixelRatio/v);const{width:fe,height:Me,anchor:xe,textOffset:Ee,textBoxScale:Ce}=W,He=rs(xe,fe,Me,Ee,Ce,ee),Je=h.getPitchedTextCorrection(ie.x+A[0],ie.y+A[1],z),qe=Fr(re.point,K,t,He,-h.bearingInRadians,Je),ft=m.allowVerticalPlacement&&Y.placedOrientation===f.aA.vertical?Math.PI/2:0;for(let Pt=0;Pt<Y.numGlyphs;Pt++)f.aH(F,qe,ft);S&&Y.associatedIconIndex>=0&&(X[Y.associatedIconIndex]={shiftedAnchor:qe,angle:ft})}else Ka(Y.numGlyphs,F)}if(S){U.clear();const Q=m.icon.placedSymbolArray;for(let Y=0;Y<Q.length;Y++){const W=Q.get(Y);if(W.hidden)Ka(W.numGlyphs,U);else{const ie=X[Y];if(ie)for(let K=0;K<W.numGlyphs;K++)f.aH(U,ie.shiftedAnchor,ie.angle);else Ka(W.numGlyphs,U)}}m.icon.dynamicLayoutVertexBuffer.updateData(U)}m.text.dynamicLayoutVertexBuffer.updateData(F)}function Eh(m,t,a){return a.iconsInText&&t?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Go(m,t,a,l,h,_,v,w,S,A,z,R,I){const F=m.context,U=F.gl,X=m.transform,Q=w==="map",Y=S==="map",W=w!=="viewport"&&a.layout.get("symbol-placement")!=="point",ie=Q&&!Y&&!W,K=!a.layout.get("symbol-sort-key").isConstant();let re=!1;const se=m.getDepthModeForSublayer(0,Bt.ReadOnly),ee=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),fe=[],Me=X.getCircleRadiusCorrection();for(const xe of l){const Ee=t.getTile(xe),Ce=Ee.getBucket(a);if(!Ce)continue;const He=h?Ce.text:Ce.icon;if(!He||!He.segments.get().length||!He.hasVisibleVertices)continue;const Je=He.programConfigurations.get(a.id),qe=h||Ce.sdfIcons,ft=h?Ce.textSizeData:Ce.iconSizeData,Pt=Y||X.pitch!==0,li=m.useProgram(Eh(qe,h,Ce),Je),zi=f.az(ft,X.zoom),fi=m.style.map.terrain&&m.style.map.terrain.getTerrainData(xe);let Bi,yi,Mn,Li,En=[0,0],Qi=null;if(h)yi=Ee.glyphAtlasTexture,Mn=U.LINEAR,Bi=Ee.glyphAtlasTexture.size,Ce.iconsInText&&(En=Ee.imageAtlasTexture.size,Qi=Ee.imageAtlasTexture,Li=Pt||m.options.rotating||m.options.zooming||ft.kind==="composite"||ft.kind==="camera"?U.LINEAR:U.NEAREST);else{const Wi=a.layout.get("icon-size").constantOr(0)!==1||Ce.iconsNeedLinear;yi=Ee.imageAtlasTexture,Mn=qe||m.options.rotating||m.options.zooming||Wi||Pt?U.LINEAR:U.NEAREST,Bi=Ee.imageAtlasTexture.size}const sn=f.aO(Ee,1,m.transform.zoom),Xn=Kr(Q,m.transform,sn),ar=f.N();f.aC(ar,Xn);const Na=lc(Y,Q,m.transform,sn),ks=f.aP(X,Ee,_,v),Qo=X.getProjectionData({overscaledTileID:xe,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),Oc=ee&&Ce.hasTextData(),Wo=a.layout.get("icon-text-fit")!=="none"&&Oc&&Ce.hasIconData();if(W){const Wi=m.style.map.terrain?(Pr,ji)=>m.style.map.terrain.getElevation(xe,Pr,ji):null,Cn=a.layout.get("text-rotation-alignment")==="map";vs(Ce,m,h,Xn,ar,Y,A,Cn,xe.toUnwrapped(),X.width,X.height,ks,Wi)}const Ur=h&&ee||Wo,An=W||Ur?ns:Y?Xn:m.transform.clipSpaceToPixelsMatrix,Vn=qe&&a.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Yn;Yn=qe?Ce.iconsInText?xa(ft.kind,zi,ie,Y,W,Ur,m,An,Na,ks,Bi,En,Me):yc(ft.kind,zi,ie,Y,W,Ur,m,An,Na,ks,h,Bi,0,Me):Mu(ft.kind,zi,ie,Y,W,Ur,m,An,Na,ks,h,Bi,Me);const ua={program:li,buffers:He,uniformValues:Yn,projectionData:Qo,atlasTexture:yi,atlasTextureIcon:Qi,atlasInterpolation:Mn,atlasInterpolationIcon:Li,isSDF:qe,hasHalo:Vn};if(K&&Ce.canOverlap){re=!0;const Wi=He.segments.get();for(const Cn of Wi)fe.push({segments:new f.aY([Cn]),sortKey:Cn.sortKey,state:ua,terrainData:fi})}else fe.push({segments:He.segments,sortKey:0,state:ua,terrainData:fi})}re&&fe.sort(((xe,Ee)=>xe.sortKey-Ee.sortKey));for(const xe of fe){const Ee=xe.state;if(F.activeTexture.set(U.TEXTURE0),Ee.atlasTexture.bind(Ee.atlasInterpolation,U.CLAMP_TO_EDGE),Ee.atlasTextureIcon&&(F.activeTexture.set(U.TEXTURE1),Ee.atlasTextureIcon&&Ee.atlasTextureIcon.bind(Ee.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),Ee.isSDF){const Ce=Ee.uniformValues;Ee.hasHalo&&(Ce.u_is_halo=1,Ll(Ee.buffers,xe.segments,a,m,Ee.program,se,z,R,Ce,Ee.projectionData,xe.terrainData)),Ce.u_is_halo=0}Ll(Ee.buffers,xe.segments,a,m,Ee.program,se,z,R,Ee.uniformValues,Ee.projectionData,xe.terrainData)}}function Ll(m,t,a,l,h,_,v,w,S,A,z){const R=l.context;h.draw(R,R.gl.TRIANGLES,_,v,w,jt.backCCW,S,z,A,a.id,m.layoutVertexBuffer,m.indexBuffer,t,a.paint,l.transform.zoom,m.programConfigurations.get(a.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Ah(m,t,a,l,h){const _=m.context,v=_.gl,w=ti.disabled,S=new _i([v.ONE,v.ONE],f.bq.transparent,[!0,!0,!0,!0]),A=t.getBucket(a);if(!A)return;const z=l.key;let R=a.heatmapFbos.get(z);R||(R=Ai(_,t.tileSize,t.tileSize),a.heatmapFbos.set(z,R)),_.bindFramebuffer.set(R.framebuffer),_.viewport.set([0,0,t.tileSize,t.tileSize]),_.clear({color:f.bq.transparent});const I=A.programConfigurations.get(a.id),F=m.useProgram("heatmap",I,!h),U=m.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),X=m.style.map.terrain.getTerrainData(l);F.draw(_,v.TRIANGLES,Bt.disabled,w,S,jt.disabled,no(t,m.transform.zoom,a.paint.get("heatmap-intensity"),1),X,U,a.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,a.paint,m.transform.zoom,I)}function Hn(m,t,a,l,h){const _=m.context,v=_.gl,w=m.transform;_.setColorMode(m.colorModeForRenderPass());const S=Xt(_,t),A=a.key,z=t.heatmapFbos.get(A);if(!z)return;_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,z.colorAttachment.get()),_.activeTexture.set(v.TEXTURE1),S.bind(v.LINEAR,v.CLAMP_TO_EDGE);const R=w.getProjectionData({overscaledTileID:a,applyTerrainMatrix:h,applyGlobeMatrix:!l});m.useProgram("heatmapTexture").draw(_,v.TRIANGLES,Bt.disabled,ti.disabled,m.colorModeForRenderPass(),jt.disabled,xh(m,t,0,1),null,R,t.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,t.paint,w.zoom),z.destroy(),t.heatmapFbos.delete(A)}function Ai(m,t,a){var l,h;const _=m.gl,v=_.createTexture();_.bindTexture(_.TEXTURE_2D,v),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR);const w=(l=m.HALF_FLOAT)!==null&&l!==void 0?l:_.UNSIGNED_BYTE,S=(h=m.RGBA16F)!==null&&h!==void 0?h:_.RGBA;_.texImage2D(_.TEXTURE_2D,0,S,t,a,0,_.RGBA,w,null);const A=m.createFramebuffer(t,a,!1,!1);return A.colorAttachment.set(v),A}function Xt(m,t){return t.colorRampTexture||(t.colorRampTexture=new f.T(m,t.colorRamp,m.gl.RGBA)),t.colorRampTexture}function Ss(m,t,a,l,h,_,v,w){let S=256;if(h.stepInterpolant){const A=t.getSource().maxzoom,z=v.canonical.z===A?Math.ceil(1<<m.transform.maxZoom-v.canonical.z):1;S=f.ao(f.cf(_.maxLineLength/f.a5*1024*z),256,a.maxTextureSize)}return w.gradient=f.cg({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:S,image:w.gradient||void 0,clips:_.lineClipsArray}),w.texture?w.texture.update(w.gradient):w.texture=new f.T(a,w.gradient,l.RGBA),w.version=h.gradientVersion,w.texture}function aa(m,t,a,l,h){m.activeTexture.set(t.TEXTURE0),a.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),l.updatePaintBuffers(h)}function Hi(m,t,a,l,h,_){(h||m.lineAtlas.dirty)&&(t.activeTexture.set(a.TEXTURE0),m.lineAtlas.bind(t)),l.updatePaintBuffers(_)}function Nr(m,t,a,l,h,_,v){const w=_.gradients[h.id];let S=w.texture;h.gradientVersion!==w.version&&(S=Ss(m,t,a,l,h,_,v,w)),a.activeTexture.set(l.TEXTURE0),S.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE)}function sa(m,t,a,l,h,_,v,w,S){const A=_.gradients[h.id];let z=A.texture;h.gradientVersion!==A.version&&(z=Ss(m,t,a,l,h,_,v,A)),a.activeTexture.set(l.TEXTURE0),z.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE),a.activeTexture.set(l.TEXTURE1),m.lineAtlas.bind(a),w.updatePaintBuffers(S)}function Ru(m,t,a,l,h){if(!a||!l||!l.imageAtlas)return;const _=l.imageAtlas.patternPositions;let v=_[a.to.toString()],w=_[a.from.toString()];if(!v&&w&&(v=w),!w&&v&&(w=v),!v||!w){const S=h.getPaintProperty(t);v=_[S],w=_[S]}v&&w&&m.setConstantPatternPositions(v,w)}function as(m,t,a,l,h,_,v,w){const S=m.context.gl,A="fill-pattern",z=a.paint.get(A),R=z&&z.constantOr(1),I=a.getCrossfadeParameters();let F,U,X,Q,Y;const W=m.transform,ie=a.paint.get("fill-translate"),K=a.paint.get("fill-translate-anchor");v?(U=R&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=S.LINES):(U=R?"fillPattern":"fill",F=S.TRIANGLES);const re=z.constantOr(null);for(const se of l){const ee=t.getTile(se);if(R&&!ee.patternsLoaded())continue;const fe=ee.getBucket(a);if(!fe)continue;const Me=fe.programConfigurations.get(a.id),xe=m.useProgram(U,Me),Ee=m.style.map.terrain&&m.style.map.terrain.getTerrainData(se);R&&(m.context.activeTexture.set(S.TEXTURE0),ee.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Me.updatePaintBuffers(I)),Ru(Me,A,re,ee,a);const Ce=W.getProjectionData({overscaledTileID:se,applyGlobeMatrix:!w,applyTerrainMatrix:!0}),He=f.aP(W,ee,ie,K);if(v){Q=fe.indexBuffer2,Y=fe.segments2;const qe=[S.drawingBufferWidth,S.drawingBufferHeight];X=U==="fillOutlinePattern"&&R?Lf(m,I,ee,qe,He):Pl(qe,He)}else Q=fe.indexBuffer,Y=fe.segments,X=R?Bo(m,I,ee,He):{u_fill_translate:He};const Je=m.stencilModeForClipping(se);xe.draw(m.context,F,h,Je,_,jt.backCCW,X,Ee,Ce,a.id,fe.layoutVertexBuffer,Q,Y,a.paint,m.transform.zoom,Me)}}function ss(m,t,a,l,h,_,v,w){const S=m.context,A=S.gl,z="fill-extrusion-pattern",R=a.paint.get(z),I=R.constantOr(1),F=a.getCrossfadeParameters(),U=a.paint.get("fill-extrusion-opacity"),X=R.constantOr(null),Q=m.transform;for(const Y of l){const W=t.getTile(Y),ie=W.getBucket(a);if(!ie)continue;const K=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Y),re=ie.programConfigurations.get(a.id),se=m.useProgram(I?"fillExtrusionPattern":"fillExtrusion",re);I&&(m.context.activeTexture.set(A.TEXTURE0),W.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),re.updatePaintBuffers(F));const ee=Q.getProjectionData({overscaledTileID:Y,applyGlobeMatrix:!w,applyTerrainMatrix:!0});Ru(re,z,X,W,a);const fe=f.aP(Q,W,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Me=a.paint.get("fill-extrusion-vertical-gradient"),xe=I?mc(m,Me,U,fe,Y,F,W):pc(m,Me,U,fe);se.draw(S,S.gl.TRIANGLES,h,_,v,jt.backCCW,xe,K,ee,a.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,a.paint,m.transform.zoom,re,m.style.map.terrain&&ie.centroidVertexBuffer)}}function os(m,t,a,l,h,_,v,w,S){var A;const z=m.style.projection,R=m.context,I=m.transform,F=R.gl,U=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],X=m.useProgram("hillshade",null,!1,U),Q=!m.options.moving;for(const Y of l){const W=t.getTile(Y),ie=W.fbo;if(!ie)continue;const K=z.getMeshFromTileID(R,Y.canonical,w,!0,"raster"),re=(A=m.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(Y);R.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,ie.colorAttachment.get());const se=I.getProjectionData({overscaledTileID:Y,aligned:Q,applyGlobeMatrix:!S,applyTerrainMatrix:!0});X.draw(R,F.TRIANGLES,_,h[Y.overscaledZ],v,jt.backCCW,wu(m,W,a),re,se,a.id,K.vertexBuffer,K.indexBuffer,K.segments)}}function Ms(m,t,a,l,h,_,v,w,S){var A;const z=m.style.projection,R=m.context,I=m.transform,F=R.gl,U=m.useProgram("colorRelief"),X=!m.options.moving;let Q=!0,Y=0;for(const W of l){const ie=t.getTile(W),K=ie.dem;if(Q){const xe=F.getParameter(F.MAX_TEXTURE_SIZE),{elevationTexture:Ee,colorTexture:Ce}=a.getColorRampTextures(R,xe,K.getUnpackVector());R.activeTexture.set(F.TEXTURE1),Ee.bind(F.NEAREST,F.CLAMP_TO_EDGE),R.activeTexture.set(F.TEXTURE4),Ce.bind(F.LINEAR,F.CLAMP_TO_EDGE),Q=!1,Y=Ee.size[0]}if(!K||!K.data)continue;const re=K.stride,se=K.getPixels();if(R.activeTexture.set(F.TEXTURE0),R.pixelStoreUnpackPremultiplyAlpha.set(!1),ie.demTexture=ie.demTexture||m.getTileTexture(re),ie.demTexture){const xe=ie.demTexture;xe.update(se,{premultiply:!1}),xe.bind(F.LINEAR,F.CLAMP_TO_EDGE)}else ie.demTexture=new f.T(R,se,F.RGBA,{premultiply:!1}),ie.demTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const ee=z.getMeshFromTileID(R,W.canonical,w,!0,"raster"),fe=(A=m.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(W),Me=I.getProjectionData({overscaledTileID:W,aligned:X,applyGlobeMatrix:!S,applyTerrainMatrix:!0});U.draw(R,F.TRIANGLES,_,h[W.overscaledZ],v,jt.backCCW,Bf(a,ie.dem,Y),fe,Me,a.id,ee.vertexBuffer,ee.indexBuffer,ee.segments)}}const Es=[new f.P(0,0),new f.P(f.a5,0),new f.P(f.a5,f.a5),new f.P(0,f.a5)];function wa(m,t,a,l,h,_,v,w,S=!1,A=!1){const z=l[l.length-1].overscaledZ,R=m.context,I=R.gl,F=m.useProgram("raster"),U=m.transform,X=m.style.projection,Q=m.colorModeForRenderPass(),Y=!m.options.moving,W=a.paint.get("raster-opacity"),ie=a.paint.get("raster-resampling"),K=a.paint.get("raster-fade-duration"),re=!!m.style.map.terrain;for(const se of l){const ee=m.getDepthModeForSublayer(se.overscaledZ-z,W===1?Bt.ReadWrite:Bt.ReadOnly,I.LESS),fe=t.getTile(se),Me=ie==="nearest"?I.NEAREST:I.LINEAR;R.activeTexture.set(I.TEXTURE0),fe.texture.bind(Me,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),R.activeTexture.set(I.TEXTURE1);const{parentTile:xe,parentScaleBy:Ee,parentTopLeft:Ce,fadeValues:He}=ls(fe,t,K,re);fe.fadeOpacity=He.tileOpacity,xe?(xe.fadeOpacity=He.parentTileOpacity,xe.texture.bind(Me,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST)):fe.texture.bind(Me,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),fe.texture.useMipmap&&R.extTextureFilterAnisotropic&&m.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const Je=m.style.map.terrain&&m.style.map.terrain.getTerrainData(se),qe=U.getProjectionData({overscaledTileID:se,aligned:Y,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),ft=gc(Ce,Ee,He.fadeMix,a,w),Pt=X.getMeshFromTileID(R,se.canonical,_,v,"raster");F.draw(R,I.TRIANGLES,ee,h?h[se.overscaledZ]:ti.disabled,Q,S?jt.frontCCW:jt.backCCW,ft,Je,qe,a.id,Pt.vertexBuffer,Pt.indexBuffer,Pt.segments)}}function ls(m,t,a,l){const h={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||l)return h;if(m.fadingParentID){const _=t.getLoadedTile(m.fadingParentID);if(!_)return h;const v=Math.pow(2,_.tileID.overscaledZ-m.tileID.overscaledZ),w=[m.tileID.canonical.x*v%1,m.tileID.canonical.y*v%1],S=(function(A,z,R){const I=Et(),F=(I-z.timeAdded)/R,U=A.fadingDirection===Se.Incoming,X=f.ao((I-A.timeAdded)/R,0,1),Q=f.ao(1-F,0,1),Y=U?X:Q;return{tileOpacity:Y,parentTileOpacity:U?Q:X,fadeMix:{opacity:1,mix:1-Y}}})(m,_,a);return{parentTile:_,parentScaleBy:v,parentTopLeft:w,fadeValues:S}}if(m.selfFading){const _=(function(v,w){const S=(Et()-v.timeAdded)/w,A=f.ao(S,0,1);return{tileOpacity:A,fadeMix:{opacity:A,mix:0}}})(m,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:_}}return h}const As=new f.bq(1,0,0,1),us=new f.bq(0,1,0,1),Ec=new f.bq(0,0,1,1),Ac=new f.bq(1,0,1,1),Ta=new f.bq(0,1,1,1);function Ol(m,t,a,l){xn(m,0,t+a/2,m.transform.width,a,l)}function Cs(m,t,a,l){xn(m,t-a/2,0,a,m.transform.height,l)}function xn(m,t,a,l,h,_){const v=m.context,w=v.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*m.pixelRatio,a*m.pixelRatio,l*m.pixelRatio,h*m.pixelRatio),v.clear({color:_}),w.disable(w.SCISSOR_TEST)}function Lu(m,t,a){const l=m.context,h=l.gl,_=m.useProgram("debug"),v=Bt.disabled,w=ti.disabled,S=m.colorModeForRenderPass(),A="$debug",z=m.style.map.terrain&&m.style.map.terrain.getTerrainData(a);l.activeTexture.set(h.TEXTURE0);const R=t.getTileByID(a.key).latestRawTileData,I=Math.floor((R&&R.byteLength||0)/1024),F=t.getTile(a).tileSize,U=512/Math.min(F,512)*(a.overscaledZ/m.transform.zoom)*.5;let X=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(X+=` => ${a.overscaledZ}`),(function(Y,W){Y.initDebugOverlayCanvas();const ie=Y.debugOverlayCanvas,K=Y.context.gl,re=Y.debugOverlayCanvas.getContext("2d");re.clearRect(0,0,ie.width,ie.height),re.shadowColor="white",re.shadowBlur=2,re.lineWidth=1.5,re.strokeStyle="white",re.textBaseline="top",re.font="bold 36px Open Sans, sans-serif",re.fillText(W,5,5),re.strokeText(W,5,5),Y.debugOverlayTexture.update(ie),Y.debugOverlayTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE)})(m,`${X} ${I}kB`);const Q=m.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(l,h.TRIANGLES,v,w,_i.alphaBlended,jt.disabled,bu(f.bq.transparent,U),null,Q,A,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),_.draw(l,h.LINE_STRIP,v,w,S,jt.disabled,bu(f.bq.red),z,Q,A,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Cc(m,t,a,l){const{isRenderingGlobe:h}=l,_=m.context,v=_.gl,w=m.transform,S=m.colorModeForRenderPass(),A=m.getDepthModeFor3D(),z=m.useProgram("terrain");_.bindFramebuffer.set(null),_.viewport.set([0,0,m.width,m.height]);for(const R of a){const I=t.getTerrainMesh(R.tileID),F=m.renderToTexture.getTexture(R),U=t.getTerrainData(R.tileID);_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,F.texture);const X=t.getMeshFrameDelta(w.zoom),Q=w.calculateFogMatrix(R.tileID.toUnwrapped()),Y=Pf(X,Q,m.style.sky,w.pitch,h),W=w.getProjectionData({overscaledTileID:R.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});z.draw(_,v.TRIANGLES,A,ti.disabled,S,jt.backCCW,Y,U,W,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}}function Ch(m,t){if(!t.mesh){const a=new f.aX;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const l=new f.aZ;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),t.mesh=new Ei(m.createVertexBuffer(a,_a.members),m.createIndexBuffer(l),f.aY.simpleSegment(0,0,a.length,l.length))}return t.mesh}class Vf{constructor(t,a){this.context=new co(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:f.as(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ii.maxOverzooming+Ii.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Fn}resize(t,a,l){if(this.width=Math.floor(t*l),this.height=Math.floor(a*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const t=this.context,a=new f.aX;a.emplaceBack(0,0),a.emplaceBack(f.a5,0),a.emplaceBack(0,f.a5),a.emplaceBack(f.a5,f.a5),this.tileExtentBuffer=t.createVertexBuffer(a,_a.members),this.tileExtentSegments=f.aY.simpleSegment(0,0,4,2);const l=new f.aX;l.emplaceBack(0,0),l.emplaceBack(f.a5,0),l.emplaceBack(0,f.a5),l.emplaceBack(f.a5,f.a5),this.debugBuffer=t.createVertexBuffer(l,_a.members),this.debugSegments=f.aY.simpleSegment(0,0,4,5);const h=new f.ci;h.emplaceBack(0,0,0,0),h.emplaceBack(f.a5,0,f.a5,0),h.emplaceBack(0,f.a5,0,f.a5),h.emplaceBack(f.a5,f.a5,f.a5,f.a5),this.rasterBoundsBuffer=t.createVertexBuffer(h,Df.members),this.rasterBoundsSegments=f.aY.simpleSegment(0,0,4,2);const _=new f.aX;_.emplaceBack(0,0),_.emplaceBack(f.a5,0),_.emplaceBack(0,f.a5),_.emplaceBack(f.a5,f.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(_,_a.members),this.rasterBoundsSegmentsPosOnly=f.aY.simpleSegment(0,0,4,5);const v=new f.aX;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(v,_a.members),this.viewportSegments=f.aY.simpleSegment(0,0,4,2);const w=new f.cj;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(w);const S=new f.aZ;S.emplaceBack(1,0,2),S.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S);const A=this.context.gl;this.stencilClearMode=new ti({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.tileExtentMesh=new Ei(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=f.N();f.c8(l,0,this.width,this.height,0,0,1),f.Q(l,l,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const h={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(t,a.TRIANGLES,Bt.disabled,this.stencilClearMode,_i.disabled,jt.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a,l){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source,this.nextStencilID+a.length>256&&this.clearStencil();const h=this.context;h.setColorMode(_i.disabled),h.setDepthMode(Bt.disabled);const _={};for(const v of a)_[v.key]=this.nextStencilID++;this._renderTileMasks(_,a,l,!0),this._renderTileMasks(_,a,l,!1),this._tileClippingMaskIDs=_}_renderTileMasks(t,a,l,h){const _=this.context,v=_.gl,w=this.style.projection,S=this.transform,A=this.useProgram("clippingMask");for(const z of a){const R=t[z.key],I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),F=w.getMeshFromTileID(this.context,z.canonical,h,!0,"stencil"),U=S.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!l,applyTerrainMatrix:!0});A.draw(_,v.TRIANGLES,Bt.disabled,new ti({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),_i.disabled,l?jt.disabled:jt.backCCW,null,I,U,"$clipping",F.vertexBuffer,F.indexBuffer,F.segments)}}_renderTilesDepthBuffer(){const t=this.context,a=t.gl,l=this.style.projection,h=this.transform,_=this.useProgram("depth"),v=this.getDepthModeFor3D(),w=hn(h,{tileSize:h.tileSize});for(const S of w){const A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S),z=l.getMeshFromTileID(this.context,S.canonical,!0,!0,"raster"),R=h.getProjectionData({overscaledTileID:S,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(t,a.TRIANGLES,v,ti.disabled,_i.disabled,jt.backCCW,null,A,R,"$clipping",z.vertexBuffer,z.indexBuffer,z.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new ti({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new ti({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const a=this.context.gl,l=t.sort(((v,w)=>w.overscaledZ-v.overscaledZ)),h=l[l.length-1].overscaledZ,_=l[0].overscaledZ-h+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const v={};for(let w=0;w<_;w++)v[w+h]=new ti({func:a.GEQUAL,mask:255},w+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=_,[v,l]}return[{[h]:ti.disabled},l]}stencilConfigForOverlapTwoPass(t){const a=this.context.gl,l=t.sort(((v,w)=>w.overscaledZ-v.overscaledZ)),h=l[l.length-1].overscaledZ,_=l[0].overscaledZ-h+1;if(this.clearStencil(),_>1){const v={},w={};for(let S=0;S<_;S++)v[S+h]=new ti({func:a.GREATER,mask:255},_+1+S,255,a.KEEP,a.KEEP,a.REPLACE),w[S+h]=new ti({func:a.GREATER,mask:255},1+S,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*_+1,[v,w,l]}return this.nextStencilID=3,[{[h]:new ti({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[h]:new ti({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new _i([t.CONSTANT_COLOR,t.ONE],new f.bq(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?_i.unblended:_i.alphaBlended}getDepthModeForSublayer(t,a,l){if(!this.opaquePassEnabledForLayer())return Bt.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Bt(l||this.context.gl.LEQUAL,a,[h,h])}getDepthModeFor3D(){return new Bt(this.context.gl.LEQUAL,Bt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){var l,h;this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(Et()),this.imageManager.beginFrame();const _=this.style._order,v=this.style.tileManagers,w={},S={},A={},z={isRenderingToTexture:!1,isRenderingGlobe:((l=t.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const I in v){const F=v[I];F.used&&F.prepare(this.context),w[I]=F.getVisibleCoordinates(!1),S[I]=w[I].slice().reverse(),A[I]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<_.length;I++)if(this.style._layers[_[I]].is3D()){this.opaquePassCutoff=I;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const I of _){const F=this.style._layers[I];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const U=S[F.source];(F.type==="custom"||U.length)&&this.renderLayer(this,v[F.source],F,U,z)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:I=>this.useProgram(I)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?f.bq.black:f.bq.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(I,F){const U=I.context,X=U.gl,Q=((se,ee,fe)=>{const Me=Math.cos(ee.rollInRadians),xe=Math.sin(ee.rollInRadians),Ee=ci(ee),Ce=ee.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:se.properties.get("sky-color"),u_horizon_color:se.properties.get("horizon-color"),u_horizon:[(ee.width/2-Ee*xe)*fe,(ee.height/2+Ee*Me)*fe],u_horizon_normal:[-xe,Me],u_sky_horizon_blend:se.properties.get("sky-horizon-blend")*ee.height/2*fe,u_sky_blend:Ce}})(F,I.style.map.transform,I.pixelRatio),Y=new Bt(X.LEQUAL,Bt.ReadWrite,[0,1]),W=ti.disabled,ie=I.colorModeForRenderPass(),K=I.useProgram("sky"),re=Ch(U,F);K.draw(U,X.TRIANGLES,Y,W,ie,jt.disabled,Q,null,void 0,"sky",re.vertexBuffer,re.indexBuffer,re.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[_[this.currentLayer]],F=v[I.source],U=w[I.source];this._renderTileClippingMasks(I,U,!1),this.renderLayer(this,F,I,U,z)}this.renderPass="translucent";let R=!1;for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const I=this.style._layers[_[this.currentLayer]],F=v[I.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(I,z))continue;this.opaquePassEnabledForLayer()||R||(R=!0,z.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const U=(I.type==="symbol"?A:S)[I.source];this._renderTileClippingMasks(I,w[I.source],!!this.renderToTexture),this.renderLayer(this,F,I,U,z)}if(z.isRenderingGlobe&&(function(I,F,U){const X=I.context,Q=X.gl,Y=I.useProgram("atmosphere"),W=new Bt(Q.LEQUAL,Bt.ReadOnly,[0,1]),ie=I.transform,K=(function(Ce,He){const Je=Ce.properties.get("position"),qe=[-Je.x,-Je.y,-Je.z],ft=f.as(new Float64Array(16));return Ce.properties.get("anchor")==="map"&&(f.bh(ft,ft,He.rollInRadians),f.bi(ft,ft,-He.pitchInRadians),f.bh(ft,ft,He.bearingInRadians),f.bi(ft,ft,He.center.lat*Math.PI/180),f.bK(ft,ft,-He.center.lng*Math.PI/180)),f.ch(qe,qe,ft),qe})(U,I.transform),re=ie.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),se=F.properties.get("atmosphere-blend")*re.projectionTransition;if(se===0)return;const ee=Oo(ie.worldSize,ie.center.lat),fe=ie.inverseProjectionMatrix,Me=new Float64Array(4);Me[3]=1,f.aI(Me,Me,ie.modelViewProjectionMatrix),Me[0]/=Me[3],Me[1]/=Me[3],Me[2]/=Me[3],Me[3]=1,f.aI(Me,Me,fe),Me[0]/=Me[3],Me[1]/=Me[3],Me[2]/=Me[3],Me[3]=1;const xe=((Ce,He,Je,qe,ft)=>({u_sun_pos:Ce,u_atmosphere_blend:He,u_globe_position:Je,u_globe_radius:qe,u_inv_proj_matrix:ft}))(K,se,[Me[0],Me[1],Me[2]],ee,fe),Ee=Ch(X,F);Y.draw(X,Q.TRIANGLES,W,ti.disabled,_i.alphaBlended,jt.disabled,xe,null,null,"atmosphere",Ee.vertexBuffer,Ee.indexBuffer,Ee.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const I=(function(F,U){let X=null;const Q=Object.values(F._layers).flatMap((K=>K.source&&!K.isHidden(U)?[F.tileManagers[K.source]]:[])),Y=Q.filter((K=>K.getSource().type==="vector")),W=Q.filter((K=>K.getSource().type!=="vector")),ie=K=>{(!X||X.getSource().maxzoom<K.getSource().maxzoom)&&(X=K)};return Y.forEach((K=>ie(K))),X||W.forEach((K=>ie(K))),X})(this.style,this.transform.zoom);I&&(function(F,U,X){for(let Q=0;Q<X.length;Q++)Lu(F,U,X[Q])})(this,I,I.getVisibleCoordinates())}this.options.showPadding&&(function(I){const F=I.transform.padding;Ol(I,I.transform.height-(F.top||0),3,As),Ol(I,F.bottom||0,3,us),Cs(I,F.left||0,3,Ec),Cs(I,I.transform.width-(F.right||0),3,Ac);const U=I.transform.centerPoint;(function(X,Q,Y,W){xn(X,Q-1,Y-10,2,20,W),xn(X,Q-10,Y-1,20,2,W)})(I,U.x,I.transform.height-U.y,Ta)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=t?!f.ck(a,l):!f.cl(a,l)),h||(h=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(f.cm(a,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(_,v){const w=_.context,S=w.gl,A=_.transform,z=_i.unblended,R=new Bt(S.LEQUAL,Bt.ReadWrite,[0,1]),I=v.tileManager.getRenderableTiles(),F=_.useProgram("terrainDepth");w.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),w.clear({color:f.bq.transparent,depth:1});for(const U of I){const X=v.getTerrainMesh(U.tileID),Q=v.getTerrainData(U.tileID),Y=A.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),W={u_ele_delta:v.getMeshFrameDelta(A.zoom)};F.draw(w,S.TRIANGLES,R,ti.disabled,z,jt.backCCW,W,Q,Y,"terrain",X.vertexBuffer,X.indexBuffer,X.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain),(function(_,v){const w=_.context,S=w.gl,A=_.transform,z=_i.unblended,R=new Bt(S.LEQUAL,Bt.ReadWrite,[0,1]),I=v.getCoordsTexture(),F=v.tileManager.getRenderableTiles(),U=_.useProgram("terrainCoords");w.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),w.clear({color:f.bq.transparent,depth:1}),v.coordsIndex=[];for(const X of F){const Q=v.getTerrainMesh(X.tileID),Y=v.getTerrainData(X.tileID);w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,I.texture);const W={u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(A.zoom)},ie=A.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(w,S.TRIANGLES,R,ti.disabled,z,jt.backCCW,W,Y,ie,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments),v.coordsIndex.push(X.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain))}renderLayer(t,a,l,h,_){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(h||[]).length)&&(this.id=l.id,f.cn(l)?(function(v,w,S,A,z,R){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:I}=R,F=ti.disabled,U=v.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(X,Q,Y,W,ie,K,re,se,ee){const fe=Q.transform,Me=Q.style.map.terrain,xe=ie==="map",Ee=K==="map";for(const Ce of X){const He=W.getTile(Ce),Je=He.getBucket(Y);if(!Je||!Je.text||!Je.text.segments.get().length)continue;const qe=f.az(Je.textSizeData,fe.zoom),ft=f.aO(He,1,Q.transform.zoom),Pt=Kr(xe,Q.transform,ft),li=Y.layout.get("icon-text-fit")!=="none"&&Je.hasIconData();if(qe){const zi=Math.pow(2,fe.zoom-He.tileID.overscaledZ),fi=Me?(Bi,yi)=>Me.getElevation(Ce,Bi,yi):null;Ts(Je,xe,Ee,ee,fe,Pt,zi,qe,li,f.aP(fe,He,re,se),Ce.toUnwrapped(),fi)}}})(A,v,S,w,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),z),S.paint.get("icon-opacity").constantOr(1)!==0&&Go(v,w,S,A,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),F,U,I),S.paint.get("text-opacity").constantOr(1)!==0&&Go(v,w,S,A,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),F,U,I),w.map.showCollisionBoxes&&(Zn(v,w,S,A,!0),Zn(v,w,S,A,!1))})(t,a,l,h,this.style.placement.variableOffsets,_):f.co(l)?(function(v,w,S,A,z){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,I=S.paint.get("circle-opacity"),F=S.paint.get("circle-stroke-width"),U=S.paint.get("circle-stroke-opacity"),X=!S.layout.get("circle-sort-key").isConstant();if(I.constantOr(1)===0&&(F.constantOr(1)===0||U.constantOr(1)===0))return;const Q=v.context,Y=Q.gl,W=v.transform,ie=v.getDepthModeForSublayer(0,Bt.ReadOnly),K=ti.disabled,re=v.colorModeForRenderPass(),se=[],ee=W.getCircleRadiusCorrection();for(let fe=0;fe<A.length;fe++){const Me=A[fe],xe=w.getTile(Me),Ee=xe.getBucket(S);if(!Ee)continue;const Ce=S.paint.get("circle-translate"),He=S.paint.get("circle-translate-anchor"),Je=f.aP(W,xe,Ce,He),qe=Ee.programConfigurations.get(S.id),ft=v.useProgram("circle",qe),Pt=Ee.layoutVertexBuffer,li=Ee.indexBuffer,zi=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Me),fi={programConfiguration:qe,program:ft,layoutVertexBuffer:Pt,indexBuffer:li,uniformValues:xu(v,xe,S,Je,ee),terrainData:zi,projectionData:W.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!R,applyTerrainMatrix:!0})};if(X){const Bi=Ee.segments.get();for(const yi of Bi)se.push({segments:new f.aY([yi]),sortKey:yi.sortKey,state:fi})}else se.push({segments:Ee.segments,sortKey:0,state:fi})}X&&se.sort(((fe,Me)=>fe.sortKey-Me.sortKey));for(const fe of se){const{programConfiguration:Me,program:xe,layoutVertexBuffer:Ee,indexBuffer:Ce,uniformValues:He,terrainData:Je,projectionData:qe}=fe.state;xe.draw(Q,Y.TRIANGLES,ie,K,re,jt.backCCW,He,Je,qe,S.id,Ee,Ce,fe.segments,S.paint,v.transform.zoom,Me)}})(t,a,l,h,_):f.cp(l)?(function(v,w,S,A,z){if(S.paint.get("heatmap-opacity")===0)return;const R=v.context,{isRenderingToTexture:I,isRenderingGlobe:F}=z;if(v.style.map.terrain){for(const U of A){const X=w.getTile(U);w.hasRenderableParent(U)||(v.renderPass==="offscreen"?Ah(v,X,S,U,F):v.renderPass==="translucent"&&Hn(v,S,U,I,F))}R.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?(function(U,X,Q,Y){const W=U.context,ie=W.gl,K=U.transform,re=ti.disabled,se=new _i([ie.ONE,ie.ONE],f.bq.transparent,[!0,!0,!0,!0]);(function(ee,fe,Me){const xe=ee.gl;ee.activeTexture.set(xe.TEXTURE1),ee.viewport.set([0,0,fe.width/4,fe.height/4]);let Ee=Me.heatmapFbos.get(f.ce);Ee?(xe.bindTexture(xe.TEXTURE_2D,Ee.colorAttachment.get()),ee.bindFramebuffer.set(Ee.framebuffer)):(Ee=Ai(ee,fe.width/4,fe.height/4),Me.heatmapFbos.set(f.ce,Ee))})(W,U,Q),W.clear({color:f.bq.transparent});for(let ee=0;ee<Y.length;ee++){const fe=Y[ee];if(X.hasRenderableParent(fe))continue;const Me=X.getTile(fe),xe=Me.getBucket(Q);if(!xe)continue;const Ee=xe.programConfigurations.get(Q.id),Ce=U.useProgram("heatmap",Ee),He=K.getProjectionData({overscaledTileID:fe,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Je=K.getCircleRadiusCorrection();Ce.draw(W,ie.TRIANGLES,Bt.disabled,re,se,jt.backCCW,no(Me,K.zoom,Q.paint.get("heatmap-intensity"),Je),null,He,Q.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,Q.paint,K.zoom,Ee)}W.viewport.set([0,0,U.width,U.height])})(v,w,S,A):v.renderPass==="translucent"&&(function(U,X){const Q=U.context,Y=Q.gl;Q.setColorMode(U.colorModeForRenderPass());const W=X.heatmapFbos.get(f.ce);W&&(Q.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,W.colorAttachment.get()),Q.activeTexture.set(Y.TEXTURE1),Xt(Q,X).bind(Y.LINEAR,Y.CLAMP_TO_EDGE),U.useProgram("heatmapTexture").draw(Q,Y.TRIANGLES,Bt.disabled,ti.disabled,U.colorModeForRenderPass(),jt.disabled,xh(U,X,0,1),null,null,X.id,U.viewportBuffer,U.quadTriangleIndexBuffer,U.viewportSegments,X.paint,U.transform.zoom))})(v,S)})(t,a,l,h,_):f.cq(l)?(function(v,w,S,A,z){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,I=S.paint.get("line-opacity"),F=S.paint.get("line-width");if(I.constantOr(1)===0||F.constantOr(1)===0)return;const U=v.getDepthModeForSublayer(0,Bt.ReadOnly),X=v.colorModeForRenderPass(),Q=S.paint.get("line-dasharray"),Y=Q.constantOr(1),W=S.paint.get("line-pattern"),ie=W.constantOr(1),K=S.paint.get("line-gradient"),re=S.getCrossfadeParameters();let se;se=ie?"linePattern":Y&&K?"lineGradientSDF":Y?"lineSDF":K?"lineGradient":"line";const ee=v.context,fe=ee.gl,Me=v.transform;let xe=!0;for(const Ee of A){const Ce=w.getTile(Ee);if(ie&&!Ce.patternsLoaded())continue;const He=Ce.getBucket(S);if(!He)continue;const Je=He.programConfigurations.get(S.id),qe=v.context.program.get(),ft=v.useProgram(se,Je),Pt=xe||ft.program!==qe,li=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ee),zi=W.constantOr(null),fi=Q&&Q.constantOr(null);if(zi&&Ce.imageAtlas){const En=Ce.imageAtlas,Qi=En.patternPositions[zi.to.toString()],sn=En.patternPositions[zi.from.toString()];Qi&&sn&&Je.setConstantPatternPositions(Qi,sn)}else if(fi){const En=S.layout.get("line-cap")==="round",Qi=v.lineAtlas.getDash(fi.to,En),sn=v.lineAtlas.getDash(fi.from,En);Je.setConstantDashPositions(Qi,sn)}const Bi=Me.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),yi=Me.getPixelScale();let Mn;ie?(Mn=bh(v,Ce,S,yi,re),aa(ee,fe,Ce,Je,re)):Y&&K?(Mn=ro(v,Ce,S,yi,re,He.lineClipsArray.length),sa(v,w,ee,fe,S,He,Ee,Je,re)):Y?(Mn=kr(v,Ce,S,yi,re),Hi(v,ee,fe,Je,Pt,re)):K?(Mn=kf(v,Ce,S,yi,He.lineClipsArray.length),Nr(v,w,ee,fe,S,He,Ee)):Mn=Tu(v,Ce,S,yi);const Li=v.stencilModeForClipping(Ee);ft.draw(ee,fe.TRIANGLES,U,Li,X,jt.disabled,Mn,li,Bi,S.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,S.paint,v.transform.zoom,Je,He.layoutVertexBuffer2),xe=!1}})(t,a,l,h,_):f.cr(l)?(function(v,w,S,A,z){const R=S.paint.get("fill-color"),I=S.paint.get("fill-opacity");if(I.constantOr(1)===0)return;const{isRenderingToTexture:F}=z,U=v.colorModeForRenderPass(),X=S.paint.get("fill-pattern"),Q=v.opaquePassEnabledForLayer()&&!X.constantOr(1)&&R.constantOr(f.bq.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===Q){const Y=v.getDepthModeForSublayer(1,v.renderPass==="opaque"?Bt.ReadWrite:Bt.ReadOnly);as(v,w,S,A,Y,U,!1,F)}if(v.renderPass==="translucent"&&S.paint.get("fill-antialias")){const Y=v.getDepthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,Bt.ReadOnly);as(v,w,S,A,Y,U,!0,F)}})(t,a,l,h,_):f.cs(l)?(function(v,w,S,A,z){const R=S.paint.get("fill-extrusion-opacity");if(R===0)return;const{isRenderingToTexture:I}=z;if(v.renderPass==="translucent"){const F=new Bt(v.context.gl.LEQUAL,Bt.ReadWrite,v.depthRangeFor3D);if(R!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))ss(v,w,S,A,F,ti.disabled,_i.disabled,I),ss(v,w,S,A,F,v.stencilModeFor3D(),v.colorModeForRenderPass(),I);else{const U=v.colorModeForRenderPass();ss(v,w,S,A,F,ti.disabled,U,I)}}})(t,a,l,h,_):f.ct(l)?(function(v,w,S,A,z){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,I=v.context,F=v.style.projection.useSubdivision,U=v.getDepthModeForSublayer(0,Bt.ReadOnly),X=v.colorModeForRenderPass();if(v.renderPass==="offscreen")(function(Q,Y,W,ie,K,re,se){const ee=Q.context,fe=ee.gl;for(const Me of W){const xe=Y.getTile(Me),Ee=xe.dem;if(!Ee||!Ee.data||!xe.needsHillshadePrepare)continue;const Ce=Ee.dim,He=Ee.stride,Je=Ee.getPixels();if(ee.activeTexture.set(fe.TEXTURE1),ee.pixelStoreUnpackPremultiplyAlpha.set(!1),xe.demTexture=xe.demTexture||Q.getTileTexture(He),xe.demTexture){const ft=xe.demTexture;ft.update(Je,{premultiply:!1}),ft.bind(fe.NEAREST,fe.CLAMP_TO_EDGE)}else xe.demTexture=new f.T(ee,Je,fe.RGBA,{premultiply:!1}),xe.demTexture.bind(fe.NEAREST,fe.CLAMP_TO_EDGE);ee.activeTexture.set(fe.TEXTURE0);let qe=xe.fbo;if(!qe){const ft=new f.T(ee,{width:Ce,height:Ce,data:null},fe.RGBA);ft.bind(fe.LINEAR,fe.CLAMP_TO_EDGE),qe=xe.fbo=ee.createFramebuffer(Ce,Ce,!0,!1),qe.colorAttachment.set(ft.texture)}ee.bindFramebuffer.set(qe.framebuffer),ee.viewport.set([0,0,Ce,Ce]),Q.useProgram("hillshadePrepare").draw(ee,fe.TRIANGLES,K,re,se,jt.disabled,Of(xe.tileID,Ee),null,null,ie.id,Q.rasterBoundsBuffer,Q.quadTriangleIndexBuffer,Q.rasterBoundsSegments),xe.needsHillshadePrepare=!1}})(v,w,A,S,U,ti.disabled,X),I.viewport.set([0,0,v.width,v.height]);else if(v.renderPass==="translucent")if(F){const[Q,Y,W]=v.stencilConfigForOverlapTwoPass(A);os(v,w,S,W,Q,U,X,!1,R),os(v,w,S,W,Y,U,X,!0,R)}else{const[Q,Y]=v.getStencilConfigForOverlapAndUpdateStencilID(A);os(v,w,S,Y,Q,U,X,!1,R)}})(t,a,l,h,_):f.cu(l)?(function(v,w,S,A,z){if(v.renderPass!=="translucent"||!A.length)return;const{isRenderingToTexture:R}=z,I=v.style.projection.useSubdivision,F=v.getDepthModeForSublayer(0,Bt.ReadOnly),U=v.colorModeForRenderPass();if(I){const[X,Q,Y]=v.stencilConfigForOverlapTwoPass(A);Ms(v,w,S,Y,X,F,U,!1,R),Ms(v,w,S,Y,Q,F,U,!0,R)}else{const[X,Q]=v.getStencilConfigForOverlapAndUpdateStencilID(A);Ms(v,w,S,Q,X,F,U,!1,R)}})(t,a,l,h,_):f.bV(l)?(function(v,w,S,A,z){if(v.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!A.length)return;const{isRenderingToTexture:R}=z,I=w.getSource(),F=v.style.projection.useSubdivision;if(I instanceof Br)wa(v,w,S,A,null,!1,!1,I.tileCoords,I.flippedWindingOrder,R);else if(F){const[U,X,Q]=v.stencilConfigForOverlapTwoPass(A);wa(v,w,S,Q,U,!1,!0,Es,!1,R),wa(v,w,S,Q,X,!0,!0,Es,!1,R)}else{const[U,X]=v.getStencilConfigForOverlapAndUpdateStencilID(A);wa(v,w,S,X,U,!1,!0,Es,!1,R)}})(t,a,l,h,_):f.cv(l)?(function(v,w,S,A,z){const R=S.paint.get("background-color"),I=S.paint.get("background-opacity");if(I===0)return;const{isRenderingToTexture:F}=z,U=v.context,X=U.gl,Q=v.style.projection,Y=v.transform,W=Y.tileSize,ie=S.paint.get("background-pattern");if(v.isPatternMissing(ie))return;const K=!ie&&R.a===1&&I===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==K)return;const re=ti.disabled,se=v.getDepthModeForSublayer(0,K==="opaque"?Bt.ReadWrite:Bt.ReadOnly),ee=v.colorModeForRenderPass(),fe=v.useProgram(ie?"backgroundPattern":"background"),Me=A||hn(Y,{tileSize:W,terrain:v.style.map.terrain});ie&&(U.activeTexture.set(X.TEXTURE0),v.imageManager.bind(v.context));const xe=S.getCrossfadeParameters();for(const Ee of Me){const Ce=Y.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),He=ie?Au(I,v,ie,{tileID:Ee,tileSize:W},xe):Eu(I,R),Je=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ee),qe=Q.getMeshFromTileID(U,Ee.canonical,!1,!0,"raster");fe.draw(U,X.TRIANGLES,se,re,ee,jt.backCCW,He,Je,Ce,S.id,qe.vertexBuffer,qe.indexBuffer,qe.segments)}})(t,0,l,h,_):f.cw(l)&&(function(v,w,S,A){const{isRenderingGlobe:z}=A,R=v.context,I=S.implementation,F=v.style.projection,U=v.transform,X=U.getProjectionDataForCustomLayer(z),Q={farZ:U.farZ,nearZ:U.nearZ,fov:U.fov*Math.PI/180,modelViewProjectionMatrix:U.modelViewProjectionMatrix,projectionMatrix:U.projectionMatrix,shaderData:{variantName:F.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${F.shaderPreludeCode.vertexSource}`,define:F.shaderDefine},defaultProjectionData:X},Y=I.renderingMode?I.renderingMode:"2d";if(v.renderPass==="offscreen"){const W=I.prerender;W&&(v.setCustomLayerDefaults(),R.setColorMode(v.colorModeForRenderPass()),W.call(I,R.gl,Q),R.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),R.setColorMode(v.colorModeForRenderPass()),R.setStencilMode(ti.disabled);const W=Y==="3d"?v.getDepthModeFor3D():v.getDepthModeForSublayer(0,Bt.ReadOnly);R.setDepthMode(W),I.render(R.gl,Q),R.setDirty(),v.setBaseState(),R.bindFramebuffer.set(null)}})(t,0,l,_))}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!a||!l}useProgram(t,a,l=!1,h=[]){this.cache=this.cache||{};const _=!!this.style.map.terrain,v=this.style.projection,w=l?ki.projectionMercator:v.shaderPreludeCode,S=l?rn:v.shaderDefine,A=t+(a?a.cacheKey:"")+`/${l?br:v.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(_?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[A]||(this.cache[A]=new If(this.context,ki[t],a,Ff[t],this._showOverdrawInspector,_,w,S,h)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new f.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,a;if(this._tileTextures){for(const l in this._tileTextures){const h=this._tileTextures[l];if(h)for(const _ of h)_.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const l in this.cache){const h=this.cache[l];h&&h.program&&this.context.gl.deleteProgram(h.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}function zh(m,t){let a,l=!1,h=null,_=null;const v=()=>{h=null,l&&(m.apply(_,a),h=setTimeout(v,t),l=!1)};return(...w)=>(l=!0,_=this,a=w,h||v(),h)}class $i{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let l;return a.split("&").map((h=>h.split("="))).forEach((h=>{h[0]===this._hashName&&(l=h)})),(l&&l[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:l,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const l=a.join("/");let h=l;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${l}`);let _=window.location.hash.replace(h,"");_.startsWith("#&")?_=_.slice(0,1)+_.slice(2):_==="#"&&(_="");let v=window.location.href.replace(/(#.+)?$/,_);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=zh(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const a=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,h),v=Math.round(a.lng*_)/_,w=Math.round(a.lat*_)/_,S=this._map.getBearing(),A=this._map.getPitch();let z="";if(z+=t?`/${v}/${w}/${l}`:`${l}/${w}/${v}`,(S||A)&&(z+="/"+Math.round(10*S)/10),A&&(z+=`/${Math.round(A)}`),this._hashName){const R=this._hashName;let I=!1;const F=window.location.hash.slice(1).split("&").map((U=>{const X=U.split("=")[0];return X===R?(I=!0,`${X}=${z}`):U})).filter((U=>U));return I||F.push(`${R}=${z}`),`#${F.join("&")}`}return`#${z}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new f.V(+t[2],+t[1])}catch{return!1}const a=+t[0],l=+(t[3]||0),h=+(t[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&l>=-180&&l<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}const ho={linearity:.3,easing:f.cx(0,0,.3,1)},fr=f.e({deceleration:2500,maxSpeed:1400},ho),Ar=f.e({deceleration:20,maxSpeed:1400},ho),zc=f.e({deceleration:1e3,maxSpeed:360},ho),dr=f.e({deceleration:1e3,maxSpeed:90},ho),Bl=f.e({deceleration:1e3,maxSpeed:360},ho);class kl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Et(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=Et();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new f.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)a.zoom+=_.zoomDelta||0,a.bearing+=_.bearingDelta||0,a.pitch+=_.pitchDelta||0,a.roll+=_.rollDelta||0,_.panDelta&&a.pan._add(_.panDelta),_.around&&(a.around=_.around),_.pinchAround&&(a.pinchAround=_.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(a.pan.mag()){const _=Ou(a.pan.mag(),l,f.e({},fr,t||{})),v=a.pan.mult(_.amount/a.pan.mag()),w=this._map.cameraHelper.handlePanInertia(v,this._map.transform);h.center=w.easingCenter,h.offset=w.easingOffset,Fl(h,_)}if(a.zoom){const _=Ou(a.zoom,l,Ar);h.zoom=this._map.transform.zoom+_.amount,Fl(h,_)}if(a.bearing){const _=Ou(a.bearing,l,zc);h.bearing=this._map.transform.bearing+f.ao(_.amount,-179,179),Fl(h,_)}if(a.pitch){const _=Ou(a.pitch,l,dr);h.pitch=this._map.transform.pitch+_.amount,Fl(h,_)}if(a.roll){const _=Ou(a.roll,l,Bl);h.roll=this._map.transform.roll+f.ao(_.amount,-179,179),Fl(h,_)}if(h.zoom||h.bearing){const _=a.pinchAround===void 0?a.around:a.pinchAround;h.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),f.e(h,{noMoveStart:!0})}}function Fl(m,t){(!m.duration||m.duration<t.duration)&&(m.duration=t.duration,m.easing=t.easing)}function Ou(m,t,a){const{maxSpeed:l,linearity:h,deceleration:_}=a,v=f.ao(m*h/(t/1e3),-l,l),w=Math.abs(v)/(_*h);return{easing:a.easing,duration:1e3*w,amount:v*(w/2)}}class Vr extends f.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,l,h={}){l=l instanceof MouseEvent?l:new MouseEvent(t,l);const _=Ae.mousePos(a.getCanvas(),l),v=a.unproject(_);super(t,f.e({point:_,lngLat:v,originalEvent:l},h)),this._defaultPrevented=!1,this.target=a}}class Oa extends f.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,l){const h=t==="touchend"?l.changedTouches:l.touches,_=Ae.touchPos(a.getCanvasContainer(),h),v=_.map((S=>a.unproject(S))),w=_.reduce(((S,A,z,R)=>S.add(A.div(R.length))),new f.P(0,0));super(t,{points:_,point:w,lngLats:v,lngLat:a.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class Bu extends f.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class fo{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Bu(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Vr(t.type,this._map,t))}mouseup(t){this._map.fire(new Vr(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Vr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Vr(t.type,this._map,t))}mouseover(t){this._map.fire(new Vr(t.type,this._map,t))}mouseout(t){this._map.fire(new Vr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Oa(t.type,this._map,t))}touchmove(t){this._map.fire(new Oa(t.type,this._map,t))}touchend(t){this._map.fire(new Oa(t.type,this._map,t))}touchcancel(t){this._map.fire(new Oa(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cs{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Vr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Vr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Vr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class nt{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(f.P.convert(t),this._map.terrain)}}class ku{constructor(t,a){this._map=t,this._tr=new nt(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ae.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const l=a;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=Ae.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(h.x,l.x),v=Math.max(h.x,l.x),w=Math.min(h.y,l.y),S=Math.max(h.y,l.y);Ae.setTransform(this._box,`translate(${_}px,${w}px)`),this._box.style.width=v-_+"px",this._box.style.height=S-w+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const l=this._startPos,h=a;if(this.reset(),Ae.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new f.l("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Ae.remove(this._box),this._box=null),Ae.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new f.l(t,{originalEvent:a}))}}function po(m,t){if(m.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${t.length}`);const a={};for(let l=0;l<m.length;l++)a[m[l].identifier]=t[l];return a}class Fu{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=(function(h){const _=new f.P(0,0);for(const v of h)_._add(v);return _.div(h.length)})(a),this.touches=po(l,a)))}touchmove(t,a,l){if(this.aborted||!this.centroid)return;const h=po(l,a);for(const _ in this.touches){const v=h[_];(!v||v.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,a,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class mo{constructor(t){this.singleTap=new Fu(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,l){this.singleTap.touchstart(t,a,l)}touchmove(t,a,l){this.singleTap.touchmove(t,a,l)}touchend(t,a,l){const h=this.singleTap.touchend(t,a,l);if(h){const _=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(h)<30;if(_&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class Nl{constructor(t){this._tr=new nt(t),this._zoomIn=new mo({numTouches:1,numTaps:2}),this._zoomOut=new mo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,l){this._zoomIn.touchstart(t,a,l),this._zoomOut.touchstart(t,a,l)}touchmove(t,a,l){this._zoomIn.touchmove(t,a,l),this._zoomOut.touchmove(t,a,l)}touchend(t,a,l){const h=this._zoomIn.touchend(t,a,l),_=this._zoomOut.touchend(t,a,l),v=this._tr;return h?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(h)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oa{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const h=Array.isArray(a)?a[0]:a;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&Ae.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const qo=0,Dc=2,Dh={[qo]:1,[Dc]:2};class Sa{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=Ae.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(a,l){const h=Dh[l];return a.buttons===void 0||(a.buttons&h)!==h})(t,this._eventButton)}isValidEndEvent(t){return Ae.mouseButton(t)===this._eventButton}}class Nu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Vu{constructor(t=new Sa({checkCorrectEvent:()=>!0}),a=new Nu){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(t,a,l){return t instanceof MouseEvent?a(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?l(t):void 0}startMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const go=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=t=>{t.preventDefault()}};class Pc{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new f.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,a,l){return this._calculateTransform(t,a,l)}touchmove(t,a,l){if(this._active){if(!this._shouldBePrevented(l.length))return t.preventDefault(),this._calculateTransform(t,a,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,a,l){this._calculateTransform(t,a,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,l){l.length>0&&(this._active=!0);const h=po(l,a),_=new f.P(0,0),v=new f.P(0,0);let w=0;for(const A in h){const z=h[A],R=this._touches[A];R&&(_._add(z),v._add(z.sub(R)),w++,h[A]=z)}if(this._touches=h,this._shouldBePrevented(w)||!v.mag())return;const S=v.div(w);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(w),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ju{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,l){if(!this._firstTwoTouches)return;t.preventDefault();const[h,_]=this._firstTwoTouches,v=hs(l,a,h),w=hs(l,a,_);if(!v||!w)return;const S=this._aroundCenter?null:v.add(w).div(2);return this._move([v,w],S,t)}touchend(t,a,l){if(!this._firstTwoTouches)return;const[h,_]=this._firstTwoTouches,v=hs(l,a,h),w=hs(l,a,_);v&&w||(this._active&&Ae.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function hs(m,t,a){for(let l=0;l<m.length;l++)if(m[l].identifier===a)return t[l]}function Ic(m,t){return Math.log(m/t)/Math.LN2}class zs extends ju{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Ic(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ic(this._distance,l),pinchAround:a}}}function Rc(m,t){return 180*m.angleWith(t)/Math.PI}class Ba extends ju{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,l){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Rc(this._vector,h),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,l=Rc(t,this._startVector);return Math.abs(l)<a}}function Qt(m){return Math.abs(m.y)>Math.abs(m.x)}class Ds extends ju{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,l){super.touchstart(t,a,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,Qt(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=t[0].sub(this._lastPoints[0]),_=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,_,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(h.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,l){if(this._valid!==void 0)return this._valid;const h=t.mag()>=2,_=a.mag()>=2;if(!h&&!_)return;if(!h||!_)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=t.y>0==a.y>0;return Qt(t)&&Qt(a)&&v}}const _o={panStep:100,bearingStep:15,pitchStep:10};class Zo{constructor(t){this._tr=new nt(t);const a=_o;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,l=0,h=0,_=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?h=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?h=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:w=>{const S=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Uu,zoom:a?Math.round(S.zoom)+a*(t.shiftKey?2:1):S.zoom,bearing:S.bearing+l*this._bearingStep,pitch:S.pitch+h*this._pitchStep,offset:[-_*this._panStep,-v*this._panStep],center:S.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Uu(m){return m*(2-m)}const Ho=4.000244140625,Vl=1/450;class Lc{constructor(t,a){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new nt(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Vl}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=Et(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,a!==0&&a%Ho==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(h*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Ae.mousePos(this._map.getCanvas(),t),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(f.V.convert(l.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const w=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=w),typeof this._targetZoom=="number"&&(this._targetZoom+=w)}if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>Ho?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&S!==0&&(S=1/S);const A=typeof this._targetZoom!="number"?t.scale:f.ar(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),f.au(A*S)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,l=this._startZoom,h=this._easing;let _,v=!1;if(this._type==="wheel"&&l&&h){const w=Et()-this._lastWheelEventTime,S=Math.min((w+5)/200,1),A=h(S);_=f.G.number(l,a,A),S<1?this._frameId||(this._frameId=!0):v=!0}else _=a,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=_,{noInertia:!0,needsRenderFrame:!v,zoomDelta:_-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=f.cz;if(this._prevEase){const l=this._prevEase,h=(Et()-l.start)/l.duration,_=l.easing(h+.01)-l.easing(h),v=.27/Math.sqrt(_*_+1e-4)*.01,w=Math.sqrt(.0729-v*v);a=f.cx(v,w,.25,1)}return this._prevEase={start:Et(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ph{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Cr{constructor(t){this._tr=new nt(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $o{constructor(){this._tap=new mo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,l){if(!this._swipePoint)if(this._tapTime){const h=a[0],_=t.timeStamp-this._tapTime<500,v=this._tapPoint.dist(h)<30;_&&v?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,a,l)}touchmove(t,a,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=a[0],_=h.y-this._swipePoint.y;return this._swipePoint=h,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,a,l)}touchend(t,a,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(t,a,l);h&&(this._tapTime=t.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dt{constructor(t,a,l){this._el=t,this._mousePan=a,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class xt{constructor(t,a,l,h){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=a,this._mousePitch=l,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class yo{constructor(t,a,l,h){this._el=t,this._touchZoom=a,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class zr{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=Ae.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=a,this._container.appendChild(h);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=l,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Ae.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,a){this._enabled&&(this._map.fire(new f.l("cooperativegestureprevented",{gestureType:t,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const $n=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class dn extends f.l{}function Dr(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class Ih{constructor(t,a){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,_)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=h.type==="renderFrame"?void 0:h,w={needsRenderFrame:!1},S={},A={};for(const{handlerName:I,handler:F,allowed:U}of this._handlers){if(!F.isEnabled())continue;let X;if(this._blockedByActive(A,U,I))F.reset();else if(F[_||h.type]){if(f.cA(h,_||h.type)){const Q=Ae.mousePos(this._map.getCanvas(),h);X=F[_||h.type](h,Q)}else if(f.cB(h,_||h.type)){const Q=this._getMapTouches(h.touches),Y=Ae.touchPos(this._map.getCanvas(),Q);X=F[_||h.type](h,Y,Q)}else f.cC(_||h.type)||(X=F[_||h.type](h));this.mergeHandlerResult(w,S,X,I,v),X&&X.needsRenderFrame&&this._triggerRenderFrame()}(X||F.isActive())&&(A[I]=F)}const z={};for(const I in this._previousActiveHandlers)A[I]||(z[I]=v);this._previousActiveHandlers=A,(Object.keys(z).length||Dr(w))&&(this._changes.push([w,S,z]),this._triggerRenderFrame()),(Object.keys(A).length||Dr(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=w;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new kl(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,_,v]of this._listeners)Ae.addEventListener(h,_,h===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,a,l]of this._listeners)Ae.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const a=this._map,l=a.getCanvasContainer();this._add("mapEvent",new fo(a,t));const h=a.boxZoom=new ku(a,t);this._add("boxZoom",h),t.interactive&&t.boxZoom&&h.enable();const _=a.cooperativeGestures=new zr(a,t.cooperativeGestures);this._add("cooperativeGestures",_),t.cooperativeGestures&&_.enable();const v=new Nl(a),w=new Cr(a);a.doubleClickZoom=new Ph(w,v),this._add("tapZoom",v),this._add("clickZoom",w),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const S=new $o;this._add("tapDragZoom",S);const A=a.touchPitch=new Ds(a);this._add("touchPitch",A),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const z=()=>a.project(a.getCenter()),R=(function({enable:K,clickTolerance:re,aroundCenter:se=!0,minPixelCenterThreshold:ee=100,rotateDegreesPerPixelMoved:fe=.8},Me){const xe=new Sa({checkCorrectEvent:Ee=>Ae.mouseButton(Ee)===0&&Ee.ctrlKey||Ae.mouseButton(Ee)===2&&!Ee.ctrlKey});return new oa({clickTolerance:re,move:(Ee,Ce)=>{const He=Me();if(se&&Math.abs(He.y-Ee.y)>ee)return{bearingDelta:f.cy(new f.P(Ee.x,Ce.y),Ce,He)};let Je=(Ce.x-Ee.x)*fe;return se&&Ce.y<He.y&&(Je=-Je),{bearingDelta:Je}},moveStateManager:xe,enable:K,assignEvents:go})})(t,z),I=(function({enable:K,clickTolerance:re,pitchDegreesPerPixelMoved:se=-.5}){const ee=new Sa({checkCorrectEvent:fe=>Ae.mouseButton(fe)===0&&fe.ctrlKey||Ae.mouseButton(fe)===2});return new oa({clickTolerance:re,move:(fe,Me)=>({pitchDelta:(Me.y-fe.y)*se}),moveStateManager:ee,enable:K,assignEvents:go})})(t),F=(function({enable:K,clickTolerance:re,rollDegreesPerPixelMoved:se=.3},ee){const fe=new Sa({checkCorrectEvent:Me=>Ae.mouseButton(Me)===2&&Me.ctrlKey});return new oa({clickTolerance:re,move:(Me,xe)=>{const Ee=ee();let Ce=(xe.x-Me.x)*se;return xe.y<Ee.y&&(Ce=-Ce),{rollDelta:Ce}},moveStateManager:fe,enable:K,assignEvents:go})})(t,z);a.dragRotate=new xt(t,R,I,F),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",I,["mouseRotate","mouseRoll"]),this._add("mouseRoll",F,["mousePitch"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const U=(function({enable:K,clickTolerance:re}){const se=new Sa({checkCorrectEvent:ee=>Ae.mouseButton(ee)===0&&!ee.ctrlKey});return new oa({clickTolerance:re,move:(ee,fe)=>({around:fe,panDelta:fe.sub(ee)}),activateOnStart:!0,moveStateManager:se,enable:K,assignEvents:go})})(t),X=new Pc(t,a);a.dragPan=new dt(l,U,X),this._add("mousePan",U),this._add("touchPan",X,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const Q=new Ba,Y=new zs;a.touchZoomRotate=new yo(l,Y,Q,S),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new cs(a));const W=a.scrollZoom=new Lc(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",W,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const ie=a.keyboard=new Zo(a);this._add("keyboard",ie),t.interactive&&t.keyboard&&a.keyboard.enable()}_add(t,a,l){this._handlers.push({handlerName:t,handler:a,allowed:l}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$n(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,l){for(const h in t)if(h!==l&&(!a||a.indexOf(h)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const l of t)this._el.contains(l.target)&&a.push(l);return a}mergeHandlerResult(t,a,l,h,_){if(!l)return;f.e(t,l);const v={handlerName:h,originalEvent:l.originalEvent||_};l.zoomDelta!==void 0&&(a.zoom=v),l.panDelta!==void 0&&(a.drag=v),l.rollDelta!==void 0&&(a.roll=v),l.pitchDelta!==void 0&&(a.pitch=v),l.bearingDelta!==void 0&&(a.rotate=v)}_applyChanges(){const t={},a={},l={};for(const[h,_,v]of this._changes)h.panDelta&&(t.panDelta=(t.panDelta||new f.P(0,0))._add(h.panDelta)),h.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(t.rollDelta=(t.rollDelta||0)+h.rollDelta),h.around!==void 0&&(t.around=h.around),h.pinchAround!==void 0&&(t.pinchAround=h.pinchAround),h.noInertia&&(t.noInertia=h.noInertia),f.e(a,_),f.e(l,v);this._updateMapTransform(t,a,l),this._changes=[]}_updateMapTransform(t,a,l){const h=this._map,_=h._getTransformForUpdate(),v=h.terrain;if(!(Dr(t)||v&&this._terrainMovement))return this._fireEvents(a,l,!0);h._stop(!0);let{panDelta:w,zoomDelta:S,bearingDelta:A,pitchDelta:z,rollDelta:R,around:I,pinchAround:F}=t;F!==void 0&&(I=F),I=I||h.transform.centerPoint,v&&!_.isPointOnMapSurface(I)&&(I=_.centerPoint);const U={panDelta:w,zoomDelta:S,rollDelta:R,pitchDelta:z,bearingDelta:A,around:I};this._map.cameraHelper.useGlobeControls&&!_.isPointOnMapSurface(I)&&(I=_.centerPoint);const X=I.distSqr(_.centerPoint)<.01?_.center:_.screenPointToLocation(w?I.sub(w):I);this._handleMapControls({terrain:v,tr:_,deltasForHelper:U,preZoomAroundLoc:X,combinedEventsInProgress:a,panDelta:w}),h._applyUpdatedTransform(_),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,l,!0)}_handleMapControls({terrain:t,tr:a,deltasForHelper:l,preZoomAroundLoc:h,combinedEventsInProgress:_,panDelta:v}){const w=this._map.cameraHelper;if(w.handleMapControlsRollPitchBearingZoom(l,a),t)return w.useGlobeControls?(this._terrainMovement||!_.drag&&!_.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void w.handleMapControlsPan(l,a,h)):this._terrainMovement||!_.drag&&!_.zoom?void(_.drag&&this._terrainMovement&&v?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(v))):w.handleMapControlsPan(l,a,h)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void w.handleMapControlsPan(l,a,h));w.handleMapControlsPan(l,a,h)}_fireEvents(t,a,l){const h=$n(this._eventsInProgress),_=$n(t),v={};for(const R in t){const{originalEvent:I}=t[R];this._eventsInProgress[R]||(v[`${R}start`]=I),this._eventsInProgress[R]=t[R]}!h&&_&&this._fireEvent("movestart",_.originalEvent);for(const R in v)this._fireEvent(R,v[R]);_&&this._fireEvent("move",_.originalEvent);for(const R in t){const{originalEvent:I}=t[R];this._fireEvent(R,I)}const w={};let S;for(const R in this._eventsInProgress){const{handlerName:I,originalEvent:F}=this._eventsInProgress[R];this._handlersById[I].isActive()||(delete this._eventsInProgress[R],S=a[I]||F,w[`${R}end`]=S)}for(const R in w)this._fireEvent(R,w[R]);const A=$n(this._eventsInProgress),z=(h||_)&&!A;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const R=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&R.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(R)}if(l&&z){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),I=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;!R||!R.essential&&Mt.prefersReducedMotion?(this._map.fire(new f.l("moveend",{originalEvent:S})),I(this._map.getBearing())&&this._map.resetNorth()):(I(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new f.l(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new dn("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class vo extends f.E{constructor(t,a,l){super(),this._renderFrameCallback=()=>{const h=Math.min((Et()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,a){t.apply(this.transform),this.transform=t,this.cameraHelper=a}getCenter(){return new f.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,a){return this.jumpTo({elevation:t},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,a,l){return t=f.P.convert(t).mult(-1),this.panTo(this.transform.center,f.e({offset:t},a),l)}panTo(t,a,l){return this.easeTo(f.e({center:t},a),l)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,l){return this.easeTo(f.e({zoom:t},a),l)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,a){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new f.l("movestart",a)).fire(new f.l("move",a)).fire(new f.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,l){return this.easeTo(f.e({bearing:t},a),l)}resetNorth(t,a){return this.rotateTo(0,f.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(f.e({bearing:0,pitch:0,roll:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}getRoll(){return this.transform.roll}setRoll(t,a){return this.jumpTo({roll:t},a),this}cameraForBounds(t,a){t=tn.convert(t).adjustAntiMeridian();const l=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,a)}_cameraForBoxAndBearing(t,a,l,h){const _={top:0,bottom:0,right:0,left:0};if(typeof(h=f.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const A=h.padding;h.padding={top:A,bottom:A,right:A,left:A}}const v=f.e(_,h.padding);h.padding=v;const w=this.transform,S=new tn(t,a);return this.cameraHelper.cameraForBoxAndBearing(h,v,S,l,w)}fitBounds(t,a,l){return this._fitInternal(this.cameraForBounds(t,a),a,l)}fitScreenCoordinates(t,a,l,h,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(f.P.convert(t)),this.transform.screenPointToLocation(f.P.convert(a)),l,h),h,_)}_fitInternal(t,a,l){return t?(delete(a=f.e(t,a)).padding,a.linear?this.easeTo(a,l):this.flyTo(a,l)):this}jumpTo(t,a){this.stop();const l=this._getTransformForUpdate();let h=!1,_=!1,v=!1;const w=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,t);const S=l.zoom!==w;return"elevation"in t&&l.elevation!==+t.elevation&&l.setElevation(+t.elevation),"bearing"in t&&l.bearing!==+t.bearing&&(h=!0,l.setBearing(+t.bearing)),"pitch"in t&&l.pitch!==+t.pitch&&(_=!0,l.setPitch(+t.pitch)),"roll"in t&&l.roll!==+t.roll&&(v=!0,l.setRoll(+t.roll)),t.padding==null||l.isPaddingEqual(t.padding)||l.setPadding(t.padding),this._applyUpdatedTransform(l),this.fire(new f.l("movestart",a)).fire(new f.l("move",a)),S&&this.fire(new f.l("zoomstart",a)).fire(new f.l("zoom",a)).fire(new f.l("zoomend",a)),h&&this.fire(new f.l("rotatestart",a)).fire(new f.l("rotate",a)).fire(new f.l("rotateend",a)),_&&this.fire(new f.l("pitchstart",a)).fire(new f.l("pitch",a)).fire(new f.l("pitchend",a)),v&&this.fire(new f.l("rollstart",a)).fire(new f.l("roll",a)).fire(new f.l("rollend",a)),this.fire(new f.l("moveend",a))}calculateCameraOptionsFromTo(t,a,l,h=0){const _=f.ab.fromLngLat(t,a),v=f.ab.fromLngLat(l,h),w=v.x-_.x,S=v.y-_.y,A=v.z-_.z,z=Math.hypot(w,S,A);if(z===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(w,S),I=f.au(this.transform.cameraToCenterDistance/z/this.transform.tileSize),F=180*Math.atan2(w,-S)/Math.PI;let U=180*Math.acos(R/z)/Math.PI;return U=A<0?90-U:90+U,{center:v.toLngLat(),elevation:h,zoom:I,pitch:U,bearing:F}}calculateCameraOptionsFromCameraLngLatAltRotation(t,a,l,h,_){const v=this.transform.calculateCenterFromCameraLngLatAlt(t,a,l,h);return{center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:l,pitch:h,roll:_}}easeTo(t,a){this._stop(!1,t.easeId),((t=f.e({offset:[0,0],duration:500,easing:f.cz},t)).animate===!1||!t.essential&&Mt.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),h=this.getBearing(),_=l.pitch,v=l.roll,w="bearing"in t?this._normalizeBearing(t.bearing,h):h,S="pitch"in t?+t.pitch:_,A="roll"in t?this._normalizeBearing(t.roll,v):v,z="padding"in t?t.padding:l.padding,R=f.P.convert(t.offset);let I,F;t.around&&(I=f.V.convert(t.around),F=l.locationToScreenPoint(I));const U={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},X=this.cameraHelper.handleEaseTo(l,{bearing:w,pitch:S,roll:A,padding:z,around:I,aroundPoint:F,offsetAsPoint:R,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||h!==w,this._pitching=this._pitching||S!==_,this._rolling=this._rolling||A!==v,this._padding=!l.isPaddingEqual(z),this._zooming=this._zooming||X.isZooming,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,U),this.terrain&&this._prepareElevation(X.elevationCenter),this._ease((Q=>{X.easeFunc(Q),this.terrain&&!t.freezeElevation&&this._updateElevation(Q),this._applyUpdatedTransform(l),this._fireMoveEvents(a)}),(Q=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a,Q)}),t),this}_prepareEase(t,a,l={}){this._moving=!0,a||l.moving||this.fire(new f.l("movestart",t)),this._zooming&&!l.zooming&&this.fire(new f.l("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new f.l("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new f.l("pitchstart",t)),this._rolling&&!l.rolling&&this.fire(new f.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(a-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.setElevation(f.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const a=t.getCameraLngLat(),l=t.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(a,t.zoom):0;if(l<h){const _=this.calculateCameraOptionsFromTo(a,h,t.center,t.elevation);return{pitch:_.pitch,zoom:_.zoom}}return{}}_applyUpdatedTransform(t){const a=[];if(a.push((h=>this._elevateCameraIfInsideTerrain(h))),this.transformCameraUpdate&&a.push((h=>this.transformCameraUpdate(h))),!a.length)return;const l=t.clone();for(const h of a){const _=l.clone(),{center:v,zoom:w,roll:S,pitch:A,bearing:z,elevation:R}=h(_);v&&_.setCenter(v),R!==void 0&&_.setElevation(R),w!==void 0&&_.setZoom(w),S!==void 0&&_.setRoll(S),A!==void 0&&_.setPitch(A),z!==void 0&&_.setBearing(z),l.apply(_)}this.transform.apply(l)}_fireMoveEvents(t){this.fire(new f.l("move",t)),this._zooming&&this.fire(new f.l("zoom",t)),this._rotating&&this.fire(new f.l("rotate",t)),this._pitching&&this.fire(new f.l("pitch",t)),this._rolling&&this.fire(new f.l("roll",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const l=this._zooming,h=this._rotating,_=this._pitching,v=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new f.l("zoomend",t)),h&&this.fire(new f.l("rotateend",t)),_&&this.fire(new f.l("pitchend",t)),v&&this.fire(new f.l("rollend",t)),this.fire(new f.l("moveend",t))}flyTo(t,a){if(!t.essential&&Mt.prefersReducedMotion){const Ce=f.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ce,a)}this.stop(),t=f.e({offset:[0,0],speed:1.2,curve:1.42,easing:f.cz},t);const l=this._getTransformForUpdate(),h=l.bearing,_=l.pitch,v=l.roll,w=l.padding,S="bearing"in t?this._normalizeBearing(t.bearing,h):h,A="pitch"in t?+t.pitch:_,z="roll"in t?this._normalizeBearing(t.roll,v):v,R="padding"in t?t.padding:l.padding,I=f.P.convert(t.offset);let F=l.centerPoint.add(I);const U=l.screenPointToLocation(F),X=this.cameraHelper.handleFlyTo(l,{bearing:S,pitch:A,roll:z,padding:R,locationAtOffset:U,offsetAsPoint:I,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let Q=t.curve;const Y=Math.max(l.width,l.height),W=Y/X.scaleOfZoom,ie=X.pixelPathLength;typeof X.scaleOfMinZoom=="number"&&(Q=Math.sqrt(Y/X.scaleOfMinZoom/ie*2));const K=Q*Q;function re(Ce){const He=(W*W-Y*Y+(Ce?-1:1)*K*K*ie*ie)/(2*(Ce?W:Y)*K*ie);return Math.log(Math.sqrt(He*He+1)-He)}function se(Ce){return(Math.exp(Ce)-Math.exp(-Ce))/2}function ee(Ce){return(Math.exp(Ce)+Math.exp(-Ce))/2}const fe=re(!1);let Me=function(Ce){return ee(fe)/ee(fe+Q*Ce)},xe=function(Ce){return Y*((ee(fe)*(se(He=fe+Q*Ce)/ee(He))-se(fe))/K)/ie;var He},Ee=(re(!0)-fe)/Q;if(Math.abs(ie)<2e-6||!isFinite(Ee)){if(Math.abs(Y-W)<1e-6)return this.easeTo(t,a);const Ce=W<Y?-1:1;Ee=Math.abs(Math.log(W/Y))/Q,xe=()=>0,Me=He=>Math.exp(Ce*Q*He)}return t.duration="duration"in t?+t.duration:1e3*Ee/("screenSpeed"in t?+t.screenSpeed/Q:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=h!==S,this._pitching=A!==_,this._rolling=z!==v,this._padding=!l.isPaddingEqual(R),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(X.targetCenter),this._ease((Ce=>{const He=Ce*Ee,Je=1/Me(He),qe=xe(He);this._rotating&&l.setBearing(f.G.number(h,S,Ce)),this._pitching&&l.setPitch(f.G.number(_,A,Ce)),this._rolling&&l.setRoll(f.G.number(v,z,Ce)),this._padding&&(l.interpolatePadding(w,R,Ce),F=l.centerPoint.add(I)),X.easeFunc(Ce,Je,qe,F),this.terrain&&!t.freezeElevation&&this._updateElevation(Ce),this._applyUpdatedTransform(l),this._fireMoveEvents(a)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,a)}return t||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(t,a,l){l.animate===!1||l.duration===0?(t(1),a()):(this._easeStart=Et(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=f.W(t,-180,180);const l=Math.abs(t-a);return Math.abs(t-360-a)<l&&(t-=360),Math.abs(t+360-a)<l&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(f.V.convert(t)):null}}const jr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class pn{constructor(t=jr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=Ae.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Ae.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ae.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Ae.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const l=this._map._getUIString(`AttributionControl.${a}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((h=>typeof h!="string"?"":h))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const a=this._map.style.tileManagers;for(const h in a){const _=a[h];if(_.used||_.usedForTerrain){const v=_.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t=t.filter((h=>String(h).trim())),t.sort(((h,_)=>h.length-_.length)),t=t.filter(((h,_)=>{for(let v=_+1;v<t.length;v++)if(t[v].indexOf(h)>=0)return!1;return!0}));const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=Ae.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ps{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const l=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=Ae.create("div","maplibregl-ctrl");const a=Ae.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Ae.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class hi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,l=a?this._queue.concat(a):this._queue;for(const h of l)if(h.id===t)return void(h.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const l of a)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var vt=f.aV([{name:"a_pos3d",type:"Int16",components:3}]);class Ci extends f.E{constructor(t){super(),this._lastTilesetChange=Et(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,a){this.tileManager.update(t,a),this._renderableTilesKeys=[];const l={};for(const h of hn(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),f.c8(h.terrainRttPosMatrix32f,0,f.a5,f.a5,0,0,1),this._tiles[h.key]=new Ve(h,this.tileSize),this._lastTilesetChange=Et());for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(t){for(const a in this._tiles){const l=this._tiles[a];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,a){return a?this._getTerrainCoordsForTileRanges(t,a):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const a={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID,_=t.clone(),v=f.bl();if(h.canonical.equals(t.canonical))f.c8(v,0,f.a5,f.a5,0,0,1);else if(h.canonical.isChildOf(t.canonical)){const w=h.canonical.z-t.canonical.z,S=h.canonical.x-(h.canonical.x>>w<<w),A=h.canonical.y-(h.canonical.y>>w<<w),z=f.a5>>w;f.c8(v,0,z,z,0,0,1),f.O(v,v,[-S*z,-A*z,0])}else{if(!t.canonical.isChildOf(h.canonical))continue;{const w=t.canonical.z-h.canonical.z,S=t.canonical.x-(t.canonical.x>>w<<w),A=t.canonical.y-(t.canonical.y>>w<<w),z=f.a5>>w;f.c8(v,0,f.a5,f.a5,0,0,1),f.O(v,v,[S*z,A*z,0]),f.Q(v,v,[1/2**w,1/2**w,0])}}_.terrainRttPosMatrix32f=new Float32Array(v),a[l]=_}return a}_getTerrainCoordsForTileRanges(t,a){const l={};for(const h of this._renderableTilesKeys){const _=this._tiles[h].tileID;if(!this._isWithinTileRanges(_,a))continue;const v=t.clone(),w=f.bl();if(_.canonical.z===t.canonical.z){const S=t.canonical.x-_.canonical.x,A=t.canonical.y-_.canonical.y;f.c8(w,0,f.a5,f.a5,0,0,1),f.O(w,w,[S*f.a5,A*f.a5,0])}else if(_.canonical.z>t.canonical.z){const S=_.canonical.z-t.canonical.z,A=_.canonical.x-(_.canonical.x>>S<<S),z=_.canonical.y-(_.canonical.y>>S<<S),R=t.canonical.x-(_.canonical.x>>S),I=t.canonical.y-(_.canonical.y>>S),F=f.a5>>S;f.c8(w,0,F,F,0,0,1),f.O(w,w,[-A*F+R*f.a5,-z*F+I*f.a5,0])}else{const S=t.canonical.z-_.canonical.z,A=t.canonical.x-(t.canonical.x>>S<<S),z=t.canonical.y-(t.canonical.y>>S<<S),R=(t.canonical.x>>S)-_.canonical.x,I=(t.canonical.y>>S)-_.canonical.y,F=f.a5<<S;f.c8(w,0,F,F,0,0,1),f.O(w,w,[A*f.a5+R*F,z*f.a5+I*F,0])}v.terrainRttPosMatrix32f=new Float32Array(w),l[h]=v}return l}getSourceTile(t,a){const l=this.tileManager._source;let h=t.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(h).key);let _=this.findTileInCaches(this._sourceTileCache[t.key]);if(!_?.dem&&a)for(;h>=l.minzoom&&!_?.dem;)_=this.findTileInCaches(t.scaledTo(h--).key);return _}findTileInCaches(t){let a=this.tileManager.getTileByID(t);return a||(a=this.tileManager._outOfViewCache.getByKey(t),a)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,a){return a[t.canonical.z]&&t.canonical.x>=a[t.canonical.z].minTileX&&t.canonical.x<=a[t.canonical.z].maxTileX&&t.canonical.y>=a[t.canonical.z].minTileY&&t.canonical.y<=a[t.canonical.z].maxTileY}}class Xi{constructor(t,a,l){this._meshCache={},this.painter=t,this.tileManager=new Ci(a),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,l,h=f.a5){var _;if(!(a>=0&&a<h&&l>=0&&l<h))return 0;const v=this.getTerrainData(t),w=(_=v.tile)===null||_===void 0?void 0:_.dem;if(!w)return 0;const S=f.cD([],[a/h*f.a5,l/h*f.a5],v.u_terrain_matrix),A=[S[0]*w.dim,S[1]*w.dim],z=Math.floor(A[0]),R=Math.floor(A[1]),I=A[0]-z,F=A[1]-R;return w.get(z,R)*(1-I)*(1-F)+w.get(z+1,R)*I*(1-F)+w.get(z,R+1)*(1-I)*F+w.get(z+1,R+1)*I*F}getElevationForLngLatZoom(t,a){if(!f.cE(a,t.wrap()))return 0;const{tileID:l,mercatorX:h,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(l,h%f.a5,_%f.a5,f.a5)}getElevationForLngLat(t){return this.getElevationForLngLatZoom(t,this.tileManager.maxzoom)}getElevation(t,a,l,h=f.a5){return this.getDEMElevation(t,a,l,h)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const h=this.painter.context,_=new f.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new f.T(h,_,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new f.T(h,new f.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=f.as([])}const a=this.tileManager.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const h=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new f.T(h,a.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),a.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const l=a&&a+a.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const h=this.tileManager.getSource().maxzoom;let _=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=h?_=t.canonical.z-h:f.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=t.canonical.x-(t.canonical.x>>_<<_),w=t.canonical.y-(t.canonical.y>>_<<_),S=f.cF(new Float64Array(16),[1/(f.a5<<_),1/(f.a5<<_),0]);f.O(S,S,[v*f.a5,w*f.a5,0]),this._demMatrixCache[t.key]={matrix:S,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,l=a.width/devicePixelRatio,h=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new f.T(a.context,{width:l,height:h,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new f.T(a.context,{width:l,height:h,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,v=0;_<this._coordsTextureSize;_++)for(let w=0;w<this._coordsTextureSize;w++,v+=4)a[v+0]=255&w,a[v+1]=255&_,a[v+2]=w>>8<<4|_>>8,a[v+3]=0;const l=new f.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),h=new f.T(t,l,t.gl.RGBA,{premultiply:!1});return h.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),l=this.painter.context,h=l.gl,_=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(_,w-v-1,1,1,h.RGBA,h.UNSIGNED_BYTE,a),l.bindFramebuffer.set(null);const S=a[0]+(a[2]>>4<<8),A=a[1]+((15&a[2])<<8),z=this.coordsIndex[255-a[3]],R=z&&this.tileManager.getTileByID(z);if(!R)return null;const I=this._coordsTextureSize,F=(1<<R.tileID.canonical.z)*I;return new f.ab((R.tileID.canonical.x*I+S)/F+R.tileID.wrap,(R.tileID.canonical.y*I+A)/F,this.getElevation(R.tileID,S,A,I))}depthAtPoint(t){const a=new Uint8Array(4),l=this.painter.context,h=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,a),l.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(t){var a;const l=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,h=l&&t.canonical.y===0,_=l&&t.canonical.y===(1<<t.canonical.z)-1,v=`m_${h?"n":""}_${_?"s":""}`;if(this._meshCache[v])return this._meshCache[v];const w=this.painter.context,S=new f.cG,A=new f.aZ,z=this.meshSize,R=f.a5/z,I=z*z;for(let ee=0;ee<=z;ee++)for(let fe=0;fe<=z;fe++)S.emplaceBack(fe*R,ee*R,0);for(let ee=0;ee<I;ee+=z+1)for(let fe=0;fe<z;fe++)A.emplaceBack(fe+ee,z+fe+ee+1,z+fe+ee+2),A.emplaceBack(fe+ee,z+fe+ee+2,fe+ee+1);const F=S.length,U=F+(z+1),X=(z+1)*z,Q=h?f.bs:0,Y=h?0:1,W=_?f.bt:f.a5,ie=_?0:1;for(let ee=0;ee<=z;ee++)S.emplaceBack(ee*R,Q,Y);for(let ee=0;ee<=z;ee++)S.emplaceBack(ee*R,W,ie);for(let ee=0;ee<z;ee++)A.emplaceBack(X+ee,U+ee,U+ee+1),A.emplaceBack(X+ee,U+ee+1,X+ee+1),A.emplaceBack(0+ee,F+ee+1,F+ee),A.emplaceBack(0+ee,0+ee+1,F+ee+1);const K=S.length,re=K+2*(z+1);for(const ee of[0,1])for(let fe=0;fe<=z;fe++)for(const Me of[0,1])S.emplaceBack(ee*f.a5,fe*R,Me);for(let ee=0;ee<2*z;ee+=2)A.emplaceBack(K+ee,K+ee+1,K+ee+3),A.emplaceBack(K+ee,K+ee+3,K+ee+2),A.emplaceBack(re+ee,re+ee+3,re+ee+1),A.emplaceBack(re+ee,re+ee+2,re+ee+3);const se=new Ei(w.createVertexBuffer(S,vt.members),w.createIndexBuffer(A),f.aY.simpleSegment(0,0,S.length,A.length));return this._meshCache[v]=se,se}getMeshFrameDelta(t){return 2*Math.PI*f.bF/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,a){var l;if(!f.cE(a,t.wrap()))return 0;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return a&&a.dem&&(l.minElevation=a.dem.min*this.exaggeration,l.maxElevation=a.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,a){const l=f.ab.fromLngLat(t.wrap()),h=(1<<a)*f.a5,_=l.x*h,v=l.y*h,w=Math.floor(_/f.a5),S=Math.floor(v/f.a5);return{tileID:new f.a2(a,0,a,w,S),mercatorX:_,mercatorY:v}}}class Xo{constructor(t,a,l){this._context=t,this._size=a,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new f.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(l.texture),{id:t,fbo:a,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>t.id!==a)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const la={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Is{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new Xo(t.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((l=>!t._layers[l].isHidden(a))),this._coordsAscending={};for(const l in t.tileManagers){this._coordsAscending[l]={};const h=t.tileManagers[l].getVisibleCoordinates(),_=t.tileManagers[l].getSource(),v=_ instanceof Br?_.terrainTileRanges:null;for(const w of h){const S=this.terrain.tileManager.getTerrainCoords(w,v);for(const A in S)this._coordsAscending[l][A]||(this._coordsAscending[l][A]=[]),this._coordsAscending[l][A].push(S[A])}}this._coordsAscendingStr={};for(const l of t._order){const h=t._layers[l],_=h.source;if(la[h.type]&&!this._coordsAscendingStr[_]){this._coordsAscendingStr[_]={};for(const v in this._coordsAscending[_])this._coordsAscendingStr[_][v]=this._coordsAscending[_][v].map((w=>w.key)).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsAscendingStr){const _=this._coordsAscendingStr[h][l.tileID.key];_&&_!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(t,a){if(t.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),h=t.type,_=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(la[h]&&(this._prevType&&la[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(t.id),!v))return!0;if(la[this._prevType]||la[h]&&v){this._prevType=h;const w=this._stacks.length-1,S=this._stacks[w]||[];for(const A of this._renderableTiles){if(this.pool.isFull()&&(Cc(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(A),A.rtt[w]){const R=this.pool.getObjectForId(A.rtt[w].id);if(R.stamp===A.rtt[w].stamp){this.pool.useObject(R);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),A.rtt[w]={id:z.id,stamp:z.stamp},_.context.bindFramebuffer.set(z.fbo.framebuffer),_.context.clear({color:f.bq.transparent,stencil:0}),_.currentStencilSource=void 0;for(let R=0;R<S.length;R++){const I=_.style._layers[S[R]],F=I.source?this._coordsAscending[I.source][A.tileID.key]:[A.tileID];_.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),_._renderTileClippingMasks(I,F,!0),_.renderLayer(_,_.style.tileManagers[I.source],I,F,l),I.source&&(A.rttCoords[I.source]=this._coordsAscendingStr[I.source][A.tileID.key])}}return Cc(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),la[h]}return!1}}const jl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Rs=me,Ls={hash:!1,interactive:!0,bearingSnap:7,attributionControl:jr,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:f.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Rh={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Yi{constructor(t,a,l=!1){this.mousedown=_=>{this.startMove(_,Ae.mousePos(this.element,_)),Ae.addEventListener(window,"mousemove",this.mousemove),Ae.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.move(_,Ae.mousePos(this.element,_))},this.mouseup=_=>{this._rotatePitchHandler.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ae.touchPos(this.element,_.targetTouches)[0],this.startMove(_,this._startPos),Ae.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ae.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=Ae.touchPos(this.element,_.targetTouches)[0],this.move(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const h=new Vu;this._rotatePitchHandler=new oa({clickTolerance:3,move:(_,v)=>{const w=a.getBoundingClientRect(),S=new f.P((w.bottom-w.top)/2,(w.right-w.left)/2);return{bearingDelta:f.cy(new f.P(_.x,v.y),v,S),pitchDelta:l?-.5*(v.y-_.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=t,Ae.addEventListener(a,"mousedown",this.mousedown),Ae.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),Ae.addEventListener(a,"touchcancel",this.reset)}startMove(t,a){this._rotatePitchHandler.dragStart(t,a),Ae.disableDrag()}move(t,a){const l=this.map,{bearingDelta:h,pitchDelta:_}=this._rotatePitchHandler.dragMove(t,a)||{};h&&l.setBearing(l.getBearing()+h),_&&l.setPitch(l.getPitch()+_)}off(){const t=this.element;Ae.removeEventListener(t,"mousedown",this.mousedown),Ae.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),Ae.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ae.removeEventListener(window,"touchend",this.touchend),Ae.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){Ae.enableDrag(),Ae.removeEventListener(window,"mousemove",this.mousemove),Ae.removeEventListener(window,"mouseup",this.mouseup),Ae.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ae.removeEventListener(window,"touchend",this.touchend)}}let ka;function Ul(m,t,a,l=!1){if(l||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();const h=new f.V(m.lng,m.lat);if(m=new f.V(m.lng,m.lat),t){const _=new f.V(m.lng-360,m.lat),v=new f.V(m.lng+360,m.lat),w=a.locationToScreenPoint(m).distSqr(t);a.locationToScreenPoint(_).distSqr(t)<w?m=_:a.locationToScreenPoint(v).distSqr(t)<w&&(m=v)}for(;Math.abs(m.lng-a.center.lng)>180;){const _=a.locationToScreenPoint(m);if(_.x>=0&&_.y>=0&&_.x<=a.width&&_.y<=a.height)break;m.lng>a.center.lng?m.lng-=360:m.lng+=360}return m.lng!==h.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(m))?m:h}const Gl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Gu(m,t,a){const l=m.classList;for(const h in Gl)l.remove(`maplibregl-${a}-anchor-${h}`);l.add(`maplibregl-${a}-anchor-${t}`)}class qu extends f.E{constructor(t){if(super(),this._onKeyPress=a=>{const l=a.code,h=a.charCode||a.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=a=>{const l=a.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=Ul(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),Ae.setTransform(this._element,`${Gl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${h}`),Mt.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new f.l("dragstart"))),this.fire(new f.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new f.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=f.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ae.create("div");const a=Ae.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${l}px`),a.setAttributeNS(null,"width",`${h}px`),a.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const _=Ae.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const v=Ae.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const w=Ae.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Y of S){const W=Ae.createNS("http://www.w3.org/2000/svg","ellipse");W.setAttributeNS(null,"opacity","0.04"),W.setAttributeNS(null,"cx","10.5"),W.setAttributeNS(null,"cy","5.80029008"),W.setAttributeNS(null,"rx",Y.rx),W.setAttributeNS(null,"ry",Y.ry),w.appendChild(W)}const A=Ae.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const z=Ae.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(z);const R=Ae.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const I=Ae.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(I);const F=Ae.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(6.0, 7.0)"),F.setAttributeNS(null,"fill","#FFFFFF");const U=Ae.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");const X=Ae.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#000000"),X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962");const Q=Ae.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#FFFFFF"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962"),U.appendChild(X),U.appendChild(Q),v.appendChild(w),v.appendChild(A),v.appendChild(R),v.appendChild(F),v.appendChild(U),a.appendChild(v),a.setAttributeNS(null,"height",l*this._scale+"px"),a.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(a),this._offset=f.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),Gu(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Ae.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=f.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const h=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,l;const h=(a=this._map)===null||a===void 0?void 0:a.terrain,_=this._map.transform.isLocationOccluded(this._lngLat);if(!h||_){const F=_?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==F&&(this._element.style.opacity=F))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const v=this._map,w=v.terrain.depthAtPoint(this._pos),S=v.terrain.getElevationForLngLat(this._lngLat);if(v.transform.lngLatToCameraDepth(this._lngLat,S)-w<.006)return void(this._element.style.opacity=this._opacity);const A=-this._offset.y/v.transform.pixelsPerMeter,z=Math.sin(v.getPitch()*Math.PI/180)*A,R=v.terrain.depthAtPoint(new f.P(this._pos.x,this._pos.y-this._offset.y)),I=v.transform.lngLatToCameraDepth(this._lngLat,S+z)-R>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&I&&this._popup.remove(),this._element.style.opacity=I?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=f.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return(this._opacity===void 0||t===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const Zu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Os=0,Bs=!1;const rr={maxWidth:100,unit:"metric"};function Vi(m,t,a){const l=a&&a.maxWidth||100,h=m._container.clientHeight/2,_=m._container.clientWidth/2,v=m.unproject([_-l/2,h]),w=m.unproject([_+l/2,h]),S=Math.round(m.project(w).x-m.project(v).x),A=Math.min(l,S,m._container.clientWidth),z=v.distanceTo(w);if(a&&a.unit==="imperial"){const R=3.2808*z;R>5280?fs(t,A,R/5280,m._getUIString("ScaleControl.Miles")):fs(t,A,R,m._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?fs(t,A,z/1852,m._getUIString("ScaleControl.NauticalMiles")):z>=1e3?fs(t,A,z/1e3,m._getUIString("ScaleControl.Kilometers")):fs(t,A,z,m._getUIString("ScaleControl.Meters"))}function fs(m,t,a,l){const h=(function(_){const v=Math.pow(10,`${Math.floor(_)}`.length-1);let w=_/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(S){const A=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*A)/A})(w),v*w})(a);m.style.width=t*(h/a)+"px",m.innerHTML=`${h}&nbsp;${l}`}const Yo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},ql=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Zl(m){if(m){if(typeof m=="number"){const t=Math.round(Math.abs(m)/Math.SQRT2);return{center:new f.P(0,0),top:new f.P(0,m),"top-left":new f.P(t,t),"top-right":new f.P(-t,t),bottom:new f.P(0,-m),"bottom-left":new f.P(t,-t),"bottom-right":new f.P(-t,-t),left:new f.P(m,0),right:new f.P(-m,0)}}if(m instanceof f.P||Array.isArray(m)){const t=f.P.convert(m);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:f.P.convert(m.center||[0,0]),top:f.P.convert(m.top||[0,0]),"top-left":f.P.convert(m["top-left"]||[0,0]),"top-right":f.P.convert(m["top-right"]||[0,0]),bottom:f.P.convert(m.bottom||[0,0]),"bottom-left":f.P.convert(m["bottom-left"]||[0,0]),"bottom-right":f.P.convert(m["bottom-right"]||[0,0]),left:f.P.convert(m.left||[0,0]),right:f.P.convert(m.right||[0,0])}}return Zl(new f.P(0,0))}const Fa=me;L.AJAXError=f.cJ,L.Event=f.l,L.Evented=f.E,L.LngLat=f.V,L.MercatorCoordinate=f.ab,L.Point=f.P,L.addProtocol=f.cK,L.config=f.c,L.removeProtocol=f.cL,L.AttributionControl=pn,L.BoxZoomHandler=ku,L.CanvasSource=j,L.CooperativeGesturesHandler=zr,L.DoubleClickZoomHandler=Ph,L.DragPanHandler=dt,L.DragRotateHandler=xt,L.EdgeInsets=Jr,L.FullscreenControl=class extends f.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var t;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=a?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:f.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ae.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Ae.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=Ae.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Ae.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new f.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new f.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},L.GeoJSONSource=Gn,L.GeolocateControl=class extends f.E{constructor(m){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new f.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new f.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new f.V(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,h=this._map.getBearing(),_=f.e({bearing:h},this.options.fitBoundsOptions),v=tn.fromLngLat(a,l);this._map.fitBounds(v,_,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new f.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Bs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new f.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=Ae.create("button","maplibregl-ctrl-geolocate",this._container),Ae.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){f.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ae.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new qu({element:this._dotElement}),this._circleElement=Ae.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new qu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const l=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new f.l("trackuserlocationend")),this.fire(new f.l("userlocationlostfocus")))}))}},this.options=f.e({},Zu,m)}onAdd(m){return this._map=m,this._container=Ae.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return f._(this,arguments,void 0,(function*(t=!1){if(ka!==void 0&&!t)return ka;if(window.navigator.permissions===void 0)return ka=!!window.navigator.geolocation,ka;try{ka=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ka=!!window.navigator.geolocation}return ka}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Ae.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Os=0,Bs=!1}_isOutOfMapMaxBounds(m){const t=this._map.getMaxBounds(),a=m.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const m=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&m))return;const t=this._map.project(m),a=this._map.unproject([t.x+100,t.y]),l=m.distanceTo(a)/100,h=2*this._accuracy/l;this._circleElement.style.width=`${h.toFixed(2)}px`,this._circleElement.style.height=`${h.toFixed(2)}px`}trigger(){if(!this._setup)return f.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Os--,Bs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new f.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.l("trackuserlocationstart")),this.fire(new f.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Os++,Os>1?(m={maximumAge:6e5,timeout:0},Bs=!0):(m=this.options.positionOptions,Bs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},L.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const t=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=Ae.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Ae.create("button","maplibregl-ctrl-globe",this._container),Ae.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Ae.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},L.Hash=$i,L.ImageSource=Br,L.KeyboardHandler=Zo,L.LngLatBounds=tn,L.LogoControl=Ps,L.Map=class extends vo{constructor(m){var t,a;f.cH.mark(f.cI.create);const l=Object.assign(Object.assign(Object.assign({},Ls),m),{canvasContextAttributes:Object.assign(Object.assign({},Ls.canvasContextAttributes),m.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const h=new Sn,_=new Ro;if(l.minZoom!==void 0&&h.setMinZoom(l.minZoom),l.maxZoom!==void 0&&h.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&h.setMinPitch(l.minPitch),l.maxPitch!==void 0&&h.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&h.setRenderWorldCopies(l.renderWorldCopies),l.transformConstrain!==null&&h.setConstrainOverride(l.transformConstrain),super(h,_,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new hi,this._controls=[],this._mapId=f.ah(),this._lostContextStyle={style:null,images:null},this._contextLost=w=>{w.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const S of Object.values(this.style._layers))if(S.type==="custom"&&console.warn(`Custom layer with id '${S.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),S._listeners)for(const[A]of Object.entries(S._listeners))console.warn(`Custom layer with id '${S.id}' had event listeners for event '${A}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new f.l("webglcontextlost",{originalEvent:w}))},this._contextRestored=w=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new f.l("webglcontextrestored",{originalEvent:w}))},this._onMapScroll=w=>{if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},jl),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this._zoomLevelsToOverscale=l.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=l.transformCameraUpdate,this.transformConstrain=l.transformConstrain,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,l.reduceMotion!==void 0&&(Mt.prefersReducedMotion=l.reduceMotion),this._imageQueueHandle=Lt.addThrottleControl((()=>this.isMoving())),this._requestManager=new Bn(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let w=!1;const S=zh((A=>{this._trackResize&&!this._removed&&(this.resize(A),this.redraw())}),50);this._resizeObserver=new ResizeObserver((A=>{w?S(A):w=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Ih(this,l),this._hash=l.hash&&new $i(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,f.e({},l.fitBoundsOptions,{duration:0}))));const v=typeof l.style=="string"||((a=(t=l.style)===null||t===void 0?void 0:t.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,v),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new pn(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new Ps,l.logoPosition),this.on("style.load",(()=>{if(v||this._resizeTransform(),this.transform.unmodified){const w=f.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(w)}})),this.on("data",(w=>{this._update(w.dataType==="style"),this.fire(new f.l(`${w.dataType}data`,w))})),this.on("dataloading",(w=>{this.fire(new f.l(`${w.dataType}dataloading`,w))})),this.on("dataabort",(w=>{this.fire(new f.l("sourcedataabort",w))}))}_getMapId(){return this._mapId}setGlobalStateProperty(m,t){return this.style.setGlobalStateProperty(m,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,t){if(t===void 0&&(t=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new f.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=m.onAdd(this);this._controls.push(m);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(a,l.firstChild):l.appendChild(a),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new f.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(m);return t>-1&&this._controls.splice(t,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}coveringTiles(m){return hn(this.transform,m)}calculateCameraOptionsFromTo(m,t,a,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLat(a)),super.calculateCameraOptionsFromTo(m,t,a,l)}resize(m,t=!0){const[a,l]=this._containerDimensions(),h=this._getClampedPixelRatio(a,l);if(this._resizeCanvas(a,l,h),this.painter.resize(a,l,h),this.painter.overLimit()){const v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];const w=this._getClampedPixelRatio(a,l);this._resizeCanvas(a,l,w),this.painter.resize(a,l,w)}this._resizeTransform(t);const _=!this._moving;return _&&(this.stop(),this.fire(new f.l("movestart",m)).fire(new f.l("move",m))),this.fire(new f.l("resize",m)),_&&this.fire(new f.l("moveend",m)),this}_resizeTransform(m=!0){var t;const[a,l]=this._containerDimensions();this.transform.resize(a,l,m),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,l,m)}_getClampedPixelRatio(m,t){const{0:a,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),_=m*h,v=t*h;return Math.min(_>a?a/_:1,v>l?l/v:1)*h}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(tn.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}setTransformConstrain(m){return this.transform.setConstrainOverride(m),this._update()}project(m){return this.transform.locationToScreenPoint(f.V.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(f.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,t,a){if(m==="mouseenter"||m==="mouseover"){let l=!1;return{layers:t,listener:a,delegates:{mousemove:_=>{const v=t.filter((S=>this.getLayer(S))),w=v.length!==0?this.queryRenderedFeatures(_.point,{layers:v}):[];w.length?l||(l=!0,a.call(this,new Vr(m,this,_.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(m==="mouseleave"||m==="mouseout"){let l=!1;return{layers:t,listener:a,delegates:{mousemove:v=>{const w=t.filter((S=>this.getLayer(S)));(w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[]).length?l=!0:l&&(l=!1,a.call(this,new Vr(m,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,a.call(this,new Vr(m,this,v.originalEvent)))}}}}{const l=h=>{const _=t.filter((w=>this.getLayer(w))),v=_.length!==0?this.queryRenderedFeatures(h.point,{layers:_}):[];v.length&&(h.features=v,a.call(this,h),delete h.features)};return{layers:t,listener:a,delegates:{[m]:l}}}}_saveDelegatedListener(m,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(t)}_removeDelegatedListener(m,t,a){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const l=this._delegatedListeners[m];for(let h=0;h<l.length;h++){const _=l[h];if(_.listener===a&&_.layers.length===t.length&&_.layers.every((v=>t.includes(v)))){for(const v in _.delegates)this.off(v,_.delegates[v]);return void l.splice(h,1)}}}on(m,t,a){if(a===void 0)return super.on(m,t);const l=typeof t=="string"?[t]:t,h=this._createDelegatedListener(m,l,a);this._saveDelegatedListener(m,h);for(const _ in h.delegates)this.on(_,h.delegates[_]);return{unsubscribe:()=>{this._removeDelegatedListener(m,l,a)}}}once(m,t,a){if(a===void 0)return super.once(m,t);const l=typeof t=="string"?[t]:t,h=this._createDelegatedListener(m,l,a);for(const _ in h.delegates){const v=h.delegates[_];h.delegates[_]=(...w)=>{this._removeDelegatedListener(m,l,a),v(...w)}}this._saveDelegatedListener(m,h);for(const _ in h.delegates)this.once(_,h.delegates[_]);return this}off(m,t,a){return a===void 0?super.off(m,t):(this._removeDelegatedListener(m,typeof t=="string"?[t]:t,a),this)}queryRenderedFeatures(m,t){if(!this.style)return[];let a;const l=m instanceof f.P||Array.isArray(m),h=l?m:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:m)||{},h instanceof f.P||typeof h[0]=="number")a=[f.P.convert(h)];else{const _=f.P.convert(h[0]),v=f.P.convert(h[1]);a=[_,new f.P(v.x,_.y),v,new f.P(_.x,v.y),_]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(m,t){return this.style.querySourceFeatures(m,t)}setStyle(m,t){return(t=f.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(m,t))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const t=this._locale[m];if(t==null)throw new Error(`Missing UI string '${m}'`);return t}_updateStyle(m,t){var a,l;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(m,t)));const h=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new to(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,t,h):this.style.loadJSON(m,t,h),this):((l=(a=this.style)===null||a===void 0?void 0:a.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new to(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,t){if(typeof m=="string"){const a=this._requestManager.transformRequest(m,"Style");f.j(a,new AbortController).then((l=>{this._updateDiff(l.data,t)})).catch((l=>{l&&this.fire(new f.k(l))}))}else typeof m=="object"&&this._updateDiff(m,t)}_updateDiff(m,t){try{this.style.setState(m,t)&&this._update(!0)}catch(a){f.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(m,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():f.w("There is no style added to the map.")}addSource(m,t){return this._lazyInitEmptyStyle(),this.style.addSource(m,t),this._update(!0)}isSourceLoaded(m){const t=this.style&&this.style.tileManagers[m];if(t!==void 0)return t.loaded();this.fire(new f.k(new Error(`There is no tile manager with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const t=this.style.tileManagers[m.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const l=this.style._layers[a];l.type==="hillshade"&&l.source===m.source&&f.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===m.source&&f.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Xi(this.painter,t,m),this.painter.renderToTexture=new Is(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var l;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=a.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new f.l("terrain",{terrain:m})),this}getTerrain(){var m,t;return(t=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const m=this.style&&this.style.tileManagers;for(const t of Object.values(m))if(!t.areTilesLoaded())return!1;return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,t,a){if(a){const l=this.getSource(a);if(!l)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);l.calculateTileZoom=mi(Math.max(1,m),Math.max(1,t))}else for(const l in this.style.tileManagers)this.style.tileManagers[l].getSource().calculateTileZoom=mi(Math.max(1,m),Math.max(1,t));return this._update(!0),this}refreshTiles(m,t){const a=this.style.tileManagers[m];if(!a)throw new Error(`There is no tile manager with ID "${m}", cannot refresh tile`);t===void 0?a.reload(!0):a.refreshTiles(t.map((l=>new f.ae(l.z,l.x,l.y))))}addImage(m,t,a={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:_,stretchY:v,content:w,textFitWidth:S,textFitHeight:A}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||f.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new f.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:R,data:I}=t,F=t;return this.style.addImage(m,{data:new f.R({width:z,height:R},new Uint8Array(I)),pixelRatio:l,stretchX:_,stretchY:v,content:w,textFitWidth:S,textFitHeight:A,sdf:h,version:0,userImage:F}),F.onAdd&&F.onAdd(this,m),this}}{const{width:z,height:R,data:I}=Mt.getImageData(t);this.style.addImage(m,{data:new f.R({width:z,height:R},I),pixelRatio:l,stretchX:_,stretchY:v,content:w,textFitWidth:S,textFitHeight:A,sdf:h,version:0})}}updateImage(m,t){const a=this.style.getImage(m);if(!a)return this.fire(new f.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||f.b(t)?Mt.getImageData(t):t,{width:h,height:_,data:v}=l;if(h===void 0||_===void 0)return this.fire(new f.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==a.data.width||_!==a.data.height)return this.fire(new f.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(t instanceof HTMLImageElement||f.b(t));return a.data.replace(v,w),this.style.updateImage(m,a),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new f.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return Lt.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,t){return this._lazyInitEmptyStyle(),this.style.addLayer(m,t),this._update(!0)}moveLayer(m,t){return this.style.moveLayer(m,t),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,t,a){return this.style.setLayerZoomRange(m,t,a),this._update(!0)}setFilter(m,t,a={}){return this.style.setFilter(m,t,a),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,t,a,l={}){return this.style.setPaintProperty(m,t,a,l),this._update(!0)}getPaintProperty(m,t){return this.style.getPaintProperty(m,t)}setLayoutProperty(m,t,a,l={}){return this.style.setLayoutProperty(m,t,a,l),this._update(!0)}getLayoutProperty(m,t){return this.style.getLayoutProperty(m,t)}setGlyphs(m,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,t,a,(l=>{l||this._update(!0)})),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,t,(a=>{a||this._update(!0)})),this}setLight(m,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,t){return this.style.setFeatureState(m,t),this._update()}removeFeatureState(m,t){return this.style.removeFeatureState(m,t),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,t=0;return this._container&&(m=this._container.clientWidth||400,t=this._container.clientHeight||300),[m,t]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const t=this._canvasContainer=Ae.create("div","maplibregl-canvas-container",m);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=Ae.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),l=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],l);const h=this._controlContainer=Ae.create("div","maplibregl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((v=>{_[v]=Ae.create("div",`maplibregl-ctrl-${v} `,h)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,t,a){this._canvas.width=Math.floor(a*m),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{t={requestedAttributes:m},l&&(t.statusMessage=l.statusMessage,t.type=l.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!a){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new Vf(a,this.transform),Ji.testSupport(a)}migrateProjection(m,t){super.migrateProjection(m,t),this.painter.transform=m,this.fire(new f.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var t,a,l,h,_;const v=this._idleTriggered?this._fadeDuration:0,w=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let S=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,I=Et();this.style.zoomHistory.update(R,I);const F=new f.H(R,{now:I,fadeDuration:v,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),U=F.crossFadingFactor();U===1&&U===this._crossFadingFactor||(S=!0,this._crossFadingFactor=U),this.style.update(F)}const A=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==w;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(_=this.style.projection)===null||_===void 0?void 0:_.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||A)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,A),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,showPadding:this.showPadding}),this.fire(new f.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,f.cH.mark(f.cI.load),this.fire(new f.l("load"))),this.style&&(this.style.hasTransitions()||S)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const z=this._sourcesDirty||this._styleDirty||this._placementDirty;return z||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new f.l("idle")),!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,f.cH.mark(f.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Lt.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Ae.remove(this._canvasContainer),Ae.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),f.cH.clearMetrics(),this._removed=!0,this.fire(new f.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Mt.frame(this._frameRequest,(m=>{f.cH.frame(m),this._frameRequest=null;try{this._render(m)}catch(t){if(!f.Z(t)&&!(function(a){return a.message===uo})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Rs}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},L.MapMouseEvent=Vr,L.MapTouchEvent=Oa,L.MapWheelEvent=Bu,L.Marker=qu,L.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,a)=>{const l=this._map._getUIString(`NavigationControl.${a}`);t.title=l,t.setAttribute("aria-label",l)},this.options=f.e({},Rh,m),this._container=Ae.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),Ae.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),Ae.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=Ae.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yi(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Ae.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,t){const a=Ae.create("button",m,this._container);return a.type="button",a.addEventListener("click",t),a}},L.Popup=class extends f.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Ae.remove(this._content),this._container&&(Ae.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new f.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Ae.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Ae.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Ul(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const h=Zl(this.options.offset);if(!l){const v=this._container.offsetWidth,w=this._container.offsetHeight;let S;S=a.y+h.bottom.y<w?["top"]:a.y>this._map.transform.height-w?["bottom"]:[],a.x<v/2?S.push("left"):a.x>this._map.transform.width-v/2&&S.push("right"),l=S.length===0?"bottom":S.join("-")}let _=a.add(h[l]);this.options.subpixelPositioning||(_=_.round()),Ae.setTransform(this._container,`${Gl[l]} translate(${_.x}px,${_.y}px)`),Gu(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=f.e(Object.create(Yo),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new f.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=f.V.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const t=document.createDocumentFragment(),a=document.createElement("body");let l;for(a.innerHTML=m;l=a.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Ae.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=Ae.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(ql);m&&m.focus()}},L.RasterDEMTileSource=$a,L.RasterTileSource=$s,L.ScaleControl=class{constructor(m){this._onMove=()=>{Vi(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Vi(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},rr),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=Ae.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Ae.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},L.ScrollZoomHandler=Lc,L.Style=to,L.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=Ae.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Ae.create("button","maplibregl-ctrl-terrain",this._container),Ae.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Ae.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},L.TwoFingersTouchPitchHandler=Ds,L.TwoFingersTouchRotateHandler=Ba,L.TwoFingersTouchZoomHandler=zs,L.TwoFingersTouchZoomRotateHandler=yo,L.VectorTileSource=ys,L.VideoSource=ye,L.addSourceType=(m,t)=>f._(void 0,void 0,void 0,(function*(){if(H(m))throw new Error(`A source type called "${m}" already exists.`);((a,l)=>{V[a]=l})(m,t)})),L.clearPrewarmedResources=function(){const m=$t;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(gt),$t=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},L.createTileMesh=Af,L.getMaxParallelImageRequests=function(){return f.c.MAX_PARALLEL_IMAGE_REQUESTS},L.getRTLTextPluginStatus=function(){return ge().getRTLTextPluginStatus()},L.getVersion=function(){return Fa},L.getWorkerCount=function(){return Tt.workerCount},L.getWorkerUrl=function(){return f.c.WORKER_URL},L.importScriptInWorkers=function(m){return Hs().broadcast("IS",m)},L.isTimeFrozen=function(){return Kt.isFrozen()},L.now=Et,L.prewarm=function(){Ri().acquire(gt)},L.restoreNow=function(){Kt.restoreNow()},L.setMaxParallelImageRequests=function(m){f.c.MAX_PARALLEL_IMAGE_REQUESTS=m},L.setNow=function(m){Kt.setNow(m)},L.setRTLTextPlugin=function(m,t){return ge().setRTLTextPlugin(m,t)},L.setWorkerCount=function(m){Tt.workerCount=m},L.setWorkerUrl=function(m){f.c.WORKER_URL=m}}));var Xe=Le;return Xe}))})(Gm)),Gm.exports}var Z_=q_();const s_=T_(Z_),o_=er.createContext(null);function zg(){return er.useContext(o_)}function H_({children:ce,className:Ie}){const Le=er.useRef(null),[oe,Fe]=er.useState(null);return er.useEffect(()=>{if(oe||!Le.current)return;const Xe=new s_.Map({container:Le.current,style:N_,attributionControl:!1});Xe.on("load",()=>Fe(Xe))},[oe]),Yr.jsxs(o_,{value:oe,children:[Yr.jsx("div",{ref:Le,className:Ie}),ce]})}const $_="_marker_bh8ju_1",X_={marker:$_};function Y_({coordinate:ce,onChange:Ie}){const Le=zg(),oe=er.useRef(null);return er.useEffect(()=>{if(!Le)return;const Fe=new s_.Marker({color:"blue",draggable:!0,className:X_.marker}).setLngLat({lat:ce.lat,lng:ce.lng}).addTo(Le);Fe.on("dragend",()=>{const{lat:Xe,lng:L}=Fe.getLngLat();Ie({lat:Xe,lng:L})}),Le.on("click",Xe=>{if(!Xe.originalEvent.ctrlKey||Xe.defaultPrevented)return;Xe.preventDefault();const{lng:L,lat:f}=Xe.lngLat;Ie({lat:f,lng:L})}),oe.current=Fe},[Le]),er.useEffect(()=>{if(!oe.current)return;const{lat:Fe,lng:Xe}=ce;oe.current.setLngLat({lat:Fe,lng:Xe})},[ce]),null}var Zs=63710088e-1,l_={centimeters:Zs*100,centimetres:Zs*100,degrees:360/(2*Math.PI),feet:Zs*3.28084,inches:Zs*39.37,kilometers:Zs/1e3,kilometres:Zs/1e3,meters:Zs,metres:Zs,miles:Zs/1609.344,millimeters:Zs*1e3,millimetres:Zs*1e3,nauticalmiles:Zs/1852,radians:1,yards:Zs*1.0936};function Zp(ce,Ie,Le={}){const oe={type:"Feature"};return(Le.id===0||Le.id)&&(oe.id=Le.id),Le.bbox&&(oe.bbox=Le.bbox),oe.properties=Ie||{},oe.geometry=ce,oe}function ml(ce,Ie,Le={}){if(!ce)throw new Error("coordinates is required");if(!Array.isArray(ce))throw new Error("coordinates must be an Array");if(ce.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Wg(ce[0])||!Wg(ce[1]))throw new Error("coordinates must contain numbers");return Zp({type:"Point",coordinates:ce},Ie,Le)}function Hm(ce,Ie,Le={}){for(const Fe of ce){if(Fe.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(Fe[Fe.length-1].length!==Fe[0].length)throw new Error("First and last Position are not equivalent.");for(let Xe=0;Xe<Fe[Fe.length-1].length;Xe++)if(Fe[Fe.length-1][Xe]!==Fe[0][Xe])throw new Error("First and last Position are not equivalent.")}return Zp({type:"Polygon",coordinates:ce},Ie,Le)}function Q_(ce,Ie,Le={}){if(ce.length<2)throw new Error("coordinates must be an array of two or more positions");return Zp({type:"LineString",coordinates:ce},Ie,Le)}function W_(ce,Ie="kilometers"){const Le=l_[Ie];if(!Le)throw new Error(Ie+" units is invalid");return ce*Le}function K_(ce,Ie="kilometers"){const Le=l_[Ie];if(!Le)throw new Error(Ie+" units is invalid");return ce/Le}function Zm(ce){return ce%(2*Math.PI)*180/Math.PI}function oc(ce){return ce%360*Math.PI/180}function Wg(ce){return!isNaN(ce)&&ce!==null&&!Array.isArray(ce)}function Ld(ce){if(!ce)throw new Error("coord is required");if(!Array.isArray(ce)){if(ce.type==="Feature"&&ce.geometry!==null&&ce.geometry.type==="Point")return[...ce.geometry.coordinates];if(ce.type==="Point")return[...ce.coordinates]}if(Array.isArray(ce)&&ce.length>=2&&!Array.isArray(ce[0])&&!Array.isArray(ce[1]))return[...ce];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function J_(ce){if(Array.isArray(ce))return ce;if(ce.type==="Feature"){if(ce.geometry!==null)return ce.geometry.coordinates}else if(ce.coordinates)return ce.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ey(ce,Ie,Le,oe={}){const Fe=Ld(ce),Xe=oc(Fe[0]),L=oc(Fe[1]),f=oc(Le),me=K_(Ie,oe.units),we=Math.asin(Math.sin(L)*Math.cos(me)+Math.cos(L)*Math.sin(me)*Math.cos(f)),st=Xe+Math.atan2(Math.sin(f)*Math.sin(me)*Math.cos(L),Math.cos(me)-Math.sin(L)*Math.sin(we)),it=Zm(st),St=Zm(we);return Fe[2]!==void 0?ml([it,St,Fe[2]],oe.properties):ml([it,St],oe.properties)}function qm(ce,Ie,Le={}){var oe=Ld(ce),Fe=Ld(Ie),Xe=oc(Fe[1]-oe[1]),L=oc(Fe[0]-oe[0]),f=oc(oe[1]),me=oc(Fe[1]),we=Math.pow(Math.sin(Xe/2),2)+Math.pow(Math.sin(L/2),2)*Math.cos(f)*Math.cos(me);return W_(2*Math.atan2(Math.sqrt(we),Math.sqrt(1-we)),Le.units)}function ty(ce,Ie){var Le,oe,Fe,Xe,L,f,me,we,st,it,St=0,Mt=ce.type==="FeatureCollection",Kt=ce.type==="Feature",Et=Mt?ce.features.length:1;for(Le=0;Le<Et;Le++){for(f=Mt?ce.features[Le].geometry:Kt?ce.geometry:ce,we=Mt?ce.features[Le].properties:Kt?ce.properties:{},st=Mt?ce.features[Le].bbox:Kt?ce.bbox:void 0,it=Mt?ce.features[Le].id:Kt?ce.id:void 0,me=f?f.type==="GeometryCollection":!1,L=me?f.geometries.length:1,Fe=0;Fe<L;Fe++){if(Xe=me?f.geometries[Fe]:f,Xe===null){if(Ie(null,St,we,st,it)===!1)return!1;continue}switch(Xe.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(Ie(Xe,St,we,st,it)===!1)return!1;break}case"GeometryCollection":{for(oe=0;oe<Xe.geometries.length;oe++)if(Ie(Xe.geometries[oe],St,we,st,it)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}St++}}function iy(ce,Ie){ty(ce,function(Le,oe,Fe,Xe,L){var f=Le===null?null:Le.type;switch(f){case null:case"Point":case"LineString":case"Polygon":return Ie(Zp(Le,Fe,{bbox:Xe,id:L}),oe,0)===!1?!1:void 0}var me;switch(f){case"MultiPoint":me="Point";break;case"MultiLineString":me="LineString";break;case"MultiPolygon":me="Polygon";break}for(var we=0;we<Le.coordinates.length;we++){var st=Le.coordinates[we],it={type:me,coordinates:st};if(Ie(Zp(it,Fe),oe,we)===!1)return!1}})}var ny=Object.defineProperty,ry=Object.defineProperties,ay=Object.getOwnPropertyDescriptors,Kg=Object.getOwnPropertySymbols,sy=Object.prototype.hasOwnProperty,oy=Object.prototype.propertyIsEnumerable,Jg=(ce,Ie,Le)=>Ie in ce?ny(ce,Ie,{enumerable:!0,configurable:!0,writable:!0,value:Le}):ce[Ie]=Le,e_=(ce,Ie)=>{for(var Le in Ie||(Ie={}))sy.call(Ie,Le)&&Jg(ce,Le,Ie[Le]);if(Kg)for(var Le of Kg(Ie))oy.call(Ie,Le)&&Jg(ce,Le,Ie[Le]);return ce},t_=(ce,Ie)=>ry(ce,ay(Ie));function ly(ce,Ie,Le={}){if(!ce||!Ie)throw new Error("lines and pt are required arguments");const oe=Ld(Ie);let Fe=ml([1/0,1/0],{dist:1/0,index:-1,multiFeatureIndex:-1,location:-1}),Xe=0;return iy(ce,function(L,f,me){const we=J_(L);for(let st=0;st<we.length-1;st++){const it=ml(we[st]),St=Ld(it),Mt=ml(we[st+1]),Kt=Ld(Mt),Et=qm(it,Mt,Le);let Ae,Ji;Kt[0]===oe[0]&&Kt[1]===oe[1]?[Ae,Ji]=[Kt,!0]:St[0]===oe[0]&&St[1]===oe[1]?[Ae,Ji]=[St,!1]:[Ae,Ji]=hy(St,Kt,oe);const ni=ml(Ae,{dist:qm(Ie,Ae,Le),multiFeatureIndex:me,location:Xe+qm(it,Ae,Le)});ni.properties.dist<Fe.properties.dist&&(Fe=t_(e_({},ni),{properties:t_(e_({},ni.properties),{index:Ji?st+1:st})})),Xe+=Et}}),Fe}function wf(ce,Ie){const[Le,oe,Fe]=ce,[Xe,L,f]=Ie;return Le*Xe+oe*L+Fe*f}function qp(ce,Ie){const[Le,oe,Fe]=ce,[Xe,L,f]=Ie;return[oe*f-Fe*L,Fe*Xe-Le*f,Le*L-oe*Xe]}function uy(ce){return Math.sqrt(Math.pow(ce[0],2)+Math.pow(ce[1],2)+Math.pow(ce[2],2))}function i_(ce){const Ie=uy(ce);return[ce[0]/Ie,ce[1]/Ie,ce[2]/Ie]}function Ag(ce){const Ie=oc(ce[1]),Le=oc(ce[0]);return[Math.cos(Ie)*Math.cos(Le),Math.cos(Ie)*Math.sin(Le),Math.sin(Ie)]}function cy(ce){const[Ie,Le,oe]=ce,Fe=Math.min(Math.max(oe,-1),1),Xe=Zm(Math.asin(Fe));return[Zm(Math.atan2(Le,Ie)),Xe]}function hy(ce,Ie,Le){const oe=Ag(ce),Fe=Ag(Ie),Xe=Ag(Le),L=qp(oe,Fe);if(L[0]===0&&L[1]===0&&L[2]===0)return wf(oe,Fe)>0?[[...Ie],!0]:[[...Le],!1];const f=qp(L,Xe);if(f[0]===0&&f[1]===0&&f[2]===0)return[[...Ie],!0];const me=qp(f,L),we=i_(me),st=[-we[0],-we[1],-we[2]],it=wf(Xe,we)>wf(Xe,st)?we:st,St=i_(L),Mt=wf(qp(oe,it),St),Kt=wf(qp(it,Fe),St);return Mt>=0&&Kt>=0?[cy(it),!1]:wf(oe,Xe)>wf(Fe,Xe)?[[...ce],!1]:[[...Ie],!0]}function u_(ce){let Ie,Le;const oe={type:"FeatureCollection",features:[]};if(ce.type==="Feature"?Le=ce.geometry:Le=ce,Le.type==="LineString")Ie=[Le.coordinates];else if(Le.type==="MultiLineString")Ie=Le.coordinates;else if(Le.type==="MultiPolygon")Ie=[].concat(...Le.coordinates);else if(Le.type==="Polygon")Ie=Le.coordinates;else throw new Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");return Ie.forEach(Fe=>{Ie.forEach(Xe=>{for(let L=0;L<Fe.length-1;L++)for(let f=L;f<Xe.length-1;f++){if(Fe===Xe&&(Math.abs(L-f)===1||L===0&&f===Fe.length-2&&Fe[L][0]===Fe[Fe.length-1][0]&&Fe[L][1]===Fe[Fe.length-1][1]))continue;const me=fy(Fe[L][0],Fe[L][1],Fe[L+1][0],Fe[L+1][1],Xe[f][0],Xe[f][1],Xe[f+1][0],Xe[f+1][1]);me&&oe.features.push(ml([me[0],me[1]]))}})}),oe}function fy(ce,Ie,Le,oe,Fe,Xe,L,f){let me,we,st,it,St;const Mt={x:null,y:null,onLine1:!1,onLine2:!1};return me=(f-Xe)*(Le-ce)-(L-Fe)*(oe-Ie),me===0?Mt.x!==null&&Mt.y!==null?Mt:!1:(we=Ie-Xe,st=ce-Fe,it=(L-Fe)*we-(f-Xe)*st,St=(Le-ce)*we-(oe-Ie)*st,we=it/me,st=St/me,Mt.x=ce+we*(Le-ce),Mt.y=Ie+we*(oe-Ie),we>=0&&we<=1&&(Mt.onLine1=!0),st>=0&&st<=1&&(Mt.onLine2=!0),Mt.onLine1&&Mt.onLine2?[Mt.x,Mt.y]:!1)}const Rd={fillColor:"#f00",fillOpacity:.4,lineColor:"#f00",lineWidth:2,circleRadius:5,circleColor:"#00aaff"},za={main:"polygon",nodes:"polygon-nodes"};function dy({polygon:ce}){const Ie=zg();return er.useEffect(()=>{if(!Ie)return;const Le=Ie.getSource(za.main);if(Le){const oe=ce.geometry.coordinates[0],Fe=[ce,...oe.slice(0,-1).map((Xe,L)=>ml(Xe,{index:L}))];Le.setData({type:"FeatureCollection",features:Fe})}else Ie.addSource(za.main,{type:"geojson",data:ce}),Ie.addLayer({id:"polygon-fill",type:"fill",source:za.main,paint:{"fill-color":Rd.fillColor,"fill-opacity":Rd.fillOpacity}}),Ie.addLayer({id:"polygon-line",type:"line",source:za.main,paint:{"line-color":Rd.lineColor,"line-width":Rd.lineWidth}}),Ie.addLayer({id:za.nodes,type:"circle",source:za.main,paint:{"circle-color":Rd.circleColor,"circle-radius":Rd.circleRadius}})},[Ie,ce]),null}function py(ce){const Ie=er.useRef(null),Le=er.useCallback(Xe=>{if(Xe.preventDefault(),!Xe.features?.[0])return;const L=Xe.features[0].properties.index;Ie.current=L},[]),oe=er.useCallback(Xe=>{const L=Ie.current;if(L===null)return;const{lng:f,lat:me}=Xe.lngLat;ce(we=>{const it=[...we.geometry.coordinates[0]];it[L]=[f,me],L===0&&(it[it.length-1]=[f,me]);const St=Hm([it]);return u_(St).features.length>0?we:St})},[]),Fe=er.useCallback(()=>{Ie.current=null},[]);return{onMouseDown:Le,onMouseMove:oe,onMouseUp:Fe}}function my({onChange:ce,map:Ie,event:Le}){const oe=Ie.queryRenderedFeatures(Le.point,{layers:[za.nodes]});oe.length&&ce(Fe=>{const Xe=oe[0].properties.index,L=Fe.geometry.coordinates[0];if(L.length<=4)return Fe;const f=L.filter((me,we)=>we!==Xe);return Xe===0&&(f[f.length-1]=f[0]),Hm([f])})}const n_=20;function gy({event:ce,map:Ie,onChange:Le}){if(ce.defaultPrevented||Ie.queryRenderedFeatures(ce.point,{layers:[za.nodes]}).length)return;const Fe=[ce.lngLat.lng,ce.lngLat.lat];Le(Xe=>{const L=Xe.geometry.coordinates[0];if(!L.length)return Xe;if(L.length>n_)return alert(` : ${n_}`),Xe;let f=1/0,me=null;for(let we=0;we<L.length-1;we++){const st=Q_([L[we],L[we+1]]),it=ly(st,ml(Fe)),St=qm(it,ml(Fe));St<f&&(f=St,me=we)}if(me!==null){const we=L.slice(0,-1);we.splice(me+1,0,Fe);const st=[...we,we[0]],it=Hm([st]);if(!u_(it).features.length)return it}return alert("      "),Xe})}function _y(ce){const Fe=[0,90,180,270],Xe=ce.getCenter(),L=ce.getZoom(),f=Math.max(5,4e3/Math.pow(2,L-10)),me=ml([Xe.lng,Xe.lat]),[we,st,it,St]=Fe.map(Et=>ey(me,f/2,Et,{units:"meters"})),Mt=[St.geometry.coordinates[0],we.geometry.coordinates[1]],Kt=[Mt,[st.geometry.coordinates[0],we.geometry.coordinates[1]],[st.geometry.coordinates[0],it.geometry.coordinates[1]],Mt];return Hm([Kt])}const yy="_container_139pb_1",vy={container:yy};function xy({onChange:ce}){const Ie=zg(),{onMouseDown:Le,onMouseMove:oe,onMouseUp:Fe}=py(ce);er.useEffect(()=>{if(!Ie)return;const f=it=>gy({onChange:ce,map:Ie,event:it}),me=it=>my({onChange:ce,map:Ie,event:it}),we=()=>Ie.getCanvas().style.cursor="pointer",st=()=>Ie.getCanvas().style.cursor="";return Ie.on("mousedown",za.nodes,Le),Ie.on("click",za.nodes,me),Ie.on("mousemove",oe),Ie.on("mouseup",Fe),Ie.on("click",f),Ie.on("mouseenter",za.nodes,we),Ie.on("mouseleave",za.nodes,st),()=>{Ie.off("mousedown",za.nodes,Le),Ie.off("click",za.nodes,f),Ie.off("mousemove",oe),Ie.off("mouseup",Fe),Ie.off("click",f),Ie.off("mouseenter",za.nodes,we),Ie.off("mouseleave",za.nodes,st)}},[Ie,ce]);const Xe=er.useCallback(()=>{ce(_y(Ie))},[ce,Ie]),L=er.useCallback(()=>{ce(f=>({type:f.type,properties:f.properties,geometry:{type:f.geometry.type,coordinates:[[]]}}))},[]);return Yr.jsxs("div",{className:vy.container,children:[Yr.jsx("button",{onClick:Xe,children:" "}),Yr.jsx("button",{onClick:L,children:" "})]})}function by(){const[ce,Ie]=er.useState({lat:0,lng:0}),[Le,oe]=er.useState({type:"Feature",geometry:{type:"Polygon",coordinates:[[]]},properties:{}}),Fe=er.useCallback(()=>{const Xe=Le.geometry.coordinates[0];if(Xe.length){const L=U_(ce,Xe)?"     ":"    ";alert(L);return}alert("  ")},[Le,ce]);return Yr.jsxs("div",{children:[Yr.jsx(j_,{onChange:Ie}),Yr.jsxs(H_,{className:"map",children:[Yr.jsx(Y_,{coordinate:ce,onChange:Ie}),Yr.jsx(dy,{polygon:Le}),Yr.jsx(xy,{geojson:Le,onChange:oe})]}),Yr.jsx("button",{onClick:Fe,className:"checkBtn",children:""})]})}R_.createRoot(document.getElementById("root")).render(Yr.jsx(er.StrictMode,{children:Yr.jsx(by,{})}));
